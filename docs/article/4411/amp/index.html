<!DOCTYPE html>
<html amp lang="en-US">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
	<script type="application/ld+json" class="yoast-schema-graph yoast-schema-graph--main">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://uzzz.org/#website","url":"https://uzzz.org/","name":"\u6709\u7ec4\u7ec7\u5728!","potentialAction":{"@type":"SearchAction","target":"https://uzzz.org/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://uzzz.org/article/4411/#primaryimage","url":"https://profile.csdnimg.cn/B/E/4/3_kezhen"},{"@type":"WebPage","@id":"https://uzzz.org/article/4411/#webpage","url":"https://uzzz.org/article/4411/","inLanguage":"en-US","name":"Scrapy: Run Using TOR and Multiple Agents - \u6709\u7ec4\u7ec7\u5728!","isPartOf":{"@id":"https://uzzz.org/#website"},"primaryImageOfPage":{"@id":"https://uzzz.org/article/4411/#primaryimage"},"datePublished":"2015-04-08T08:24:36+00:00","dateModified":"2015-04-08T08:24:36+00:00","author":{"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f"}},{"@type":["Person"],"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f","name":"fandyvon","sameAs":[]}]}</script>
	<title>Scrapy: Run Using TOR and Multiple Agents - 有组织在!</title>
		<link rel="canonical" href="https://uzzz.org/article/4411/">
	<script type="text/javascript" src="https://cdn.ampproject.org/v0.js" async></script>
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
	<style amp-custom>
		/* Generic WP styling */

.alignright {
	float: right;
}

.alignleft {
	float: left;
}

.aligncenter {
	display: block;
	text-align: center;
	margin-left: auto;
	margin-right: auto;
}

.amp-wp-enforced-sizes {
	/** Our sizes fallback is 100vw, and we have a padding on the container; the max-width here prevents the element from overflowing. **/
	max-width: 100%;
	margin: 0 auto;
}


/*
 * Prevent cases of amp-img converted from img to appear with stretching by using object-fit to scale.
 * See <https://github.com/ampproject/amphtml/issues/21371#issuecomment-475443219>.
 * Also use object-fit:contain in worst case scenario when we can't figure out dimensions for an image.
 * Additionally, in side of \AMP_Img_Sanitizer::determine_dimensions() it could $amp_img->setAttribute( 'object-fit', 'contain' )
 * so that the following rules wouldn't be needed.
 */
amp-img.amp-wp-enforced-sizes[layout="intrinsic"] > img,
amp-anim.amp-wp-enforced-sizes[layout="intrinsic"] > img {
	object-fit: contain;
}

amp-fit-text blockquote,
amp-fit-text h1,
amp-fit-text h2,
amp-fit-text h3,
amp-fit-text h4,
amp-fit-text h5,
amp-fit-text h6 {
	font-size: inherit;
}

/**
 * Override a style rule in Twenty Sixteen and Twenty Seventeen.
 * It set display:none for audio elements.
 * This selector is the same, though it adds body and uses amp-audio instead of audio.
 */
body amp-audio:not([controls]) {
	display: inline-block;
	height: auto;
}

/*
 * Style the default template messages for submit-success, submit-error, and submitting. These elements are inserted
 * by the form sanitizer when a POST form lacks the action-xhr attribute.
 */
.amp-wp-default-form-message > p {
	margin: 1em 0;
	padding: 0.5em;
}

.amp-wp-default-form-message[submitting] > p,
.amp-wp-default-form-message[submit-success] > p.amp-wp-form-redirecting {
	font-style: italic;
}

.amp-wp-default-form-message[submit-success] > p:not(.amp-wp-form-redirecting) {
	border: solid 1px #008000;
	background-color: #90ee90;
	color: #000;
}

.amp-wp-default-form-message[submit-error] > p {
	border: solid 1px #f00;
	background-color: #ffb6c1;
	color: #000;
}

/* Prevent showing empty success message in the case of an AMP-Redirect-To response header. */
.amp-wp-default-form-message[submit-success] > p:empty {
	display: none;
}

amp-carousel .amp-wp-gallery-caption {
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	text-align: center;
	background-color: rgba(0, 0, 0, 0.5);
	color: #fff;
	padding: 1rem;
}

.wp-block-gallery[data-amp-carousel="true"] {
	display: block;
	flex-wrap: unset;
}

/* Template Styles */

.amp-wp-content,
.amp-wp-title-bar div {
		margin: 0 auto;
	max-width: 840px;
	}

html {
	background: #0a89c0;
}

body {
	background: #fff;
	color: #353535;
	font-family: Georgia, 'Times New Roman', Times, Serif;
	font-weight: 300;
	line-height: 1.75em;
}

p,
ol,
ul,
figure {
	margin: 0 0 1em;
	padding: 0;
}

a,
a:visited {
	color: #0a89c0;
}

a:hover,
a:active,
a:focus {
	color: #353535;
}

/* Quotes */

blockquote {
	color: #353535;
	background: rgba(127,127,127,.125);
	border-left: 2px solid #0a89c0;
	margin: 8px 0 24px 0;
	padding: 16px;
}

blockquote p:last-child {
	margin-bottom: 0;
}

/* UI Fonts */

.amp-wp-meta,
.amp-wp-header div,
.amp-wp-title,
.wp-caption-text,
.amp-wp-tax-category,
.amp-wp-tax-tag,
.amp-wp-comments-link,
.amp-wp-footer p,
.back-to-top {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif;
}

/* Header */

.amp-wp-header {
	background-color: #0a89c0;
}

.amp-wp-header div {
	color: #fff;
	font-size: 1em;
	font-weight: 400;
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: .875em 16px;
	position: relative;
}

.amp-wp-header a {
	color: #fff;
	text-decoration: none;
}


.amp-wp-header .amp-wp-site-icon {
	/** site icon is 32px **/
	background-color: #fff;
	border: 1px solid #fff;
	border-radius: 50%;
	position: absolute;
	right: 18px;
	top: 10px;
}

/* Article */

.amp-wp-article {
	color: #353535;
	font-weight: 400;
	margin: 1.5em auto;
	max-width: 840px;
	overflow-wrap: break-word;
	word-wrap: break-word;
}

/* Article Header */

.amp-wp-article-header {
	align-items: center;
	align-content: stretch;
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
	margin: 1.5em 16px 0;
}

.amp-wp-title {
	color: #353535;
	display: block;
	flex: 1 0 100%;
	font-weight: 900;
	margin: 0 0 .625em;
	width: 100%;
}

/* Article Meta */

.amp-wp-meta {
	color: #696969;
	display: inline-block;
	flex: 2 1 50%;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0 0 1.5em;
	padding: 0;
}

.amp-wp-article-header .amp-wp-meta:last-of-type {
	text-align: right;
}

.amp-wp-article-header .amp-wp-meta:first-of-type {
	text-align: left;
}

.amp-wp-byline amp-img,
.amp-wp-byline .amp-wp-author {
	display: inline-block;
	vertical-align: middle;
}

.amp-wp-byline amp-img {
	border: 1px solid #0a89c0;
	border-radius: 50%;
	position: relative;
	margin-right: 6px;
}

.amp-wp-posted-on {
	text-align: right;
}

/* Featured image */

.amp-wp-article-featured-image {
	margin: 0 0 1em;
}
.amp-wp-article-featured-image amp-img {
	margin: 0 auto;
}
.amp-wp-article-featured-image.wp-caption .wp-caption-text {
	margin: 0 18px;
}

/* Article Content */

.amp-wp-article-content {
	margin: 0 16px;
}

.amp-wp-article-content ul,
.amp-wp-article-content ol {
	margin-left: 1em;
}

.amp-wp-article-content .wp-caption {
	max-width: 100%;
}

.amp-wp-article-content amp-img {
	margin: 0 auto;
}

.amp-wp-article-content amp-img.alignright {
	margin: 0 0 1em 16px;
}

.amp-wp-article-content amp-img.alignleft {
	margin: 0 16px 1em 0;
}

/* Captions */

.wp-caption {
	padding: 0;
}

.wp-caption.alignleft {
	margin-right: 16px;
}

.wp-caption.alignright {
	margin-left: 16px;
}

.wp-caption .wp-caption-text {
	border-bottom: 1px solid #c2c2c2;
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0;
	padding: .66em 10px .75em;
}

/* AMP Media */

.alignwide,
.alignfull {
	clear: both;
}

amp-carousel {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}
amp-iframe,
amp-youtube,
amp-instagram,
amp-vine {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}

.amp-wp-article-content amp-carousel amp-img {
	border: none;
}

amp-carousel > amp-img > img {
	object-fit: contain;
}

.amp-wp-iframe-placeholder {
	background: #c2c2c2 url( https://uzzz.org/wp-content/plugins/amp/assets/images/placeholder-icon.png ) no-repeat center 40%;
	background-size: 48px 48px;
	min-height: 48px;
}

/* Article Footer Meta */

.amp-wp-article-footer .amp-wp-meta {
	display: block;
}

.amp-wp-tax-category,
.amp-wp-tax-tag {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 1.5em 16px;
}

.amp-wp-comments-link {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	text-align: center;
	margin: 2.25em 0 1.5em;
}

.amp-wp-comments-link a {
	border-style: solid;
	border-color: #c2c2c2;
	border-width: 1px 1px 2px;
	border-radius: 4px;
	background-color: transparent;
	color: #0a89c0;
	cursor: pointer;
	display: block;
	font-size: 14px;
	font-weight: 600;
	line-height: 18px;
	margin: 0 auto;
	max-width: 200px;
	padding: 11px 16px;
	text-decoration: none;
	width: 50%;
	-webkit-transition: background-color 0.2s ease;
			transition: background-color 0.2s ease;
}

/* AMP Footer */

.amp-wp-footer {
	border-top: 1px solid #c2c2c2;
	margin: calc(1.5em - 1px) 0 0;
}

.amp-wp-footer div {
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: 1.25em 16px 1.25em;
	position: relative;
}

.amp-wp-footer h2 {
	font-size: 1em;
	line-height: 1.375em;
	margin: 0 0 .5em;
}

.amp-wp-footer p {
	color: #696969;
	font-size: .8em;
	line-height: 1.5em;
	margin: 0 85px 0 0;
}

.amp-wp-footer a {
	text-decoration: none;
}

.back-to-top {
	bottom: 1.275em;
	font-size: .8em;
	font-weight: 600;
	line-height: 2em;
	position: absolute;
	right: 16px;
}
		/* Inline stylesheets */
.htmledit_views{font-family:-apple-system,SF UI Text,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif,SimHei,SimSun}.htmledit_views a>amp-img{padding:1px;margin:1px;border:none;outline:#0782c1 solid 1px}.htmledit_views p{font-size:16px;color:#4d4d4d;font-weight:400;line-height:26px;margin:0 0 16px;overflow-x:auto}.htmledit_views amp-img{max-width:100%;height:auto}.htmledit_views strong,.htmledit_views strong span{font-weight:700}.htmledit_views *{box-sizing:border-box}.htmledit_views ul{margin:0 0 24px;padding:0;font-size:16px}.htmledit_views ul li{list-style-type:disc;margin:8px 0 0 32px}.htmledit_views table tr{border:0;border-top:1px solid #ddd;background-color:#fff}.htmledit_views table{border-collapse:collapse;display:table;width:100%;text-align:left;margin-bottom:24px;margin-left:auto;margin-right:auto}.htmledit_views tbody{border:0}.htmledit_views table tr:nth-child(2n){background-color:#f7f7f7}.htmledit_views table tr td{border:1px solid #ddd;font-size:14px;color:#4f4f4f;line-height:22px;padding:8px;text-align:left}.htmledit_views table tr td p{font-size:14px;color:#4f4f4f;margin:0;padding:0;text-align:left;line-height:22px}.htmledit_views table tr td code{white-space:normal;word-break:break-word}.htmledit_views pre{white-space:pre-wrap;word-wrap:break-word;margin:0 0 24px;overflow-x:auto;padding:8px}.htmledit_views pre{font-family:Consolas,Inconsolata,Courier,monospace;font-size:14px;line-height:22px;color:#000}.htmledit_views pre code,.htmledit_views pre code div,.htmledit_views pre code span{font-family:"Source Code Pro","DejaVu Sans Mono","Ubuntu Mono","Anonymous Pro","Droid Sans Mono",Menlo,Monaco,Consolas,Inconsolata,Courier,monospace,"PingFang SC","Microsoft YaHei",sans-serif}.htmledit_views code{border-radius:4px}.htmledit_views a{color:#4ea1db;text-decoration:none}.htmledit_views a:focus,.htmledit_views a:hover{color:#ca0c16}.htmledit_views a:visited{color:#6795b5}.htmledit_views pre code{display:block;line-height:22px;overflow-x:auto;white-space:pre;word-wrap:normal;border-radius:4px;padding:8px}.htmledit_views pre code:not(.hljs){background-color:#f3f4f5}.htmledit_views pre code,.htmledit_views pre code div,.htmledit_views pre code span{font-size:14px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-4597ae9{color:#d33682}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-4597ae9{font-style:normal;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-582fad9{font-style:normal;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-e248e56{color:#cb4b16}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-e248e56{font-style:normal;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-d4008a2{color:#268bd2}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-d4008a2{font-style:normal;font-weight:bold}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-fa88123{line-height:20px;font-weight:300}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-d4a5bd1{border-collapse:collapse;border-spacing:0px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-b159c5c{font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;font-size:13px;display:block;line-height:20px;color:#cacccd;overflow:auto;border:none}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-794cbe1{font-size:12px;border:0px;display:block}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-794cbe1{font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;color:#cacccd}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-29544e6{color:#268bd2}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-29544e6{font-style:normal;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-92b5d85{color:#cacccd}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-92b5d85{font-style:normal;font-weight:bold}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-61836c1{color:#2aa198}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-61836c1{font-style:normal;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-614ed87{color:#586e75}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-614ed87{font-style:italic;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-830f4ea{color:#cacccd}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-830f4ea{font-style:normal;font-weight:normal}	</style>
</head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="https://uzzz.org/">
										<amp-img src="https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png" width="32" height="32" class="amp-wp-site-icon"></amp-img>
						<span class="amp-site-title">
				有组织在!			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">Scrapy: Run Using TOR and Multiple Agents</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/e786821a74ef0467825a7d60183307bc?s=24&d=mm&r=g" alt="fandyvon" width="24" height="24" layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">fandyvon</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2015-04-08T16:24:36+00:00">
		5 years ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		<p><br>
<br>
<br>
 </p>
<div id="article_content" class="article_content clearfix">
 
 
<div class="htmledit_views" id="content_views">
<p>http://pkmishra.github.io/blog/2013/03/18/how-to-run-scrapy-with-TOR-and-multiple-browser-agents-part-1-mac/</p>

<p><a href="http://scrapy.org/" rel="nofollow">Scrapy</a><span> </span>is a brilliant and well documented crawler written in python. Though it is not as scalable as Apache Nutch but it can easily handle thousands of sites easily. You can get up and running very quickly using the official documentation.<span> </span><a href="https://www.torproject.org/" rel="nofollow">Tor</a><span> </span>gives you power to keep your privacy and security.Tor can hide you so that website can not track your identity. You may read more about TOR in<span> </span><a href="https://www.torproject.org/about/overview.html.en" rel="nofollow">official site</a>. However Tor only works for TCP streams and can be used by any application with SOCKS support.</p>
<p>When we combine Scrapy with Tor, we can have more control over our crawler privacy. We already know that Scrapy can work with proxy server however since Scrapy doesn’t work directly with SOCKS proxy, things can work out if we can introduce a http proxy server as an intermediate between Scrapy and Tor which can also speak to Tor using SOCKS. SOCKS protocol is a lower level protocol than http and it is more transparent in a sense that it doesn’t add extra info like http-header etc. We are going to use a tiny and fast proxy server<span> </span><a href="http://www.pps.univ-paris-diderot.fr/~jch/software/polipo" rel="nofollow">polipo</a>. Polipo can talk to Tor using SOCKS protocol therefore all three together can work to create anonymous crawler. Alright let’s get started.</p>
<ul>
<li class="amp-wp-fa88123">I am going to assume that you have already installed scrapy on your system.</li>
<li class="amp-wp-fa88123">Install Tor as per the instruction from<span> </span><a href="https://www.torproject.org/docs/documentation.html.en" rel="nofollow">official documentation</a>. On my mac I used macport to install Tor.</li>
<li class="amp-wp-fa88123">Start tor</li>
<li class="amp-wp-fa88123">Install polipo using macport.</li>
<li class="amp-wp-fa88123">uncomment following lines in /etc/polipo/config or /opt/local/etc/polipo/config file.<span> </span></li>
</ul>
<p>  <span>build.sbt</span> </p>
<div class="highlight">
<table class="amp-wp-d4a5bd1">
<tbody>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class="line-number amp-wp-da70925">1</span>
<span class="line-number amp-wp-da70925">2</span>
<span class="line-number amp-wp-da70925">3</span>
</pre>
</td>
<td class="code">
<pre class="amp-wp-b159c5c"><code class="sh amp-wp-794cbe1"><span class="line amp-wp-830f4ea"><span class="nv amp-wp-29544e6">socksParentProxy</span> <span class="o amp-wp-92b5d85">=</span> localhost:9050 </span><span class="line amp-wp-830f4ea"><span class="nv amp-wp-29544e6">diskCacheRoot</span><span class="o amp-wp-92b5d85">=</span><span class="s2 amp-wp-61836c1">""</span> </span><span class="line amp-wp-830f4ea"><span class="nv amp-wp-29544e6">disableLocalInterface</span><span class="o amp-wp-92b5d85">=</span><span class="s2 amp-wp-61836c1">""</span> </span></code></pre>
</td>
</tr>
</tbody>
</table></div>
<ul>
<li class="amp-wp-fa88123">start polipo. By default polipo listens on 8123 port and Tor on 9050 port. If you want you may change this port and accordingly adjust settings in config files.</li>
</ul>
<p>Now to verify if everything is working fine + change your broser proxy setting to point to localhost and port 8123. + Visit<span> </span><a href="https://check.torproject.org/" rel="nofollow">this tor check page</a>. This page should give your message that you are using tor correctly depending upon if everything is configured correctly.</p>
<p>Now after basic setup is complete let’s add middleware code in Scrapy to make use of this proxy. + Add a new file called middlewares.py in your project and add following code.<a href="https://gist.github.com/pkmishra/5193452" rel="nofollow">See this Gist</a></p>
<p>  <span>middlewares.py</span> </p>
<div class="highlight">
<table class="amp-wp-d4a5bd1">
<tbody>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class="line-number amp-wp-da70925">1</span>
<span class="line-number amp-wp-da70925">2</span>
<span class="line-number amp-wp-da70925">3</span>
<span class="line-number amp-wp-da70925">4</span>
<span class="line-number amp-wp-da70925">5</span>
<span class="line-number amp-wp-da70925">6</span>
<span class="line-number amp-wp-da70925">7</span>
<span class="line-number amp-wp-da70925">8</span>
<span class="line-number amp-wp-da70925">9</span>
<span class="line-number amp-wp-da70925">10</span>
<span class="line-number amp-wp-da70925">11</span>
<span class="line-number amp-wp-da70925">12</span>
</pre>
</td>
<td class="code">
<pre class="amp-wp-b159c5c"><code class="python amp-wp-794cbe1"><span class="line amp-wp-830f4ea"><span class="kn amp-wp-830f4ea">import</span> <span class="nn amp-wp-582fad9">os</span> </span><span class="line amp-wp-830f4ea"><span class="kn amp-wp-830f4ea">import</span> <span class="nn amp-wp-582fad9">random</span> </span><span class="line amp-wp-830f4ea"><span class="kn amp-wp-830f4ea">from</span> <span class="nn amp-wp-582fad9">scrapy.conf</span> <span class="kn amp-wp-830f4ea">import</span> <span class="n amp-wp-29544e6">settings</span> </span><span class="line amp-wp-830f4ea"><span class="k amp-wp-e248e56">class</span> <span class="nc amp-wp-4597ae9">RandomUserAgentMiddleware</span><span class="p amp-wp-830f4ea">(</span><span class="nb amp-wp-582fad9">object</span><span class="p amp-wp-830f4ea">):</span> </span><span class="line amp-wp-830f4ea"> <span class="k amp-wp-e248e56">def</span> <span class="nf amp-wp-d4008a2">process_request</span><span class="p amp-wp-830f4ea">(</span><span class="bp amp-wp-830f4ea">self</span><span class="p amp-wp-830f4ea">,</span> <span class="n amp-wp-29544e6">request</span><span class="p amp-wp-830f4ea">,</span> <span class="n amp-wp-29544e6">spider</span><span class="p amp-wp-830f4ea">):</span> </span><span class="line amp-wp-830f4ea"> <span class="n amp-wp-29544e6">ua</span> <span class="o amp-wp-92b5d85">=</span> <span class="n amp-wp-29544e6">random</span><span class="o amp-wp-92b5d85">.</span><span class="n amp-wp-29544e6">choice</span><span class="p amp-wp-830f4ea">(</span><span class="n amp-wp-29544e6">settings</span><span class="o amp-wp-92b5d85">.</span><span class="n amp-wp-29544e6">get</span><span class="p amp-wp-830f4ea">(</span><span class="s amp-wp-61836c1">'USER_AGENT_LIST'</span><span class="p amp-wp-830f4ea">))</span> </span><span class="line amp-wp-830f4ea"> <span class="k amp-wp-e248e56">if</span> <span class="n amp-wp-29544e6">ua</span><span class="p amp-wp-830f4ea">:</span> </span><span class="line amp-wp-830f4ea"> <span class="n amp-wp-29544e6">request</span><span class="o amp-wp-92b5d85">.</span><span class="n amp-wp-29544e6">headers</span><span class="o amp-wp-92b5d85">.</span><span class="n amp-wp-29544e6">setdefault</span><span class="p amp-wp-830f4ea">(</span><span class="s amp-wp-61836c1">'User-Agent'</span><span class="p amp-wp-830f4ea">,</span> <span class="n amp-wp-29544e6">ua</span><span class="p amp-wp-830f4ea">)</span> </span><span class="line amp-wp-830f4ea"> </span><span class="line amp-wp-830f4ea"><span class="k amp-wp-e248e56">class</span> <span class="nc amp-wp-4597ae9">ProxyMiddleware</span><span class="p amp-wp-830f4ea">(</span><span class="nb amp-wp-582fad9">object</span><span class="p amp-wp-830f4ea">):</span> </span><span class="line amp-wp-830f4ea"> <span class="k amp-wp-e248e56">def</span> <span class="nf amp-wp-d4008a2">process_request</span><span class="p amp-wp-830f4ea">(</span><span class="bp amp-wp-830f4ea">self</span><span class="p amp-wp-830f4ea">,</span> <span class="n amp-wp-29544e6">request</span><span class="p amp-wp-830f4ea">,</span> <span class="n amp-wp-29544e6">spider</span><span class="p amp-wp-830f4ea">):</span> </span><span class="line amp-wp-830f4ea"> <span class="n amp-wp-29544e6">request</span><span class="o amp-wp-92b5d85">.</span><span class="n amp-wp-29544e6">meta</span><span class="p amp-wp-830f4ea">[</span><span class="s amp-wp-61836c1">'proxy'</span><span class="p amp-wp-830f4ea">]</span> <span class="o amp-wp-92b5d85">=</span> <span class="n amp-wp-29544e6">settings</span><span class="o amp-wp-92b5d85">.</span><span class="n amp-wp-29544e6">get</span><span class="p amp-wp-830f4ea">(</span><span class="s amp-wp-61836c1">'HTTP_PROXY'</span><span class="p amp-wp-830f4ea">)</span> </span></code></pre>
</td>
</tr>
</tbody>
</table></div>
<ul>
<li class="amp-wp-fa88123">In settings.py add the code shown below.<span> </span><a href="https://gist.github.com/pkmishra/5193452" rel="nofollow">See this Gist</a></li>
</ul>
<p>  <span>settings.py</span> </p>
<div class="highlight">
<table class="amp-wp-d4a5bd1">
<tbody>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class="line-number amp-wp-da70925">1</span>
<span class="line-number amp-wp-da70925">2</span>
<span class="line-number amp-wp-da70925">3</span>
<span class="line-number amp-wp-da70925">4</span>
<span class="line-number amp-wp-da70925">5</span>
<span class="line-number amp-wp-da70925">6</span>
<span class="line-number amp-wp-da70925">7</span>
<span class="line-number amp-wp-da70925">8</span>
<span class="line-number amp-wp-da70925">9</span>
<span class="line-number amp-wp-da70925">10</span>
<span class="line-number amp-wp-da70925">11</span>
<span class="line-number amp-wp-da70925">12</span>
<span class="line-number amp-wp-da70925">13</span>
<span class="line-number amp-wp-da70925">14</span>
<span class="line-number amp-wp-da70925">15</span>
<span class="line-number amp-wp-da70925">16</span>
<span class="line-number amp-wp-da70925">17</span>
</pre>
</td>
<td class="code">
<pre class="amp-wp-b159c5c"><code class="python amp-wp-794cbe1"><span class="line amp-wp-830f4ea"><span class="c amp-wp-614ed87">### More comprehensive list can be found at </span> </span><span class="line amp-wp-830f4ea"><span class="c amp-wp-614ed87">### http://techpatterns.com/forums/about304.html</span> </span><span class="line amp-wp-830f4ea"><span class="n amp-wp-29544e6">USER_AGENT_LIST</span> <span class="o amp-wp-92b5d85">=</span> <span class="p amp-wp-830f4ea">[</span> </span><span class="line amp-wp-830f4ea"> <span class="s amp-wp-61836c1">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.7 </span> </span><span class="line amp-wp-830f4ea"> <span class="p amp-wp-830f4ea">(</span><span class="n amp-wp-29544e6">KHTML</span><span class="p amp-wp-830f4ea">,</span> <span class="n amp-wp-29544e6">like</span> <span class="n amp-wp-29544e6">Gecko</span><span class="p amp-wp-830f4ea">)</span> <span class="n amp-wp-29544e6">Chrome</span><span class="o amp-wp-92b5d85">/</span><span class="mf amp-wp-61836c1">16.0</span><span class="o amp-wp-92b5d85">.</span><span class="mf amp-wp-61836c1">912.36</span> <span class="n amp-wp-29544e6">Safari</span><span class="o amp-wp-92b5d85">/</span><span class="mf amp-wp-61836c1">535.7</span><span class="s amp-wp-61836c1">',</span> </span><span class="line amp-wp-830f4ea"> <span class="s amp-wp-61836c1">'Mozilla/5.0 (Windows NT 6.2; Win64; x64; rv:16.0) </span> </span><span class="line amp-wp-830f4ea"> <span class="n amp-wp-29544e6">Gecko</span><span class="o amp-wp-92b5d85">/</span><span class="mf amp-wp-61836c1">16.0</span> <span class="n amp-wp-29544e6">Firefox</span><span class="o amp-wp-92b5d85">/</span><span class="mf amp-wp-61836c1">16.0</span><span class="s amp-wp-61836c1">',</span> </span><span class="line amp-wp-830f4ea"> <span class="s amp-wp-61836c1">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/534.55.3 </span> </span><span class="line amp-wp-830f4ea"> <span class="p amp-wp-830f4ea">(</span><span class="n amp-wp-29544e6">KHTML</span><span class="p amp-wp-830f4ea">,</span> <span class="n amp-wp-29544e6">like</span> <span class="n amp-wp-29544e6">Gecko</span><span class="p amp-wp-830f4ea">)</span> <span class="n amp-wp-29544e6">Version</span><span class="o amp-wp-92b5d85">/</span><span class="mf amp-wp-61836c1">5.1</span><span class="o amp-wp-92b5d85">.</span><span class="mi amp-wp-61836c1">3</span> <span class="n amp-wp-29544e6">Safari</span><span class="o amp-wp-92b5d85">/</span><span class="mf amp-wp-61836c1">534.53</span><span class="o amp-wp-92b5d85">.</span><span class="mi amp-wp-61836c1">10</span><span class="s amp-wp-61836c1">'</span> </span><span class="line amp-wp-830f4ea"><span class="p amp-wp-830f4ea">]</span> </span><span class="line amp-wp-830f4ea"><span class="n amp-wp-29544e6">HTTP_PROXY</span> <span class="o amp-wp-92b5d85">=</span> <span class="s amp-wp-61836c1">'http://127.0.0.1:8123'</span> </span><span class="line amp-wp-830f4ea"><span class="n amp-wp-29544e6">DOWNLOADER_MIDDLEWARES</span> <span class="o amp-wp-92b5d85">=</span> <span class="p amp-wp-830f4ea">{</span> </span><span class="line amp-wp-830f4ea"> <span class="s amp-wp-61836c1">'myproject.middlewares.RandomUserAgentMiddleware'</span><span class="p amp-wp-830f4ea">:</span> <span class="mi amp-wp-61836c1">400</span><span class="p amp-wp-830f4ea">,</span> </span><span class="line amp-wp-830f4ea"> <span class="s amp-wp-61836c1">'myproject.middlewares.ProxyMiddleware'</span><span class="p amp-wp-830f4ea">:</span> <span class="mi amp-wp-61836c1">410</span><span class="p amp-wp-830f4ea">,</span> </span><span class="line amp-wp-830f4ea"> <span class="s amp-wp-61836c1">'scrapy.contrib.downloadermiddleware.useragent.UserAgentMiddleware'</span><span class="p amp-wp-830f4ea">:</span> <span class="bp amp-wp-830f4ea">None</span> </span><span class="line amp-wp-830f4ea"> <span class="c amp-wp-614ed87"># Disable compression middleware, so the actual HTML pages are cached</span> </span><span class="line amp-wp-830f4ea"><span class="p amp-wp-830f4ea">}</span> </span></code></pre>
</td>
</tr>
</tbody>
</table></div>
<p>You are all set to crawl now.<span> </span><strong>Make sure you use the crawler responsibly with sufficient delay and follow the website terms and conditions along with robots.txt rules.</strong></p>
<p>Next time I am going to setup things on ubuntu and accordingly I will update this article. Hope this helps!!!</p>
<p> 
 </p></div>
<div class="more-toolbox">
<div class="left-toolbox">
<ul class="toolbox-list">
<li class="tool-item tool-active is-like "><a><br>
      <svg class="icon" aria-hidden="true"><br>
       <use xlink:href="#csdnc-thumbsup"></use><br>
      </svg><span class="name">点赞</span> <span class="count"></span> </a></li>
<li class="tool-item tool-active is-collection "><a data-report-click='{"mod":"popu_824"}'><br>
      <svg class="icon" aria-hidden="true"><br>
       <use xlink:href="#icon-csdnc-Collection-G"></use><br>
      </svg><span class="name">收藏</span></a></li>
<li class="tool-item tool-active is-share"><a data-report-click='{"mod":"1582594662_002"}'><br>
      <svg class="icon" aria-hidden="true"><br>
       <use xlink:href="#icon-csdnc-fenxiang"></use><br>
      </svg>分享</a></li>
<p>    <br>
     </p>
<li class="tool-item tool-more"> <a><br>
      <svg class="icon" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><br>
       <defs>

<p>       </p></defs>
       <path d="M179.176 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z"></path>
       <path d="M509.684 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z"></path>
       <path d="M846.175 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z"></path>
      </svg> </a> 
<ul class="more-box">
<li class="item"><a class="article-report">文章举报</a></li>
</ul>
</li>
</ul></div>
</div>
<div class="person-messagebox">
<div class="left-message">
   <a href="https://blog.csdn.net/kezhen"> <amp-img src="https://profile.csdnimg.cn/B/E/4/3_kezhen" class="avatar_pic amp-wp-enforced-sizes" width="75" height="75" layout="intrinsic"><noscript><img src="https://profile.csdnimg.cn/B/E/4/3_kezhen" class="avatar_pic" width="75" height="75"></noscript></amp-img> <amp-img src="https://g.csdnimg.cn/static/user-reg-year/1x/12.png" class="user-years amp-wp-enforced-sizes" width="23" height="23" layout="intrinsic"><noscript><img src="https://g.csdnimg.cn/static/user-reg-year/1x/12.png" class="user-years" width="23" height="23"></noscript></amp-img> </a>
  </div>
<div class="middle-message">
<div class="title">
    <span class="tit"><a href="https://blog.csdn.net/kezhen" data-report-click='{"mod":"popu_379"}' target="_blank" rel="noopener noreferrer">kezhen</a></span>
   </div>
<div class="text">
    <span>发布了49 篇原创文章</span> ·<br>
    <span>获赞 26</span> ·<br>
    <span>访问量 66万+</span>
   </div>
</div>
<div class="right-message">
   <a href="https://bbs.csdn.net/topics/395530559" target="_blank" class="btn btn-sm btn-red-hollow bt-button personal-messageboard" rel="noopener noreferrer">他的留言板 </a><br>
   <a class="btn btn-sm  bt-button personal-watch" data-report-click='{"mod":"popu_379"}'>关注</a>
  </div>
</div>
</div>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: Uncategorized	</div>

	<div class="amp-wp-meta amp-wp-tax-tag">
		Tags: <a href="https://uzzz.org/tag/python/" rel="tag">python</a>, <a href="https://uzzz.org/tag/pachong/" rel="tag">爬虫</a>	</div>
	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>有组织在!</h2>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>



</body>
</html>
