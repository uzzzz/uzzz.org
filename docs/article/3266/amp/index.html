<!DOCTYPE html>
<html amp lang="en-US">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
	<script type="application/ld+json" class="yoast-schema-graph yoast-schema-graph--main">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://uzzz.org/#website","url":"https://uzzz.org/","name":"\u6709\u7ec4\u7ec7\u5728!","potentialAction":{"@type":"SearchAction","target":"https://uzzz.org/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://uzzz.org/article/3266/#primaryimage","url":"https://uzshare.com/_p?https://img-blog.csdn.net/20150728132805189?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"},{"@type":"WebPage","@id":"https://uzzz.org/article/3266/#webpage","url":"https://uzzz.org/article/3266/","inLanguage":"en-US","name":"Qt\u5b9e\u6218\u4e4b\u5f00\u53d1\u8f6f\u4ef6\u6570\u636e\u83b7\u53d6\u52a9\u624b - \u6709\u7ec4\u7ec7\u5728!","isPartOf":{"@id":"https://uzzz.org/#website"},"primaryImageOfPage":{"@id":"https://uzzz.org/article/3266/#primaryimage"},"datePublished":"2015-07-28T02:09:15+00:00","dateModified":"2015-07-28T02:09:15+00:00","author":{"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f"}},{"@type":["Person"],"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f","name":"fandyvon","sameAs":[]}]}</script>
	<title>Qt实战之开发软件数据获取助手 - 有组织在!</title>
		<link rel="canonical" href="https://uzzz.org/article/3266/">
	<script type="text/javascript" src="https://cdn.ampproject.org/v0.js" async></script>
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
	<style amp-custom>
		/* Generic WP styling */

.alignright {
	float: right;
}

.alignleft {
	float: left;
}

.aligncenter {
	display: block;
	text-align: center;
	margin-left: auto;
	margin-right: auto;
}

.amp-wp-enforced-sizes {
	/** Our sizes fallback is 100vw, and we have a padding on the container; the max-width here prevents the element from overflowing. **/
	max-width: 100%;
	margin: 0 auto;
}


/*
 * Prevent cases of amp-img converted from img to appear with stretching by using object-fit to scale.
 * See <https://github.com/ampproject/amphtml/issues/21371#issuecomment-475443219>.
 * Also use object-fit:contain in worst case scenario when we can't figure out dimensions for an image.
 * Additionally, in side of \AMP_Img_Sanitizer::determine_dimensions() it could $amp_img->setAttribute( 'object-fit', 'contain' )
 * so that the following rules wouldn't be needed.
 */
amp-img.amp-wp-enforced-sizes[layout="intrinsic"] > img,
amp-anim.amp-wp-enforced-sizes[layout="intrinsic"] > img {
	object-fit: contain;
}

amp-fit-text blockquote,
amp-fit-text h1,
amp-fit-text h2,
amp-fit-text h3,
amp-fit-text h4,
amp-fit-text h5,
amp-fit-text h6 {
	font-size: inherit;
}

/**
 * Override a style rule in Twenty Sixteen and Twenty Seventeen.
 * It set display:none for audio elements.
 * This selector is the same, though it adds body and uses amp-audio instead of audio.
 */
body amp-audio:not([controls]) {
	display: inline-block;
	height: auto;
}

/*
 * Style the default template messages for submit-success, submit-error, and submitting. These elements are inserted
 * by the form sanitizer when a POST form lacks the action-xhr attribute.
 */
.amp-wp-default-form-message > p {
	margin: 1em 0;
	padding: 0.5em;
}

.amp-wp-default-form-message[submitting] > p,
.amp-wp-default-form-message[submit-success] > p.amp-wp-form-redirecting {
	font-style: italic;
}

.amp-wp-default-form-message[submit-success] > p:not(.amp-wp-form-redirecting) {
	border: solid 1px #008000;
	background-color: #90ee90;
	color: #000;
}

.amp-wp-default-form-message[submit-error] > p {
	border: solid 1px #f00;
	background-color: #ffb6c1;
	color: #000;
}

/* Prevent showing empty success message in the case of an AMP-Redirect-To response header. */
.amp-wp-default-form-message[submit-success] > p:empty {
	display: none;
}

amp-carousel .amp-wp-gallery-caption {
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	text-align: center;
	background-color: rgba(0, 0, 0, 0.5);
	color: #fff;
	padding: 1rem;
}

.wp-block-gallery[data-amp-carousel="true"] {
	display: block;
	flex-wrap: unset;
}

/* Template Styles */

.amp-wp-content,
.amp-wp-title-bar div {
		margin: 0 auto;
	max-width: 840px;
	}

html {
	background: #0a89c0;
}

body {
	background: #fff;
	color: #353535;
	font-family: Georgia, 'Times New Roman', Times, Serif;
	font-weight: 300;
	line-height: 1.75em;
}

p,
ol,
ul,
figure {
	margin: 0 0 1em;
	padding: 0;
}

a,
a:visited {
	color: #0a89c0;
}

a:hover,
a:active,
a:focus {
	color: #353535;
}

/* Quotes */

blockquote {
	color: #353535;
	background: rgba(127,127,127,.125);
	border-left: 2px solid #0a89c0;
	margin: 8px 0 24px 0;
	padding: 16px;
}

blockquote p:last-child {
	margin-bottom: 0;
}

/* UI Fonts */

.amp-wp-meta,
.amp-wp-header div,
.amp-wp-title,
.wp-caption-text,
.amp-wp-tax-category,
.amp-wp-tax-tag,
.amp-wp-comments-link,
.amp-wp-footer p,
.back-to-top {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif;
}

/* Header */

.amp-wp-header {
	background-color: #0a89c0;
}

.amp-wp-header div {
	color: #fff;
	font-size: 1em;
	font-weight: 400;
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: .875em 16px;
	position: relative;
}

.amp-wp-header a {
	color: #fff;
	text-decoration: none;
}


.amp-wp-header .amp-wp-site-icon {
	/** site icon is 32px **/
	background-color: #fff;
	border: 1px solid #fff;
	border-radius: 50%;
	position: absolute;
	right: 18px;
	top: 10px;
}

/* Article */

.amp-wp-article {
	color: #353535;
	font-weight: 400;
	margin: 1.5em auto;
	max-width: 840px;
	overflow-wrap: break-word;
	word-wrap: break-word;
}

/* Article Header */

.amp-wp-article-header {
	align-items: center;
	align-content: stretch;
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
	margin: 1.5em 16px 0;
}

.amp-wp-title {
	color: #353535;
	display: block;
	flex: 1 0 100%;
	font-weight: 900;
	margin: 0 0 .625em;
	width: 100%;
}

/* Article Meta */

.amp-wp-meta {
	color: #696969;
	display: inline-block;
	flex: 2 1 50%;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0 0 1.5em;
	padding: 0;
}

.amp-wp-article-header .amp-wp-meta:last-of-type {
	text-align: right;
}

.amp-wp-article-header .amp-wp-meta:first-of-type {
	text-align: left;
}

.amp-wp-byline amp-img,
.amp-wp-byline .amp-wp-author {
	display: inline-block;
	vertical-align: middle;
}

.amp-wp-byline amp-img {
	border: 1px solid #0a89c0;
	border-radius: 50%;
	position: relative;
	margin-right: 6px;
}

.amp-wp-posted-on {
	text-align: right;
}

/* Featured image */

.amp-wp-article-featured-image {
	margin: 0 0 1em;
}
.amp-wp-article-featured-image amp-img {
	margin: 0 auto;
}
.amp-wp-article-featured-image.wp-caption .wp-caption-text {
	margin: 0 18px;
}

/* Article Content */

.amp-wp-article-content {
	margin: 0 16px;
}

.amp-wp-article-content ul,
.amp-wp-article-content ol {
	margin-left: 1em;
}

.amp-wp-article-content .wp-caption {
	max-width: 100%;
}

.amp-wp-article-content amp-img {
	margin: 0 auto;
}

.amp-wp-article-content amp-img.alignright {
	margin: 0 0 1em 16px;
}

.amp-wp-article-content amp-img.alignleft {
	margin: 0 16px 1em 0;
}

/* Captions */

.wp-caption {
	padding: 0;
}

.wp-caption.alignleft {
	margin-right: 16px;
}

.wp-caption.alignright {
	margin-left: 16px;
}

.wp-caption .wp-caption-text {
	border-bottom: 1px solid #c2c2c2;
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0;
	padding: .66em 10px .75em;
}

/* AMP Media */

.alignwide,
.alignfull {
	clear: both;
}

amp-carousel {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}
amp-iframe,
amp-youtube,
amp-instagram,
amp-vine {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}

.amp-wp-article-content amp-carousel amp-img {
	border: none;
}

amp-carousel > amp-img > img {
	object-fit: contain;
}

.amp-wp-iframe-placeholder {
	background: #c2c2c2 url( https://uzzz.org/wp-content/plugins/amp/assets/images/placeholder-icon.png ) no-repeat center 40%;
	background-size: 48px 48px;
	min-height: 48px;
}

/* Article Footer Meta */

.amp-wp-article-footer .amp-wp-meta {
	display: block;
}

.amp-wp-tax-category,
.amp-wp-tax-tag {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 1.5em 16px;
}

.amp-wp-comments-link {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	text-align: center;
	margin: 2.25em 0 1.5em;
}

.amp-wp-comments-link a {
	border-style: solid;
	border-color: #c2c2c2;
	border-width: 1px 1px 2px;
	border-radius: 4px;
	background-color: transparent;
	color: #0a89c0;
	cursor: pointer;
	display: block;
	font-size: 14px;
	font-weight: 600;
	line-height: 18px;
	margin: 0 auto;
	max-width: 200px;
	padding: 11px 16px;
	text-decoration: none;
	width: 50%;
	-webkit-transition: background-color 0.2s ease;
			transition: background-color 0.2s ease;
}

/* AMP Footer */

.amp-wp-footer {
	border-top: 1px solid #c2c2c2;
	margin: calc(1.5em - 1px) 0 0;
}

.amp-wp-footer div {
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: 1.25em 16px 1.25em;
	position: relative;
}

.amp-wp-footer h2 {
	font-size: 1em;
	line-height: 1.375em;
	margin: 0 0 .5em;
}

.amp-wp-footer p {
	color: #696969;
	font-size: .8em;
	line-height: 1.5em;
	margin: 0 85px 0 0;
}

.amp-wp-footer a {
	text-decoration: none;
}

.back-to-top {
	bottom: 1.275em;
	font-size: .8em;
	font-weight: 600;
	line-height: 2em;
	position: absolute;
	right: 16px;
}
		/* Inline stylesheets */
.htmledit_views em{font-style:italic}.htmledit_views{font-family:-apple-system,SF UI Text,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif,SimHei,SimSun}.htmledit_views a>amp-img{padding:1px;margin:1px;border:none;outline:#0782c1 solid 1px}.htmledit_views p{font-size:16px;color:#4d4d4d;font-weight:400;line-height:26px;margin:0 0 16px;overflow-x:auto}.htmledit_views amp-img{max-width:100%}.htmledit_views strong,.htmledit_views strong span{font-weight:700}.htmledit_views *{box-sizing:border-box}.htmledit_views pre{white-space:pre-wrap;word-wrap:break-word;margin:0 0 24px;overflow-x:auto;padding:8px}.htmledit_views pre{font-family:Consolas,Inconsolata,Courier,monospace;font-size:14px;line-height:22px;color:#000}.htmledit_views pre code,.htmledit_views pre code div,.htmledit_views pre code span{font-family:"Source Code Pro","DejaVu Sans Mono","Ubuntu Mono","Anonymous Pro","Droid Sans Mono",Menlo,Monaco,Consolas,Inconsolata,Courier,monospace,"PingFang SC","Microsoft YaHei",sans-serif}.htmledit_views code{border-radius:4px}.htmledit_views a{color:#4ea1db;text-decoration:none}.htmledit_views a:focus,.htmledit_views a:hover{color:#ca0c16}.htmledit_views a:visited{color:#6795b5}.htmledit_views pre code{display:block;line-height:22px;overflow-x:auto;white-space:pre;word-wrap:normal;border-radius:4px;padding:8px}.htmledit_views pre code:not(.hljs){background-color:#f3f4f5}.htmledit_views pre code,.htmledit_views pre code div,.htmledit_views pre code span{font-size:14px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-1384bf4{color:#fc3}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-57ced48{color:#f60}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-ba670eb{color:#f00}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-c2a3047{color:#f66}	</style>
</head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="https://uzzz.org/">
										<amp-img src="https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png" width="32" height="32" class="amp-wp-site-icon"></amp-img>
						<span class="amp-site-title">
				有组织在!			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">Qt实战之开发软件数据获取助手</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/e786821a74ef0467825a7d60183307bc?s=24&d=mm&r=g" alt="fandyvon" width="24" height="24" layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">fandyvon</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2015-07-28T10:09:15+00:00">
		5 years ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		<div id="article_content" class="article_content clearfix">
 <br>
 
 
 
<div class="htmledit_views" id="content_views">
<p><span></span>前段时间，受朋友委托，需要做一个能够获取别人软件文本框中内容的助手。当然这需要调用win api来解决问题。一开始，我想都没想,就用getWindowText()。。。。居然没用，好郁闷。于是查msdn。。发现关于返回值,是这样写的</p>
<p></p>
<p>Return Values</p>

<p>The length, in characters, of the copied string, not including the terminating null character, indicates success. Zero indicates that the window has no title bar or text, if the title bar is empty, or if the window or control handle is invalid. To get extended error information, call GetLastError. </p>
<p><span class="amp-wp-c2a3047">This function cannot retrieve the text of an edit control in another application.</span></p>
<p>原来是不能跨线程获取数据。。。。。。好吧。。那没办法。接着用SendMessage发送WM_GETTEXT。。。测试记事本是完全没有问题的。。。但是对那个软件却不起作用。。。。。于是各种百度。。无果。。好吧。。暂时搁一搁。。后来，同学在用vb弄文本框时发现了<span class="amp-wp-ba670eb">EM_GETLINECOUNT</span>和  <span class="amp-wp-ba670eb">EM_GETLINE  。</span>至此，这个问题算是解决了。</p>
<p></p>
<p><span></span>啰嗦了那么多，进入主题吧。接下来，我们先实现这个助手。spy++这个大同小异。无非就是多了几个api的调用和线程处理问题。好了。先看下这个助手的最终效果图。。</p>
<p><amp-img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728132805189?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" width="681" height="583" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728132805189?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" width="681" height="583" class=""></noscript></amp-img></p>
<p></p>
<p><amp-img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728132901723?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" width="590" height="470" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728132901723?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" width="590" height="470" class=""></noscript></amp-img></p>
<p><amp-img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728133449764?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" width="644" height="579" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728133449764?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" width="644" height="579" class=""></noscript></amp-img></p>
<p></p>
<p>按住那个放大镜后  鼠标的样式会自动改变  然后获取鼠标所在位置的窗口句柄。。选择模式 尝试获取数据。  如果有填写发送数据的目的地信息。。还可以直接发送数据。</p>
<p></p>
<p><span></span>好了。我们来重点说说以下几点 :</p>
<p><span></span><span class="amp-wp-ba670eb">1） 获取窗口句柄      </span>所用API函数为:  <strong>HWND<span class="amp-wp-1384bf4">WindowFromPoint</span>( POINT</strong><em><a class="synParam" href="" rel="nofollow" data-token="24555ae4e427d16e7201ba72ab34cb09">Point</a></em><strong>);  </strong>只有获取句柄后我们才能调用SendMessage来获取信息</p>
<p><span></span><span class="amp-wp-ba670eb">2）Qt修改鼠标样式 </span>  首先，要修改鼠标样式，我们就应该对存放图片的便签进行事件处理 鼠标按下，切换切换label背景图片。同时修改鼠标样式。。代码如下</p>
<p></p>

<pre><code class="language-cpp">bool MainWindow::eventFilter(QObject *obj, QEvent *event)
{
    if (event->type() == QEvent::MouseButtonPress) {

        if (obj == ui->lab_MouseStyle) {

            QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);
            if (mouseEvent->button() == Qt::LeftButton) {
                ui->lab_MouseStyle->setPixmap(QPixmap("://image/wait.png"));
                // 设置鼠标样式

                QCursor cursor ;
                QPixmap pixmap("://image/searchMouse.png") ;
                cursor = QCursor(pixmap,-1,-1);
                setCursor(cursor) ;

                // 修改标志
                m_IsMouseStyleChanged = true;

                // 开启计时器 300 毫秒刷新一次
                m_pTimer->start(300);

                return true;
            }
        }
    }
    return QWidget::eventFilter(obj, event);
}</code></pre>
<p> 其中lab_MouseStyle就是软件截图中，存放放大镜的label。。。 </p>
<p><span class="amp-wp-57ced48">同时，当用户松开鼠标时。我们需要还原鼠标样式，并且切换label背景. </span>  这个时候，就要对整个程序进行事件拦截了。而不是对label处理事件了。具体代码如下</p>

<pre><code class="language-cpp">bool MainWindow::event(QEvent *event)
{
    if (event->type() == QEvent::MouseButtonRelease) {

        if (m_IsMouseStyleChanged == true) {

            // 当用户松开鼠标时, 恢复鼠标样式并且重新给鼠标样式标签设置图标
            setCursor(Qt::ArrowCursor);
            ui->lab_MouseStyle->setPixmap(QPixmap("://image/searchMouse.png").scaled(QSize(48,48), Qt::KeepAspectRatio));
            m_IsMouseStyleChanged = false;

            // 停止计时器
            m_pTimer->stop();
            return true;
        }
    }
    return QWidget::event(event);
}</code></pre>
<p> 计时器的做用时通知绘图  绘制窗口的黑色边框。。具体的可以看源码部分。。（绘图部分参考于网络，并非原创。。太久不用gdi了。。有点生疏哈） </p>
<p></p>
<p>   <span class="amp-wp-ba670eb">3） 通过句柄获取数据   这里只是谈谈消息的使用   同时有个新问题。怎么处理字符编码问题。。</span> 代码如下(  部分 )</p>
<p></p>

<pre><code class="language-cpp">// 模式一 : 通过直接发送WM_GETTEXT
            TCHAR lpRes[20000] = L"";

            int len = ::SendMessage(m_DesHwnd,  WM_GETTEXT  , (WPARAM)10000, (LPARAM)lpRes);

            char str[40240] = "";

            int iLength = <span style="color:#ff0000;">WideCharToMultiByte</span>(CP_ACP, 0, lpRes, -1, NULL, 0, NULL, NULL);
            <span style="color:#ff0000;">WideCharToMultiByte</span>(CP_ACP, 0, lpRes, -1,str , iLength, NULL, NULL);

            ui->textEdit_Handle->setText(QString::fromAscii(str));</code></pre>
<p> 利用<br>
  <span class="amp-wp-ba670eb">WideCharToMultiByte</span>函数再结合<br>
  <span class="amp-wp-ba670eb">QString::fromAscii</span>我们可以很轻松的转换编码。。。 那么问题来了？ QString又该怎么便捷的转换为TCHAR呢？？  </p>
<p></p>

<pre><code class="language-cpp">// 此函数实现通过句柄获取富文本数据
QString MainWindow::getDataFromHwnd(HWND hWnd)
{
    // 先获取总行数  然后读取数据
    int lineCount= ::SendMessage(hWnd, EM_GETLINECOUNT, 0, 0);

    if (lineCount >0) {

        TCHAR strRes[102400] = L""; // 使用宽字符

        int  count = 0; // 用来记录总共获取了多少字符

        for (int i = 0; i< lineCount;++i) {

            TCHAR szBuffer[200] = L"";
            ((WORD*) szBuffer)[0] = 200;

            int len = ::SendMessage(hWnd,  EM_GETLINE  ,(WPARAM)i, (LPARAM)szBuffer);

            ((WORD*) szBuffer)[len] = '\0';

            for  (int j= 0; j< len;++j)
                strRes[count++] = szBuffer[j];
            strRes[count++] = '\n';
        }

        // 将宽字符转换为ASCII码字符
        char str[30240] = "";
        int iLength = WideCharToMultiByte(CP_ACP, 0, strRes, -1, NULL, 0, NULL, NULL);
        WideCharToMultiByte(CP_ACP, 0, strRes, -1,str , iLength, NULL, NULL);
        return QString::fromAscii(str);
    }
    return QString("");
}</code></pre>
<p> 这个主要是针对文本框的处理！思路很简单： 先获取文本框中的行数，然后循环获取每一行数据。。不过此代码中没有采用动态开辟数组。。这个如有需要，自行修改。 </p>
<p></p>
<p>  <span class="amp-wp-ba670eb">4）到此基本的就实现了。我们讲讲题外话。。怎么实现开机启动的功能。   </span>代码如下</p>

<pre><code class="language-cpp"> //设置为开机启动
    static void AutoRunWithSystem(bool IsAutoRun) {
        QSettings *reg = new QSettings(
                    "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run",
                    QSettings::NativeFormat);
        QString AppPath = QApplication::applicationFilePath();
        QString AppName = QApplication::applicationName();
        if (IsAutoRun) {
            reg->setValue(AppName, AppPath.replace("/","\\"));
        } else {
            reg->setValue(AppName, "");
        }
    }</code></pre>

<p></p>
<p>此代码并非原创。参考与游龙大神的代码。有修改。源代码测试有问题。问题出在windows系统注册表的‘\’符号问题。。必须先修改相应的符号。。</p>
<p></p>
<p>好了。最后附上已打包的软件和源码。。。仅供学习与交流。，不用于商业用途。 有不足之处，欢迎指出。谢谢。</p>
<p></p>
<p><span class="amp-wp-c2a3047">可执行文件下载地址: http://download.csdn.net/detail/wu5151/8939661</span></p>
<p><span class="amp-wp-c2a3047"><br></span></p>
<p><span class="amp-wp-c2a3047">源码文件下载地址:   http://download.csdn.net/detail/wu5151/8939673</span></p>
<p><span class="amp-wp-c2a3047"><br></span></p>
<p><span class="amp-wp-c2a3047">本博客地址: http://blog.csdn.net/wu5151</span></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p><span class="amp-wp-ba670eb"><br></span></p>
<p><span></span></p>
<p></p>
<p><span class="amp-wp-c2a3047"><br></span></p>
<p> 
 </p></div>
</div>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: <a href="https://uzzz.org/category/qt/" rel="category tag">qt</a>	</div>

	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>有组织在!</h2>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>



</body>
</html>
