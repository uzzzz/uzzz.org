<!DOCTYPE html>
<html amp lang="en-US">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
	<script type="application/ld+json" class="yoast-schema-graph yoast-schema-graph--main">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://uzzz.org/#website","url":"https://uzzz.org/","name":"\u6709\u7ec4\u7ec7\u5728!","potentialAction":{"@type":"SearchAction","target":"https://uzzz.org/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://uzzz.org/article/4328/#primaryimage","url":"https://profile.csdnimg.cn/3/7/9/3_lhf_debug"},{"@type":"WebPage","@id":"https://uzzz.org/article/4328/#webpage","url":"https://uzzz.org/article/4328/","inLanguage":"en-US","name":"TOR\u539f\u751f\u6570\u636e\u586b\u5145\u65b9\u5f0f\uff08Channel Padding\uff09 - \u6709\u7ec4\u7ec7\u5728!","isPartOf":{"@id":"https://uzzz.org/#website"},"primaryImageOfPage":{"@id":"https://uzzz.org/article/4328/#primaryimage"},"datePublished":"2018-03-31T08:07:40+00:00","dateModified":"2018-03-31T08:07:40+00:00","author":{"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f"}},{"@type":["Person"],"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f","name":"fandyvon","sameAs":[]}]}</script>
	<title>TOR原生数据填充方式（Channel Padding） - 有组织在!</title>
		<link rel="canonical" href="https://uzzz.org/article/4328/">
	<script type="text/javascript" src="https://cdn.ampproject.org/v0.js" async></script>
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
	<style amp-custom>
		/* Generic WP styling */

.alignright {
	float: right;
}

.alignleft {
	float: left;
}

.aligncenter {
	display: block;
	text-align: center;
	margin-left: auto;
	margin-right: auto;
}

.amp-wp-enforced-sizes {
	/** Our sizes fallback is 100vw, and we have a padding on the container; the max-width here prevents the element from overflowing. **/
	max-width: 100%;
	margin: 0 auto;
}


/*
 * Prevent cases of amp-img converted from img to appear with stretching by using object-fit to scale.
 * See <https://github.com/ampproject/amphtml/issues/21371#issuecomment-475443219>.
 * Also use object-fit:contain in worst case scenario when we can't figure out dimensions for an image.
 * Additionally, in side of \AMP_Img_Sanitizer::determine_dimensions() it could $amp_img->setAttribute( 'object-fit', 'contain' )
 * so that the following rules wouldn't be needed.
 */
amp-img.amp-wp-enforced-sizes[layout="intrinsic"] > img,
amp-anim.amp-wp-enforced-sizes[layout="intrinsic"] > img {
	object-fit: contain;
}

amp-fit-text blockquote,
amp-fit-text h1,
amp-fit-text h2,
amp-fit-text h3,
amp-fit-text h4,
amp-fit-text h5,
amp-fit-text h6 {
	font-size: inherit;
}

/**
 * Override a style rule in Twenty Sixteen and Twenty Seventeen.
 * It set display:none for audio elements.
 * This selector is the same, though it adds body and uses amp-audio instead of audio.
 */
body amp-audio:not([controls]) {
	display: inline-block;
	height: auto;
}

/*
 * Style the default template messages for submit-success, submit-error, and submitting. These elements are inserted
 * by the form sanitizer when a POST form lacks the action-xhr attribute.
 */
.amp-wp-default-form-message > p {
	margin: 1em 0;
	padding: 0.5em;
}

.amp-wp-default-form-message[submitting] > p,
.amp-wp-default-form-message[submit-success] > p.amp-wp-form-redirecting {
	font-style: italic;
}

.amp-wp-default-form-message[submit-success] > p:not(.amp-wp-form-redirecting) {
	border: solid 1px #008000;
	background-color: #90ee90;
	color: #000;
}

.amp-wp-default-form-message[submit-error] > p {
	border: solid 1px #f00;
	background-color: #ffb6c1;
	color: #000;
}

/* Prevent showing empty success message in the case of an AMP-Redirect-To response header. */
.amp-wp-default-form-message[submit-success] > p:empty {
	display: none;
}

amp-carousel .amp-wp-gallery-caption {
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	text-align: center;
	background-color: rgba(0, 0, 0, 0.5);
	color: #fff;
	padding: 1rem;
}

.wp-block-gallery[data-amp-carousel="true"] {
	display: block;
	flex-wrap: unset;
}

/* Template Styles */

.amp-wp-content,
.amp-wp-title-bar div {
		margin: 0 auto;
	max-width: 840px;
	}

html {
	background: #0a89c0;
}

body {
	background: #fff;
	color: #353535;
	font-family: Georgia, 'Times New Roman', Times, Serif;
	font-weight: 300;
	line-height: 1.75em;
}

p,
ol,
ul,
figure {
	margin: 0 0 1em;
	padding: 0;
}

a,
a:visited {
	color: #0a89c0;
}

a:hover,
a:active,
a:focus {
	color: #353535;
}

/* Quotes */

blockquote {
	color: #353535;
	background: rgba(127,127,127,.125);
	border-left: 2px solid #0a89c0;
	margin: 8px 0 24px 0;
	padding: 16px;
}

blockquote p:last-child {
	margin-bottom: 0;
}

/* UI Fonts */

.amp-wp-meta,
.amp-wp-header div,
.amp-wp-title,
.wp-caption-text,
.amp-wp-tax-category,
.amp-wp-tax-tag,
.amp-wp-comments-link,
.amp-wp-footer p,
.back-to-top {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif;
}

/* Header */

.amp-wp-header {
	background-color: #0a89c0;
}

.amp-wp-header div {
	color: #fff;
	font-size: 1em;
	font-weight: 400;
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: .875em 16px;
	position: relative;
}

.amp-wp-header a {
	color: #fff;
	text-decoration: none;
}


.amp-wp-header .amp-wp-site-icon {
	/** site icon is 32px **/
	background-color: #fff;
	border: 1px solid #fff;
	border-radius: 50%;
	position: absolute;
	right: 18px;
	top: 10px;
}

/* Article */

.amp-wp-article {
	color: #353535;
	font-weight: 400;
	margin: 1.5em auto;
	max-width: 840px;
	overflow-wrap: break-word;
	word-wrap: break-word;
}

/* Article Header */

.amp-wp-article-header {
	align-items: center;
	align-content: stretch;
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
	margin: 1.5em 16px 0;
}

.amp-wp-title {
	color: #353535;
	display: block;
	flex: 1 0 100%;
	font-weight: 900;
	margin: 0 0 .625em;
	width: 100%;
}

/* Article Meta */

.amp-wp-meta {
	color: #696969;
	display: inline-block;
	flex: 2 1 50%;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0 0 1.5em;
	padding: 0;
}

.amp-wp-article-header .amp-wp-meta:last-of-type {
	text-align: right;
}

.amp-wp-article-header .amp-wp-meta:first-of-type {
	text-align: left;
}

.amp-wp-byline amp-img,
.amp-wp-byline .amp-wp-author {
	display: inline-block;
	vertical-align: middle;
}

.amp-wp-byline amp-img {
	border: 1px solid #0a89c0;
	border-radius: 50%;
	position: relative;
	margin-right: 6px;
}

.amp-wp-posted-on {
	text-align: right;
}

/* Featured image */

.amp-wp-article-featured-image {
	margin: 0 0 1em;
}
.amp-wp-article-featured-image amp-img {
	margin: 0 auto;
}
.amp-wp-article-featured-image.wp-caption .wp-caption-text {
	margin: 0 18px;
}

/* Article Content */

.amp-wp-article-content {
	margin: 0 16px;
}

.amp-wp-article-content ul,
.amp-wp-article-content ol {
	margin-left: 1em;
}

.amp-wp-article-content .wp-caption {
	max-width: 100%;
}

.amp-wp-article-content amp-img {
	margin: 0 auto;
}

.amp-wp-article-content amp-img.alignright {
	margin: 0 0 1em 16px;
}

.amp-wp-article-content amp-img.alignleft {
	margin: 0 16px 1em 0;
}

/* Captions */

.wp-caption {
	padding: 0;
}

.wp-caption.alignleft {
	margin-right: 16px;
}

.wp-caption.alignright {
	margin-left: 16px;
}

.wp-caption .wp-caption-text {
	border-bottom: 1px solid #c2c2c2;
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0;
	padding: .66em 10px .75em;
}

/* AMP Media */

.alignwide,
.alignfull {
	clear: both;
}

amp-carousel {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}
amp-iframe,
amp-youtube,
amp-instagram,
amp-vine {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}

.amp-wp-article-content amp-carousel amp-img {
	border: none;
}

amp-carousel > amp-img > img {
	object-fit: contain;
}

.amp-wp-iframe-placeholder {
	background: #c2c2c2 url( https://uzzz.org/wp-content/plugins/amp/assets/images/placeholder-icon.png ) no-repeat center 40%;
	background-size: 48px 48px;
	min-height: 48px;
}

/* Article Footer Meta */

.amp-wp-article-footer .amp-wp-meta {
	display: block;
}

.amp-wp-tax-category,
.amp-wp-tax-tag {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 1.5em 16px;
}

.amp-wp-comments-link {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	text-align: center;
	margin: 2.25em 0 1.5em;
}

.amp-wp-comments-link a {
	border-style: solid;
	border-color: #c2c2c2;
	border-width: 1px 1px 2px;
	border-radius: 4px;
	background-color: transparent;
	color: #0a89c0;
	cursor: pointer;
	display: block;
	font-size: 14px;
	font-weight: 600;
	line-height: 18px;
	margin: 0 auto;
	max-width: 200px;
	padding: 11px 16px;
	text-decoration: none;
	width: 50%;
	-webkit-transition: background-color 0.2s ease;
			transition: background-color 0.2s ease;
}

/* AMP Footer */

.amp-wp-footer {
	border-top: 1px solid #c2c2c2;
	margin: calc(1.5em - 1px) 0 0;
}

.amp-wp-footer div {
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: 1.25em 16px 1.25em;
	position: relative;
}

.amp-wp-footer h2 {
	font-size: 1em;
	line-height: 1.375em;
	margin: 0 0 .5em;
}

.amp-wp-footer p {
	color: #696969;
	font-size: .8em;
	line-height: 1.5em;
	margin: 0 85px 0 0;
}

.amp-wp-footer a {
	text-decoration: none;
}

.back-to-top {
	bottom: 1.275em;
	font-size: .8em;
	font-weight: 600;
	line-height: 2em;
	position: absolute;
	right: 16px;
}
		/* Inline stylesheets */
.htmledit_views{font-family:-apple-system,SF UI Text,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif,SimHei,SimSun}.htmledit_views a>amp-img{padding:1px;margin:1px;border:none;outline:#0782c1 solid 1px}.htmledit_views p{font-size:16px;color:#4d4d4d;font-weight:400;line-height:26px;margin:0 0 16px;overflow-x:auto}p[align=center]{text-align:center}.htmledit_views amp-img{max-width:100%;height:auto}.htmledit_views strong,.htmledit_views strong span{font-weight:700}.htmledit_views *{box-sizing:border-box}.htmledit_views ul{margin:0 0 24px;padding:0;font-size:16px}.htmledit_views ul li{list-style-type:disc;margin:8px 0 0 32px}.htmledit_views table tr{border:0;border-top:1px solid #ddd;background-color:#fff}.htmledit_views table{border-collapse:collapse;display:table;width:100%;text-align:left;margin-bottom:24px;margin-left:auto;margin-right:auto}.htmledit_views tbody{border:0}.htmledit_views table tr:nth-child(2n){background-color:#f7f7f7}.htmledit_views table tr td{border:1px solid #ddd;font-size:14px;color:#4f4f4f;line-height:22px;padding:8px;text-align:left}.htmledit_views table tr td p{font-size:14px;color:#4f4f4f;margin:0;padding:0;text-align:left;line-height:22px}.htmledit_views a{color:#4ea1db;text-decoration:none}.htmledit_views a:focus,.htmledit_views a:hover{color:#ca0c16}.htmledit_views a:visited{color:#6795b5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-c192678{color:#585959;font-family:"Source Sans",Arial,"Helvetica Neue",Helvetica,sans-serif;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-7910d0a{color:#68b030;text-decoration:underline}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-9bd93d3{font-size:12px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-f51b372{border-spacing:0px;color:#24292e;font-family:"-apple-system",BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:14px;line-height:21px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-b25821f{width:50px;min-width:50px;font-family:"SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.298039);text-align:right;vertical-align:top}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-a205cac{line-height:20px;vertical-align:top;font-family:"SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:12px;color:#24292e}	</style>
</head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="https://uzzz.org/">
										<amp-img src="https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png" width="32" height="32" class="amp-wp-site-icon"></amp-img>
						<span class="amp-site-title">
				有组织在!			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">TOR原生数据填充方式（Channel Padding）</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/e786821a74ef0467825a7d60183307bc?s=24&d=mm&r=g" alt="fandyvon" width="24" height="24" layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">fandyvon</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2018-03-31T16:07:40+00:00">
		2 years ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		<p><br>
<br>
<br>
 </p>
<div id="article_content" class="article_content clearfix">
 
 
<div class="htmledit_views" id="content_views">
<p>TOR本身已经做了这个功能了，今天发现。TOR 0.3.1.7版本加入的流量分析阻力，ChannelPadding,2017年9月</p>
<p>颇为绝望。今天才在GITHUB上看见TOR padding specification。</p>
<p>然后赶紧找了找官方的版本更新说明 原文如下：</p>
<p><span class="amp-wp-c192678">Major features (traffic analysis resistance):</span></p>
<ul class="amp-wp-c192678">
<li>
<p>Connections between clients and relays now send a padding cell in each direction every 1.5 to 9.5 seconds (tunable via consensus parameters). This padding will not resist specialized eavesdroppers, but it should be enough to make many ISPs’ routine network flow logging less useful in traffic analysis against Tor users.</p>
<p>Padding is negotiated using Tor’s link protocol, so both relays and clients must upgrade for this to take effect. Clients may still send padding despite the relay’s version by setting ConnectionPadding 1 in torrc, and may disable padding by setting ConnectionPadding 0 in torrc. Padding may be minimized for mobile users with the torrc option ReducedConnectionPadding. Implements Proposal 251 and Section 2 of Proposal 254; closes ticket <a href="https://bugs.torproject.org/16861" rel="nofollow" class="amp-wp-7910d0a">16861</a>.</p>
</li>
<li>Relays will publish 24 hour totals of padding and non-padding cell counts to their extra-info descriptors, unless PaddingStatistics 0 is set in torrc. These 24 hour totals are also rounded to multiples of 10000.</li>
</ul>
<p>原文地址：<a href="https://blog.torproject.org/tor-0317-now-released" rel="nofollow">点击打开链接</a></p>
<p>总的大体意思是 在中继和客户端间每1.5到9.6秒发送一个填充数据元在所有方向上（可通过一致性参数调整），填充不针对专门的窃听者，但能够破坏ISP常规网络流记录对TOR用户的流量分析。填充使用TOR链接协议，因此中继和客户端必须进行升级才可使用。客户端仍然可以发送填充，只要中继版本里的torrc设置了连接填充为1，并可通过设置为0来禁用。当移动用户设置了ReducedConnectionPadding 在torrc里时，填充会在最小的方式进行。中继会24小时发送填充数据元和非填充数据元（基于他们额外信息描述符），除非torrc设置了PaddingStatistics 为0。</p>
<p></p>
<p>好吧，大体意思是这样，那我们再来看看，具体是什么情况。来尝试看看TOR的Specification是怎么描述这个功能的。</p>
<p><a href="https://github.com/torproject/torspec/blob/master/padding-spec.txt">Github上的TOR-SPEC</a></p>
<p>1.1 概览</p>
<p>TOR支持两种级别的覆盖流量，连接级别填充和链路级别填充。</p>
<p>连接级别的填充使用 CELL_PADDING数据元命令用来填充流量，而链路级别填充使用RELAY_COMMAND_DROP中继命令。CELL_PADDING是单跳的，且可被中继将之与正常流量区分开（内部检查器），而无法被外部区分（外部观察者）</p>
<p>RELAY_COMMAND_DROP是多跳的，并且对途经的中继不可见，因为中继命令域已被（circuit）链路层加密。并且，TOR的”可识别“域允许RELAY_COMMAND_DROP填充流量发送至该链路中的任意中间节点。</p>
<p>如今只有单跳的CELL_PADDING被使用（其实我看了一下0.3.1.7,貌似多跳的RELAY_COMMAND_DROP也被使用了）</p>
<p><strong>连接级别的填充：</strong></p>
<p>2.1背景：</p>
<p>TOR客户端和中继使用CELL_PADDING来对抗IPS和其他的监察者对连接级别的元数据搜集。这些流数据采集检测在互联网路由器中以NetFlow,JFlow,NetStream或IPFIX记录的形式实现。（这些都是各大路由厂商比如华为、思科等设备的数据流形式）。这些记录被网关路由以原生形式获取，并输出给（一般都是明文形式）一个既不逐字记录也不减少其记录粒度的采集器（我的理解是一个比较完整地记录的采集器。）</p>
<p>网络流记录和其相关的数据搜集工具都是可配置的，且有许多操作模式，特别是当其配置于解决高数据量通过时。然而，在ISP维度，每一种流的记录都很可能被使用，因为他们既是默认的也提供了一种对终端活动的高可分辨性。其次仅对全包或者包头进行捕获。</p>
<p>单流记录以五元组的形式记录一个终端的连接，包括一段特定时间内总计发送接收的字节数。他们也可以存储额外的域信息，但我们关注的一般都是时间信息及字节计数信息。</p>
<p>当配置于提供单流记录时，路由器周期性发送所有通过他们的连接的原生流记录，基于两个参数“active flow timeout”,”inactive flow time out”。</p>
<p>“active flow timeout”使路由器周期地发送一个关于所有持续发送数据的活动的TCP会话的新的记录。大多数路由器默认的活动流超时时间使三十分钟。意味着一个新纪录至少会每三十分钟产生一次，不管如何，这些值可以配置成1分钟到六十分钟，在主流路由器上。</p>
<p>“inactive flow timeout”使路由器在一个TCP会话超时一定时间时产生一个新的记录。允许路由器避免追溯内存里一大堆的终结连接和在有活动的时候发送一个单独的记录。在通用路由器里这个值域一般是10秒到600秒，目前似乎没有路由器支持小于十秒的该值。</p>
<p>罗列一些主流路由的两个参数列表</p>
<p><span class="amp-wp-9bd93d3">                        路由                                      Activeflow time out                  Inactiveflow time out</span></p>

<table class="highlight tab-size js-file-line-container amp-wp-f51b372">
<tbody>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">Cisco IOS[3] 15s (10-600s) 30min (1-60min)</td>
</tr>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">Cisco Catalyst[4] 5min 32min</td>
</tr>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">Juniper (jFlow)[5] 15s (10-600s) 30min (1-60min)</td>
</tr>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">Juniper (Netflow)[6,7] 60s (10-600s) 30min (1-30min)</td>
</tr>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">H3C (Netstream)[8] 60s (60-600s) 30min (1-60min)</td>
</tr>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">Fortinet[9] 15s 30min</td>
</tr>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">MicroTik[10] 15s 30min</td>
</tr>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">nProbe[14] 30s 120s</td>
</tr>
<tr>
<td class="blob-num js-line-number amp-wp-b25821f"> </td>
<td class="blob-code blob-code-inner js-file-line amp-wp-a205cac">Alcatel-Lucent[2] 15s (10-600s) 30min (1-600min)</td>
</tr>
</tbody>
</table>
<p>这张表允许我们设计一个低代价的填充对抗方式，使路由产生的记录在他们输出到采集器进行存储前崩塌（就区别于实际的流量记录）。在一个连接在不活动流超时前传输数据时，路由器会继续对数据流进行计数直到活动流超时。</p>
<p>这意味着对于阻止不活动流超时的最小填充数，这是有可能减少在大小为30分钟的窗口内原生数据收发数据总量可分辨性的，</p>
<p>对于HTTP,IRC,XMPP,SSH和其他断断续续的内在互相关联的流量，特别是所有用户流量在一定时间内都从一个连接上通过时，这种方法能够大量减少这些流量记录的可变性。（TOR便是在连接上复用多个通道，通道上复用多个链路）</p>
<p><strong>实现</strong></p>
<p>Tor客户端当前保持一个TLS连接到他们的入口节点来承载实际的应用流量，并且额外建立三个连接到其他节点来获取目录信息。我们仅仅对客户端到入口节点的连接进行填充，而忽略任何其它的连接。我们把对网桥节点到Tor网络的连接看作客户端连接，也填充他们，但其他正常中继间不进行填充。</p>
<p>客户端和入口节点都会对所有应用TLS连接维持一个计时器，每次一个非填充包被对端接收或发送时，终端将会通过max(x,x)分发方式（稍后会提到）从1.5s到9.5s之间抽取一个超时值。这个时间范围取决于一致性参数（稍后也会提到）。</p>
<p>如果连接在计时器超时前开始活动了，计时器会重置为1.5s到9.5s间一个新的随机值，如果连接保持不活动直到计时器超时，一个单独的CELL_PADDING包将被发送到该连接上。</p>
<p>通过这种方式，连接填充只会发生在空闲阶段，并且最小十秒的非活动超时时总会传输一个数据报。</p>
<p><strong>填充数据元超时分配计数</strong></p>
<p>由于填充时双向的，并且双端都会维持计时器，因此该时间在向双端发送填充包前都是min(client_timeou,server_timeout)。</p>
<p>如果client_timeout和server_timeout都是一致地抽样，则min(client_timeout,server_timeout)将不再一致地分配且平均的超时结果（Exp[min(X,X)]）会较范围中值低。</p>
<p>为了弥补此不足，相对于平均地从每个终端一致地抽样超时，TOR会使用max(X,X)进行抽样，X为一致分配的</p>
<p>如果X是一个一致随机变量，范围为0到R-1（R=high-low），则随机变量Y=max(X,X)有（Y==i）=(2.0*i+1)/(R*R)</p>
<p>当双端均从Y中产生超时值，则双向填充数据包发送率为第三个随机变量Z=min(Y,Y).</p>
<p>Z的分布是略显钟罩形的（参见正态分布曲线），但集中于中值，也显示Exp[Z]~=Exp[X],以下为每个变量的均值表</p>
<p></p>
<table border="1" cellspacing="1" cellpadding="1" align="center">
<tbody>
<tr>
<td>R</td>
<td>Exp[X]   </td>
<td>Exp[Z]</td>
<td>Exp[min(X,X)]</td>
<td>Exp[Y=max(X,X)]</td>
</tr>
<tr>
<td>2000</td>
<td>999.5</td>
<td>1066</td>
<td>666.2</td>
<td>1332.8</td>
</tr>
<tr>
<td>3000</td>
<td>1499.5</td>
<td>1599.5</td>
<td>999.5</td>
<td>1999.5</td>
</tr>
<tr>
<td>5000</td>
<td>2499.5</td>
<td>2666</td>
<td>1666.5</td>
<td>3332.8</td>
</tr>
<tr>
<td>6000</td>
<td>2999.5</td>
<td>3199.5</td>
<td>1999.5</td>
<td>3999.5</td>
</tr>
<tr>
<td>7000</td>
<td>3499.5</td>
<td>3732.8</td>
<td>2332.8</td>
<td>4666.2</td>
</tr>
<tr>
<td>8000</td>
<td>3999.5</td>
<td>4266,2</td>
<td>2666.2</td>
<td>5332.8</td>
</tr>
<tr>
<td>10000</td>
<td>4999.5</td>
<td>5328</td>
<td>3332.8</td>
<td>6666.2</td>
</tr>
</tbody>
</table>
<p>通过这种方式，我们保证了超时范围的中点是填充数据报双向发送期望的均值时间</p>
<p><strong>最大值上界</strong></p>
<p>通过使用默认参数和以上分配的方式，我们期望一个被填充的连接会每5.5s发送一个填充数据元。平均一秒会有103个字节被完全发送（即单向会发送52个字节每秒），假设一个512字节的数据元和55字节的TLS+TCP+IP头部。</p>
<p>对于一个客户端连接，当其保持空闲时其期望一个50分钟的生存期（基于链路空闲超时加上一个较小的额外连接超时），这大约有154.5kb上界在每个方向上（总计308KB）</p>
<p>每天有将近250万的日常用户在使用TOR网络，52B/s，在整个TOR网络范围内即130MB/s(在每个方向上)，即当前TOR目录流量的大小。但250万的日常用户不会都同时连接，也不会都一直完全空闲，因此我们估计实际的耗费会比这更小。</p>
<p><strong>通过协商减少或禁用填充</strong></p>
<p>为了允许移动客户端可以减少或者禁用他们的填充开支，客户端可以发送CELL_PADDING_NEGOTIATE到中继。这个数据元用来告诉中继减缓发送填充数据元。</p>
<p>若客户端选择了填充减少，它会持续发送填充数据元，但时间间隔为[9000,14000]ms的范围中抽样（取决于一致性参数，后面会提到），仍然使用Y=max(X,X)分配方式。填充是单向的 ，则预计的填充规律取决于Y而不是Z，对于5000ms范围内的取值，我们可预计在9000+3332.8=12332.8（也就是12秒）的时间内发送一次填充包。我们将链路可用超时减半（50min减为25min）,这会导致客户端的OR连接会在其空闲后很快关闭，以减少耗费。</p>
<p>这两个变化导致了每次用TOR连接的填充耗费从309kb减到了69kb，对于连续的使用，最大的耗费从103kb/s减少到了46kb/s</p>
<p>如果客户端选择了完全禁用填充，它会发送一个CELL_PADDING_NEGOTIATE 包来告诉中继不要进行填充，接下来它将不会发送任何填充数据包。</p>
<p><strong>实现行为控制的一致性参数</strong></p>
<p>连接层次的填充是被以下一致性参数控制的。</p>
<p>*nf_ito_low (netflow inactive timeout low)</p>
<p>    不活动填充时间范围下界，当不活动时 默认值：1500 ms</p>
<p>*nf_ito_high(netflow inactive timeout high)</p>
<p>    不活动填充时间范围上界，默认值：9500ms 若nf_ito_low==nf_ito_high==0 即填充被禁用</p>
<p>*nf_ito_low_reduced(reduced netflow inactive timeout low)</p>
<p>    客户端设置减少填充时的不活动填充时间范围下界 默认值：9000ms</p>
<p>*nf_ito_high_reduced(reduced netflow inactive timeout high)</p>
<p>    客户端设置减少填充时的不活动填充范围上界 默认值：14000ms</p>
<p>*nf_conntimeout_client(netflow client connection timeout)</p>
<p>    保持链路打开且可为用户所用的时长，实际用户超时时间是这个值到其二倍值范围内的完全随机数。这确定了客户端OR连接的生存周期，选择减少填充的用户使用该一致值的一半 默认值：1800s</p>
<p>*nf_pad_before_usage</p>
<p>    若设置为1，OR连接会在用户开始将其用于任何应用流量前进行填充，若设置为0，则OR连接会直到应用流量开始发送时才进行填充，默认值：1</p>
<p>*nf_pad_relays</p>
<p>    若设置为1，不活动的OR-OR连接也会被填充,默认值：0</p>
<p>*nf_conntimeout_relays</p>
<p>    空闲的OR-OR连接保持开启的时间 默认值：3600s</p>
</div>
<div class="more-toolbox">
<div class="left-toolbox">
<ul class="toolbox-list">
<li class="tool-item tool-active is-like "><a><br>
      <svg class="icon" aria-hidden="true"><br>
       <use xlink:href="#csdnc-thumbsup"></use><br>
      </svg><span class="name">点赞</span> <span class="count"></span> </a></li>
<li class="tool-item tool-active is-collection "><a data-report-click='{"mod":"popu_824"}'><br>
      <svg class="icon" aria-hidden="true"><br>
       <use xlink:href="#icon-csdnc-Collection-G"></use><br>
      </svg><span class="name">收藏</span></a></li>
<li class="tool-item tool-active is-share"><a data-report-click='{"mod":"1582594662_002"}'><br>
      <svg class="icon" aria-hidden="true"><br>
       <use xlink:href="#icon-csdnc-fenxiang"></use><br>
      </svg>分享</a></li>
<p>    <br>
     </p>
<li class="tool-item tool-more"> <a><br>
      <svg class="icon" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><br>
       <defs>

<p>       </p></defs>
       <path d="M179.176 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z"></path>
       <path d="M509.684 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z"></path>
       <path d="M846.175 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z"></path>
      </svg> </a> 
<ul class="more-box">
<li class="item"><a class="article-report">文章举报</a></li>
</ul>
</li>
</ul></div>
</div>
<div class="person-messagebox">
<div class="left-message">
   <a href="https://blog.csdn.net/LHF_debug"> <amp-img src="https://profile.csdnimg.cn/3/7/9/3_lhf_debug" class="avatar_pic amp-wp-enforced-sizes" width="75" height="75" layout="intrinsic"><noscript><img src="https://profile.csdnimg.cn/3/7/9/3_lhf_debug" class="avatar_pic" width="75" height="75"></noscript></amp-img> <amp-img src="https://g.csdnimg.cn/static/user-reg-year/1x/4.png" class="user-years amp-wp-enforced-sizes" width="22" height="23" layout="intrinsic"><noscript><img src="https://g.csdnimg.cn/static/user-reg-year/1x/4.png" class="user-years" width="22" height="23"></noscript></amp-img> </a>
  </div>
<div class="middle-message">
<div class="title">
    <span class="tit"><a href="https://blog.csdn.net/LHF_debug" data-report-click='{"mod":"popu_379"}' target="_blank" rel="noopener noreferrer">LHF_debug</a></span>
   </div>
<div class="text">
    <span>发布了24 篇原创文章</span> ·<br>
    <span>获赞 4</span> ·<br>
    <span>访问量 1万+</span>
   </div>
</div>
<div class="right-message">
   <a href="https://im.csdn.net/im/main.html?userName=LHF_debug" target="_blank" class="btn btn-sm btn-red-hollow bt-button personal-letter" rel="noopener noreferrer">私信 </a><br>
   <a class="btn btn-sm  bt-button personal-watch" data-report-click='{"mod":"popu_379"}'>关注</a>
  </div>
</div>
</div>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: Uncategorized	</div>

	<div class="amp-wp-meta amp-wp-tax-tag">
		Tags: <a href="https://uzzz.org/tag/tor/" rel="tag">tor</a>	</div>
	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>有组织在!</h2>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>



</body>
</html>
