<!DOCTYPE html>
<html amp lang="en-US">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
		<title>Tor网络突破IP封锁，爬虫好搭档【入门手册】 – 有组织在!</title>
		<link rel="canonical" href="https://uzzz.org/article/1223/">
	<script type="text/javascript" src="https://cdn.ampproject.org/v0.js" async></script>
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>	<script type="application/ld+json">{"@context":"http:\/\/schema.org","publisher":{"@type":"Organization","name":"有组织在!","logo":"https:\/\/uzzz.org\/wp-content\/uploads\/2019\/10\/cropped-icon.png"},"@type":"BlogPosting","mainEntityOfPage":"https:\/\/uzzz.org\/article\/1223\/","headline":"Tor网络突破IP封锁，爬虫好搭档【入门手册】","datePublished":"2016-07-29T09:47:00+00:00","dateModified":"2016-07-29T09:47:00+00:00","author":{"@type":"Person","name":"fandyvon"}}</script>
	
	<style amp-custom>
		/* Generic WP styling */

.alignright {
	float: right;
}

.alignleft {
	float: left;
}

.aligncenter {
	display: block;
	text-align: center;
	margin-left: auto;
	margin-right: auto;
}

.amp-wp-enforced-sizes {
	/** Our sizes fallback is 100vw, and we have a padding on the container; the max-width here prevents the element from overflowing. **/
	max-width: 100%;
	margin: 0 auto;
}


/*
 * Prevent cases of amp-img converted from img to appear with stretching by using object-fit to scale.
 * See <https://github.com/ampproject/amphtml/issues/21371#issuecomment-475443219>.
 * Also use object-fit:contain in worst case scenario when we can't figure out dimensions for an image.
 * Additionally, in side of \AMP_Img_Sanitizer::determine_dimensions() it could $amp_img->setAttribute( 'object-fit', 'contain' )
 * so that the following rules wouldn't be needed.
 */
amp-img.amp-wp-enforced-sizes[layout="intrinsic"] > img,
amp-anim.amp-wp-enforced-sizes[layout="intrinsic"] > img {
	object-fit: contain;
}

amp-fit-text blockquote,
amp-fit-text h1,
amp-fit-text h2,
amp-fit-text h3,
amp-fit-text h4,
amp-fit-text h5,
amp-fit-text h6 {
	font-size: inherit;
}

/**
 * Override a style rule in Twenty Sixteen and Twenty Seventeen.
 * It set display:none for audio elements.
 * This selector is the same, though it adds body and uses amp-audio instead of audio.
 */
body amp-audio:not([controls]) {
	display: inline-block;
	height: auto;
}

/*
 * Style the default template messages for submit-success, submit-error, and submitting. These elements are inserted
 * by the form sanitizer when a POST form lacks the action-xhr attribute.
 */
.amp-wp-default-form-message > p {
	margin: 1em 0;
	padding: 0.5em;
}

.amp-wp-default-form-message[submitting] > p,
.amp-wp-default-form-message[submit-success] > p.amp-wp-form-redirecting {
	font-style: italic;
}

.amp-wp-default-form-message[submit-success] > p:not(.amp-wp-form-redirecting) {
	border: solid 1px #008000;
	background-color: #90ee90;
	color: #000;
}

.amp-wp-default-form-message[submit-error] > p {
	border: solid 1px #f00;
	background-color: #ffb6c1;
	color: #000;
}

/* Prevent showing empty success message in the case of an AMP-Redirect-To response header. */
.amp-wp-default-form-message[submit-success] > p:empty {
	display: none;
}

amp-carousel .amp-wp-gallery-caption {
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	text-align: center;
	background-color: rgba(0, 0, 0, 0.5);
	color: #fff;
	padding: 1rem;
}

.wp-block-gallery[data-amp-carousel="true"] {
	display: block;
	flex-wrap: unset;
}

/* Template Styles */

.amp-wp-content,
.amp-wp-title-bar div {
		margin: 0 auto;
	max-width: 840px;
	}

html {
	background: #0a89c0;
}

body {
	background: #fff;
	color: #353535;
	font-family: Georgia, 'Times New Roman', Times, Serif;
	font-weight: 300;
	line-height: 1.75em;
}

p,
ol,
ul,
figure {
	margin: 0 0 1em;
	padding: 0;
}

a,
a:visited {
	color: #0a89c0;
}

a:hover,
a:active,
a:focus {
	color: #353535;
}

/* Quotes */

blockquote {
	color: #353535;
	background: rgba(127,127,127,.125);
	border-left: 2px solid #0a89c0;
	margin: 8px 0 24px 0;
	padding: 16px;
}

blockquote p:last-child {
	margin-bottom: 0;
}

/* UI Fonts */

.amp-wp-meta,
.amp-wp-header div,
.amp-wp-title,
.wp-caption-text,
.amp-wp-tax-category,
.amp-wp-tax-tag,
.amp-wp-comments-link,
.amp-wp-footer p,
.back-to-top {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif;
}

/* Header */

.amp-wp-header {
	background-color: #0a89c0;
}

.amp-wp-header div {
	color: #fff;
	font-size: 1em;
	font-weight: 400;
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: .875em 16px;
	position: relative;
}

.amp-wp-header a {
	color: #fff;
	text-decoration: none;
}


.amp-wp-header .amp-wp-site-icon {
	/** site icon is 32px **/
	background-color: #fff;
	border: 1px solid #fff;
	border-radius: 50%;
	position: absolute;
	right: 18px;
	top: 10px;
}

/* Article */

.amp-wp-article {
	color: #353535;
	font-weight: 400;
	margin: 1.5em auto;
	max-width: 840px;
	overflow-wrap: break-word;
	word-wrap: break-word;
}

/* Article Header */

.amp-wp-article-header {
	align-items: center;
	align-content: stretch;
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
	margin: 1.5em 16px 0;
}

.amp-wp-title {
	color: #353535;
	display: block;
	flex: 1 0 100%;
	font-weight: 900;
	margin: 0 0 .625em;
	width: 100%;
}

/* Article Meta */

.amp-wp-meta {
	color: #696969;
	display: inline-block;
	flex: 2 1 50%;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0 0 1.5em;
	padding: 0;
}

.amp-wp-article-header .amp-wp-meta:last-of-type {
	text-align: right;
}

.amp-wp-article-header .amp-wp-meta:first-of-type {
	text-align: left;
}

.amp-wp-byline amp-img,
.amp-wp-byline .amp-wp-author {
	display: inline-block;
	vertical-align: middle;
}

.amp-wp-byline amp-img {
	border: 1px solid #0a89c0;
	border-radius: 50%;
	position: relative;
	margin-right: 6px;
}

.amp-wp-posted-on {
	text-align: right;
}

/* Featured image */

.amp-wp-article-featured-image {
	margin: 0 0 1em;
}
.amp-wp-article-featured-image amp-img {
	margin: 0 auto;
}
.amp-wp-article-featured-image.wp-caption .wp-caption-text {
	margin: 0 18px;
}

/* Article Content */

.amp-wp-article-content {
	margin: 0 16px;
}

.amp-wp-article-content ul,
.amp-wp-article-content ol {
	margin-left: 1em;
}

.amp-wp-article-content .wp-caption {
	max-width: 100%;
}

.amp-wp-article-content amp-img {
	margin: 0 auto;
}

.amp-wp-article-content amp-img.alignright {
	margin: 0 0 1em 16px;
}

.amp-wp-article-content amp-img.alignleft {
	margin: 0 16px 1em 0;
}

/* Captions */

.wp-caption {
	padding: 0;
}

.wp-caption.alignleft {
	margin-right: 16px;
}

.wp-caption.alignright {
	margin-left: 16px;
}

.wp-caption .wp-caption-text {
	border-bottom: 1px solid #c2c2c2;
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0;
	padding: .66em 10px .75em;
}

/* AMP Media */

.alignwide,
.alignfull {
	clear: both;
}

amp-carousel {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}
amp-iframe,
amp-youtube,
amp-instagram,
amp-vine {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}

.amp-wp-article-content amp-carousel amp-img {
	border: none;
}

amp-carousel > amp-img > img {
	object-fit: contain;
}

.amp-wp-iframe-placeholder {
	background: #c2c2c2 url( https://uzzz.org/wp-content/plugins/amp/assets/images/placeholder-icon.png ) no-repeat center 40%;
	background-size: 48px 48px;
	min-height: 48px;
}

/* Article Footer Meta */

.amp-wp-article-footer .amp-wp-meta {
	display: block;
}

.amp-wp-tax-category,
.amp-wp-tax-tag {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 1.5em 16px;
}

.amp-wp-comments-link {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	text-align: center;
	margin: 2.25em 0 1.5em;
}

.amp-wp-comments-link a {
	border-style: solid;
	border-color: #c2c2c2;
	border-width: 1px 1px 2px;
	border-radius: 4px;
	background-color: transparent;
	color: #0a89c0;
	cursor: pointer;
	display: block;
	font-size: 14px;
	font-weight: 600;
	line-height: 18px;
	margin: 0 auto;
	max-width: 200px;
	padding: 11px 16px;
	text-decoration: none;
	width: 50%;
	-webkit-transition: background-color 0.2s ease;
			transition: background-color 0.2s ease;
}

/* AMP Footer */

.amp-wp-footer {
	border-top: 1px solid #c2c2c2;
	margin: calc(1.5em - 1px) 0 0;
}

.amp-wp-footer div {
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: 1.25em 16px 1.25em;
	position: relative;
}

.amp-wp-footer h2 {
	font-size: 1em;
	line-height: 1.375em;
	margin: 0 0 .5em;
}

.amp-wp-footer p {
	color: #696969;
	font-size: .8em;
	line-height: 1.5em;
	margin: 0 85px 0 0;
}

.amp-wp-footer a {
	text-decoration: none;
}

.back-to-top {
	bottom: 1.275em;
	font-size: .8em;
	font-weight: 600;
	line-height: 2em;
	position: absolute;
	right: 16px;
}
		/* Inline stylesheets */
.htmledit_views{font-family:-apple-system,SF UI Text,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif,SimHei,SimSun}.htmledit_views a>amp-img{padding:1px;margin:1px;border:none;outline:#0782c1 solid 1px}.htmledit_views p{font-size:16px;color:#4d4d4d;font-weight:400;line-height:26px;margin:0 0 16px;overflow-x:auto}p[align=center]{text-align:center}.htmledit_views amp-img{max-width:100%}.htmledit_views strong,.htmledit_views strong span{font-weight:700}.htmledit_views *{box-sizing:border-box}.htmledit_views h1,.htmledit_views h3,.htmledit_views h4{color:#4f4f4f;margin:8px 0 16px;font-weight:700}.htmledit_views h1{font-size:28px;line-height:36px}.htmledit_views h3{font-size:22px;line-height:30px}.htmledit_views h4{font-size:20px;line-height:28px}.htmledit_views blockquote{display:block;padding:16px 16px 0;margin:0 0 24px;border-left:8px solid #dddfe4;background:#eef0f4;overflow:auto;overflow-scrolling:touch;word-wrap:normal;word-break:normal}.htmledit_views blockquote p{font-size:16px;line-height:26px;font-weight:400;margin-bottom:16px;color:#4f4f4f}.htmledit_views table tr{border:0;border-top:1px solid #ddd;background-color:#fff}.htmledit_views table{border-collapse:collapse;display:table;width:100%;text-align:left;margin-bottom:24px;margin-left:auto;margin-right:auto}.htmledit_views tbody{border:0}.htmledit_views table tr:nth-child(2n){background-color:#f7f7f7}.htmledit_views table tr td{border:1px solid #ddd;font-size:14px;color:#4f4f4f;line-height:22px;padding:8px;text-align:left}.htmledit_views table tr td p{font-size:14px;color:#4f4f4f;margin:0;padding:0;text-align:left;line-height:22px}.htmledit_views pre{white-space:pre-wrap;word-wrap:break-word;margin:0 0 24px;overflow-x:auto;padding:8px}.htmledit_views pre{font-family:Consolas,Inconsolata,Courier,monospace;font-size:14px;line-height:22px;color:#000}.htmledit_views a{color:#4ea1db;text-decoration:none}.htmledit_views a:focus,.htmledit_views a:hover{color:#ca0c16}.htmledit_views a:visited{color:#6795b5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-f27947e{font-size:14px;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-ba670eb{color:#f00}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-feb9b23{width:414px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-efde0e0{color:#0f0}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-244a7f3{text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-bea8ac4{color:#fff;background-color:#396}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-73b9e15{color:#000;background-color:#fff}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-9456def{color:#000}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-055ec14{color:#008080}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-93316a4{color:#00f}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-d75015b{color:#800000}	</style>
</head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="https://uzzz.org/">
										<amp-img src="https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png" width="32" height="32" class="amp-wp-site-icon"></amp-img>
						<span class="amp-site-title">
				有组织在!			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">Tor网络突破IP封锁，爬虫好搭档【入门手册】</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/e786821a74ef0467825a7d60183307bc?s=24&d=mm&r=g" alt="fandyvon" width="24" height="24" layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">fandyvon</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2016-07-29T17:47:00+00:00">
		4 years ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		<div id="article_content" class="article_content clearfix">
 
 
<div class="htmledit_views" id="content_views">
<div class="postBody">
<div id="cnblogs_post_body" class="blogpost-body">
<h1 class="amp-wp-244a7f3"><strong class="amp-wp-f27947e">本文地址：<a href="http://www.cnblogs.com/likeli/p/5719230.html" rel="nofollow" data-token="68207ae81195126c10443d9851879f00">http://www.cnblogs.com/likeli/p/5719230.html</a></strong></h1>
<h3>前言</h3>
<p>　　本文<span class="amp-wp-ba670eb"><strong>不提供任何搭梯子之类的内容</strong></span>，我在这里仅仅讨论网络爬虫遇到的IP封杀，然后使用Tor如何对抗这种封杀。作为一种技术上的研究讨论。</p>
<h3>场景</h3>
<p> 　　我们编写的网络爬虫全网采集的时候总会有一些网站有意识的保护自己的网站内容，以防止网络爬虫的抓取。常见的方式就是通过身份验证的方式来进行人机识别。也就是在登陆（查询）的入口增加或者加固防御。这些防御有那些呢？我目前见到的有：各种验证码、参数的加密、在前端JS挖坑、访问频率限制（IP黑名单）等。</p>
<p>　　其实前面的几种我们在某些情况下都是有办法解决的，我一一举例：</p>
<p>　　1、加密参数。其实老司机们都知道了，在客户端加密参数并没有什么卵用。因为爬虫完全可以将前端的js丢到一个游览器的内核环境中去执行js，这样的话，无论你怎么加密，都没有用，因为这和在游览器中运行没有什么区别，是无法进行人机识别的。</p>
<p>　　2、前端在Js脚本中挖坑。这是一些小聪明了，毕竟被抓取的网站方是这场战争的游戏规则制定者，他们能够自己制定规则，然后在没有什么漏洞的情况下，爬虫只能按照对方指定的规则一条条的来，一个坎一个坎的去跨。</p>
<p>　　这种情况下，网站开发人员在一大堆的js中藏着一小段预警js作为地雷。毕竟一般情况下，爬虫都是直接请求后得到的响应是一段html的文本，并不会执行其中的js。那么这样就区分出来了，网站方可以在页面加载后执行一段js，这段js不用和服务器通信，就是默默的执行。若是这段js执行了，说明访问者很可能是人，若是没有执行，那么这个访问真绝对是爬虫了。我们在正文请求中附带上的cookie中加上一个特定的标记。告诉服务器这个请求不是人发起的。服务器得到这个消息后，针对IP标记，但是这次请求是允许通过的（隐藏我们的判断依据）。下次或者这个IP访问几次后，就将这个IP拉入黑名单。 </p>
<p> 　  3、验证码，这东西是主要防御手段，这里不多说，我博客里面也有一篇关于这个文章。但是，只要技术能力足够，验证码还是会被突破的。君不见，12306验证码防御也没什么用。</p>
<p>　　4、IP黑名单，这个是依赖于上面的一个后台防御策略。但是再某种情况下，这种策略确实很有效，而且无解。</p>
<p>　　比如：有一个查询类的网站，通过限制IP的访问次数、频率就完全可以封锁或者限制爬虫，因为爬虫的意义就是自动化的、高效的得到数据。</p>
<h3>IP黑名单突破的方案</h3>
<p>     针对于采用黑名单的网站，我们可以使用的策略就是代理了，我们用各种方式弄到一大批的代理IP，然后通过使用这些代理IP去发起请求，IP被封锁了，就换下一个。</p>
<p>　　我们的主题，Tor网络也就用在这里了。</p>
<p>　　首先来科普一下：</p>
<p> </p>
<h3 align="left"><strong>关于Tor网络</strong></h3>
<p>官网：<a href="https://www.torproject.org/" rel="nofollow" data-token="c6efa564e657d301f3831ffb0149ab92">https://www.torproject.org/</a></p>
<p> <amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729155137309-1143455656.png" alt="" width="977" height="866" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729155137309-1143455656.png" alt="" width="977" height="866" class=""></noscript></amp-img></p>
<h3 align="left"><strong>Tor</strong><strong>是什么</strong></h3>
<p align="left">　　Tor是互联网上用于保护您隐私最有力的工具之一，但是时至今日仍有许多人往往认为Tor是一个终端加密工具。事实上，Tor是用来匿名浏览网页和邮件发送（并非是邮件内容加密）的。今天，我们要讨论一下Tor的是如何工作的、它做什么、不会做什么，以及我们该如何正确地使用它。</p>
<h3 align="left"><strong>Tor</strong><strong>的工作原理是这样的</strong></h3>
<div>
<blockquote>
<p align="left">当你通过Tor发送邮件时， tor会使用一种称为“洋葱路由”的加密技术通过网络随机生成的过程传送邮件。这有点像在一叠信中放了一封密信。网络中的每个节点都会解密消息（打开的最外信封），然后发送内部加密的内容（内密封的信封）至其下一个地址。这导致如果单看一个节点是看不了信的全部内容，并且该消息的传送路径难以追踪。</p>
</blockquote></div>
<p align="center" class="amp-wp-244a7f3"> <amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729155319263-428601237.jpg" alt="" width="640" height="312" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729155319263-428601237.jpg" alt="" width="640" height="312" class=""></noscript></amp-img></p>
<h3> 在Windows上使用Tor</h3>
<p> 　　windows上安装tor很简单，去Tor的官网下载安装洋葱游览器就可以了。</p>
<p>       当然，我们可以只安装Tor核心，不安装任何其他附属，然后我们去找个Tor控制器，去操作Tor就可以了。</p>
<p>       我这里有两个版本Tor控制器，Windows的Vidalia和OS X版本的Arm（Anonymizing Relay Monitor）这东西就Python开发的，可以完成Vidalia的绝大部分功能。</p>
<h4>windows上的Vidalia：</h4>
<p> <amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729162306575-667117241.png" alt="" width="406" height="420" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729162306575-667117241.png" alt="" width="406" height="420" class=""></noscript></amp-img></p>
<h4> Mac上的Arm：</h4>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729162329497-38841953.png" alt="" width="1146" height="911" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729162329497-38841953.png" alt="" width="1146" height="911"></noscript></amp-img></p>
<p>　　目前我使用的也就是在Mac上操作的Arm。我也是重点说Arm的。因为Window下的Tor通过C#或者Python控制都不行，不得已的情况下，换到了OS X/Linux的环境下来控制Tor。</p>
<h3>安装Tor、Arm</h3>
<p>　　首先我们得下载安装了，好消息是，Arm和Tor大部分的包管理器都有，我们可以直接下载。通过包管理器下载后，会自动安装，并完成初始化配置。</p>
<p>　　例如我在Mac上的安装以及配置：</p>
<div class="cnblogs_code">
<pre><span class="amp-wp-9456def">brew install tor
brew install arm</span></pre>
</div>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729163106044-668571521.png" alt="" width="1640" height="1292" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729163106044-668571521.png" alt="" width="1640" height="1292" class=""></noscript></amp-img></p>
<p> 我们另外需要安装Privoxy，需要通过Privoxy来将Socks5转换成Http。</p>
<div class="cnblogs_code">
<pre>brew install Privoxy</pre>
</div>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729164422731-557142660.png" alt="" width="1696" height="1348" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729164422731-557142660.png" alt="" width="1696" height="1348" class=""></noscript></amp-img></p>
<p><span class="amp-wp-ba670eb">最后，我们还需要一个前置代理，因为Tor网络，在国内是不能访问的。所以我们需要一个在国外的前置代理，目前我自己已经搭建好了一个位于加拿大的VPN，这里可以直接用的。</span></p>
<h3>配置Tor、Arm</h3>
<p>　　我们需要做一些配置，我先给一张我的配置图：</p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729164737231-776872334.png" alt="" width="1888" height="1516" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729164737231-776872334.png" alt="" width="1888" height="1516" class=""></noscript></amp-img></p>
<p>这是从已经配置好的Arm看到的。如上图，绿色的字体就是我给torrc配置文件增加的内容。</p>
<p>我们修改配置就是在 <strong><span class="amp-wp-bea8ac4">/Users/ Likeli/.arm/torrc</span> </strong>路径（Mac下的路径）。完成以上修改。</p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729165707559-130516790.png" alt="" width="1472" height="1100" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729165707559-130516790.png" alt="" width="1472" height="1100" class=""></noscript></amp-img></p>
<p>关于重要参数的说明：</p>
<table border="0" class="amp-wp-feb9b23">
<tbody>
<tr>
<td class="amp-wp-244a7f3"><strong>参数</strong></td>
<td><strong>说明</strong></td>
</tr>
<tr>
<td><span class="amp-wp-efde0e0"><strong>ControlPort</strong></span></td>
<td>控制程序访问的端口（重要）</td>
</tr>
<tr>
<td><span class="amp-wp-efde0e0"><strong>Socks5Proxy</strong></span></td>
<td>前置代理端口</td>
</tr>
<tr>
<td><span class="amp-wp-efde0e0"><strong>SocksProt</strong></span></td>
<td>外部程序访问Tor的端口</td>
</tr>
<tr>
<td><span class="amp-wp-efde0e0"><strong>MaxCircuitDirtiness</strong></span></td>
<td>自动切换Identity的时间间隔</td>
</tr>
</tbody>
</table>
<p class="amp-wp-244a7f3"> </p>
<p class="amp-wp-244a7f3"> </p>
<p class="amp-wp-244a7f3"> </p>
<p class="amp-wp-244a7f3"> </p>
<p class="amp-wp-244a7f3">除了这些参数，其实还有很多的备选参数，详细说明请查看tor帮助文档，以上配置也是我从tor的官方帮助文档中找到的。</p>
<div class="cnblogs_code">
<pre>man tor</pre>
</div>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729165641559-396316565.png" alt="" width="2008" height="1376" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729165641559-396316565.png" alt="" width="2008" height="1376" class=""></noscript></amp-img></p>
<p>好了，配置完成了，现在去出去启动Arm，完成初始化。</p>
<p>在终端运行Arm，我直接用Mac 的截图工具，貌似不能构绘制圆圈勾选，这里提供几张别出弄来的图，按照选择就ok了。</p>
<p>Arm配置源地址：https://program-think.blogspot.com/2015/03/Tor-Arm.html?utm_source=tuicool&utm_medium=referral</p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729170835216-1926123223.png" alt="" width="1019" height="630" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729170835216-1926123223.png" alt="" width="1019" height="630" class=""></noscript></amp-img></p>
<p> </p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729170845278-240617542.png" alt="" width="1014" height="451" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729170845278-240617542.png" alt="" width="1014" height="451" class=""></noscript></amp-img></p>
<p> </p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729170850997-961743564.png" alt="" width="1095" height="606" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729170850997-961743564.png" alt="" width="1095" height="606" class=""></noscript></amp-img></p>
<h3>配置好了，然后启动，启动成功后如下图：</h3>
<p>下方的启动日志显示，启动进度100%。</p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729171221216-1076342200.png" alt="" width="2008" height="1376" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729171221216-1076342200.png" alt="" width="2008" height="1376" class=""></noscript></amp-img></p>
<p>好了，到这一步，其实代理已经通了，来测一测。</p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729171413169-1450806042.png" alt="" width="1886" height="1570" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729171413169-1450806042.png" alt="" width="1886" height="1570" class=""></noscript></amp-img></p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729171425966-846981714.png" alt="" width="1886" height="1570" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729171425966-846981714.png" alt="" width="1886" height="1570" class=""></noscript></amp-img></p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729171438731-1063448222.png" alt="" width="1886" height="1570" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729171438731-1063448222.png" alt="" width="1886" height="1570" class=""></noscript></amp-img></p>
<p>　　好了，搞定了，目前Tor的Socks5代理已经接通，我们直接连接127.0.0.1:9000就可以了。这里的端口是自己根据上面的配置来的。</p>
<h3>收尾</h3>
<p>　　虽然代理通了，但是还有问题，因为一般我们都是用的Http的代理。所以我们需要将Socks5代理转换成Http代理来方便我们的应用程序使用。</p>
<p>　　这里用到的工具是：Privoxy（上面的步骤中，已经通过软件库安装了）</p>
<p>　　我们需要对这个做一下一点点配置修改。</p>
<p>我们安装Privoxy后，打开它的配置文件：</p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729172334638-992317939.png" alt="" width="1696" height="844" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729172334638-992317939.png" alt="" width="1696" height="844" class=""></noscript></amp-img></p>
<p>打开后，搜索 <strong><span class="amp-wp-bea8ac4">127.0.0.1:9050</span></strong></p>
<p>找到下图中的为之后，另起一行，插入 <strong><span class="amp-wp-bea8ac4">forward-socks5 / 127.0.0.1:9000  .</span></strong></p>
<p><amp-img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729172353372-1215531549.png" alt="" width="1712" height="1324" class="amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="https://uzshare.com/_p?https://images2015.cnblogs.com/blog/624228/201607/624228-20160729172353372-1215531549.png" alt="" width="1712" height="1324" class=""></noscript></amp-img></p>
<p>配置完成后保存关闭，若是我们尝试连接本地的8118端口，也就是 <strong><span class="amp-wp-bea8ac4">127.0.0.1:8118</span></strong></p>
<p>若是连接不上，重启一下服务，或者重启电脑。</p>
<p>这里的8118端口也是可以修改的，若是修改，请直接在Privoxy的配置文件中搜索127.0.0.1:8118，并修改8118端口就可以了。</p>
<p>到这里我们就完成了所有的配置了，任何程序直接访问<strong><span class="amp-wp-bea8ac4">127.0.0.1:8118</span></strong>，并将至设置为代理，就可以躲避网站的IP限制了。</p>
<h3><span class="amp-wp-73b9e15">最后</span></h3>
<p>　　以上中测试代理可以在Chrome中安装SwitchySharp插件，然后稍加配置就可以了。</p>
<p>　　好了，自由享受无限IP的刺激把，如此以后，IP黑名单（IP封锁）形同虚设~</p>
<p> 　 最后附上Python控制Tor切换IP的样例代码：来源（<a href="https://stackoverflow.com/questions/9887505/how-to-change-tor-identity-in-python" rel="nofollow" data-token="9664ad26e7e7a546a76612b3e3844e4e">https://stackoverflow.com/questions/9887505/how-to-change-tor-identity-in-python</a>）</p>
<div class="cnblogs_code">
<pre><span class="amp-wp-055ec14"> 1</span> <span class="amp-wp-93316a4">import</span><span class="amp-wp-9456def"> urllib2
</span><span class="amp-wp-055ec14"> 2</span> <span class="amp-wp-93316a4">from</span> TorCtl <span class="amp-wp-93316a4">import</span><span class="amp-wp-9456def"> TorCtl
</span><span class="amp-wp-055ec14"> 3</span> 
<span class="amp-wp-055ec14"> 4</span> proxy_support = urllib2.ProxyHandler({<span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">http</span><span class="amp-wp-d75015b">"</span> : <span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">127.0.0.1:8118</span><span class="amp-wp-d75015b">"</span><span class="amp-wp-9456def">})
</span><span class="amp-wp-055ec14"> 5</span> opener =<span class="amp-wp-9456def"> urllib2.build_opener(proxy_support) 
</span><span class="amp-wp-055ec14"> 6</span> 
<span class="amp-wp-055ec14"> 7</span> <span class="amp-wp-93316a4">def</span><span class="amp-wp-9456def"> newId():
</span><span class="amp-wp-055ec14"> 8</span>     conn = TorCtl.connect(controlAddr=<span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">127.0.0.1</span><span class="amp-wp-d75015b">"</span>, controlPort=9051, passphrase=<span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">your_password</span><span class="amp-wp-d75015b">"</span><span class="amp-wp-9456def">)
</span><span class="amp-wp-055ec14"> 9</span>     conn.send_signal(<span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">NEWNYM</span><span class="amp-wp-d75015b">"</span><span class="amp-wp-9456def">)
</span><span class="amp-wp-055ec14">10</span> 
<span class="amp-wp-055ec14">11</span> <span class="amp-wp-93316a4">for</span> i <span class="amp-wp-93316a4">in</span> range(0, 10<span class="amp-wp-9456def">):
</span><span class="amp-wp-055ec14">12</span>     <span class="amp-wp-93316a4">print</span> <span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">case </span><span class="amp-wp-d75015b">"</span>+str(i+1<span class="amp-wp-9456def">)
</span><span class="amp-wp-055ec14">13</span> <span class="amp-wp-9456def">    newId()
</span><span class="amp-wp-055ec14">14</span>     proxy_support = urllib2.ProxyHandler({<span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">http</span><span class="amp-wp-d75015b">"</span> : <span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">127.0.0.1:8118</span><span class="amp-wp-d75015b">"</span><span class="amp-wp-9456def">})
</span><span class="amp-wp-055ec14">15</span> <span class="amp-wp-9456def">    urllib2.install_opener(opener)
</span><span class="amp-wp-055ec14">16</span>     <span class="amp-wp-93316a4">print</span>(urllib2.urlopen(<span class="amp-wp-d75015b">"</span><span class="amp-wp-d75015b">http://www.ifconfig.me/ip</span><span class="amp-wp-d75015b">"</span>).read())</pre>
</div>
<p> </p>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
    </div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>
</div>
</div>
</div>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: Uncategorized	</div>

	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>有组织在!</h2>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>



</body>
</html>
