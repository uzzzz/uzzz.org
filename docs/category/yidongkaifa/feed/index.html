<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>移动开发 &#8211; 有组织在!</title>
	<atom:link href="https://uzzz.org/category/yidongkaifa/feed" rel="self" type="application/rss+xml" />
	<link>https://uzzz.org/</link>
	<description></description>
	<lastBuildDate>Thu, 04 Jul 2019 13:27:19 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.2.4</generator>

<image>
	<url>https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png</url>
	<title>移动开发 &#8211; 有组织在!</title>
	<link>https://uzzz.org/</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Android9.0网络兼容和依赖适配问题</title>
		<link>https://uzzz.org/article/2238.html</link>
				<pubDate>Thu, 04 Jul 2019 13:27:19 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/2238.html</guid>
				<description><![CDATA[&#160; &#160; &#160; &#160; 客观来说，9.0兼容好像问题不是很大，很多的APP一点问题都没有，但是有些比较旧的APP就问题比较多了，下面简单写一下解决方法，本文纯属笔记，方便以后查看。 网络问题： 问题一 应对9.0 版本的网络明暗流量问题 设置一下 application （清单文件里面） &#60;application android:usesCleartextTraffic="true" &#62; 问题二 引用httpclient的报错 java.lang.NoClassDefFoundError: Failed resolution of: Lorg/apache/commons/logging/LogFactory; Caused by: java.lang.ClassNotFoundException: Didn&#8217;t find class &#8220;org.apache.commons.logging.LogFactory&#8221; on path: DexPathList[[zip file &#8220;/data/app/com.inno.nestlesuper- oPFXtK6GZQsOCWb8lvmj2g==/base.apk&#8221;],nativeLibraryDirectories= [/data/app/com.inno.nestlesuper-oPFXtK6GZQsOCWb8lvmj2g==/lib/arm, /data/app/com.inno.nestlesuper-oPFXtK6GZQsOCWb8lvmj2g==/base.apk!/lib/armeabi, /system/lib, /vendor/lib]] 主要问题是 9.0版本谷歌不支持这两个网络包了需要自己导进去支持来规避兼容问题。 api files('libs/httpclient-4.3.6.jar') api files('libs/httpcore-4.3.2.jar') 然后 解决方法如下： 下载导入一个commons-logging的jar包 api files('libs/commons-logging-1.2.jar') &#160;自此网络问题解决。 当然使用jar毕竟麻烦，时不时更新就需要改动，在此用新的方法： 在AndroidManifest.xml下的&#60;application&#62;节点加入以下相关依赖（如果项目继续使用Apache的httpclient），这是因为httpclient在Android6.0就已经被废弃了，如果不想大变动我们可以将这个库强制依赖进来，避免报错。 &#60;uses-library android:name="org.apache.http.legacy" android:required="false" /&#62; 同时在app目录下build.gradle的android节点加入httpclient依赖： useLibrary 'org.apache.http.legacy' Android9.0官方要求中，禁止传输接收没加密的数据，也就是说对网络数据传输这一块做了限制，我们需要在AndroidManifest.xml中的&#60;application&#62;节点内加入网络安全配置： &#60;application android:networkSecurityConfig="@xml/network_security_config" tools:replace="android:theme,android:allowBackup"&#62; &#160;其中network_security_config.xml在xml目录如下： &#60;?xml version="1.0" encoding="utf-8"?&#62; &#60;network-security-config&#62; &#60;base-config cleartextTrafficPermitted="true" /&#62; &#60;/network-security-config&#62; &#160; 依赖问题 我们升级SDK编译版本和目标版本为28时，我们需要改动相应的依赖版本： implementation 'com.android.support:appcompat-v7:28.0.0' implementation 'com.android.support:support-v4:28.0.0' 冲突Program type already present 下面是一个项目build.gradle中的依赖，我们简单做一下分类 网络相关 okhttp retrofit http-legacy 常用类库 rxpermission(权限监测) leakcanary(内存泄漏) BaseRecycleViewAdapterHelper(star较多的Adapter) rxjava2 smartRefreshLayout(刷新) 不常用 bmob(消息推送) jsoup(html解析器) 异常 当我们运行时，会发生异常 查看异常 自带工具查看 如果你觉得标识的不太清晰，可以点击如图所示图标，展开信息 通过指令将异常保存 gradlew build &#8211;stacktrace &#62; logs.txt 2&#62;logErrors.txt 编译前，请确认gradle环境变量已配置，关于build Task请查看Gradle总结。 通过上述指令，将信息分别保存到上述文件中(默认项目根目录)： logs.txt:编译过程信息 logErrors.txt：异常信息 logs、logErrors信息如下： 分析异常 在logErrors中看到Program type already present: okio.AsyncTimeout$1，如何查看是否有多个的Okio文件呢？ 通过搜索栏查看 双击Shift，在搜索框中输入Okio，可以看到有2条okio的信息 在Terminal中输入指令 gradlew -q app:dependencies 在External Libraries中查看对应依赖 解决 Group与module的区别 要解决上述问题，首先要明白Group与module的区别，然而搜索了一遍，好像网上没有给出比较清晰的解释，而这些又是解决依赖冲突这些问题首先要明白的问题，本人在摸索中，稍微总结了一下(如有问题，还请包含) Module 具有独立功能的模块 Module中可能还包含有Module implementation分号之后的部分 Group Module的集合 implementation分号之前的部分 实例分析 以下图为例，加入我们要了解com.android.support:design:26.1.0中，group和module分别是哪些呢？ 在Terminal中输入指令 gradlew -q app:dependencies 在 Maven Repository中查找com.android.support:design:26.1.0 可以清晰的看到，group为：com.android.support， module为下面的内容： support-v4 appcompat-v7 recyclerview-v7 transition 解决依赖 解决依赖本文提供两种方式 exclude方式 特点： 配置较为麻烦，需要在引起冲突的每个依赖上进行exclude操作 配置繁琐，不美观 通过configurations方式 特点： 在configurations中，统一指定要配置的方式 配置简单，较为整洁 通过configurations.all同一版本 当然还有其他的依赖问题，后续再补充。&#160; &#160; 屏幕适配 屏幕适配基本和9.0之前版本没多大差异，除了再增加下刘海屏处理： // 9.0以上刘海屏适配 if (Build.VERSION.SDK_INT &#62;= Build.VERSION_CODES.P) { WindowManager.LayoutParams lp =]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div class="htmledit_views" id="content_views">
<p>&nbsp; &nbsp; &nbsp; &nbsp; 客观来说，9.0兼容好像问题不是很大，很多的APP一点问题都没有，但是有些比较旧的APP就问题比较多了，下面简单写一下解决方法，本文纯属笔记，方便以后查看。</p>
<h3>网络问题：</h3>
<p><strong>问题一</strong></p>
<p>应对9.0 版本的网络明暗流量问题</p>
<p>设置一下 application （清单文件里面）</p>
<pre class="has">
<code class="hljs"> &lt;application
       android:usesCleartextTraffic="true" 
  &gt;
</code></pre>
<p>问题二</p>
<p>引用httpclient的报错</p>
<blockquote>
<p>java.lang.NoClassDefFoundError: Failed resolution of: Lorg/apache/commons/logging/LogFactory;</p>
<p>Caused by: java.lang.ClassNotFoundException: Didn&#8217;t find class &#8220;org.apache.commons.logging.LogFactory&#8221; on path: DexPathList[[zip file &#8220;/data/app/com.inno.nestlesuper- oPFXtK6GZQsOCWb8lvmj2g==/base.apk&#8221;],nativeLibraryDirectories= [/data/app/com.inno.nestlesuper-oPFXtK6GZQsOCWb8lvmj2g==/lib/arm, /data/app/com.inno.nestlesuper-oPFXtK6GZQsOCWb8lvmj2g==/base.apk!/lib/armeabi, /system/lib, /vendor/lib]]</p>
</blockquote>
<p>主要问题是 9.0版本谷歌不支持这两个网络包了需要自己导进去支持来规避兼容问题。</p>
<pre class="has">
<code class="hljs">api files('libs/httpclient-4.3.6.jar')
api files('libs/httpcore-4.3.2.jar')</code></pre>
<p>然后 解决方法如下：<br /> 下载导入一个commons-logging的jar包</p>
<pre class="has">
<code class="hljs">api files('libs/commons-logging-1.2.jar')</code></pre>
<p>&nbsp;自此网络问题解决。</p>
<p>当然使用jar毕竟麻烦，时不时更新就需要改动，在此用新的方法：</p>
<p>在AndroidManifest.xml下的&lt;application&gt;节点加入以下相关依赖（如果项目继续使用Apache的httpclient），这是因为httpclient在Android6.0就已经被废弃了，如果不想大变动我们可以将这个库强制依赖进来，避免报错。</p>
<pre class="has">
<code class="hljs">       &lt;uses-library
            android:name="org.apache.http.legacy"
            android:required="false" /&gt;
</code></pre>
<p>同时在app目录下build.gradle的android节点加入httpclient依赖：</p>
<pre class="has">
<code class="hljs"> useLibrary 'org.apache.http.legacy'
</code></pre>
<p>Android9.0官方要求中，禁止传输接收没加密的数据，也就是说对网络数据传输这一块做了限制，我们需要在AndroidManifest.xml中的&lt;application&gt;节点内加入网络安全配置：</p>
<pre class="has">
<code class="hljs"> &lt;application     
        android:networkSecurityConfig="@xml/network_security_config"
        tools:replace="android:theme,android:allowBackup"&gt;
</code></pre>
<p>&nbsp;其中<strong>network_security_config.xml</strong>在xml目录如下：</p>
<pre class="has">
<code class="hljs">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;network-security-config&gt;
    &lt;base-config cleartextTrafficPermitted="true" /&gt;
&lt;/network-security-config&gt;
</code></pre>
<p>&nbsp;</p>
<h3>依赖问题</h3>
<p>我们升级SDK编译版本和目标版本为28时，我们需要改动相应的依赖版本：</p>
<pre class="has">
<code class="hljs">implementation 'com.android.support:appcompat-v7:28.0.0'
implementation 'com.android.support:support-v4:28.0.0'</code></pre>
<h3><strong>冲突Program type already present</strong></h3>
<p>下面是一个项目build.gradle中的依赖，我们简单做一下分类</p>
<h3><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451465"><br /><strong>网络相关</strong></h3>
<p>okhttp<br /> retrofit<br /> http-legacy</p>
<h3> 常用类库</h3>
<p>rxpermission(权限监测)<br /> leakcanary(内存泄漏)<br /> BaseRecycleViewAdapterHelper(star较多的Adapter)<br /> rxjava2<br /> smartRefreshLayout(刷新)</p>
<h3> 不常用</h3>
<p>bmob(消息推送)<br /> jsoup(html解析器)</p>
<h3> 异常</h3>
<p>当我们运行时，会发生异常</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451484"><br /><strong>查看异常</strong></p>
<p>自带工具查看</p>
<p>如果你觉得标识的不太清晰，可以点击如图所示图标，展开信息</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451506"><br /> 通过指令将异常保存</p>
<blockquote>
<p>gradlew build &#8211;stacktrace &gt; logs.txt 2&gt;logErrors.txt</p>
</blockquote>
<p>编译前，请确认gradle环境变量已配置，关于build Task请查看Gradle总结。</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451551"><br /> 通过上述指令，将信息分别保存到上述文件中(默认项目根目录)：</p>
<p>logs.txt:编译过程信息<br /> logErrors.txt：异常信息</p>
<p> logs、logErrors信息如下：</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451569"><br /> 分析异常</p>
<p>在logErrors中看到Program type already present: okio.AsyncTimeout$1，如何查看是否有多个的Okio文件呢？</p>
<p>通过搜索栏查看</p>
<p>双击Shift，在搜索框中输入Okio，可以看到有2条okio的信息</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451594"><br /> 在Terminal中输入指令</p>
<blockquote>
<p>gradlew -q app:dependencies</p>
</blockquote>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451612"><br /> 在External Libraries中查看对应依赖</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451630"></p>
<h3>解决</h3>
<p><strong>Group与module的区别</strong></p>
<p>要解决上述问题，首先要明白Group与module的区别，然而搜索了一遍，好像网上没有给出比较清晰的解释，而这些又是解决依赖冲突这些问题首先要明白的问题，本人在摸索中，稍微总结了一下(如有问题，还请包含)</p>
<p><strong>Module</strong></p>
<p>具有独立功能的模块<br /> Module中可能还包含有Module<br /> implementation分号之后的部分</p>
<p><strong>Group</strong></p>
<p>Module的集合<br /> implementation分号之前的部分<br /> 实例分析</p>
<p>以下图为例，加入我们要了解com.android.support:design:26.1.0中，group和module分别是哪些呢？</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451648"><br /> 在Terminal中输入指令</p>
<blockquote>
<p>gradlew -q app:dependencies</p>
</blockquote>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451754"><br /> 在 Maven Repository中查找com.android.support:design:26.1.0</p>
<p>可以清晰的看到，group为：com.android.support，</p>
<p>module为下面的内容：</p>
<p>support-v4<br /> appcompat-v7<br /> recyclerview-v7<br /> transition</p>
<h3><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451772"><br /> 解决依赖</h3>
<p>解决依赖本文提供两种方式</p>
<h3>exclude方式</h3>
<p>特点：</p>
<p>配置较为麻烦，需要在引起冲突的每个依赖上进行exclude操作<br /> 配置繁琐，不美观</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451795"><br /> 通过configurations方式</p>
<p>特点：</p>
<p>在configurations中，统一指定要配置的方式<br /> 配置简单，较为整洁</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451815"><br /> 通过configurations.all同一版本</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181222215451835"></p>
<p>当然还有其他的依赖问题，后续再补充。&nbsp;</p>
<p>&nbsp;</p>
<h3>屏幕适配</h3>
<p>屏幕适配基本和9.0之前版本没多大差异，除了再增加下刘海屏处理：</p>
<pre class="has">
<code class="hljs">// 9.0以上刘海屏适配
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) {
            WindowManager.LayoutParams lp = getWindow().getAttributes();
            lp.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES;
            getWindow().setAttributes(lp);
        }</code></pre>
<p>&nbsp;</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>WWDC2019 &#8212;&#8212;iOS13适配（持续更新）</title>
		<link>https://uzzz.org/article/1333.html</link>
				<pubDate>Sat, 15 Jun 2019 15:08:26 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[iOS]]></category>
		<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/1333.html</guid>
				<description><![CDATA[第一、Web Content适配 https://developer.apple.com/videos/play/wwdc2019/511/ https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme 问题展示 先看两张图： 如上图所示，如果h5未适配dark模式，则在dark模式下原来的页面内容展示就就存在问题。 适配方法 这里主要介绍基于CSS样式的修改来适配web内容 首先，一定要声明当前支持的color-scheme有两种样式，这一句很重要，用东北话说就是“必须的” :root { color-scheme: light dark; } 适配的策略就是为两种color-scheme设置不同的颜色样式。 1、文本适配 如图一，它的CSS描述为 body { color: black; } h1 { color: #333; } .header { background-color: #593a78; color: white; } 这里相关的颜色样式都是写死的，所以dark模式下才会出现图二的情况。现在我们来看如何适配下面这段代码： h1 { color: #333; } .header { background-color: #593a78; color: white; } 然后可用如下方式改造： :root { color-scheme: light dark; --post-title-color: #333; --header-bg-color: #593a78; --header-txt-color: white; } h1 { color: var(--post-title-color); } .header { background-color: var(--header-bg-color); color: var(--header-txt-color); } 这里所做的工作实际上是抽象了颜色的值的setter和getter，即不同模式下的值统一定义，然后使用时通过var()去自动获取。 而结合@media与prefers-color-scheme,颜色值的定义可以更加清晰： @media (prefers-color-scheme: dark) { :root { --post-title-color: white; --header-bg-color: #513d66; --header-txt-color: #eee; } } 同理可以定义light模式下的色值。 2、图片适配 假设原文件有一幅图片资源，其CSS描述如下： &#60;img src="mojave-day.jpg"&#62; 那么，可以通过下面的方式来达到适配两种模式的目的： &#60;picture&#62; &#60;source srcset="mojave-night.jpg" media="(prefers-color-scheme: dark)"&#62; &#60;img src="mojave-day.jpg"&#62; &#60;/picture&#62; 3、动态内容适配 动态内容适配需要注意：WebKit提供了获取指定模式下需要适配的多媒体项的能力，以及不同模式间切换的通知，一般情况下，通过下面的方式可以完成适配： // Adapting dynamic content to dark mode with JavaScript let darkModeMediaQuery = window.matchMedia("(prefers-color-scheme: dark)"); function updateForDarkModeChange() { if (darkModeMediaQuery.matches) { ... } else { ... } } darkModeMediaQuery.addListener(updateForDarkModeChange); updateForDarkModeChange(); // Handle if Dark Mode is already active. 所以，这里很显然要处理light2dark和dark2light等情形。&#160; &#160; 如果需要更深度的定制，需h5与客户端评估是否需要注入js变量来判断当前模式。如果涉及服务端的直接适配，则可考虑在UA中添加识别信息。 4、小结： 使用 color-scheme 来声明支持的模式； 利用prefers-color-scheme来设置不同模式下的配置； 利用&#60;picture&#62; 标签设置不同模式下的图片； 利用var() 方法来适配不同模式下的变量取值； 动态内容适配视具体情况而定。 &#160;]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<h1>第一、Web Content适配</h1>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/511/" rel="nofollow" data-token="db1a7093653219e7a45ee0938eb01598">https://developer.apple.com/videos/play/wwdc2019/511/</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme" rel="nofollow" data-token="ccdd9b15b3cc1cafc76ae55f1420d3e1">https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme</a></p>
<h2>问题展示</h2>
<p>先看两张图：</p>
<p><img alt="" class="has" height="500" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190615223143824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MTM5NTU=,size_16,color_FFFFFF,t_70" width="300"><img alt="" class="has" height="500" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190615223309706.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MTM5NTU=,size_16,color_FFFFFF,t_70" width="300"></p>
<p>如上图所示，如果h5未适配dark模式，则在dark模式下原来的页面内容展示就就存在问题。</p>
<h2>适配方法</h2>
<p>这里主要介绍基于CSS样式的修改来适配web内容</p>
<p>首先，一定要声明当前支持的color-scheme有两种样式，这一句很重要，用东北话说就是“必须的”</p>
<pre class="has">
<code class="language-css">:root {
    color-scheme: light dark;
}</code></pre>
<p>适配的策略就是为两种color-scheme设置不同的颜色样式。</p>
<h3>1、文本适配</h3>
<p>如图一，它的CSS描述为</p>
<pre class="has">
<code class="language-css"> body {
     color: black;
 }
 h1 {
     color: #333;
 }
 .header {
    background-color: #593a78;
    color: white;
 }</code></pre>
<p>这里相关的颜色样式都是写死的，所以dark模式下才会出现图二的情况。现在我们来看如何适配下面这段代码：</p>
<pre class="has">
<code class="language-css">
h1 {
    color: #333;
}
.header {
    background-color: #593a78;
    color: white;
}</code></pre>
<p>然后可用如下方式改造：</p>
<pre class="has">
<code class="language-css">:root {
    color-scheme: light dark; 
    --post-title-color: #333;
    --header-bg-color: #593a78;
    --header-txt-color: white;
}


h1 {
    color: var(--post-title-color);
}
.header {
    background-color: var(--header-bg-color);
    color: var(--header-txt-color);
}</code></pre>
<p>这里所做的工作实际上是抽象了颜色的值的setter和getter，即不同模式下的值统一定义，然后使用时通过var()去自动获取。</p>
<p>而结合@media与prefers-color-scheme,颜色值的定义可以更加清晰：</p>
<pre class="has">
<code class="language-css">@media (prefers-color-scheme: dark) {
    :root {
        --post-title-color: white;
        --header-bg-color: #513d66;
        --header-txt-color: #eee;
    }
}</code></pre>
<p>同理可以定义light模式下的色值。</p>
<h3>2、图片适配</h3>
<p>假设原文件有一幅图片资源，其CSS描述如下：</p>
<pre class="has">
<code class="language-css">&lt;img src="mojave-day.jpg"&gt;</code></pre>
<p>那么，可以通过下面的方式来达到适配两种模式的目的：</p>
<pre class="has">
<code class="language-css">&lt;picture&gt;
    &lt;source srcset="mojave-night.jpg" media="(prefers-color-scheme: dark)"&gt;
    &lt;img src="mojave-day.jpg"&gt;
&lt;/picture&gt;</code></pre>
<h3>3、动态内容适配</h3>
<p>动态内容适配需要注意：WebKit提供了获取指定模式下需要适配的多媒体项的能力，以及不同模式间切换的通知，一般情况下，通过下面的方式可以完成适配：</p>
<pre class="has">
<code class="language-css">// Adapting dynamic content to dark mode with JavaScript
let darkModeMediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
function updateForDarkModeChange() {
    if (darkModeMediaQuery.matches) {
        ...
    } else {
        ...
    }
}
darkModeMediaQuery.addListener(updateForDarkModeChange);
updateForDarkModeChange(); // Handle if Dark Mode is already active.</code></pre>
<p>所以，这里很显然要处理light2dark和dark2light等情形。&nbsp; &nbsp;</p>
<p>如果需要更深度的定制，需h5与客户端评估是否需要注入js变量来判断当前模式。如果涉及服务端的直接适配，则可考虑在UA中添加识别信息。</p>
<h3>4、小结：</h3>
<ul>
<li>使用 color-scheme 来声明支持的模式；</li>
<li>利用prefers-color-scheme来设置不同模式下的配置；</li>
<li>利用&lt;picture&gt; 标签设置不同模式下的图片；</li>
<li>利用var() 方法来适配不同模式下的变量取值；</li>
<li>动态内容适配视具体情况而定。</li>
</ul>
<p>&nbsp;</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>Flutter资源管理</title>
		<link>https://uzzz.org/article/1507.html</link>
				<pubDate>Thu, 16 May 2019 11:41:22 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[前端]]></category>
		<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/1507.html</guid>
				<description><![CDATA[资源管理 Flutter应用程序可以包含代码和 assets（有时称为资源）。assets是会打包到程序安装包中的，可在运行时访问。常见类型的assets包括静态数据（例如JSON文件）、配置文件、图标和图片（JPEG，WebP，GIF，动画WebP / GIF，PNG，BMP和WBMP）等。 指定 assets 和包管理一样，Flutter也使用pubspec.yaml文件来管理应用程序所需的资源。举一个例子: flutter: assets: - assets/my_icon.png - assets/background.png assets指定应包含在应用程序中的文件。 每个asset都通过相对于pubspec.yaml文件所在位置的显式路径进行标识。asset的声明顺序是无关紧要的。asset的实际目录可以是任意文件夹（在本示例中是assets）。 在构建期间，Flutter将asset放置到称为&#160;asset bundle&#160;的特殊存档中，应用程序可以在运行时读取它们（但不能修改）。 Asset 变体（variant） 构建过程支持asset变体的概念：不同版本的asset可能会显示在不同的上下文中。 在pubspec.yaml的assets部分中指定asset路径时，构建过程中，会在相邻子目录中查找具有相同名称的任何文件。这些文件随后会与指定的asset一起被包含在asset bundle中。 例如，如果应用程序目录中有以下文件: …/pubspec.yaml …/graphics/my_icon.png …/graphics/background.png …/graphics/dark/background.png …etc. 然后pubspec.yaml文件中只需包含: flutter: assets: - graphics/background.png 那么这两个graphics/background.png和graphics/dark/background.png&#160;都将包含在您的asset bundle中。前者被认为是main asset&#160;（主资源），后者被认为是一种变体（variant）。 在选择匹配当前设备分辨率的图片时，Flutter会使用到asset变体（见下文），将来，Flutter可能会将这种机制扩展到本地化、阅读提示等方面。 加载 assets 您的应用可以通过AssetBundle对象访问其asset 。有两种主要方法允许从Asset bundle中加载字符串或图片(二进制)文件。 加载文本assets 通过rootBundle&#160;对象加载：每个Flutter应用程序都有一个rootBundle对象， 通过它可以轻松访问主资源包，直接使用package:flutter/services.dart中全局静态的rootBundle对象来加载asset即可。 通过&#160;DefaultAssetBundle&#160;加载：建议使用&#160;DefaultAssetBundle&#160;来获取当前BuildContext的AssetBundle。 这种方法不是使用应用程序构建的默认asset bundle，而是使父级widget在运行时动态替换的不同的AssetBundle，这对于本地化或测试场景很有用。 通常，可以使用DefaultAssetBundle.of()在应用运行时来间接加载asset（例如JSON文件），而在widget上下文之外，或其它AssetBundle句柄不可用时，可以使用rootBundle直接加载这些asset，例如： import 'dart:async' show Future; import 'package:flutter/services.dart' show rootBundle; Future&#60;String&#62; loadAsset() async { return await rootBundle.loadString('assets/config.json'); } 加载图片 类似于原生开发，Flutter也可以为当前设备加载适合其分辨率的图像。 声明分辨率相关的图片 assets AssetImage&#160;可以将asset的请求逻辑映射到最接近当前设备像素比例(dpi)的asset。为了使这种映射起作用，必须根据特定的目录结构来保存asset： …/image.png …/Mx/image.png …/Nx/image.png …etc. 其中M和N是数字标识符，对应于其中包含的图像的分辨率，也就是说，它们指定不同设备像素比例的图片。 主资源默认对应于1.0倍的分辨率图片。看一个例子： …/my_icon.png …/2.0x/my_icon.png …/3.0x/my_icon.png 在设备像素比率为1.8的设备上，.../2.0x/my_icon.png&#160;将被选择。对于2.7的设备像素比率，.../3.0x/my_icon.png将被选择。 如果未在Image&#160;widget上指定渲染图像的宽度和高度，那么Image&#160;widget将占用与主资源相同的屏幕空间大小。 也就是说，如果.../my_icon.png是72px乘72px，那么.../3.0x/my_icon.png应该是216px乘216px; 但如果未指定宽度和高度，它们都将渲染为72像素×72像素（以逻辑像素为单位）。 pubspec.yaml中asset部分中的每一项都应与实际文件相对应，但主资源项除外。当主资源缺少某个资源时，会按分辨率从低到高的顺序去选择 ，也就是说1x中没有的话会在2x中找，2x中还没有的话就在3x中找。 加载图片 要加载图片，可以使用&#160;AssetImage类。例如，我们可以从上面的asset声明中加载背景图片： Widget build(BuildContext context) { return new DecoratedBox( decoration: new BoxDecoration( image: new DecorationImage( image: new AssetImage('graphics/background.png'), ), ), ); } 注意，AssetImage&#160;并非是一个widget， 它实际上是一个ImageProvider，有些时候你可能期望直接得到一个显示图片的widget，那么你可以使用Image.asset()方法，如： Widget build(BuildContext context) { return Image.asset('graphics/background.png'); } 使用默认的 asset bundle 加载资源时，内部会自动处理分辨率等，这些处理对开发者来说是无感知的。 (如果使用一些更低级别的类，如&#160;ImageStream或&#160;ImageCache&#160;时你会注意到有与缩放相关的参数) 依赖包中的资源图片 要加载依赖包中的图像，必须给AssetImage提供package参数。 例如，假设您的应用程序依赖于一个名为“my_icons”的包，它具有如下目录结构： …/pubspec.yaml …/icons/heart.png …/icons/1.5x/heart.png …/icons/2.0x/heart.png …etc. 然后加载图像，使用: new AssetImage('icons/heart.png', package: 'my_icons') 或 new Image.asset('icons/heart.png', package: 'my_icons') 注意：包在使用本身的资源时也应该加上package参数来获取。 打包包中的 assets 如果在pubspec.yaml文件中声明了期望的资源，它将会打包到相应的package中。特别是，包本身使用的资源必须在pubspec.yaml中指定。 包也可以选择在其lib/文件夹中包含未在其pubspec.yaml文件中声明的资源。在这种情况下，对于要打包的图片，应用程序必须在pubspec.yaml中指定包含哪些图像。 例如，一个名为“fancy_backgrounds”的包，可能包含以下文件： …/lib/backgrounds/background1.png …/lib/backgrounds/background2.png …/lib/backgrounds/background3.png 要包含第一张图像，必须在pubspec.yaml的assets部分中声明它： flutter: assets: - packages/fancy_backgrounds/backgrounds/background1.png lib/是隐含的，所以它不应该包含在资产路径中。 特定平台 assets 上面的资源都是flutter应用中的，这些资源只有在Flutter框架运行之后才能使用，如果要给我们的应用设置APP图标或者添加启动图，那我们必须使用特定平台的assets。 设置APP图标 更新Flutter应用程序启动图标的方式与在本机Android或iOS应用程序中更新启动图标的方式相同。 Android 在Flutter项目的根目录中，导航到.../android/app/src/main/res目录，里面包含了各种资源文件夹（如mipmap-hdpi已包含占位符图像”ic_launcher.png”）。 只需按照Android开发人员指南中的说明， 将其替换为所需的资源，并遵守每种屏幕密度（dpi）的建议图标大小标准。 注意:&#160;如果您重命名.png文件，则还必须在您AndroidManifest.xml的&#60;application&#62;标签的android:icon属性中更新名称。 iOS 在Flutter项目的根目录中，导航到.../ios/Runner。该目录中Assets.xcassets/AppIcon.appiconset已经包含占位符图片。 只需将它们替换为适当大小的图片。保留原始文件名称。 更新启动页 在Flutter框架加载时，Flutter会使用本地平台机制绘制启动页。此启动页将持续到Flutter渲染应用程序的第一帧时。 注意:&#160;这意味着如果您不在应用程序的main()方法中调用runApp&#160;函数 （或者更具体地说，如果您不调用window.render去响应window.onDrawFrame）的话， 启动屏幕将永远持续显示。 Android 要将启动屏幕（splash screen）添加到您的Flutter应用程序， 请导航至.../android/app/src/main。在res/drawable/launch_background.xml，通过自定义drawable来实现自定义启动界面（你也可以直接换一张图片）。 iOS 要将图片添加到启动屏幕（splash screen）的中心，请导航至.../ios/Runner。在Assets.xcassets/LaunchImage.imageset，]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<h1 id="资源管理">资源管理</h1>
<p>Flutter应用程序可以包含代码和 assets（有时称为资源）。assets是会打包到程序安装包中的，可在运行时访问。常见类型的assets包括静态数据（例如JSON文件）、配置文件、图标和图片（JPEG，WebP，GIF，动画WebP / GIF，PNG，BMP和WBMP）等。</p>
<h2 id="指定-assets">指定 assets</h2>
<p>和包管理一样，Flutter也使用<a href="https://www.dartlang.org/tools/pub/pubspec" rel="nofollow" data-token="bccfdb318f058c1c47375f5bbba695a7"><code>pubspec.yaml</code></a>文件来管理应用程序所需的资源。举一个例子:</p>
<pre class="has">
<code>flutter:
  assets:
    - assets/my_icon.png
    - assets/background.png
</code></pre>
<p><code>assets</code>指定应包含在应用程序中的文件。 每个asset都通过相对于<code>pubspec.yaml</code>文件所在位置的显式路径进行标识。asset的声明顺序是无关紧要的。asset的实际目录可以是任意文件夹（在本示例中是assets）。</p>
<p>在构建期间，Flutter将asset放置到称为&nbsp;<em>asset bundle</em>&nbsp;的特殊存档中，应用程序可以在运行时读取它们（但不能修改）。</p>
<h2 id="asset-变体（variant）">Asset 变体（variant）</h2>
<p>构建过程支持asset变体的概念：不同版本的asset可能会显示在不同的上下文中。 在<code>pubspec.yaml</code>的assets部分中指定asset路径时，构建过程中，会在相邻子目录中查找具有相同名称的任何文件。这些文件随后会与指定的asset一起被包含在asset bundle中。</p>
<p>例如，如果应用程序目录中有以下文件:</p>
<ul>
<li>…/pubspec.yaml</li>
<li>…/graphics/my_icon.png</li>
<li>…/graphics/background.png</li>
<li>…/graphics/dark/background.png</li>
<li>…etc.</li>
</ul>
<p>然后<code>pubspec.yaml</code>文件中只需包含:</p>
<pre class="has">
<code>flutter:
  assets:
    - graphics/background.png
</code></pre>
<p>那么这两个<code>graphics/background.png</code>和<code>graphics/dark/background.png</code>&nbsp;都将包含在您的asset bundle中。前者被认为是<em>main asset</em>&nbsp;（主资源），后者被认为是一种变体（variant）。</p>
<p>在选择匹配当前设备分辨率的图片时，Flutter会使用到asset变体（见下文），将来，Flutter可能会将这种机制扩展到本地化、阅读提示等方面。</p>
<h2 id="加载-assets">加载 assets</h2>
<p>您的应用可以通过<a href="https://docs.flutter.io/flutter/services/AssetBundle-class.html" rel="nofollow" data-token="7f3725a47b86a66f1ca07c2b4c151540"><code>AssetBundle</code></a>对象访问其asset 。有两种主要方法允许从Asset bundle中加载字符串或图片(二进制)文件。</p>
<h3 id="加载文本assets">加载文本assets</h3>
<ul>
<li>通过<a href="https://docs.flutter.io/flutter/services/rootBundle.html" rel="nofollow" data-token="1cf0d9d4630245bea0dc925cbeff037a"><code>rootBundle</code></a>&nbsp;对象加载：每个Flutter应用程序都有一个<a href="https://docs.flutter.io/flutter/services/rootBundle.html" rel="nofollow" data-token="1cf0d9d4630245bea0dc925cbeff037a"><code>rootBundle</code></a>对象， 通过它可以轻松访问主资源包，直接使用<code>package:flutter/services.dart</code>中全局静态的<code>rootBundle</code>对象来加载asset即可。</li>
<li>通过&nbsp;<a href="https://docs.flutter.io/flutter/widgets/DefaultAssetBundle-class.html" rel="nofollow" data-token="011e1ccf48027e1851d805dc257b0d64"><code>DefaultAssetBundle</code></a>&nbsp;加载：建议使用&nbsp;<a href="https://docs.flutter.io/flutter/widgets/DefaultAssetBundle-class.html" rel="nofollow" data-token="011e1ccf48027e1851d805dc257b0d64"><code>DefaultAssetBundle</code></a>&nbsp;来获取当前BuildContext的AssetBundle。 这种方法不是使用应用程序构建的默认asset bundle，而是使父级widget在运行时动态替换的不同的AssetBundle，这对于本地化或测试场景很有用。</li>
</ul>
<p>通常，可以使用<code>DefaultAssetBundle.of()</code>在应用运行时来间接加载asset（例如JSON文件），而在widget上下文之外，或其它<code>AssetBundle</code>句柄不可用时，可以使用<code>rootBundle</code>直接加载这些asset，例如：</p>
<pre class="has">
<code>import 'dart:async' show Future;
import 'package:flutter/services.dart' show rootBundle;

Future&lt;String&gt; loadAsset() async {
  return await rootBundle.loadString('assets/config.json');
}
</code></pre>
<h3 id="加载图片">加载图片</h3>
<p>类似于原生开发，Flutter也可以为当前设备加载适合其分辨率的图像。</p>
<p>声明分辨率相关的图片 assets</p>
<p><a href="https://docs.flutter.io/flutter/painting/AssetImage-class.html" rel="nofollow" data-token="f55c31f4385082daf84f7a4b91cc8094"><code>AssetImage</code></a>&nbsp;可以将asset的请求逻辑映射到最接近当前设备像素比例(dpi)的asset。为了使这种映射起作用，必须根据特定的目录结构来保存asset：</p>
<ul>
<li>…/image.png</li>
<li>…/<strong>M</strong>x/image.png</li>
<li>…/<strong>N</strong>x/image.png</li>
<li>…etc.</li>
</ul>
<p>其中M和N是数字标识符，对应于其中包含的图像的分辨率，也就是说，它们指定不同设备像素比例的图片。</p>
<p>主资源默认对应于1.0倍的分辨率图片。看一个例子：</p>
<ul>
<li>…/my_icon.png</li>
<li>…/2.0x/my_icon.png</li>
<li>…/3.0x/my_icon.png</li>
</ul>
<p>在设备像素比率为1.8的设备上，<code>.../2.0x/my_icon.png</code>&nbsp;将被选择。对于2.7的设备像素比率，<code>.../3.0x/my_icon.png</code>将被选择。</p>
<p>如果未在<code>Image</code>&nbsp;widget上指定渲染图像的宽度和高度，那么<code>Image</code>&nbsp;widget将占用与主资源相同的屏幕空间大小。 也就是说，如果<code>.../my_icon.png</code>是72px乘72px，那么<code>.../3.0x/my_icon.png</code>应该是216px乘216px; 但如果未指定宽度和高度，它们都将渲染为72像素×72像素（以逻辑像素为单位）。</p>
<p><code>pubspec.yaml</code>中asset部分中的每一项都应与实际文件相对应，但主资源项除外。当主资源缺少某个资源时，会按分辨率从低到高的顺序去选择 ，也就是说1x中没有的话会在2x中找，2x中还没有的话就在3x中找。</p>
<p>加载图片</p>
<p>要加载图片，可以使用&nbsp;<a href="https://docs.flutter.io/flutter/painting/AssetImage-class.html" rel="nofollow" data-token="f55c31f4385082daf84f7a4b91cc8094"><code>AssetImage</code></a>类。例如，我们可以从上面的asset声明中加载背景图片：</p>
<pre class="has">
<code>Widget build(BuildContext context) {
  return new DecoratedBox(
    decoration: new BoxDecoration(
      image: new DecorationImage(
        image: new AssetImage('graphics/background.png'),
      ),
    ),
  );
}
</code></pre>
<p>注意，<code>AssetImage</code>&nbsp;并非是一个widget， 它实际上是一个<code>ImageProvider</code>，有些时候你可能期望直接得到一个显示图片的widget，那么你可以使用<code>Image.asset()</code>方法，如：</p>
<pre class="has">
<code>Widget build(BuildContext context) {
  return Image.asset('graphics/background.png');
}
</code></pre>
<p>使用默认的 asset bundle 加载资源时，内部会自动处理分辨率等，这些处理对开发者来说是无感知的。 (如果使用一些更低级别的类，如&nbsp;<a href="https://docs.flutter.io/flutter/painting/ImageStream-class.html" rel="nofollow" data-token="a1646f087a00269aafc1693814a4a9e3"><code>ImageStream</code></a>或&nbsp;<a href="https://docs.flutter.io/flutter/painting/ImageCache-class.html" rel="nofollow" data-token="f53a0ed69d58cf3aeee6c54ec8917cd9"><code>ImageCache</code></a>&nbsp;时你会注意到有与缩放相关的参数)</p>
<p>依赖包中的资源图片</p>
<p>要加载依赖包中的图像，必须给<code>AssetImage</code>提供<code>package</code>参数。</p>
<p>例如，假设您的应用程序依赖于一个名为“my_icons”的包，它具有如下目录结构：</p>
<ul>
<li>…/pubspec.yaml</li>
<li>…/icons/heart.png</li>
<li>…/icons/1.5x/heart.png</li>
<li>…/icons/2.0x/heart.png</li>
<li>…etc.</li>
</ul>
<p>然后加载图像，使用:</p>
<pre class="has">
<code> new AssetImage('icons/heart.png', package: 'my_icons')
</code></pre>
<p>或</p>
<pre class="has">
<code>new Image.asset('icons/heart.png', package: 'my_icons')
</code></pre>
<p><strong>注意：包在使用本身的资源时也应该加上<code>package</code>参数来获取</strong>。</p>
<p>打包包中的 assets</p>
<p>如果在<code>pubspec.yaml</code>文件中声明了期望的资源，它将会打包到相应的package中。特别是，包本身使用的资源必须在<code>pubspec.yaml</code>中指定。</p>
<p>包也可以选择在其<code>lib/</code>文件夹中包含未在其<code>pubspec.yaml</code>文件中声明的资源。在这种情况下，对于要打包的图片，应用程序必须在<code>pubspec.yaml</code>中指定包含哪些图像。 例如，一个名为“fancy_backgrounds”的包，可能包含以下文件：</p>
<ul>
<li>…/lib/backgrounds/background1.png</li>
<li>…/lib/backgrounds/background2.png</li>
<li>…/lib/backgrounds/background3.png</li>
</ul>
<p>要包含第一张图像，必须在<code>pubspec.yaml</code>的assets部分中声明它：</p>
<pre class="has">
<code>flutter:
  assets:
    - packages/fancy_backgrounds/backgrounds/background1.png
</code></pre>
<p><code>lib/</code>是隐含的，所以它不应该包含在资产路径中。</p>
<h3 id="特定平台-assets">特定平台 assets</h3>
<p>上面的资源都是flutter应用中的，这些资源只有在Flutter框架运行之后才能使用，如果要给我们的应用设置APP图标或者添加启动图，那我们必须使用特定平台的assets。</p>
<p>设置APP图标</p>
<p>更新Flutter应用程序启动图标的方式与在本机Android或iOS应用程序中更新启动图标的方式相同。</p>
<ul>
<li>
<p>Android</p>
<p>在Flutter项目的根目录中，导航到<code>.../android/app/src/main/res</code>目录，里面包含了各种资源文件夹（如<code>mipmap-hdpi</code>已包含占位符图像”ic_launcher.png”）。 只需按照<a href="https://developer.android.com/guide/practices/ui_guidelines/icon_design_launcher.html#size" rel="nofollow" data-token="8d75fea0312e94b3570e000d496411ee">Android开发人员指南</a>中的说明， 将其替换为所需的资源，并遵守每种屏幕密度（dpi）的建议图标大小标准。</p>
<p><img alt="Android icon location" class="has" src="https://flutterchina.club/images/assets-and-images/android-icon-path.png"></p>
<blockquote>
<p><strong>注意:</strong>&nbsp;如果您重命名.png文件，则还必须在您<code>AndroidManifest.xml</code>的<code>&lt;application&gt;</code>标签的<code>android:icon</code>属性中更新名称。</p>
</blockquote>
</li>
<li>
<p>iOS</p>
<p>在Flutter项目的根目录中，导航到<code>.../ios/Runner</code>。该目录中<code>Assets.xcassets/AppIcon.appiconset</code>已经包含占位符图片。 只需将它们替换为适当大小的图片。保留原始文件名称。</p>
<p><img alt="iOS icon location" class="has" src="https://flutterchina.club/images/assets-and-images/ios-icon-path.png"></p>
</li>
</ul>
<p>更新启动页</p>
<p><img alt="Launch screen" class="has" src="https://flutterchina.club/images/assets-and-images/launch-screen.png"></p>
<p>在Flutter框架加载时，Flutter会使用本地平台机制绘制启动页。此启动页将持续到Flutter渲染应用程序的第一帧时。</p>
<blockquote>
<p><strong>注意:</strong>&nbsp;这意味着如果您不在应用程序的<code>main()</code>方法中调用<a href="https://docs.flutter.io/flutter/widgets/runApp.html" rel="nofollow" data-token="05c81e56468227aee5a5026b2bddbb44">runApp</a>&nbsp;函数 （或者更具体地说，如果您不调用<a href="https://docs.flutter.io/flutter/dart-ui/Window/render.html" rel="nofollow" data-token="5120b5441a4b77401dcf27d415ad6367"><code>window.render</code></a>去响应<a href="https://docs.flutter.io/flutter/dart-ui/Window/onDrawFrame.html" rel="nofollow" data-token="25780fdacfb07a475adb0baf6f572017"><code>window.onDrawFrame</code></a>）的话， 启动屏幕将永远持续显示。</p>
</blockquote>
<p>Android</p>
<p>要将启动屏幕（splash screen）添加到您的Flutter应用程序， 请导航至<code>.../android/app/src/main</code>。在<code>res/drawable/launch_background.xml</code>，通过自定义drawable来实现自定义启动界面（你也可以直接换一张图片）。</p>
<p>iOS</p>
<p>要将图片添加到启动屏幕（splash screen）的中心，请导航至<code>.../ios/Runner</code>。在<code>Assets.xcassets/LaunchImage.imageset</code>， 拖入图片，并命名为<code>LaunchImage.png</code>、<code>LaunchImage@2x.png</code>、<code>LaunchImage@3x.png</code>。 如果你使用不同的文件名，那您还必须更新同一目录中的<code>Contents.json</code>文件，图片的具体尺寸可以查看苹果官方的标准。</p>
<p>您也可以通过打开Xcode完全自定义storyboard。在Project Navigator中导航到<code>Runner/Runner</code>然后通过打开<code>Assets.xcassets</code>拖入图片，或者通过在LaunchScreen.storyboard中使用Interface Builder进行自定义。</p>
<p><img alt="Adding launch icons in Xcode" class="has" src="https://flutterchina.club/images/assets-and-images/ios-launchscreen-xcode.png"></p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>echart相关操作xAxis,yAxis,series,grid,(包括x轴样式，y轴样式，折现样式，网格样式，折现阴影，折线上方显示数据，x轴文字倾斜)</title>
		<link>https://uzzz.org/article/2882.html</link>
				<pubDate>Thu, 16 May 2019 07:49:52 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[前端]]></category>
		<category><![CDATA[图像处理]]></category>
		<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/2882.html</guid>
				<description><![CDATA[样式截图大概如下： &#160; &#160; &#160; 1. x，y轴相关操作：xAxis，yAxis &#160; &#160; &#160;(1)&#160; x，y轴的颜色： &#160; &#160; &#160; &#160; &#160; &#160; axisLine: { lineStyle: { color: '#2898e5', }, }, &#160; &#160; (2) x，y轴文字颜色： &#160; &#160; &#160; axisLabel: { show: true, textStyle: { color: '#019bf8' } } &#160; &#160; &#160;（3）x，y轴刻度颜色： &#160; &#160; axisTick: { lineStyle: { color: '#2898e5' } } &#160; &#160; &#160; &#160;(4) x，y轴坐标文字太长显示不全：,倾斜rotate &#160; &#160; &#160; &#160; &#160; &#160;&#160; axisLabel: { show: true, interval: 0, rotate: 20 }, &#160; &#160; &#160; （5）x ,y 轴网格线的颜色： &#160; &#160; &#160;&#160; splitLine: { show: true, lineStyle: { color: ['rgb(1,155,246,0.3)'], //网格线 width: 1, } }, &#160; 2. 折现 的样式 &#160; &#160; （1） 折现的平滑度series： &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160; symbol: 'circle', //实心点 symbolSize: 6, //实心点的大小 smooth: true, //折现平滑 &#160; &#160; （2）折现的颜色： itemStyle: { normal: { color: 'transparent' } }, &#160; &#160; &#160;（3）折现阴影变色： &#160; &#160;&#160; areaStyle: { normal: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{ offset: 0, color: 'rgb(52,214,145)' //渐变上边颜色 }, { offset: 1, color: 'transparent' //渐变下边颜色 }]) } }, &#160; &#160; &#160;（4）折线上方显示文字： &#160; &#160; &#160; &#160; &#160; &#160; label: { normal: { show: true, position: 'top', //头上显示数据]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div class="htmledit_views" id="content_views">
<p>样式截图大概如下：</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190516155254827.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0NzkwNjQ0,size_16,color_FFFFFF,t_70"></p>
<p>&nbsp;<img alt="" class="has" height="178" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190516155214221.png" width="368"></p>
<p><img alt="" class="has" height="192" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190516155229329.png" width="376"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>1. x，y轴相关操作：xAxis，yAxis</p>
<p>&nbsp; &nbsp; &nbsp;(1)&nbsp; x，y轴的颜色：</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<pre class="has">
<code>  axisLine: {
             lineStyle: {
                  color: '#2898e5',
                },
            },</code></pre>
<p>&nbsp; &nbsp; (2) x，y轴文字颜色：</p>
<p>&nbsp; &nbsp; &nbsp;</p>
<pre class="has">
<code>     axisLabel: {
            show: true,
            textStyle: {
              color: '#019bf8'
            }
          }</code></pre>
<p>&nbsp; &nbsp; &nbsp;（3）x，y轴刻度颜色：</p>
<p>&nbsp; &nbsp;</p>
<pre class="has">
<code> axisTick: {
          lineStyle: { color: '#2898e5' } 
        }</code></pre>
<p>&nbsp; &nbsp; &nbsp; &nbsp;(4) x，y轴坐标文字太长显示不全：,倾斜rotate</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p>
<pre class="has">
<code> axisLabel: {
          show: true,
          interval: 0,
          rotate: 20
  },</code></pre>
<p>&nbsp; &nbsp; &nbsp; （5）x ,y 轴网格线的颜色：</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp;</p>
<pre class="has">
<code> splitLine: {
          show: true,
          lineStyle: {
            color: ['rgb(1,155,246,0.3)'],  //网格线
            width: 1,
          }
 },</code></pre>
<p>&nbsp;</p>
<p>2. 折现 的样式</p>
<p>&nbsp; &nbsp; （1） 折现的平滑度series：</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p>
<pre class="has">
<code>symbol: 'circle',  //实心点
symbolSize: 6,     //实心点的大小
smooth: true,      //折现平滑</code></pre>
<p>&nbsp; &nbsp; （2）折现的颜色：</p>
<pre class="has">
<code>  itemStyle: {
          normal: {
            color: 'transparent'
          }
        },</code></pre>
<p>&nbsp; &nbsp; &nbsp;（3）折现阴影变色：</p>
<p>&nbsp; &nbsp;&nbsp;</p>
<pre class="has">
<code> areaStyle: {
          normal: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
              offset: 0,
              color: 'rgb(52,214,145)'  //渐变上边颜色
            }, {
              offset: 1,
              color: 'transparent'      //渐变下边颜色
            }])
          }
        },</code></pre>
<p>&nbsp; &nbsp; &nbsp;（4）折线上方显示文字：</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<pre class="has">
<code>  label: {
          normal: {
            show: true,
            position: 'top',  //头上显示数据
            color: 'rgb(0,255,255)'  //显示文字颜色
          }
   },</code></pre>
<p>3. grid图区域距离四周的距离：</p>
<p>&nbsp; &nbsp;&nbsp;在grid绘图网格里,containLabel(grid 区域是否包含坐标轴的刻度标签,默认不包含)为true的情况下,无法使图表紧贴着画布显示,&nbsp; &nbsp; &nbsp; 但可以防止标签标签长度动态变化时溢出容器或者覆盖其他组件,将containLabel设置为false即可解决;</p>
<p>&nbsp; &nbsp;&nbsp;</p>
<pre class="has">
<code> grid: {
        left: '3%',
        right: '4%',
        bottom: '15%',
        top: '15%',
        containLabel: true
  },</code></pre>
<p>&nbsp; &nbsp;&nbsp;</p>
<p>4.&nbsp;完整代码示例如下：</p>
<p>&nbsp; &nbsp;</p>
<pre class="has">
<code>var option = {
      xAxis: {
        type: 'category',
        boundaryGap: false,
        data: ['福州市', '无锡市', '兰州市', '合肥市', '广州市', '贵阳市', '长沙市'],
        axisLine: {       
          lineStyle: {        
            color: '#2898e5',   //轴颜色
          },

        },
        axisLabel: {     
          interval: 0,
          rotate: 40,    //倾斜度
          show: true,
          textStyle: {     //轴上文字
            color: '#019bf8'   //颜色
          }
        },

        axisTick: {
          lineStyle: { color: '#2898e5' },    // 刻度的颜色
        },

      },
      grid: {           //距离
        left: '3%',
        right: '4%',
        bottom: '15%',
        top: '15%',
        containLabel: true   //保留文字距离
      },
      yAxis: {
        type: 'value',
        axisLine: {
          lineStyle: {
            color: '#2898e5',  //轴
          },
        },
        axisLabel: {
          show: true,
          textStyle: {
            color: '#019bf8'  //轴字体
          }
        },
        splitLine: {
          show: true,
          lineStyle: {
            color: ['rgb(1,155,246,0.3)'],  //网格线颜色
            width: 1,
          }
        },
        axisTick: {
          lineStyle: { color: '#2898e5' }    // x轴刻度的颜色
        }

      },
      series: [{
        data: [1000, 920, 856, 601, 934, 1090, 802, 1000],
        symbol: 'circle',     //折线拐点实心圆
        symbolSize: 6,        //实心圆大小
        smooth: true,         //折线平滑
        label: {               
          normal: {
            show: true,
            position: 'top',  //折线上方显示数据
            color: 'rgb(0,255,255)'
          }
        },
        itemStyle: {
          normal: {
            color: 'rgb(0,255,255)'    //折线颜色
          }
        },
        areaStyle: {     //阴影颜色
          normal: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
              offset: 0,
              color: '#019bf8'   //渐变色上方颜色
            }, {
              offset: 1,
              color: 'transparent'    //渐变色下方颜色
            }])
          }
        },
        type: 'line'
      }]
    };
</code></pre>
<p>&nbsp;</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>Activity页面变暗并且不可点击只能返回的问题</title>
		<link>https://uzzz.org/article/987.html</link>
				<pubDate>Fri, 12 Apr 2019 02:28:58 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">http://wp.uzzz.org/article/987.html</guid>
				<description><![CDATA[场景：一个Activity请求网络，当出现网络问题请求出错时，会弹出一个Dialog提示。但是，在结果返回之前就跳到了另一个Activity，使得之前那个Activity处于后台，此时如果回到之前的Activity会出现页面变暗，而且任何地方不能点击的现象。这是由于Activity处于后台，弹Dialog遇到问题没有弹出来，但是页面已经变暗了，并抢占了焦点，使得底部的控件看得见但不可点击。给人的感觉就是App死机了，只有点返回键才能激活页面。查了半天，只遇到一个知己遇到和我一样的问题，并提出来了。有人给了一些方案。如下：https://www.iteye.com/problems/77129 我的场景不太一样，Dialog弹出没有那么重要，极端情况下Dialog可以不弹出，只要页面不变暗并且不可点击。所以我的思路是：只要Activity不是可见的，就不在当前Activity上调用弹出Dialog的操作。具体操作如下： 在我的网络请求框架MyGernericCallback上作如下判断： //只有当Activity处于前台时，才在当前Activity上弹Dialog if (IsActivityForegroundUtil.isForeground((Activity) mContext)) { try { dialog.show(); } catch (Exception e) { e.printStackTrace(); } } IsActvityForegroundUtil.java import android.app.Activity; import android.app.ActivityManager; import android.content.ComponentName; import android.content.Context; import android.text.TextUtils; import java.util.List; public class IsActivityForegroundUtil { /** * 判断某个界面是否在前台 * * @param activity 要判断的Activity * @return 是否在前台显示 */ public static boolean isForeground(Activity activity) { return isForeground(activity, activity.getClass().getName()); } /** * 判断某个界面是否在前台 * * @param context Context * @param className 界面的类名 * @return 是否在前台显示 */ public static boolean isForeground(Context context, String className) { if (context == null &#124;&#124; TextUtils.isEmpty(className)) return false; ActivityManager am = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE); List&#60;ActivityManager.RunningTaskInfo&#62; list = am.getRunningTasks(1); if (list != null &#38;&#38; list.size() &#62; 0) { ComponentName cpn = list.get(0).topActivity; if (className.equals(cpn.getClassName())) return true; } return false; } } &#160;]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
<p>场景：一个Activity请求网络，当出现网络问题请求出错时，会弹出一个Dialog提示。但是，在结果返回之前就跳到了另一个Activity，使得之前那个Activity处于后台，此时如果回到之前的Activity会出现页面变暗，而且任何地方不能点击的现象。这是由于Activity处于后台，弹Dialog遇到问题没有弹出来，但是页面已经变暗了，并抢占了焦点，使得底部的控件看得见但不可点击。给人的感觉就是App死机了，只有点返回键才能激活页面。查了半天，只遇到一个知己遇到和我一样的问题，并提出来了。有人给了一些方案。如下：<a href="https://www.iteye.com/problems/77129" rel="nofollow" data-token="582c54994dec9d7e00e845d3139d625d">https://www.iteye.com/problems/77129</a></p>
<p>我的场景不太一样，Dialog弹出没有那么重要，极端情况下Dialog可以不弹出，只要页面不变暗并且不可点击。所以我的思路是：只要Activity不是可见的，就不在当前Activity上调用弹出Dialog的操作。具体操作如下：</p>
<p>在我的网络请求框架MyGernericCallback上作如下判断：</p>
<pre class="has">
<code>       //只有当Activity处于前台时，才在当前Activity上弹Dialog
        if (IsActivityForegroundUtil.isForeground((Activity) mContext)) {
            try {
                dialog.show();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }</code></pre>
<p>IsActvityForegroundUtil.java</p>
<pre class="has">
<code>import android.app.Activity;
import android.app.ActivityManager;
import android.content.ComponentName;
import android.content.Context;
import android.text.TextUtils;

import java.util.List;

public class IsActivityForegroundUtil {

    /**
     * 判断某个界面是否在前台
     *
     * @param activity 要判断的Activity
     * @return 是否在前台显示
     */
    public static boolean isForeground(Activity activity) {
        return isForeground(activity, activity.getClass().getName());
    }

    /**
     * 判断某个界面是否在前台
     *
     * @param context   Context
     * @param className 界面的类名
     * @return 是否在前台显示
     */
    public static boolean isForeground(Context context, String className) {
        if (context == null || TextUtils.isEmpty(className))
            return false;
        ActivityManager am = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
        List&lt;ActivityManager.RunningTaskInfo&gt; list = am.getRunningTasks(1);
        if (list != null &amp;&amp; list.size() &gt; 0) {
            ComponentName cpn = list.get(0).topActivity;
            if (className.equals(cpn.getClassName()))
                return true;
        }
        return false;

    }
}
</code></pre>
<p>&nbsp;</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>cocos creator 图片黑边, 灰边问题的解决</title>
		<link>https://uzzz.org/article/3029.html</link>
				<pubDate>Sat, 23 Mar 2019 01:02:05 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3029.html</guid>
				<description><![CDATA[软件环境：cocos creator 2.0 cocos creator 中的图片或多或少有些黑边或灰边的问题，一般是在透明图片的边缘。 图片来自网络 问题是由于纹理缩放边缘插值计算导致的，cocos2d—x中精灵的blend源默认应该是one，但是cocos creator不是。 Cocos2d-x 中的设置更加智能，默认对图片进行 WebGL 预乘，如果发现贴图是已经预乘过的，那么 Sprite 就使用 ONE 作为 blend src，否则使用 SRC_ALPHA。这里带来的问题是，贴图切换，用户手动修改 Blend function 的冲突，cocos2d-x 在切换贴图的时候，会自动根据贴图的预乘属性重新设置 Blend function，而不管用户是否手动修改过，这里就有潜在的 bug 可能。 解决方案一： 利用打包工具 TexturePacker&#160;将资源打包成图集，打包过程中设置成预乘： 图片来自网络 &#160; 解决方案二： 在cocos creator编辑器的sprite 设置为图集里边的图，然后Blend/SrcBlendFactor设置为one ： 图片来自网络 方案三：通过代码修改sprite的混合模式： node.getComponent(cc.Sprite).srcBlendFactor = cc.macro.BlendFactor.ONE; &#160; 【互动教程列表，真正的手把手教学模式，点击或扫码下载】 &#160;&#160;&#160;&#160;&#160;&#160;]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div class="htmledit_views" id="content_views">
<p>软件环境：cocos creator 2.0</p>
<p>cocos creator 中的图片或多或少有些黑边或灰边的问题，一般是在透明图片的边缘。</p>
<p><img alt="" class="has" height="348" src="https://forum.cocos.com/uploads/default/original/2X/3/39c2fccc808a3c522dc0514a1544c04e52a52bb9.png" width="450"></p>
<p>图片来自网络</p>
<p>问题是由于纹理缩放边缘插值计算导致的，cocos2d—x中精灵的blend源默认应该是one，但是cocos creator不是。</p>
<p>Cocos2d-x 中的设置更加智能，默认对图片进行 WebGL 预乘，如果发现贴图是已经预乘过的，那么 Sprite 就使用 ONE 作为 blend src，否则使用 SRC_ALPHA。这里带来的问题是，贴图切换，用户手动修改 Blend function 的冲突，cocos2d-x 在切换贴图的时候，会自动根据贴图的预乘属性重新设置 Blend function，而不管用户是否手动修改过，这里就有潜在的 bug 可能。</p>
<p>解决方案一：</p>
<p>利用打包工具 TexturePacker&nbsp;将资源打包成图集，打包过程中设置成预乘：</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdn.net/20180825085823166?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JlcmV2Yw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p>
<p>图片来自网络</p>
<p>&nbsp;</p>
<p>解决方案二：</p>
<p>在cocos creator编辑器的sprite 设置为图集里边的图，然后Blend/SrcBlendFactor设置为one ：</p>
<p><img alt="" class="has" src="https://uzshare.com/_p?https://img-blog.csdn.net/20180825090029977?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JlcmV2Yw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p>
<p>图片来自网络</p>
<p>方案三：通过代码修改sprite的混合模式：</p>
<p>node.getComponent(cc.Sprite).srcBlendFactor = cc.macro.BlendFactor.ONE;</p>
<p>&nbsp;</p>
<hr>
<p>【互动教程列表，真正的手把手教学模式，点击或扫码下载】</p>
<p id="products"><a href="https://itunes.apple.com/cn/app/id1392811165" rel="nofollow" data-token="bd1c43a8d5714432d24fed05467d5b0a"><img alt="互动教程:手把手带您学习IT职场技能" class="has" height="123" src="http://coolketang.com/banner/banner_hdjc.png" width="196">&nbsp;</a><a href="https://itunes.apple.com/cn/app/id680139052" rel="nofollow" data-token="babd90a872b14d9f4a5dba7a777306f9"><img alt="" class="has" height="124" src="http://coolketang.com/banner/banner_pscc.png" width="192"></a>&nbsp;<a href="https://itunes.apple.com/cn/app/id1005557436" rel="nofollow" data-token="a89294617d9f6d13bda8d68883a23f8d"><img alt="" class="has" height="124" src="http://coolketang.com/banner/banner_aicc.png" width="207"></a>&nbsp;<a href="https://itunes.apple.com/cn/app/id1090726089" rel="nofollow" data-token="a3f895b1342cea60a55c74155ada40b7"><img alt="" class="has" height="125" src="http://coolketang.com/banner/banner_excel.png" width="199"></a><br /><a href="https://itunes.apple.com/cn/app/id1063100471" rel="nofollow" data-token="1a5001e03874a692ecac980c1a109cd0"><img alt="互动教程 for Xcode9" class="has" height="123" src="http://coolketang.com/banner/banner_xcode.png" width="197">&nbsp;</a><a href="https://itunes.apple.com/cn/app/id1209739676" rel="nofollow" data-token="8d9900dfa5e0c82719b841540977d600"><img alt="iOS开发中的神兵利器" class="has" height="117" src="http://coolketang.com/banner/banner_ios.png" width="192">&nbsp;</a><a href="https://itunes.apple.com/cn/app/id1320746678" rel="nofollow" data-token="a858a14a7db9f42e270096414a218a65"><img alt="互动教程 for Swift4" class="has" height="130" src="http://coolketang.com/banner/banner_swift.png" width="208">&nbsp;</a><a href="https://itunes.apple.com/cn/app/id934815233" rel="nofollow" data-token="3e5906a347186c8c4ce242c51ecc4f0d"><img alt="互动教程 for Photoshop Script" class="has" height="124" src="http://coolketang.com/banner/banner_psscript.png" width="200"></a></p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>设置Android系统永不休眠灭屏（Android 8.0源码修改）</title>
		<link>https://uzzz.org/article/3360.html</link>
				<pubDate>Fri, 15 Feb 2019 02:37:20 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3360.html</guid>
				<description><![CDATA[设置Android系统永不休眠灭屏（Android 8.0源码修改） From: zhoujinjian &#60;zhoujinjian@xxx.com&#62; Date: Thu, 14 Feb 2019 17:24:00 +0800 Subject: [PATCH] feat(Policy) : 保持屏幕不灭屏feature实现 Description: Settings.Global.putInt(mContext.getContentResolver(), Settings.Global.SCREEN_STAY_ON_ANYWAY, 1); 说明：1保持常亮，0规定时间灭屏，系统初始化默认保持常亮 Project：android/platform/frameworks/base --- diff --git a/api/current.txt b/api/current.txt index 2836067..806665c 100755 --- a/api/current.txt +++ b/api/current.txt @@ -35044,6 +35044,7 @@ field public static final java.lang.String RADIO_CELL = "cell"; field public static final java.lang.String RADIO_NFC = "nfc"; field public static final java.lang.String RADIO_WIFI = "wifi"; + field public static final java.lang.String SCREEN_STAY_ON_ANYWAY = "screen_stay_on_anyway"; field public static final deprecated java.lang.String SHOW_PROCESSES = "show_processes"; field public static final java.lang.String STAY_ON_WHILE_PLUGGED_IN = "stay_on_while_plugged_in"; field public static final java.lang.String TRANSITION_ANIMATION_SCALE = "transition_animation_scale"; diff --git a/api/system-current.txt b/api/system-current.txt index a6b1cee..33bd8c9 100755 --- a/api/system-current.txt +++ b/api/system-current.txt @@ -38098,6 +38098,7 @@ field public static final java.lang.String RADIO_CELL = "cell"; field public static final java.lang.String RADIO_NFC = "nfc"; field public static final java.lang.String RADIO_WIFI = "wifi"; + field public static final java.lang.String SCREEN_STAY_ON_ANYWAY = "screen_stay_on_anyway"; field public static final deprecated java.lang.String SHOW_PROCESSES = "show_processes"; field public static final java.lang.String STAY_ON_WHILE_PLUGGED_IN = "stay_on_while_plugged_in"; field public static final java.lang.String THEATER_MODE_ON = "theater_mode_on"; diff --git a/api/test-current.txt b/api/test-current.txt index e0bdeb3..40b4c5b 100755 --- a/api/test-current.txt +++]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div id="content_views" class="markdown_views prism-atom-one-dark">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<h4><a id="AndroidAndroid_80_0"></a>设置Android系统永不休眠灭屏（Android 8.0源码修改）</h4>
<pre><code>From: zhoujinjian &lt;zhoujinjian@xxx.com&gt;
Date: Thu, 14 Feb 2019 17:24:00 +0800
Subject: [PATCH] feat(Policy) : 保持屏幕不灭屏feature实现

Description:
    Settings.Global.putInt(mContext.getContentResolver(), Settings.Global.SCREEN_STAY_ON_ANYWAY, 1);
	说明：1保持常亮，0规定时间灭屏，系统初始化默认保持常亮
Project：android/platform/frameworks/base	
---

diff --git a/api/current.txt b/api/current.txt
index 2836067..806665c 100755
--- a/api/current.txt
+++ b/api/current.txt
@@ -35044,6 +35044,7 @@
     field public static final java.lang.String RADIO_CELL = "cell";
     field public static final java.lang.String RADIO_NFC = "nfc";
     field public static final java.lang.String RADIO_WIFI = "wifi";
+    field public static final java.lang.String SCREEN_STAY_ON_ANYWAY = "screen_stay_on_anyway";
     field public static final deprecated java.lang.String SHOW_PROCESSES = "show_processes";
     field public static final java.lang.String STAY_ON_WHILE_PLUGGED_IN = "stay_on_while_plugged_in";
     field public static final java.lang.String TRANSITION_ANIMATION_SCALE = "transition_animation_scale";
diff --git a/api/system-current.txt b/api/system-current.txt
index a6b1cee..33bd8c9 100755
--- a/api/system-current.txt
+++ b/api/system-current.txt
@@ -38098,6 +38098,7 @@
     field public static final java.lang.String RADIO_CELL = "cell";
     field public static final java.lang.String RADIO_NFC = "nfc";
     field public static final java.lang.String RADIO_WIFI = "wifi";
+    field public static final java.lang.String SCREEN_STAY_ON_ANYWAY = "screen_stay_on_anyway";
     field public static final deprecated java.lang.String SHOW_PROCESSES = "show_processes";
     field public static final java.lang.String STAY_ON_WHILE_PLUGGED_IN = "stay_on_while_plugged_in";
     field public static final java.lang.String THEATER_MODE_ON = "theater_mode_on";
diff --git a/api/test-current.txt b/api/test-current.txt
index e0bdeb3..40b4c5b 100755
--- a/api/test-current.txt
+++ b/api/test-current.txt
@@ -35234,6 +35234,7 @@
     field public static final java.lang.String RADIO_CELL = "cell";
     field public static final java.lang.String RADIO_NFC = "nfc";
     field public static final java.lang.String RADIO_WIFI = "wifi";
+    field public static final java.lang.String SCREEN_STAY_ON_ANYWAY = "screen_stay_on_anyway";
     field public static final deprecated java.lang.String SHOW_PROCESSES = "show_processes";
     field public static final java.lang.String STAY_ON_WHILE_PLUGGED_IN = "stay_on_while_plugged_in";
     field public static final java.lang.String TRANSITION_ANIMATION_SCALE = "transition_animation_scale";
diff --git a/core/java/android/provider/Settings.java b/core/java/android/provider/Settings.java
old mode 100644
new mode 100755
index 2d54fde..5961654
--- a/core/java/android/provider/Settings.java
+++ b/core/java/android/provider/Settings.java
@@ -7721,6 +7721,9 @@
          */
         public static final String STAY_ON_WHILE_PLUGGED_IN = "stay_on_while_plugged_in";
 
+        /* zhoujinjian add for disable screen off */
+        public static final String SCREEN_STAY_ON_ANYWAY = "screen_stay_on_anyway";
+
         /**
          * When the user has enable the option to have a "bug report" command
          * in the power menu.
diff --git a/packages/SettingsProvider/res/values/defaults.xml b/packages/SettingsProvider/res/values/defaults.xml
old mode 100644
new mode 100755
index e6a14ec..5131a12
--- a/packages/SettingsProvider/res/values/defaults.xml
+++ b/packages/SettingsProvider/res/values/defaults.xml
@@ -19,6 +19,7 @@
 &lt;resources&gt;
     &lt;bool name="def_dim_screen"&gt;true&lt;/bool&gt;
     &lt;integer name="def_screen_off_timeout"&gt;60000&lt;/integer&gt;
+    &lt;integer name="def_screen_on_anyway"&gt;1&lt;/integer&gt;
     &lt;integer name="def_sleep_timeout"&gt;-1&lt;/integer&gt;
     &lt;bool name="def_airplane_mode_on"&gt;false&lt;/bool&gt;
     &lt;bool name="def_theater_mode_on"&gt;false&lt;/bool&gt;
diff --git a/packages/SettingsProvider/src/com/android/providers/settings/DatabaseHelper.java b/packages/SettingsProvider/src/com/android/providers/settings/DatabaseHelper.java
old mode 100644
new mode 100755
index 9274f39..782153a
--- a/packages/SettingsProvider/src/com/android/providers/settings/DatabaseHelper.java
+++ b/packages/SettingsProvider/src/com/android/providers/settings/DatabaseHelper.java
@@ -2517,6 +2517,11 @@
                         mContext.getResources().getBoolean(R.bool.def_stay_on_while_plugged_in))
                      ? 1 : 0);
 
+            /* zhoujinjian add for disable screen off start */
+            loadIntegerSetting(stmt, Settings.Global.SCREEN_STAY_ON_ANYWAY,
+                    R.integer.def_screen_on_anyway);
+            /* zhoujinjian add for disable screen off end */
+
             loadIntegerSetting(stmt, Settings.Global.WIFI_SLEEP_POLICY,
                     R.integer.def_wifi_sleep_policy);
 
diff --git a/services/core/java/com/android/server/power/PowerManagerService.java b/services/core/java/com/android/server/power/PowerManagerService.java
index f320aa2..334504e 100755
--- a/services/core/java/com/android/server/power/PowerManagerService.java
+++ b/services/core/java/com/android/server/power/PowerManagerService.java
@@ -442,6 +442,8 @@
     // The stay on while plugged in setting.
     // A bitfield of battery conditions under which to make the screen stay on.
     private int mStayOnWhilePluggedInSetting;
+    /* zhoujinjian add for disable screen off */
+    private int mScreenStayOnAnyway;
 
     // True if the device should stay on.
     private boolean mStayOn;
@@ -785,6 +787,10 @@
         resolver.registerContentObserver(Settings.Global.getUriFor(
                 Settings.Global.STAY_ON_WHILE_PLUGGED_IN),
                 false, mSettingsObserver, UserHandle.USER_ALL);
+        /* zhoujinjian add for disable screen off */
+        resolver.registerContentObserver(Settings.Global.getUriFor(
+                Settings.Global.SCREEN_STAY_ON_ANYWAY),
+                false, mSettingsObserver, UserHandle.USER_ALL);
         resolver.registerContentObserver(Settings.System.getUriFor(
                 Settings.System.SCREEN_BRIGHTNESS),
                 false, mSettingsObserver, UserHandle.USER_ALL);
@@ -908,6 +914,10 @@
                 UserHandle.USER_CURRENT);
         mStayOnWhilePluggedInSetting = Settings.Global.getInt(resolver,
                 Settings.Global.STAY_ON_WHILE_PLUGGED_IN, BatteryManager.BATTERY_PLUGGED_AC);
+        /* zhoujinjian add for disable screen off start*/
+        mScreenStayOnAnyway = Settings.Global.getInt(resolver,
+                Settings.Global.SCREEN_STAY_ON_ANYWAY, 0);
+        /* zhoujinjian add for disable screen off end*/
         mTheaterModeEnabled = Settings.Global.getInt(mContext.getContentResolver(),
                 Settings.Global.THEATER_MODE_ON, 0) == 1;
         mAlwaysOnEnabled = mAmbientDisplayConfiguration.alwaysOnEnabled(UserHandle.USER_CURRENT);
@@ -1653,6 +1663,13 @@
             // Phase 0: Basic state updates.
             updateIsPoweredLocked(mDirty);
             updateStayOnLocked(mDirty);
+            /* zhoujinjian add for disable screen off start */
+            if(mScreenStayOnAnyway != 0){
+                mStayOn = true;
+                mDirty |= DIRTY_STAY_ON;
+            }
+            /* zhoujinjian add for disable screen off end */
+
             updateScreenBrightnessBoostLocked(mDirty);
 
             // Phase 1: Update wakefulness.

</code></pre>
</p></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-526ced5128.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
		<item>
		<title>Android 获取圆角图标bitmap黑色背景问题解决</title>
		<link>https://uzzz.org/article/3403.html</link>
				<pubDate>Thu, 14 Feb 2019 02:22:27 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3403.html</guid>
				<description><![CDATA[一、问题场景 在做社会化分享到微博时要展示应用图标，一般获取图标作为bitmap的方法如下： Bitmap bitmap = BitmapFactory.decodeResource(context.getResources(), R.mipmap.ic_launcher); 我用该代码分享出去一个圆角的图标，但是圆角部分展示为黑色，并且无法去除。 二、解决步骤 private Bitmap getBitmapByBg(Bitmap bitmap, int color){ Bitmap newBitmap = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), Bitmap.Config.ARGB_4444); Canvas canvas = new Canvas(newBitmap); canvas.drawColor(color); Paint paint = new Paint(); canvas.drawBitmap(bitmap, 0, 0, paint); return newBitmap; } &#160; 搞定！]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div class="htmledit_views" id="content_views">
<h1>一、问题场景</h1>
<p>在做社会化分享到微博时要展示应用图标，一般获取图标作为bitmap的方法如下：</p>
<pre class="has">
<code>Bitmap bitmap = BitmapFactory.decodeResource(context.getResources(), R.mipmap.ic_launcher);</code></pre>
<p>我用该代码分享出去一个圆角的图标，但是圆角部分展示为黑色，并且无法去除。</p>
<h1>二、解决步骤</h1>
<pre class="has">
<code>private Bitmap getBitmapByBg(Bitmap bitmap, int color){
        Bitmap newBitmap = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), Bitmap.Config.ARGB_4444);
        Canvas canvas = new Canvas(newBitmap);
        canvas.drawColor(color);
        Paint paint = new Paint();
        canvas.drawBitmap(bitmap, 0, 0, paint);
        return newBitmap;
    }</code></pre>
<p>&nbsp;</p>
<p>搞定！</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>解决设置沉浸式时华为手机底部导航栏兼容性问题</title>
		<link>https://uzzz.org/article/3420.html</link>
				<pubDate>Tue, 29 Jan 2019 11:32:15 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3420.html</guid>
				<description><![CDATA[在设置沉浸式时，华为手机底部导航栏会覆盖app的真实内容，提供以下解决方案： 判断是否有导航栏并且获取高度，然后给window的content设置padding public static int getNavigationBarHeight(Context context) { boolean hasMenuKey = ViewConfiguration.get(context).hasPermanentMenuKey(); boolean hasBackKey = KeyCharacterMap.deviceHasKey(KeyEvent.KEYCODE_BACK); if (!hasMenuKey &#38;&#38; !hasBackKey) { Resources resources = context.getResources(); int resourceId = resources.getIdentifier("navigation_bar_height", "dimen", "android");//获取NavigationBar的高度 int height = resources.getDimensionPixelSize(resourceId); return height; } else { return 0; } } 判断是否存在导航栏，并且返回高度，然后在activity的基类里设置 getWindow().getDecorView().findViewById(android.R.id.content).setPadding(0, 0, 0, getNavigationBarHeight(this)); 这样就能完美适应了，沉浸式改怎么做就这么做]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div class="htmledit_views" id="content_views">
<p>在设置沉浸式时，华为手机底部导航栏会覆盖app的真实内容，提供以下解决方案：</p>
<p>判断是否有导航栏并且获取高度，然后给window的content设置padding</p>
<pre class="has">
<code>public static int getNavigationBarHeight(Context context) {
        boolean hasMenuKey = ViewConfiguration.get(context).hasPermanentMenuKey();
        boolean hasBackKey = KeyCharacterMap.deviceHasKey(KeyEvent.KEYCODE_BACK);
        if (!hasMenuKey &amp;&amp; !hasBackKey) {
            Resources resources = context.getResources();
            int resourceId = resources.getIdentifier("navigation_bar_height", "dimen", "android");//获取NavigationBar的高度
            int height = resources.getDimensionPixelSize(resourceId);
            return height;
        } else {
            return 0;
        }
    }</code></pre>
<p>判断是否存在导航栏，并且返回高度，然后在activity的基类里设置</p>
<pre class="has">
<code>getWindow().getDecorView().findViewById(android.R.id.content).setPadding(0, 0, 0, getNavigationBarHeight(this));</code></pre>
<p>这样就能完美适应了，沉浸式改怎么做就这么做</p>
</p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>android studio 的 sync、make、clean、rebuild、build APK</title>
		<link>https://uzzz.org/article/3016.html</link>
				<pubDate>Sat, 13 Oct 2018 06:09:54 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[工具]]></category>
		<category><![CDATA[移动开发]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3016.html</guid>
				<description><![CDATA[一、sync idea 官网说明 功能是： Synchronizing Changes in Gradle Project and IntelliJ IDEA Project 即同步 gradle 项目和 idea 项目 点击 as 的 help/Show Log in Finder（windows 可能略有不同） 点击 sync 后，查看 log： 2018-10-13 12:04:31,930 [e-1024-b01] INFO - e.project.sync.GradleSyncState - Started sync with Gradle for project 'JitpackTest'. 2018-10-13 12:04:43,183 [d thread 3] INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [:app:generateDebugSources] 可看出，同步后，执行了 :app:generateDebugSources task。 二、make 查看 as 的 log（部分）： 2018-10-13 13:49:51,668 [e-1024-b01] INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [:app:assembleDebug] 可看出，执行了 :app:assembleDebug task。 三、clean 查看 as 的 log（部分）： 2018-10-13 13:45:04,075 [e-1024-b01] INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [clean, :app:generateDebugSources] 可看出，执行了 clean、 :app:generateDebugSources task。 四、rebuild 查看 as 的 log（部分） 2018-10-13 13:46:46,075 [e-1024-b01] INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [clean, :app:assembleDebug] 可看出，执行了 clean、 :app:assembleDebug task。 五、build APK 查看 as 的 log（部分）： 2018-10-14 12:51:09,380 [e-1024-b01] INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [:app:assembleDebug] 可看出，执行了 :app:assembleDebug task。 所以，make 和 build APK 效果其实是一样的。 六、结语 除了在 android studio 的 log 中查看，也可以在 build tool window 下查看。 如执行 clean Project： 其他 as 的操作也可以使用类似的方法来查看具体执行内容。]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div id="content_views" class="markdown_views prism-atom-one-dark">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<h1><a id="sync_0"></a>一、sync</h1>
<p><a href="https://www.jetbrains.com/help/idea/2016.1/synchronizing-changes-in-gradle-project-and-intellij-idea-project.html?search=sync" rel="nofollow" data-token="bfcef5ca49be77e307556717b1096101">idea 官网说明</a></p>
<p>功能是：<br /> Synchronizing Changes in Gradle Project and IntelliJ IDEA Project<br /> 即同步 gradle 项目和 idea 项目</p>
<p>点击 as 的 <code>help/Show Log in Finder</code>（windows 可能略有不同）<br /> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190325102938740.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0dkZWVy,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br /> 点击 sync 后，查看 log：</p>
<pre><code>2018-10-13 12:04:31,930 [e-1024-b01]   INFO - e.project.sync.GradleSyncState - Started sync with Gradle for project 'JitpackTest'. 
2018-10-13 12:04:43,183 [d thread 3]   INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [:app:generateDebugSources] 
</code></pre>
<p>可看出，同步后，执行了 <code>:app:generateDebugSources</code> task。</p>
<h1><a id="make_16"></a>二、make</h1>
<p>查看 as 的 log（部分）：</p>
<pre><code>2018-10-13 13:49:51,668 [e-1024-b01]   INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [:app:assembleDebug] 
</code></pre>
<p>可看出，执行了 <code>:app:assembleDebug</code> task。</p>
<h1><a id="clean_23"></a>三、clean</h1>
<p>查看 as 的 log（部分）：</p>
<pre><code>2018-10-13 13:45:04,075 [e-1024-b01]   INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [clean, :app:generateDebugSources] 
</code></pre>
<p>可看出，执行了 <code>clean</code>、 <code>:app:generateDebugSources</code> task。</p>
<h1><a id="rebuild_30"></a>四、rebuild</h1>
<p>查看 as 的 log（部分）</p>
<pre><code>2018-10-13 13:46:46,075 [e-1024-b01]   INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [clean, :app:assembleDebug]
</code></pre>
<p>可看出，执行了 <code>clean</code>、 <code>:app:assembleDebug</code> task。</p>
<h1><a id="build_APK_37"></a>五、build APK</h1>
<p>查看 as 的 log（部分）：</p>
<pre><code>2018-10-14 12:51:09,380 [e-1024-b01]   INFO - ild.invoker.GradleBuildInvoker - About to execute Gradle tasks: [:app:assembleDebug] 
</code></pre>
<p>可看出，执行了 <code>:app:assembleDebug</code> task。<br /> 所以，<code>make</code> 和 <code>build APK</code> 效果其实是一样的。</p>
<h1><a id="_45"></a>六、结语</h1>
<p>除了在 android studio 的 log 中查看，也可以在 build tool window 下查看。<br /> 如执行 <code>clean Project</code>：<br /> <img src="https://uzshare.com/_p?https://img-blog.csdn.net/20181014182947592?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0dkZWVy/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="在这里插入图片描述"></p>
<p>其他 as 的操作也可以使用类似的方法来查看具体执行内容。</p>
</p></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-526ced5128.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
	</channel>
</rss>
