<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>qt &#8211; 有组织在!</title>
	<atom:link href="https://uzzz.org/category/qt/feed" rel="self" type="application/rss+xml" />
	<link>https://uzzz.org/</link>
	<description></description>
	<lastBuildDate>Wed, 19 Dec 2018 14:35:53 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.2.4</generator>

<image>
	<url>https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png</url>
	<title>qt &#8211; 有组织在!</title>
	<link>https://uzzz.org/</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>QML仿微信聊天界面-消息气泡自适应</title>
		<link>https://uzzz.org/article/3398.html</link>
				<pubDate>Wed, 19 Dec 2018 14:35:53 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[qt]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3398.html</guid>
				<description><![CDATA[实现消息气泡自适应变换： 中英文混合自适应； 自动换行自适应； 单行文本： 多行文本 改变宽度文本自动调整 实现方案： Rectangle{ id:bodyleft height:ctxLH*(tt.lineCount-1)+35 implicitWidth:Math.min(fitWidth(tt.text),root.width*0.6) anchors.left: imgl1.right color:"white" radius:5 Item{ anchors.margins: 10 anchors.fill: parent anchors.verticalCenter: parent.verticalCenter Text{ id:tt anchors.fill: parent text:label wrapMode: fitWidth(tt.text)&#62;root.width*0.6?Text.WrapAnywhere:Text.NoWrap } } } 主要实现代码： 气泡宽度：取最小 implicitWidth:Math.min(fitWidth(tt.text),root.width*0.6) //Rectangle 搭配文本换行策略 fitWidth(tt.text)&#62;root.width*0.6?Text.WrapAnywhere:Text.NoWrap //Text 气泡高度：取最大 height:Math.max(img.height,bodyleft.height) 获取内容宽度： function fitWidth(text){ return fontMetrics.advanceWidth(text); }]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<p>实现消息气泡自适应变换：<br /> 中英文混合自适应；<br /> 自动换行自适应；</p>
<h4><a id="_4"></a>单行文本：</h4>
<p><img alt="在这里插入图片描述" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181219221938688.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlZWxpbmdfQw==,size_16,color_FFFFFF,t_70"></p>
<hr>
<h4><a id="_9"></a>多行文本</h4>
<p><img alt="在这里插入图片描述" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181219222255828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlZWxpbmdfQw==,size_16,color_FFFFFF,t_70"></p>
<h4><a id="_13"></a>改变宽度文本自动调整</h4>
<p><img alt="在这里插入图片描述" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20181219222420864.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlZWxpbmdfQw==,size_16,color_FFFFFF,t_70"></p>
<p><img alt="在这里插入图片描述" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2018121922245356.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlZWxpbmdfQw==,size_16,color_FFFFFF,t_70"></p>
<h4><a id="_19"></a>实现方案：</h4>
<pre><code>  Rectangle{
                    id:bodyleft
                    height:ctxLH*(tt.lineCount-1)+35
                    implicitWidth:Math.min(fitWidth(tt.text),root.width*0.6)
                    anchors.left: imgl1.right
                    color:"white"
                    radius:5
                    Item{
                        anchors.margins: 10
                        anchors.fill: parent
                        anchors.verticalCenter: parent.verticalCenter
                        Text{
                            id:tt
                            anchors.fill: parent
                            text:label
                            wrapMode: fitWidth(tt.text)&gt;root.width*0.6?Text.WrapAnywhere:Text.NoWrap
                        }
                    }
                }
</code></pre>
<p>主要实现代码：</p>
<pre><code>
气泡宽度：取最小
implicitWidth:Math.min(fitWidth(tt.text),root.width*0.6)       //Rectangle
搭配文本换行策略
fitWidth(tt.text)&gt;root.width*0.6?Text.WrapAnywhere:Text.NoWrap    //Text

气泡高度：取最大
 height:Math.max(img.height,bodyleft.height)
</code></pre>
<p>获取内容宽度：</p>
<pre><code> function fitWidth(text){
        return  fontMetrics.advanceWidth(text);
    }
</code></pre>
</p></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-526ced5128.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
		<item>
		<title>qt中lineedit的几个属性设置</title>
		<link>https://uzzz.org/article/3381.html</link>
				<pubDate>Thu, 19 Oct 2017 01:45:36 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[qt]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3381.html</guid>
				<description><![CDATA[1.lineedit不可修改，但内容不变成灰色 ui-&#62;lineEdit-&#62;setFocusPolicy(Qt::NoFocus); 2.lineedit不可修改，内容变成灰色 ui-&#62;lineEdit-&#62;setEnabled(false); 3.lineedit不显示边框 ui-&#62;lineEdit-&#62;setStyleSheet("background:transparent;border-width:0;border-style:outset");]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div id="content_views" class="markdown_views prism-atom-one-dark">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<p>1.lineedit不可修改，但内容不变成灰色</p>
<pre class="prettyprint"><code class=" hljs lasso">ui<span class="hljs-subst">-&gt;</span>lineEdit<span class="hljs-subst">-&gt;</span>setFocusPolicy(Qt<span class="hljs-tag">::NoFocus</span>);</code></pre>
<p>2.lineedit不可修改，内容变成灰色</p>
<pre class="prettyprint"><code class=" hljs lasso">ui<span class="hljs-subst">-&gt;</span>lineEdit<span class="hljs-subst">-&gt;</span>setEnabled(<span class="hljs-literal">false</span>);</code></pre>
<p>3.lineedit不显示边框</p>
<pre class="prettyprint"><code class=" hljs css"><span class="hljs-tag">ui-</span>&gt;<span class="hljs-tag">lineEdit-</span>&gt;<span class="hljs-tag">setStyleSheet</span>("<span class="hljs-tag">background</span><span class="hljs-pseudo">:transparent</span>;<span class="hljs-tag">border-width</span><span class="hljs-pseudo">:0</span>;<span class="hljs-tag">border-style</span><span class="hljs-pseudo">:outset")</span>;</code></pre>
</p></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-526ced5128.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
		<item>
		<title>TCP包防粘连的读取方法</title>
		<link>https://uzzz.org/article/3293.html</link>
				<pubDate>Sun, 26 Jun 2016 08:10:16 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[qt]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3293.html</guid>
				<description><![CDATA[当我们发送TCP包的时候你是一个一个发的，但是当你接收的时候就可能会一下收到多个包，为了防止少接收包，我是用这种方法的： 首先包的前2个字节声明了这个包后面的数据大小。 void TcpClientSocket::OnReceiveMessage() { QDataStream in(this); in.setVersion(QDataStream::Qt_5_5); while(bytesAvailable()&#62;=sizeof(quint16)){ if(blockSize==0) in&#62;&#62;blockSize; if(bytesAvailable()&#60;blockSize) break; TranslateMessage(); blockSize=0; } } 上面这段代码是我在Qt下写的。 blockSize 是包的数据大小（不包括2字节的数据大小声明） 当数据缓存大于等于2个字节（就是起码可以读到数据声明）时，就进行数据读取。如果blockSize = 0 ，说明这是一个新的数据包，然后首先读取包的大小到blockSize, 然后接下来就是等待缓存大于等于blockSize，然后进行读取 解析数据.]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div id="content_views" class="markdown_views prism-atom-one-dark">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<p>当我们发送TCP包的时候你是一个一个发的，但是当你接收的时候就可能会一下收到多个包，为了防止少接收包，我是用这种方法的： <br /> 首先包的前2个字节声明了这个包后面的数据大小。</p>
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">void</span> TcpClientSocket::OnReceiveMessage()
{
    QDataStream <span class="hljs-keyword">in</span>(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">in</span>.setVersion(QDataStream::Qt_5_5);
    <span class="hljs-keyword">while</span>(bytesAvailable()&gt;=<span class="hljs-keyword">sizeof</span>(quint16)){
        <span class="hljs-keyword">if</span>(blockSize==<span class="hljs-number">0</span>) <span class="hljs-keyword">in</span>&gt;&gt;blockSize;
        <span class="hljs-keyword">if</span>(bytesAvailable()&lt;blockSize) <span class="hljs-keyword">break</span>;
        TranslateMessage();
        blockSize=<span class="hljs-number">0</span>;
    }
}</code></pre>
<p>上面这段代码是我在Qt下写的。 <br /> blockSize 是包的数据大小（不包括2字节的数据大小声明） <br /> 当数据缓存大于等于2个字节（就是起码可以读到数据声明）时，就进行数据读取。如果blockSize = 0 ，说明这是一个新的数据包，然后首先读取包的大小到blockSize, 然后接下来就是等待缓存大于等于blockSize，然后进行读取 解析数据.</p>
</p></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-526ced5128.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
		<item>
		<title>SSH 7.2p2 移植到fl2440记录</title>
		<link>https://uzzz.org/article/2656.html</link>
				<pubDate>Tue, 14 Jun 2016 09:21:10 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[linux]]></category>
		<category><![CDATA[qt]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/2656.html</guid>
				<description><![CDATA[SSH简介 SSH的移植 编译条件 下载 配置安装 zlib的编译与安装 openssl的编译与安装 openssh的编译安装 sshd在开发板上的配置 现在可以启动sshd了使用全路径 密钥登录使用步骤详情 error error while loading shared libraries libzso1 sshd_config No such file or directory strip process terminated abnormally make check-config Error 2 ignored sshd re-exec requires execution with an absolute path Privilege separation user sshd does not exist Could not load host key或varempty must be owned by root ssh_exchange_identification Connection closed by remote host sshPermission denied please try again 可以SSH远程用密码验证登录开发板但无法使用秘钥对验证登录 Host key verification failed SSH简介： ssh：Secure SHell，个人理解就是一种安全的网络传输服务程序 ，由客户端和服务器组成，两者间数据传输的不再是明文，而是加密后的暗文，安全性高。安全登录验证方式有两种：基于口令的安全验证，基于密钥的安全验证。具体的网上介绍的太杂，感觉前后矛盾点大就是那个将公钥传给服务端，可明明都是将私钥放到服务端，让我费解好半天。 http://skypegnu1.blog.51cto.com/8991766/1641064 https://wiki.archlinux.org/index.php/Secure_Shell_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87) http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html http://erik-2-blog.logdown.com/posts/74081-ssh-principle http://blog.chinaunix.net/uid-16728139-id-3265394.html SSH的移植 编译条件： SSH的编译需要 Zlib 和 libcrypto (LibreSSL / OpenSSL)，请见安装说明，所以先编译这两个库。 1.下载 openSSH openSSL Zlib 如果要制作ubuntu下使用的ssh，openssl可以直接用下面两句下载安装 sudo apt-get install openssl sudo apt-get install libssl-dev 2.配置安装 为方便管理，新建一个安装目录，将上述三个包的安装目录指定到此位置。 1. zlib的编译与安装 cd zlib-1.2.8/ ./configure --prefix=安装目录/zlib 在生成的Makefile文件中修改 AR=arm-none-linux-gnueabi-ar CC=arm-none-linux-gnueabi-gcc CPP =arm-none-linux-gnueabi-gcc -E RANLIB=arm-linux-ar-ranlib LDSHARED=arm-none-linux-gnueabi-gcc make make install 2. openssl的编译与安装 ``` cd openssl-1.0.2h/ ./Configure --prefix=安装目录/openssl os/compiler:arm-none-linux-gnueabi-gcc make make install ``` 3.openssh的编译安装 configure opt介绍： –prefix= install architecture-independent files in PREFIX[ /usr/local ] (将体系无关文件安装到目录PREFIX里，默认是/usr/local)，这里的有： PREFIX/etc，PREFIX/com，PREFIX/var，PREFIX/include，PREFIX/share –exec-prefix=install architecture-dependent files in EPREFIX[PREFIX]（将体系相关文件安装到目录EPREFIX里） 这里的有： EPREFIX/bin， EPREFIX/sbin， EPREFIX/libexec， EPREFIX/lib， –with-zlib=刚才编译出来的zlib安装路径 –with-ssl-dir=刚才编译出来openssl安装路径 –host=交叉编译出来的程序运行的平台 –with-privsep-path=“/var/empty”的目录 （Path for privilege separation chroot）默认使用的是privsep模式，可查看READ.privsep –sysconfdir= 配置文件安装路径，此目录会影响sshd和ssh的配置寻找，如果没有使用此选项，在编译安装后，当你直接运行sshd时，它会直接去PREFIX/etc下找sshd_config,找不到就报错，只能用参数-f指明sshd_config路径。 配置./configure 配置脚本myconf.sh如下,制作好后直接运行./myconf.sh： anzyelay@ubuntu:openssh-7.2p2$ cat myconf.sh #!/bin/sh ./configure \ –prefix=/usr/local/openssh \]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div id="content_views" class="markdown_views prism-atom-one-dark">
  <!-- flowchart 箭头图标 勿删 --><br />
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> </p>
<div class="toc">
<div class="toc">
<ul>
<li>
<ul>
<li><a href="#ssh简介" rel="nofollow" data-token="2bcde42e8af97ac958e9c094bd6b47b3">SSH简介</a></li>
<li><a href="#ssh的移植" rel="nofollow" data-token="104c5ff0dd3eb81cb053610c9ec5388f">SSH的移植</a>
<ul>
<li><a href="#编译条件" rel="nofollow" data-token="3973e0e56c8201e1aa9d73dec5e08a40">编译条件</a></li>
<li><a href="#1下载" rel="nofollow" data-token="884a2c8b48ec6d07b42035dd62641e3c">下载</a></li>
<li><a href="#2配置安装" rel="nofollow" data-token="b21280b6176bc627815aeb235ea5437c">配置安装</a>
<ul>
<li><a href="#1-zlib的编译与安装" rel="nofollow" data-token="111fccf21ffc7b6b111ee117bec565d0">zlib的编译与安装</a></li>
<li><a href="#2-openssl的编译与安装" rel="nofollow" data-token="eba4ae917d3ca9b4a4a47e13b93cf294">openssl的编译与安装</a></li>
<li><a href="#3openssh的编译安装" rel="nofollow" data-token="50649b4812e361b2c60e11c9edc10473">openssh的编译安装</a></li>
<li><a href="#4sshd在开发板上的配置" rel="nofollow" data-token="5eac8eaa8bb4e190be68db312edcd94f">sshd在开发板上的配置</a></li>
<li><a href="#5-现在可以启动sshd了使用全路径" rel="nofollow" data-token="6112b146ccbf10409928bf7d79e8257f">现在可以启动sshd了使用全路径</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#密钥登录使用步骤详情" rel="nofollow" data-token="3b4d2abaad5e432342727140ca75cbf3">密钥登录使用步骤详情</a></li>
<li><a href="#error" rel="nofollow" data-token="8d62442f8d3df856731a0dcdef654ca2">error</a>
<ul>
<li><a href="#1-error-while-loading-shared-libraries-libzso1" rel="nofollow" data-token="62fd1d62d2213b788274c32dedeca6f4">error while loading shared libraries libzso1</a></li>
<li><a href="#2-sshdconfig-no-such-file-or-directory" rel="nofollow" data-token="e73c45db18ae6e8cf787a73bb834dcc7">sshd_config No such file or directory</a></li>
<li><a href="#3-strip-process-terminated-abnormally" rel="nofollow" data-token="f8d299fb3f76820d709dee963cc77bc5">strip process terminated abnormally</a></li>
<li><a href="#4make-check-config-error-2-ignored" rel="nofollow" data-token="bbea9c42b060329e2ea1c789d4f37d95">make check-config Error 2 ignored</a></li>
<li><a href="#5-sshd-re-exec-requires-execution-with-an-absolute-path" rel="nofollow" data-token="4e422e732b56f9a9eb0d4c6ce0168828">sshd re-exec requires execution with an absolute path</a></li>
<li><a href="#6-privilege-separation-user-sshd-does-not-exist" rel="nofollow" data-token="19c969fc7b73f5bd6d44b287f4d95b88">Privilege separation user sshd does not exist</a></li>
<li><a href="#7could-not-load-host-key或varempty-must-be-owned-by-root" rel="nofollow" data-token="3b853e024bcf16683b6556816a4dad2e">Could not load host key或varempty must be owned by root</a></li>
<li><a href="#8-sshexchangeidentification-connection-closed-by-remote-host" rel="nofollow" data-token="0750c6cdf248ef46a1b324c57e66a594">ssh_exchange_identification Connection closed by remote host</a></li>
<li><a href="#9-sshpermission-denied-please-try-again" rel="nofollow" data-token="33a36d3ba37ca3d5b0298753421667dc">sshPermission denied please try again</a></li>
<li><a href="#10-可以ssh远程用密码验证登录开发板但无法使用秘钥对验证登录" rel="nofollow" data-token="59659f7829dfedbed2b4c2ebd14672ce">可以SSH远程用密码验证登录开发板但无法使用秘钥对验证登录</a></li>
<li><a href="#11host-key-verification-failed" rel="nofollow" data-token="fefae0b1e36b20b9452620b4f4d4f56f">Host key verification failed</a></li>
</ul>
</li>
</ul>
</li>
</ul></div>
</p></div>
</p>
<h2 id="ssh简介">SSH简介：</h2>
<p>ssh：Secure SHell，个人理解就是一种安全的网络传输服务程序 ，由客户端和服务器组成，两者间数据传输的不再是明文，而是加密后的暗文，安全性高。安全登录验证方式有两种：基于口令的安全验证，基于密钥的安全验证。具体的网上介绍的太杂，感觉前后矛盾点大就是那个将公钥传给服务端，可明明都是将私钥放到服务端，让我费解好半天。 <br /> <a href="http://skypegnu1.blog.51cto.com/8991766/1641064" rel="nofollow" data-token="8e92caf812db0618bda13ab428fbe754">http://skypegnu1.blog.51cto.com/8991766/1641064</a> <br /> <a href="https://wiki.archlinux.org/index.php/Secure_Shell_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" rel="nofollow" data-token="8591b32be236e8e6a330e065f8f622d2">https://wiki.archlinux.org/index.php/Secure_Shell_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)</a> <br /> <a href="http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html" rel="nofollow" data-token="b632a2ea19b9ec91b0627c8dfdee1272">http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html</a> <br /> <a href="http://erik-2-blog.logdown.com/posts/74081-ssh-principle" rel="nofollow" data-token="74a750aa19641c05300f2c9e7c1e26b1">http://erik-2-blog.logdown.com/posts/74081-ssh-principle</a> <br /> <a href="http://blog.chinaunix.net/uid-16728139-id-3265394.html" rel="nofollow" data-token="c817a7a1227c462b996ec9b845b293ad">http://blog.chinaunix.net/uid-16728139-id-3265394.html</a></p>
<h2 id="ssh的移植">SSH的移植</h2>
<h3 id="编译条件">编译条件：</h3>
<p>SSH的编译需要 Zlib 和 libcrypto (LibreSSL / <br /> OpenSSL)，请见<a href="http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/INSTALL" rel="nofollow" data-token="b178f0e24fae571ce133b981f3895836">安装说明</a>，所以先编译这两个库。</p>
<h3 id="1下载">1.下载</h3>
<ul>
<li><a href="http://www.openssh.com/portable.html" rel="nofollow" data-token="654df1564a2cf1ac049f20b74c4e8174">openSSH</a> </li>
<li><a href="https://www.openssl.org/source/" rel="nofollow" data-token="0a3e61daf31978ac968f941c2f572233">openSSL</a></li>
<li>
<p><a href="http://www.zlib.net/" rel="nofollow" data-token="e11c68f0be796271bfef3a169e33eb9f">Zlib</a> <br /> 如果要制作ubuntu下使用的ssh，openssl可以直接用下面两句下载安装</p>
<pre class="prettyprint"><code class=" hljs lasso">sudo apt<span class="hljs-attribute">-get</span> install openssl 
sudo apt<span class="hljs-attribute">-get</span> install libssl<span class="hljs-attribute">-dev</span></code></pre>
</li>
</ul>
<h3 id="2配置安装">2.配置安装</h3>
<p>为方便管理，新建一个安装目录，将上述三个包的安装目录指定到此位置。</p>
<h4 id="1-zlib的编译与安装">1. zlib的编译与安装</h4>
<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> zlib-<span class="hljs-number">1.2</span>.<span class="hljs-number">8</span>/
./configure --prefix=安装目录/zlib</code></pre>
<p>在生成的Makefile文件中修改 <br /> AR=arm-none-linux-gnueabi-ar <br /> CC=arm-none-linux-gnueabi-gcc <br /> CPP =arm-none-linux-gnueabi-gcc -E <br /> RANLIB=arm-linux-ar-ranlib <br /> LDSHARED=arm-none-linux-gnueabi-gcc</p>
<pre class="prettyprint"><code class=" hljs go"><span class="hljs-built_in">make</span>
<span class="hljs-built_in">make</span> install</code></pre>
<h4 id="2-openssl的编译与安装">2. openssl的编译与安装</h4>
<pre><code>```
cd openssl-1.0.2h/
./Configure --prefix=安装目录/openssl os/compiler:arm-none-linux-gnueabi-gcc
make
make install
```
</code></pre>
<h4 id="3openssh的编译安装">3.openssh的编译安装</h4>
<ul>
<li>
<p>configure opt介绍：</p>
<ol>
<li>
<p>–prefix= install architecture-independent files in PREFIX[ /usr/local ] (将体系无关文件安装到目录PREFIX里，默认是/usr/local)，这里的有：</p>
<blockquote>
<p>PREFIX/etc，PREFIX/com，PREFIX/var，PREFIX/include，PREFIX/share</p>
</blockquote>
</li>
<li>
<p>–exec-prefix=install architecture-dependent files in EPREFIX[PREFIX]（将体系相关文件安装到目录EPREFIX里） <br /> 这里的有：</p>
<blockquote>
<p>EPREFIX/bin， EPREFIX/sbin， EPREFIX/libexec， EPREFIX/lib，</p>
</blockquote>
</li>
<li>
<p>–with-zlib=刚才编译出来的zlib安装路径</p>
</li>
<li>–with-ssl-dir=刚才编译出来openssl安装路径</li>
<li>–host=交叉编译出来的程序运行的平台</li>
<li>–with-privsep-path=“/var/empty”的目录 （Path for privilege separation chroot）默认使用的是privsep模式，可查看READ.privsep</li>
<li>–sysconfdir= 配置文件安装路径，此目录会影响sshd和ssh的配置寻找，如果没有使用此选项，在编译安装后，当你直接运行sshd时，它会直接去PREFIX/etc下找sshd_config,找不到就报错，只能用参数-f指明sshd_config路径。</li>
</ol>
</li>
<li>
<p>配置./configure <br /> 配置脚本myconf.sh如下,制作好后直接运行./myconf.sh：</p>
<blockquote>
<p>anzyelay@ubuntu:openssh-7.2p2$ cat myconf.sh <br /> #!/bin/sh <br /> ./configure \ <br /> –prefix=/usr/local/openssh \ <br /> –host=arm-none-linux-gnueabi \ <br /> –with-libs \ <br /> –with-zlib=/home/anzyelay/Downloads/openssh/install/zlib \ <br /> –with-ssl-dir=/home/anzyelay/Downloads/openssh/install/openssl \ <br /> –disable-etc-default-login \ <br /> CC=arm-linux-gcc \ <br /> AR=arm-none-linux-gnueabi-ar \ <br /> exit</p>
</blockquote>
<p>配置完后在生成的Makefile中做些修改,下面黑体就是要修改的地方</p>
<blockquote>
<p><strong>22 DESTDIR=/home/anzyelay/Desktop/arm/myrootfs</strong> <br /> #我的根文件系统目录，此用来设置安装根目录，真实的安装目录为DESTDIR/PREFIX/..或 DESTDIR/EPREFIX/.. <br /> <strong>31 STRIP_OPT=-s –strip-program=arm-none-linux-gnueabi-strip</strong></p>
</blockquote>
<p>之所以修改DESTDIR是为了后面的安装不会错误的安到PC机上去。如果不修改也可以在安装时指明此定义。</p>
</li>
<li>
<p>编译安装</p>
<pre class="prettyprint"><code class=" hljs go"><span class="hljs-built_in">make</span> &amp; <span class="hljs-built_in">make</span> install-nokeys</code></pre>
<p>DESTDIR修改后就可以直接用make install-nokeys而不用手动去拷贝文件了，网上的文章都是叫你手动拷贝，麻烦的要死，成功安装后多出的文件如下：</p>
<pre class="prettyprint"><code class=" hljs lasso">anzyelay@ubuntu:myrootfs$ tree usr/<span class="hljs-built_in">local</span>/openssh<span class="hljs-subst">/</span>
usr/<span class="hljs-built_in">local</span>/openssh<span class="hljs-subst">/</span>
├── bin
│   ├── scp
│   ├── sftp
│   ├── ssh
│   ├── ssh<span class="hljs-attribute">-add</span>
│   ├── ssh<span class="hljs-attribute">-agent</span>
│   ├── ssh<span class="hljs-attribute">-keygen</span>
│   └── ssh<span class="hljs-attribute">-keyscan</span>
├── etc
│   ├── moduli
│   ├── ssh_config
│   └── sshd_config
├── libexec
│   ├── sftp<span class="hljs-attribute">-server</span>
│   ├── ssh<span class="hljs-attribute">-keysign</span>
│   └── ssh<span class="hljs-attribute">-pkcs11</span><span class="hljs-attribute">-helper</span>
├── sbin
│   └── sshd
└── share
    └── man
        ├── man1
        │   ├── scp<span class="hljs-number">.1</span>
        │   ├── sftp<span class="hljs-number">.1</span>
        │   ├── ssh<span class="hljs-number">.1</span>
        │   ├── ssh<span class="hljs-attribute">-add</span><span class="hljs-number">.1</span>
        │   ├── ssh<span class="hljs-attribute">-agent</span><span class="hljs-number">.1</span>
        │   ├── ssh<span class="hljs-attribute">-keygen</span><span class="hljs-number">.1</span>
        │   └── ssh<span class="hljs-attribute">-keyscan</span><span class="hljs-number">.1</span>
        ├── man5
        │   ├── moduli<span class="hljs-number">.5</span>
        │   ├── ssh_config<span class="hljs-number">.5</span>
        │   └── sshd_config<span class="hljs-number">.5</span>
        └── man8
            ├── sftp<span class="hljs-attribute">-server</span><span class="hljs-number">.8</span>
            ├── sshd<span class="hljs-number">.8</span>
            ├── ssh<span class="hljs-attribute">-keysign</span><span class="hljs-number">.8</span>
            └── ssh<span class="hljs-attribute">-pkcs11</span><span class="hljs-attribute">-helper</span><span class="hljs-number">.8</span>
<span class="hljs-number">9</span> directories, <span class="hljs-number">28</span> files

anzyelay@ubuntu:myrootfs$ tree <span class="hljs-built_in">var</span><span class="hljs-subst">/</span>
<span class="hljs-built_in">var</span><span class="hljs-subst">/</span>
└── empty

<span class="hljs-number">1</span> directory, <span class="hljs-number">0</span> files

</code></pre>
<p>如果不执行make install-nokeys这一步，就需要手动移动上述文件，其中└── share和etc/moduli这两个不必需要。</p>
</li>
</ul>
<h4 id="4sshd在开发板上的配置">4.sshd在开发板上的配置</h4>
<p>如果是在电脑上的安装使用的是make install，从上面使用的make install-nokey可看出区别，电脑上还执行了两步check-config和host-key，因此我们在开发板上补足这两步。</p>
<ul>
<li>启动开发板 </li>
<li>
<p>添加SSHD账户 <br /> 上步的安装完成后会有一个sshd的家目录/var/empty，如果没有就自己mkdir，该文件必须是空的，具体查看 erorr.6小节的错误，也可以自行查看README.privsep文件。</p>
<pre class="prettyprint"><code class=" hljs lasso">adduser <span class="hljs-attribute">-h</span> /<span class="hljs-built_in">var</span>/empty <span class="hljs-attribute">-g</span> <span class="hljs-string">'sshd privsep'</span> <span class="hljs-attribute">-s</span> /bin/<span class="hljs-literal">false</span> sshd sshd </code></pre>
</li>
<li>
<p>手动制作sshd的私钥key <br /> 用处：用来在通信协议建立期间验证服务器身份防止连接到伪服务器。key有公钥和私钥，无论你是用PC版的ssh-keygen还是arm版的ssh-keygen，无非是制作key的平台工具不同，实质都是一样的，但PC上生成的速度快些，所以在PC机上制作好KEY，将私钥发送到开发板上做为服务器的私钥也行（网上好多这里都说将公钥弄过来，这是错误的说法。我想这里的私钥是用在服务端认证阶段中的，而网上说的公钥是用在客户端认证时的登录验证的，两者不是一个东西，登录验证我可以使用密码验证的方式，压根就不需要客户端公钥，但如果这里服务器没有自己的私钥那无论哪 种验证方式都用不了，因为无法证明你连接的服务器是不是被伪照的，所以直接连接中断。），ed25519和ecdsa这两种类型在开发板上制作也很快，其它类型要10来分钟才能生成。 <br /> 制作key的命令：ssh-keygen <br /> 命令格式：</p>
<blockquote>
<p>ssh-keygen -t type [-N new_passphrase] [-f output_keyfile] <br /> -type : 有rsa1,dsa,rsa,ecdsa,ed25519 这几种类型</p>
</blockquote>
<p>各种类型的密钥制作如下，只需要选则一种加密方式就好，推荐ecdsa，ed25519，快速高效：</p>
<pre class="prettyprint"><code class=" hljs lasso">ssh<span class="hljs-attribute">-keygen</span> <span class="hljs-attribute">-t</span> rsa1 <span class="hljs-attribute">-f</span> <span class="hljs-built_in">.</span>/ssh_host_key <span class="hljs-attribute">-N</span> <span class="hljs-string">""</span>
ssh<span class="hljs-attribute">-keygen</span> <span class="hljs-attribute">-t</span> dsa <span class="hljs-attribute">-f</span> <span class="hljs-built_in">.</span>/ssh_host_dsa_key <span class="hljs-attribute">-N</span> <span class="hljs-string">""</span>
ssh<span class="hljs-attribute">-keygen</span> <span class="hljs-attribute">-t</span> rsa <span class="hljs-attribute">-f</span> <span class="hljs-built_in">.</span>/ssh_host_rsa_key <span class="hljs-attribute">-N</span> <span class="hljs-string">""</span>
ssh<span class="hljs-attribute">-keygen</span> <span class="hljs-attribute">-t</span> ecdsa <span class="hljs-attribute">-f</span> <span class="hljs-built_in">.</span>/ssh_host_ecdsa_key <span class="hljs-attribute">-N</span> <span class="hljs-string">""</span>
ssh<span class="hljs-attribute">-keygen</span> <span class="hljs-attribute">-t</span> ed25519 <span class="hljs-attribute">-f</span> <span class="hljs-built_in">.</span>/ssh_host_ed25519_key <span class="hljs-attribute">-N</span> <span class="hljs-string">""</span>

ssh_host_key    ssh_host_key<span class="hljs-built_in">.</span>pub
ssh_host_dsa_key  ssh_host_dsa_key<span class="hljs-built_in">.</span>pub     
ssh_host_rsa_key   ssh_host_rsa_key<span class="hljs-built_in">.</span>pub
ssh_host_ecdsa_key   ssh_host_ecdsa_key<span class="hljs-built_in">.</span>pub 
ssh_host_ed25519_key ssh_host_ed25519_key<span class="hljs-built_in">.</span>pub
</code></pre>
<p>-f 指的是保存的目录文件，执行完后会生成ssh_host_**_key和ssh_host_**_key.pub,一个是私钥，一个是公钥。 <br /> ed25519类型可能你PC上的版本太低不支持，将做好的私钥拖到开发板上去（我们这里放到/usr/local/openssh/etc/下），在etc/sshd_config中指定譔私钥的位置，如我使用的是ecdsa类型，修改sshd_config如下。</p>
<pre class="prettyprint"><code class=" hljs livecodeserver">  <span class="hljs-number">9</span> Protocol <span class="hljs-number">2</span>
 <span class="hljs-number">10</span> <span class="hljs-comment"># HostKeys for protocol version 2</span>
 <span class="hljs-number">11</span> <span class="hljs-comment">#HostKey /etc/ssh/ssh_host_rsa_key</span>
 <span class="hljs-number">12</span> <span class="hljs-comment">#HostKey /etc/ssh/ssh_host_dsa_key</span>
 <span class="hljs-number">13</span> HostKey /usr/<span class="hljs-built_in">local</span>/openssh/etc/ssh_host_ecdsa_key</code></pre>
<p>同时修改使用密码登录的功能配置如下：</p>
<pre class="prettyprint"><code class=" hljs coffeescript"> <span class="hljs-number">45</span> PermitRootLogin <span class="hljs-literal">yes</span>
 <span class="hljs-number">73</span> PasswordAuthentication <span class="hljs-literal">yes</span>
 <span class="hljs-number">74</span> PermitEmptyPasswords <span class="hljs-literal">yes</span></code></pre>
<p>如果想使用密钥验证可看 密钥登录使用步骤详情，有错误看error里的10小节中的总结，那里有较细的说明</p>
</li>
</ul>
<h4 id="5-现在可以启动sshd了使用全路径">5. 现在可以启动sshd了，使用全路径</h4>
<ul>
<li>
<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/ssh</span>]<span class="hljs-comment"># /usr/local/openssh/sbin/sshd </span>
[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/ssh</span>]<span class="hljs-comment"># ps |grep sshd</span>
 <span class="hljs-number">1473</span> root       <span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span> /usr/local/openssh/sbin/sshd
 <span class="hljs-number">1501</span> root       <span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span> grep sshd</code></pre>
</li>
</ul>
<p>上面说明正常启动服务器了，每次更改配置后都要重启一次才生效。可以在PC端使用ssh命令远程登录试试，</p>
<ul>
<li>
<pre class="prettyprint"><code class=" hljs ruby">anzyelay<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:etc</span><span class="hljs-variable">$ </span>ssh root<span class="hljs-variable">@192</span>.<span class="hljs-number">168.10</span>.<span class="hljs-number">110</span>
 <span class="hljs-constant">Processing</span>  /etc/profile... 
<span class="hljs-constant">Done</span>
[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/~</span>]<span class="hljs-comment"># </span>
</code></pre>
</li>
</ul>
<p>OK，成功了</p>
<hr>
<h2 id="密钥登录使用步骤详情">密钥登录使用步骤详情</h2>
<ul>
<li>1 配置好相关文件（sshd_config）</li>
<li>
<p>2 制作开发板上（服务端）的密钥对，使服务端能正常与外部客户端建立通信。 <br /> 命令如下：（类型也可以是其它的，自己尝试）</p>
<pre class="prettyprint"><code class=" hljs lasso">ssh<span class="hljs-attribute">-keygen</span> <span class="hljs-attribute">-t</span> ecdsa <span class="hljs-attribute">-f</span> <span class="hljs-built_in">.</span>/ssh_host_ecdsa_key <span class="hljs-attribute">-N</span> <span class="hljs-string">""</span></code></pre>
<p>密钥对的制作也可以在其它机上进行，重点是要把该密钥对放置在sshd_config 的hostkey指定的位置 <br /> 比如我的是：<code>HostKey /etc/ssh/ssh_host_ecdsa_key</code>则就要将这对密钥拷贝到/etc/ssh/下，且名字要一致哦。</p>
<p>PC机在登录的前期，开发板会将这个公钥分发给PC机，PC机会将这个公钥与自己的~/.ssh/known_hosts里面的保存的服务器公钥对比，如果不对就停止。这是确保不会登录到假服务器。所以，如果你的开发板上的密钥对更改了，你PC机就要删除原来旧的开发板的公钥，这样才能正常。</p>
</li>
<li>
<p>3 在PC机上（客户端）制作密钥对，用于给服务端验证身份登录。 <br /> 命令如下：</p>
<pre class="prettyprint"><code class=" hljs vala">
<span class="hljs-preprocessor">#ssh-keygen -t ecdsa</span>


<span class="hljs-preprocessor">#ls ~/.ssh/</span>

id_ecdsa  id_ecdsa.pub  known_hosts  qtc_id  qtc_id.pub
</code></pre>
<p>不用指明地址，它会自动保存在～/.ssh/目录下 (qtc_id这对是我用QT创建的)，这个私钥用于PC机加密登录信息，公钥分发给开发板，开发板用其来解密加密过的登录信息这样就完成了登录验证。</p>
</li>
<li>
<p>4 将PC机的公钥（即id_ecdsa.pub） 添加到开发板的认证列表里，这样就可以允许该PC机登录。 <br /> 认证列表由sshd_config里的AuthorizedKeysFile %h/.ssh/authorized_keys 指定，%h是指当前用户根目录，即～/，手动将id_ecdsa.pub弄到开发板目录上，然后使用如下命令添加进去：</p>
<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># cat root/.ssh/authorized_keys cat qtc_id.pub &gt;&gt; root/.ssh/authorized_keys</span>
[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># cat root/.ssh/authorized_keys </span>
ecdsa-sha2-nistp256 <span class="hljs-constant">AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCswoZR7ZK3MMtwQ</span>/exkVd/dloZu
ecdsa-sha2-nistp256 <span class="hljs-constant">AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJI5f3AQEpVLfSUw7mKV9I6GFyUu</span>
ssh-rsa <span class="hljs-constant">AAAAB3NzaC1yc2EAAAADAQABAAAAgQC4JFTrDe92BNZ8F1lqbThtstfaen0NUACsMZjm9Fjdwt8amRT5XwvlMNsKUQy</span>
</code></pre>
<p>上面有3条公钥了， <br /> 或者（前提下是如果能使用空密码登录）</p>
<pre class="prettyprint"><code class=" hljs lasso">ssh<span class="hljs-attribute">-copy</span><span class="hljs-attribute">-id</span> <span class="hljs-attribute">-i</span> ～<span class="hljs-subst">/</span><span class="hljs-built_in">.</span>ssh<span class="hljs-subst">/</span>制作出来的公钥<span class="hljs-built_in">.</span>pub usr@IP地址 </code></pre>
<p>如果是使用qt的话，可以使用create new…创建一个密钥对（同第3步），然后会生成一对 qtc_id，点击deploy public key分发公钥给开发板，如果不行就如上手动添加。</p>
</li>
<li>
<p>5 登录</p>
<pre class="prettyprint"><code class=" hljs ruby">ssh root<span class="hljs-variable">@192</span>.<span class="hljs-number">168.10</span>.<span class="hljs-number">110</span></code></pre>
<p>如果这样可以登录了但在qt里还是出错</p>
<pre class="prettyprint"><code class=" hljs livecodeserver">Connecting <span class="hljs-built_in">to</span> host...
SSH connection failure: Timeout waiting <span class="hljs-keyword">for</span> reply <span class="hljs-built_in">from</span> server.

Device test failed.</code></pre>
<p>可以按上面说的用qt尝试生成不丗类型的密钥对，分发公钥给开发板，将timeout数值设置大些，这样总能成功的。</p>
</li>
</ul>
<h2 id="error">error</h2>
<h3 id="1-error-while-loading-shared-libraries-libzso1">1. error while loading shared libraries: libz.so.1</h3>
<ul>
<li>
<p>具体错误信息：</p>
<blockquote>
<p>[root@bst:/bin]# ./ssh-keygen -t rsa -f ssh_host_rsa_key -N “” <br /> ./ssh-keygen: error while loading shared libraries: libz.so.1: cannot <br /> open shary..</p>
<p>[root@bst:/]# /usr/local/sbin/sshd <br /> /usr/local/sbin/sshd: error while loading shared libraries: libz.so.1: cannot oy <br /> [root@bst:/]# </p>
</blockquote>
</li>
<li>
<p>原因及解决办法 ： <br /> 缺少libz.so库，到libz安装目录，将lib里的三个库拷贝到文件系统根目录</p>
<pre class="prettyprint"><code class=" hljs asciidoc">anzyelay@ubuntu:install$ cd install/zlib/
anzyelay@ubuntu:zlib$ cp -av ./lib/<span class="hljs-strong">*.so*</span> ~/Desktop/arm/myrootfs/lib/
<span class="hljs-smartquote">`./lib/libz.so'</span> -&gt; <span class="hljs-smartquote">`/home/anzyelay/Desktop/arm/myrootfs/lib/libz.so'</span>
<span class="hljs-smartquote">`./lib/libz.so.1'</span> -&gt; <span class="hljs-smartquote">`/home/anzyelay/Desktop/arm/myrootfs/lib/libz.so.1'</span>
<span class="hljs-smartquote">`./lib/libz.so.1.2.8'</span> -&gt; <span class="hljs-smartquote">`/home/anzyelay/Desktop/arm/myrootfs/lib/libz.so.1.2.8'</span>
</code></pre>
</li>
</ul>
<h3 id="2-sshdconfig-no-such-file-or-directory">2. sshd_config: No such file or directory</h3>
<ul>
<li>
<p>具体错误信息：</p>
<pre class="prettyprint"><code class=" hljs ruby"> [root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># /usr/local/sbin/sshd </span>
/home/anzyelay/<span class="hljs-constant">Downloads</span>/openssh/install/openssh/etc/<span class="hljs-symbol">sshd_config:</span> <span class="hljs-constant">No</span> such file <span class="hljs-keyword">or</span> directory</code></pre>
</li>
<li>
<p>原因及解决方式： <br /> sshd_config配置文件路径不对，使用如下命令指定sshd_config文件位置</p>
<pre class="prettyprint"><code class=" hljs lasso">/usr/<span class="hljs-built_in">local</span>/sbin/sshd <span class="hljs-attribute">-t</span> <span class="hljs-attribute">-f</span> 目录/sshd_config</code></pre>
<p>注：但我后来在做了上面第4步：<strong>sshd在开发板上的配置</strong> 后直接/usr/local/sbin/sshd未指定也能成功运行。。。</p>
</li>
</ul>
<h3 id="3-strip-process-terminated-abnormally">3. strip process terminated abnormally</h3>
<ul>
<li>
<p>具体错误信息：</p>
<pre class="prettyprint"><code class=" hljs asciidoc">/usr/bin/install -c -m 0755 -s ssh /home/anzyelay/Desktop/arm/myrootfs/usr/local/openssh/bin/ssh
strip: Unable to recognise the format of the input file <span class="hljs-smartquote">`/home/anzyelay/Desktop/arm/myrootfs/usr/local/openssh/bin/ssh'</span>
/usr/bin/install: strip process terminated abnormally
</code></pre>
</li>
<li>
<p>原因及解决方式： <br /> 由于我们是交叉编译的文件，而在make install时使用的strip不是交叉编译版的，所以不能正解执行。网上找了一圈也是只能注释掉Makefile中的STRIP_OPT=-s这一选项。后来自己man install时看到有个”–strip-program”的选项，尝试了下将STRIP_OPT=改为如下，再make install时此错误就消息了。</p>
<pre class="prettyprint"><code class=" hljs lasso">STRIP_OPT<span class="hljs-subst">=-</span>s <span class="hljs-subst">--</span>strip<span class="hljs-attribute">-program</span><span class="hljs-subst">=</span>arm<span class="hljs-attribute">-none</span><span class="hljs-attribute">-linux</span><span class="hljs-attribute">-gnueabi</span><span class="hljs-attribute">-strip</span></code></pre>
</li>
</ul>
<h3 id="4make-check-config-error-2-ignored">4.make: [check-config] Error 2 (ignored)</h3>
<ul>
<li>
<p>具体错误信息： <br /> 在make install时出错如下</p>
<pre class="prettyprint"><code class=" hljs lasso">/home/anzyelay/Desktop/arm/myrootfs/usr/<span class="hljs-built_in">local</span>/openssh/sbin/sshd <span class="hljs-attribute">-t</span> <span class="hljs-attribute">-f</span> /home/anzyelay/Desktop/arm/myrootfs/usr/<span class="hljs-built_in">local</span>/openssh/etc/sshd_config
/home/anzyelay/Desktop/arm/myrootfs/usr/<span class="hljs-built_in">local</span>/openssh/sbin/sshd: <span class="hljs-number">1</span>: /home/anzyelay/Desktop/arm/myrootfs/usr/<span class="hljs-built_in">local</span>/openssh/sbin/sshd: Syntax error: word unexpected (expecting <span class="hljs-string">")"</span>)
make: <span class="hljs-preprocessor">[</span>check<span class="hljs-attribute">-config</span><span class="hljs-preprocessor">]</span><span class="hljs-markup"> Error 2 (ignored) </span></code></pre>
</li>
<li>
<p>原因及解决方式： <br /> 查看Makefile中相关信息，在安装时会自动运行ssh-keygen和sshd，而此处运行程序是ARM版的，在PC平台是不可能运行成功，因此要跳过此步。使用如下命令</p>
<pre class="prettyprint"><code class=" hljs cmake">make <span class="hljs-keyword">install</span>-nokeys</code></pre>
<p>这样就没有做host-key和check-config这两步，手动到运行开发板设置下。</p>
</li>
</ul>
<h3 id="5-sshd-re-exec-requires-execution-with-an-absolute-path">5. sshd re-exec requires execution with an absolute path</h3>
<ul>
<li>
<p>具体错误信息：</p>
<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># ./usr/local/openssh/sbin/sshd </span>
sshd re-exec requires execution with an absolute path</code></pre>
</li>
<li>
<p>原因及解决方式： <br /> 使用绝对路径启动</p>
<pre class="prettyprint"><code class=" hljs lua">/usr/<span class="hljs-keyword">local</span>/openssh/sbin/sshd</code></pre>
</li>
</ul>
<h3 id="6-privilege-separation-user-sshd-does-not-exist">6. Privilege separation user sshd does not exist</h3>
<ul>
<li>
<p>具体错误信息：</p>
<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># /usr/local/openssh/sbin/sshd </span>
<span class="hljs-constant">Privilege</span> separation user sshd does <span class="hljs-keyword">not</span> exist</code></pre>
</li>
<li>
<p>原因及解决方式： <br /> sshd账户不存在，需要增加该账户。sshd默认是使能Privilege separation，可以阅读README.privsep文档。</p>
<blockquote>
<p>21 You should do something like the following to prepare the privsep <br /> 22 preauth environment: <br /> 23 <br /> 24 # mkdir /var/empty <br /> 25 # chown root:sys /var/empty <br /> 26 # chmod 755 /var/empty <br /> 27 # groupadd sshd <br /> 28 # useradd -g sshd -c ‘sshd privsep’ -d /var/empty -s /bin/false sshd <br /> 29 <br /> 30 /var/empty should not contain any files.</p>
</blockquote>
<p>其中groupadd，useradd命令在我的开发板上是addgroup，adduser,但分开弄没弄好，我直接使用adduser一块把分组和账户都建立了，如下sshd那行就是多出来的：</p>
<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># adduser -h /var/empty -g 'sshd privsep' -s /bin/false sshd sshd </span>
[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># cat etc/passwd </span>
<span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/sh</span>                                                   
<span class="hljs-symbol">sshd:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:sshd</span> <span class="hljs-symbol">privsep:</span>/var/<span class="hljs-symbol">empty:</span>/bin/<span class="hljs-keyword">false</span> 
[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># cat etc/group </span>
<span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:</span>                                                                    
<span class="hljs-symbol">sshd:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:</span>    
[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># cat etc/shadow </span>
<span class="hljs-symbol">root:</span>!<span class="hljs-symbol">:</span><span class="hljs-number">16884</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">99999</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span>     
<span class="hljs-symbol">sshd:</span>!<span class="hljs-symbol">:</span><span class="hljs-number">24271</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">99999</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span> </code></pre>
</li>
</ul>
<h3 id="7could-not-load-host-key或varempty-must-be-owned-by-root">7.Could not load host key或/var/empty must be owned by root</h3>
<ul>
<li>
<p>具体错误信息： <br /> 运行sshd出如下错误</p>
<pre class="prettyprint"><code class=" hljs sql">[root@bst:/]# /usr/local/openssh/sbin/sshd                                      
Could not <span class="hljs-operator"><span class="hljs-keyword">load</span> host <span class="hljs-keyword">key</span>: /usr/<span class="hljs-keyword">local</span>/openssh/etc/ssh_host_ed25519_key /var/empty must be owned <span class="hljs-keyword">by</span> root <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">or</span> world-writable. </span></code></pre>
</li>
<li>
<p>原因及解决方式： <br /> ed25519加密类型是新版本有的，我们移植的版本是最新版，在PC上可能版本没有这么新，无法生成这种类型的密钥。那就要升级了，看了下好麻烦，直接在开发板上试试ssh-keygen,结果还挺快的！！！，不过没有这个无所谓，主要客户端和服务器端有共同的加密方式可用就可以，在其中选一种加密方式通信就行，如果不想看到这个错误可以在配置上注释掉这种host_key。</p>
<pre class="prettyprint"><code class=" hljs vbnet">[root@bst:/etc]<span class="hljs-preprocessor"># /usr/local/openssh/bin/ssh-keygen -t ed25519 -f /usr/local/open</span>
ssh/etc/ssh_host_ED25519_key -N <span class="hljs-string">""</span>                                              
Generating <span class="hljs-keyword">public</span>/<span class="hljs-keyword">private</span> ed25519 <span class="hljs-keyword">key</span> pair.                                     
Your identification has been saved <span class="hljs-keyword">in</span> /usr/local/openssh/etc/ssh_host_ED25519_k.
Your <span class="hljs-keyword">public</span> <span class="hljs-keyword">key</span> has been saved <span class="hljs-keyword">in</span> /usr/local/openssh/etc/ssh_host_ED25519_key.p.
The <span class="hljs-keyword">key</span> fingerprint <span class="hljs-keyword">is</span>:                                                         
SHA256:ju+goS7itu3p61c66xBSo2iku46pmom9zsIJj/YuBh0 root@bst                     
The <span class="hljs-keyword">key</span><span class="hljs-comment">'s randomart image is: </span>
+--[ED25519 <span class="hljs-number">256</span>]--+                                                             
|                 |                                                             
|                 |                                                             
| . o             |                                                             
|+ E .            |                                                             
|o= o    S        |                                                             
|+.o .  +         |                                                             
|=o... = .        |                                                             
|B<span class="hljs-preprocessor">#o.o* o | </span>
|^O/@=oo.o        |                                                             
+----[SHA256]-----+                                                             
[root@bst:/etc]<span class="hljs-preprocessor"># </span>
</code></pre>
<p>第二个错误直接更改用户组就OK</p>
<pre class="prettyprint"><code class=" hljs php">chown root:root /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">empty</span></code></pre>
</li>
</ul>
<h3 id="8-sshexchangeidentification-connection-closed-by-remote-host">8. ssh_exchange_identification: Connection closed by remote host</h3>
<ul>
<li>
<p>具体错误信息： <br /> 从PC客户端远程登录出现如下错误</p>
<pre class="prettyprint"><code class=" hljs avrasm">anzyelay@ubuntu:etc$ ssh root<span class="hljs-localvars">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.10</span><span class="hljs-number">.110</span> -v
OpenSSH_5<span class="hljs-number">.9</span>p1 Debian-<span class="hljs-number">5</span>ubuntu1<span class="hljs-number">.9</span>, OpenSSL <span class="hljs-number">1.0</span><span class="hljs-number">.1</span> <span class="hljs-number">14</span> Mar <span class="hljs-number">2012</span>
<span class="hljs-label">debug1:</span> Reading configuration data /etc/ssh/ssh_config
<span class="hljs-label">debug1:</span> /etc/ssh/ssh_config line <span class="hljs-number">19</span>: Applying options for *
<span class="hljs-label">debug1:</span> Connecting to <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.110</span> [<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.110</span>] port <span class="hljs-number">22.</span>
<span class="hljs-label">debug1:</span> Connection established.
<span class="hljs-label">debug1:</span> identity file /home/anzyelay/<span class="hljs-preprocessor">.ssh</span>/id_rsa type -<span class="hljs-number">1</span>
<span class="hljs-label">debug1:</span> identity file /home/anzyelay/<span class="hljs-preprocessor">.ssh</span>/id_rsa-cert type -<span class="hljs-number">1</span>
<span class="hljs-label">debug1:</span> identity file /home/anzyelay/<span class="hljs-preprocessor">.ssh</span>/id_dsa type -<span class="hljs-number">1</span>
<span class="hljs-label">debug1:</span> identity file /home/anzyelay/<span class="hljs-preprocessor">.ssh</span>/id_dsa-cert type -<span class="hljs-number">1</span>
<span class="hljs-label">debug1:</span> identity file /home/anzyelay/<span class="hljs-preprocessor">.ssh</span>/id_ecdsa type -<span class="hljs-number">1</span>
<span class="hljs-label">debug1:</span> identity file /home/anzyelay/<span class="hljs-preprocessor">.ssh</span>/id_ecdsa-cert type -<span class="hljs-number">1</span>
<span class="hljs-label">ssh_exchange_identification:</span> Connection closed by remote host
</code></pre>
</li>
<li>原因及解决方式： <br /> 身份交换验证时出错：查看远程服务器端的配置文件里指明的host_key位置处有没有相应的私钥，如果一个都没有就无法验证身份，所以通信关闭。制作一个私钥放到配置文件指定处就行。</li>
</ul>
<h3 id="9-sshpermission-denied-please-try-again">9. ssh:Permission denied, please try again.</h3>
<ul>
<li>
<p>具体错误信息： <br /> 执行ssh 用户名@IP。</p>
<pre class="prettyprint"><code class=" hljs oxygene">anzyelay@ubuntu:etc$ ssh root@<span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span> -v
...
debug1: Next authentication <span class="hljs-function"><span class="hljs-keyword">method</span>:</span> publickey
debug1: Trying <span class="hljs-keyword">private</span> key: /home/anzyelay/.ssh/id_rsa
debug1: Trying <span class="hljs-keyword">private</span> key: /home/anzyelay/.ssh/id_dsa
debug1: Trying <span class="hljs-keyword">private</span> key: /home/anzyelay/.ssh/id_ecdsa
debug1: Next authentication <span class="hljs-function"><span class="hljs-keyword">method</span>:</span> keyboard-interactive
debug1: Authentications that can <span class="hljs-keyword">continue</span>: publickey,password,keyboard-interactive
debug1: Next authentication <span class="hljs-function"><span class="hljs-keyword">method</span>:</span> password
root@<span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span><span class="hljs-string">'s password: debug1: Authentications that can continue: publickey,password,keyboard-interactive Permission denied, please try again. root@192.168.10.110'</span>s password: 
debug1: Authentications that can <span class="hljs-keyword">continue</span>: publickey,password,keyboard-interactive
Permission denied, please <span class="hljs-keyword">try</span> again.
root@<span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span><span class="hljs-string">'s password: debug1: Authentications that can continue: publickey,password,keyboard-interactive debug1: No more authentication methods to try. Permission denied (publickey,password,keyboard-interactive). </span></code></pre>
</li>
<li>
<p>原因及解决方式： <br /> 确认过开发板上root的密码是正确的，但就是Permission denied，改为空密码也不对，连接时加上-v 查看错误信息如上。那一般就是配置sshd_config不对了。如下将PermitRootLogin修改成YES：</p>
<pre class="prettyprint"><code class=" hljs coffeescript"> <span class="hljs-number">44</span> <span class="hljs-comment">#PermitRootLogin prohibit-password</span>
 <span class="hljs-number">45</span> PermitRootLogin <span class="hljs-literal">yes</span></code></pre>
<p>如果想不想输入密码，使能空密码就行。修改如下几个配置：</p>
<pre class="prettyprint"><code class=" hljs coffeescript"> <span class="hljs-number">45</span> PermitRootLogin <span class="hljs-literal">yes</span>

 <span class="hljs-number">72</span> <span class="hljs-comment"># To disable tunneled clear text passwords, change to no here!</span>
 <span class="hljs-number">73</span> PasswordAuthentication <span class="hljs-literal">yes</span>
 <span class="hljs-number">74</span> PermitEmptyPasswords <span class="hljs-literal">yes</span>
</code></pre>
</li>
</ul>
<h3 id="10-可以ssh远程用密码验证登录开发板但无法使用秘钥对验证登录">10. 可以SSH远程用密码验证登录开发板，但无法使用秘钥对验证登录。</h3>
<ul>
<li>
<p>具体错误信息：</p>
<pre class="prettyprint"><code class=" hljs oxygene">anzyelay@ubuntu:zlib$ ssh root@<span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span> -v
OpenSSH_7.<span class="hljs-number">2</span>p2, OpenSSL <span class="hljs-number">1.0</span>.<span class="hljs-number">1</span> <span class="hljs-number">14</span> Mar <span class="hljs-number">2012</span>
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: Connecting <span class="hljs-keyword">to</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span> [<span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span>] port <span class="hljs-number">22</span>.
debug1: Connection established.
debug1: identity file /home/anzyelay/.ssh/id_rsa <span class="hljs-keyword">type</span> <span class="hljs-number">1</span>
debug1: key_load_public: No such file <span class="hljs-keyword">or</span> directory
debug1: identity file /home/anzyelay/.ssh/id_rsa-cert <span class="hljs-keyword">type</span> -<span class="hljs-number">1</span>
debug1: identity file /home/anzyelay/.ssh/id_dsa <span class="hljs-keyword">type</span> <span class="hljs-number">2</span>
debug1: key_load_public: No such file <span class="hljs-keyword">or</span> directory
debug1: identity file /home/anzyelay/.ssh/id_dsa-cert <span class="hljs-keyword">type</span> -<span class="hljs-number">1</span>
debug1: identity file /home/anzyelay/.ssh/id_ecdsa <span class="hljs-keyword">type</span> <span class="hljs-number">3</span>
debug1: key_load_public: No such file <span class="hljs-keyword">or</span> directory
debug1: identity file /home/anzyelay/.ssh/id_ecdsa-cert <span class="hljs-keyword">type</span> -<span class="hljs-number">1</span>
debug1: identity file /home/anzyelay/.ssh/id_ed25519 <span class="hljs-keyword">type</span> <span class="hljs-number">4</span>
debug1: key_load_public: No such file <span class="hljs-keyword">or</span> directory
debug1: identity file /home/anzyelay/.ssh/id_ed25519-cert <span class="hljs-keyword">type</span> -<span class="hljs-number">1</span>
debug1: Enabling compatibility mode <span class="hljs-keyword">for</span> protocol <span class="hljs-number">2.0</span>
debug1: Local version string SSH-<span class="hljs-number">2.0</span>-OpenSSH_7.<span class="hljs-number">2</span>
debug1: Remote protocol version <span class="hljs-number">2.0</span>, remote software version OpenSSH_7.<span class="hljs-number">2</span>
debug1: match: OpenSSH_7.<span class="hljs-number">2</span> pat OpenSSH* compat <span class="hljs-number">0</span>x04000000
debug1: Authenticating <span class="hljs-keyword">to</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span>:<span class="hljs-number">22</span> <span class="hljs-keyword">as</span> <span class="hljs-string">'root'</span>
debug1: SSH2_MSG_KEXINIT sent
debug1: SSH2_MSG_KEXINIT received
debug1: kex: algorithm: curve25519-sha256@libssh.org
debug1: kex: host key algorithm: ecdsa-sha2-nistp256
debug1: kex: server-&gt;client cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none
debug1: kex: client-&gt;server cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none
debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
debug1: Server host key: ecdsa-sha2-nistp256 SHA256:<span class="hljs-number">4</span>QwH0ADqUb2zwenxAd/bV4xh6l9ESjIsMzrDcQOxeEw
debug1: Host <span class="hljs-string">'192.168.10.110'</span> <span class="hljs-keyword">is</span> known <span class="hljs-keyword">and</span> matches the ECDSA host key.
debug1: Found key <span class="hljs-keyword">in</span> /home/anzyelay/.ssh/known_hosts:<span class="hljs-number">1</span>
debug1: rekey after <span class="hljs-number">134217728</span> blocks
debug1: SSH2_MSG_NEWKEYS sent
debug1: expecting SSH2_MSG_NEWKEYS
debug1: rekey after <span class="hljs-number">134217728</span> blocks
debug1: SSH2_MSG_NEWKEYS received
debug1: Skipping ssh-dss key /home/anzyelay/.ssh/id_dsa - <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> PubkeyAcceptedKeyTypes
debug1: SSH2_MSG_EXT_INFO received
debug1: kex_input_ext_info: server-sig-algs=&lt;rsa-sha2-<span class="hljs-number">256</span>,rsa-sha2-<span class="hljs-number">512</span>&gt;
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug1: Authentications that can <span class="hljs-keyword">continue</span>: publickey,password
debug1: Next authentication <span class="hljs-function"><span class="hljs-keyword">method</span>:</span> publickey
debug1: Offering RSA <span class="hljs-keyword">public</span> key: /home/anzyelay/.ssh/id_rsa
debug1: Authentications that can <span class="hljs-keyword">continue</span>: publickey,password
debug1: Offering ECDSA <span class="hljs-keyword">public</span> key: /home/anzyelay/.ssh/id_ecdsa
debug1: Authentications that can <span class="hljs-keyword">continue</span>: publickey,password
debug1: Offering ED25519 <span class="hljs-keyword">public</span> key: /home/anzyelay/.ssh/id_ed25519
debug1: Authentications that can <span class="hljs-keyword">continue</span>: publickey,password
debug1: Next authentication <span class="hljs-function"><span class="hljs-keyword">method</span>:</span> password
root@<span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span><span class="hljs-string">'s password: </span></code></pre>
<p>上面如果输入密码是可以登录的，但先前尝试的public key却怎么都无法登录。我的sshd配置是正确的：</p>
<pre class="prettyprint"><code class=" hljs vala">
<span class="hljs-preprocessor"># Authentication:</span>


LoginGraceTime <span class="hljs-number">2</span>m
PermitRootLogin yes 
StrictModes yes
MaxAuthTries <span class="hljs-number">6</span>
MaxSessions <span class="hljs-number">10</span>

RSAAuthentication yes
PubkeyAuthentication yes


<span class="hljs-preprocessor"># The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2</span>


<span class="hljs-preprocessor"># but this is overridden so installations will only check .ssh/authorized_keys</span>


<span class="hljs-preprocessor">#AuthorizedKeysFile %h/.ssh/authorized_keys</span>

</code></pre>
</li>
<li>
<p>出现的几种不同原因及解决方法：</p>
<ol>
<li>
<p>原因是我的/root目录的拥有者是未知的如下：</p>
<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># ls -l</span>
total <span class="hljs-number">28</span>
drwxrwxr-x    <span class="hljs-number">2</span> <span class="hljs-number">1000</span>     root          <span class="hljs-number">4096</span> <span class="hljs-constant">May</span> <span class="hljs-number">25</span>  <span class="hljs-number">2016</span> bin
drwxrwxrwt    <span class="hljs-number">5</span> root     <span class="hljs-number">0</span>            <span class="hljs-number">13080</span> <span class="hljs-constant">Jun</span> <span class="hljs-number">17</span> 09<span class="hljs-symbol">:</span><span class="hljs-number">53</span> dev
drwxrwxr-x    <span class="hljs-number">5</span> <span class="hljs-number">1000</span>     root          <span class="hljs-number">4096</span> <span class="hljs-constant">Jun</span> <span class="hljs-number">17</span>  <span class="hljs-number">2016</span> etc
drwxrwxr-x    <span class="hljs-number">3</span> <span class="hljs-number">1000</span>     root          <span class="hljs-number">4096</span> <span class="hljs-constant">Jun</span> <span class="hljs-number">17</span>  <span class="hljs-number">2016</span> lib
lrwxrwxrwx    <span class="hljs-number">1</span> root     root            <span class="hljs-number">11</span> <span class="hljs-constant">May</span> <span class="hljs-number">20</span>  <span class="hljs-number">2016</span> linuxrc -&gt; bin/busybox
dr-xr-xr-x   <span class="hljs-number">39</span> root     <span class="hljs-number">0</span>                <span class="hljs-number">0</span> <span class="hljs-constant">Jan</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1970</span> proc
drwx------    <span class="hljs-number">3</span> <span class="hljs-number">1000</span>     root          <span class="hljs-number">4096</span> <span class="hljs-constant">Jun</span> <span class="hljs-number">15</span>  <span class="hljs-number">2016</span> root
drwxrwxr-x    <span class="hljs-number">2</span> <span class="hljs-number">1000</span>     root          <span class="hljs-number">4096</span> <span class="hljs-constant">May</span> <span class="hljs-number">20</span>  <span class="hljs-number">2016</span> sbin
drwxr-xr-x   <span class="hljs-number">12</span> root     <span class="hljs-number">0</span>                <span class="hljs-number">0</span> <span class="hljs-constant">Jun</span> <span class="hljs-number">17</span> 09<span class="hljs-symbol">:</span><span class="hljs-number">53</span> sys
drwxrwxrwt    <span class="hljs-number">2</span> root     <span class="hljs-number">0</span>               <span class="hljs-number">40</span> <span class="hljs-constant">Jun</span> <span class="hljs-number">17</span> 09<span class="hljs-symbol">:</span><span class="hljs-number">53</span> tmp
drwxrwxr-x    <span class="hljs-number">6</span> <span class="hljs-number">1000</span>     root          <span class="hljs-number">4096</span> <span class="hljs-constant">Jun</span> <span class="hljs-number">12</span>  <span class="hljs-number">2016</span> usr
drwxrwxr-x    <span class="hljs-number">3</span> <span class="hljs-number">1000</span>     root          <span class="hljs-number">4096</span> <span class="hljs-constant">Jun</span> <span class="hljs-number">13</span>  <span class="hljs-number">2016</span> var
[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># </span>
</code></pre>
<p>更改拥有者后OK。</p>
<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>]<span class="hljs-comment"># chown root:root root/</span></code></pre>
</li>
<li>在做本地回环测试时（<code>ssh localhost</code>）也出现上述问题，发现需要把<code>.ssh/id_rsa.pub</code>这个公钥添加到自己的认证列表后就应该删除它才行，否则总是无法登录。</li>
<li>
<p>认证的用户目录的上级目录拥有者出错，比如使用SSH登录git账户时，在git目录下有.ssh/authorized_keys,并且权限拥有者都是对的，也无法使用密钥登录。后来发现是 <strong>../</strong>这个目录的拥有者是anzye（如下），我试着改为git，就OK了，</p>
<pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">root@ubuntu:/home/git#</span> <span class="hljs-comment">ll</span>
<span class="hljs-comment">total</span> <span class="hljs-comment">44</span>
<span class="hljs-comment">drwxr</span><span class="hljs-literal">-</span><span class="hljs-comment">xr</span><span class="hljs-literal">-</span><span class="hljs-comment">x</span> <span class="hljs-comment">4</span> <span class="hljs-comment">git</span> <span class="hljs-comment">git</span> <span class="hljs-comment">4096</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">18:03</span> <span class="hljs-string">.</span><span class="hljs-comment">/</span>
<span class="hljs-comment">drwx</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">5</span> <span class="hljs-comment">anzye</span> <span class="hljs-comment">anzye</span> <span class="hljs-comment">4096</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">17:46</span> <span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-comment">/</span>
<span class="hljs-literal">-</span><span class="hljs-comment">rw</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">1</span> <span class="hljs-comment">git</span> <span class="hljs-comment">git</span>    <span class="hljs-comment">5</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">18:03</span> <span class="hljs-string">.</span><span class="hljs-comment">bash_history</span>
<span class="hljs-literal">-</span><span class="hljs-comment">rw</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">1</span> <span class="hljs-comment">git</span> <span class="hljs-comment">git</span>  <span class="hljs-comment">220</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">17:46</span> <span class="hljs-string">.</span><span class="hljs-comment">bash_logout</span>
<span class="hljs-literal">-</span><span class="hljs-comment">rw</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">1</span> <span class="hljs-comment">git</span> <span class="hljs-comment">git</span> <span class="hljs-comment">3486</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">17:46</span> <span class="hljs-string">.</span><span class="hljs-comment">bashrc</span>
<span class="hljs-literal">-</span><span class="hljs-comment">rw</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">1</span> <span class="hljs-comment">git</span> <span class="hljs-comment">git</span> <span class="hljs-comment">8445</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">17:46</span> <span class="hljs-comment">examples</span><span class="hljs-string">.</span><span class="hljs-comment">desktop</span>
<span class="hljs-literal">-</span><span class="hljs-comment">rw</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">1</span> <span class="hljs-comment">git</span> <span class="hljs-comment">git</span>  <span class="hljs-comment">675</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">17:46</span> <span class="hljs-string">.</span><span class="hljs-comment">profile</span>
<span class="hljs-comment">drwxrwxr</span><span class="hljs-literal">-</span><span class="hljs-comment">x</span> <span class="hljs-comment">7</span> <span class="hljs-comment">git</span> <span class="hljs-comment">git</span> <span class="hljs-comment">4096</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">17:57</span> <span class="hljs-comment">repo</span><span class="hljs-string">.</span><span class="hljs-comment">git/</span>
<span class="hljs-comment">drwxr</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">2</span> <span class="hljs-comment">git</span> <span class="hljs-comment">git</span> <span class="hljs-comment">4096</span> <span class="hljs-comment">Jun</span> <span class="hljs-comment">26</span> <span class="hljs-comment">18:03</span> <span class="hljs-string">.</span><span class="hljs-comment">ssh/</span></code></pre>
</li>
</ol>
<p>总结下使用密钥对登录验证的过程及要求：</p>
<ul>
<li>
<p>登录客户端身份验证的过程： <br /> 先说明下登录验证是在ssh客户端与服务端通信协议建立后并且服务端验证通过了才开始的（这阶段需要服务器有自己的私钥，通过sshd_config的HostKey指明，这个私钥之所以网上方法都是在PC端做好移动过来，是因为PC做的快，开发板制作太慢了，这网上一片大抄，只懂抄抄也不说明原因，搞的莫名其妙越说越乱居然变成公钥了！！）。它的连接阶段具体可参看我上面提供的连接博文， <br /> 而登录客户验证需要客户端将自己的公钥添加到服务端的authorized_keys文件列表里面（该文件位置在sshd_config中由AuthorizedKeysFile指明，否则默认为服务器的～/.ssh/下），客户端在提出登录请求后，服务端到authorized_keys寻找公钥并利用它加密认证信息发送回给客户端，客户端通过对应的私钥（该文件位置在ssh_config中由IdentityFile指定，默认在～/.ssh/下）解密后发回信息给服务器通过认证。</p>
</li>
<li>
<p>根据上述简要说明可知要求如下</p>
<ul>
<li>
<p>服务器端（开发板）sshd配置及文件权限要求，使能下面两选项，指定公钥列表文件</p>
<pre class="prettyprint"><code class=" hljs coffeescript">RSAAuthentication <span class="hljs-literal">yes</span>
PubkeyAuthentication <span class="hljs-literal">yes</span>

<span class="hljs-comment">#AuthorizedKeysFile %h/.ssh/authorized_keys</span>
</code></pre>
<p>此处注释是使用默认的家目录/.ssh/authorized_keys，你可以通过cat /etc/passwd查看当前用户的家目录比如： </p>
<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@bst</span><span class="hljs-symbol">:/</span>.ssh]<span class="hljs-comment"># cat /etc/passwd</span>
<span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/sh</span>
<span class="hljs-symbol">sshd:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:sshd</span> <span class="hljs-symbol">privsep:</span>/var/<span class="hljs-symbol">empty:</span>/bin/<span class="hljs-keyword">false</span>
</code></pre>
<p>我开发板的root的家目录是/root,如果没有请自己更改指明，重点要注意的是<strong>家目录的权限</strong>是700(其它地方测试只要限制写权限就行)及<strong>拥有者是自己</strong>，而authorized_keys的权限也要求是600，任何一处有问题都将导致无法验证，这个很好理解，客户端也是一样的，这样才使得安全性得以保证，任何一个用户只能使用自己的私钥和公钥列表而不会让其它用户登录。因此如果你想登录你开发板的其它用户（比如anzyelay）上而不是root，那么必须在/home/anzyelay/.ssh/的authorized_keys添加你的公钥。</p>
</li>
<li>
<p>配置好后，客户要登录服务器，必须在制作密钥对，指定私钥，添加公钥到服务器，默认私钥在～/.ssh/下(查看ssh_config)。</p>
<ol>
<li>ssh-keygen -t rsa/dsa/ecdsa/ed25519 <br /> 类型自己选一类就可，这样会在默认的～/.ssh/下出现一对密钥，如果你 -f指定了生成位置,则要将这生成的一对密钥（只私钥不行）全拷贝到～/.ssh/下</li>
<li>ssh-copy-id -i ～/.ssh/制作出来的公钥.pub usr@IP地址 <br /> 这样会自动将公钥加到开发板用户sshd服务默认的～/.ssh/authorized_keys里，这个需要能先使用密码验证. <br /> 也可手动拷贝添加:将公钥复制到开发板目录上，使用下面命令添加 ： <br /> 
<pre class="prettyprint"><code class=" hljs avrasm">touch ～/<span class="hljs-preprocessor">.ssh</span>/authorized_keys
cat **<span class="hljs-preprocessor">.pub</span> &gt;&gt; authorized_keys</code></pre>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="11host-key-verification-failed">11.Host key verification failed</h3>
<ul>
<li>
<p>具体错误信息：</p>
<pre class="prettyprint"><code class=" hljs mel"><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span>@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
<span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span><span class="hljs-variable">@@</span>@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-<span class="hljs-keyword">in</span>-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint <span class="hljs-keyword">for</span> the ED25519 key sent by the remote host is
SHA256:n0vBJ8X2zFGZAve8Aik1Yh+OGWPxVwEK+xg8R5RACbs.
Please contact your <span class="hljs-keyword">system</span> administrator.
Add correct host key <span class="hljs-keyword">in</span> /home/anzyelay/.ssh/known_hosts to get rid of this message.
Offending ECDSA key <span class="hljs-keyword">in</span> /home/anzyelay/.ssh/known_hosts:<span class="hljs-number">1</span>
ED25519 host key <span class="hljs-keyword">for</span> <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.110</span> has changed and you have requested strict checking.
Host key verification failed.
</code></pre>
</li>
<li>
<p>原因及解决方法： <br /> 服务端的host_key改变了，与客户端的known_hosts第一行记录的有差，删除记录后重登</p>
<pre class="prettyprint"><code class=" hljs ruby">anzyelay<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:openssh-</span><span class="hljs-number">7.2</span>p2<span class="hljs-variable">$ </span>ssh-keygen -<span class="hljs-constant">R</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">10.110</span>

<span class="hljs-comment"># Host 192.168.10.110 found: line 1</span>

/home/anzyelay/.ssh/known_hosts updated.
<span class="hljs-constant">Original</span> contents retained as /home/anzyelay/.ssh/known_hosts.old
anzyelay<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:openssh-</span><span class="hljs-number">7.2</span>p2<span class="hljs-variable">$ </span>
</code></pre>
</li>
</ul></div>
<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-526ced5128.css" rel="stylesheet">
</div>
]]></content:encoded>
										</item>
		<item>
		<title>Qt实战之开发软件数据获取助手</title>
		<link>https://uzzz.org/article/3266.html</link>
				<pubDate>Tue, 28 Jul 2015 02:09:15 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[qt]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/3266.html</guid>
				<description><![CDATA[前段时间，受朋友委托，需要做一个能够获取别人软件文本框中内容的助手。当然这需要调用win api来解决问题。一开始，我想都没想,就用getWindowText()。。。。居然没用，好郁闷。于是查msdn。。发现关于返回值,是这样写的 Return Values The length, in characters, of the copied string, not including the terminating null character, indicates success. Zero indicates that the window has no title bar or text, if the title bar is empty, or if the window or control handle is invalid. To get extended error information, call GetLastError. This function cannot retrieve the text of an edit control in another application. 原来是不能跨线程获取数据。。。。。。好吧。。那没办法。接着用SendMessage发送WM_GETTEXT。。。测试记事本是完全没有问题的。。。但是对那个软件却不起作用。。。。。于是各种百度。。无果。。好吧。。暂时搁一搁。。后来，同学在用vb弄文本框时发现了EM_GETLINECOUNT和 &#160;EM_GETLINE &#160;。至此，这个问题算是解决了。 啰嗦了那么多，进入主题吧。接下来，我们先实现这个助手。spy++这个大同小异。无非就是多了几个api的调用和线程处理问题。好了。先看下这个助手的最终效果图。。 按住那个放大镜后 &#160;鼠标的样式会自动改变 &#160;然后获取鼠标所在位置的窗口句柄。。选择模式 尝试获取数据。 &#160;如果有填写发送数据的目的地信息。。还可以直接发送数据。 好了。我们来重点说说以下几点 : 1） 获取窗口句柄 &#160; &#160; &#160;所用API函数为: &#160;HWNDWindowFromPoint( POINTPoint); &#160;只有获取句柄后我们才能调用SendMessage来获取信息 2）Qt修改鼠标样式 &#160;首先，要修改鼠标样式，我们就应该对存放图片的便签进行事件处理 鼠标按下，切换切换label背景图片。同时修改鼠标样式。。代码如下 bool MainWindow::eventFilter(QObject *obj, QEvent *event) { if (event-&#62;type() == QEvent::MouseButtonPress) { if (obj == ui-&#62;lab_MouseStyle) { QMouseEvent *mouseEvent = static_cast&#60;QMouseEvent*&#62;(event); if (mouseEvent-&#62;button() == Qt::LeftButton) { ui-&#62;lab_MouseStyle-&#62;setPixmap(QPixmap("://image/wait.png")); // 设置鼠标样式 QCursor cursor ; QPixmap pixmap("://image/searchMouse.png") ; cursor = QCursor(pixmap,-1,-1); setCursor(cursor) ; // 修改标志 m_IsMouseStyleChanged = true; // 开启计时器 300 毫秒刷新一次 m_pTimer-&#62;start(300); return true; } } } return QWidget::eventFilter(obj, event); } 其中lab_MouseStyle就是软件截图中，存放放大镜的label。。。 同时，当用户松开鼠标时。我们需要还原鼠标样式，并且切换label背景. &#160; 这个时候，就要对整个程序进行事件拦截了。而不是对label处理事件了。具体代码如下 bool MainWindow::event(QEvent *event) { if (event-&#62;type() == QEvent::MouseButtonRelease) { if (m_IsMouseStyleChanged == true) { // 当用户松开鼠标时, 恢复鼠标样式并且重新给鼠标样式标签设置图标 setCursor(Qt::ArrowCursor); ui-&#62;lab_MouseStyle-&#62;setPixmap(QPixmap("://image/searchMouse.png").scaled(QSize(48,48), Qt::KeepAspectRatio)); m_IsMouseStyleChanged = false; // 停止计时器 m_pTimer-&#62;stop(); return true; } }]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <!--一个博主专栏付费入口--><br />
 <!--一个博主专栏付费入口结束-->
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
<div class="htmledit_views" id="content_views">
<p><span></span>前段时间，受朋友委托，需要做一个能够获取别人软件文本框中内容的助手。当然这需要调用win api来解决问题。一开始，我想都没想,就用getWindowText()。。。。居然没用，好郁闷。于是查msdn。。发现关于返回值,是这样写的</p>
<p></p>
<p>Return Values</p>
</p>
<p>The length, in characters, of the copied string, not including the terminating null character, indicates success. Zero indicates that the window has no title bar or text, if the title bar is empty, or if the window or control handle is invalid. To get extended error information, call GetLastError. </p>
<p><span style="color:#ff6666;">This function cannot retrieve the text of an edit control in another application.</span></p>
<p>原来是不能跨线程获取数据。。。。。。好吧。。那没办法。接着用SendMessage发送WM_GETTEXT。。。测试记事本是完全没有问题的。。。但是对那个软件却不起作用。。。。。于是各种百度。。无果。。好吧。。暂时搁一搁。。后来，同学在用vb弄文本框时发现了<span style="color:#ff0000;">EM_GETLINECOUNT</span>和 &nbsp;<span style="color:#ff0000;">EM_GETLINE &nbsp;。</span>至此，这个问题算是解决了。</p>
<p></p>
<p><span></span>啰嗦了那么多，进入主题吧。接下来，我们先实现这个助手。spy++这个大同小异。无非就是多了几个api的调用和线程处理问题。好了。先看下这个助手的最终效果图。。</p>
<p><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728132805189?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p></p>
<p><img src="" alt=""><img src="" alt=""><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728132901723?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20150728133449764?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><img src="" alt=""></p>
<p>按住那个放大镜后 &nbsp;鼠标的样式会自动改变 &nbsp;然后获取鼠标所在位置的窗口句柄。。选择模式 尝试获取数据。 &nbsp;如果有填写发送数据的目的地信息。。还可以直接发送数据。</p>
<p></p>
<p><span></span>好了。我们来重点说说以下几点 :</p>
<p><span></span><span style="color:#ff0000;">1） 获取窗口句柄 &nbsp; &nbsp; &nbsp;</span>所用API函数为: &nbsp;<strong>HWND<span style="color:#ffcc33;">WindowFromPoint</span>( POINT</strong><em><a class="synParam" href="" rel="nofollow" data-token="24555ae4e427d16e7201ba72ab34cb09">Point</a></em><strong>); &nbsp;</strong>只有获取句柄后我们才能调用SendMessage来获取信息</p>
<p><span></span><span style="color:#ff0000;">2）Qt修改鼠标样式 </span> &nbsp;首先，要修改鼠标样式，我们就应该对存放图片的便签进行事件处理 鼠标按下，切换切换label背景图片。同时修改鼠标样式。。代码如下</p>
<p></p>
</p>
<pre><code class="language-cpp">bool MainWindow::eventFilter(QObject *obj, QEvent *event)
{
    if (event-&gt;type() == QEvent::MouseButtonPress) {

        if (obj == ui-&gt;lab_MouseStyle) {

            QMouseEvent *mouseEvent = static_cast&lt;QMouseEvent*&gt;(event);
            if (mouseEvent-&gt;button() == Qt::LeftButton) {
                ui-&gt;lab_MouseStyle-&gt;setPixmap(QPixmap("://image/wait.png"));
                // 设置鼠标样式

                QCursor cursor ;
                QPixmap pixmap("://image/searchMouse.png") ;
                cursor = QCursor(pixmap,-1,-1);
                setCursor(cursor) ;

                // 修改标志
                m_IsMouseStyleChanged = true;

                // 开启计时器 300 毫秒刷新一次
                m_pTimer-&gt;start(300);

                return true;
            }
        }
    }
    return QWidget::eventFilter(obj, event);
}</code></pre>
<p> 其中lab_MouseStyle就是软件截图中，存放放大镜的label。。。 </p>
<p><span style="color:#ff6600;">同时，当用户松开鼠标时。我们需要还原鼠标样式，并且切换label背景. </span>&nbsp; 这个时候，就要对整个程序进行事件拦截了。而不是对label处理事件了。具体代码如下</p>
</p>
<pre><code class="language-cpp">bool MainWindow::event(QEvent *event)
{
    if (event-&gt;type() == QEvent::MouseButtonRelease) {

        if (m_IsMouseStyleChanged == true) {

            // 当用户松开鼠标时, 恢复鼠标样式并且重新给鼠标样式标签设置图标
            setCursor(Qt::ArrowCursor);
            ui-&gt;lab_MouseStyle-&gt;setPixmap(QPixmap("://image/searchMouse.png").scaled(QSize(48,48), Qt::KeepAspectRatio));
            m_IsMouseStyleChanged = false;

            // 停止计时器
            m_pTimer-&gt;stop();
            return true;
        }
    }
    return QWidget::event(event);
}</code></pre>
<p> 计时器的做用时通知绘图 &nbsp;绘制窗口的黑色边框。。具体的可以看源码部分。。（绘图部分参考于网络，并非原创。。太久不用gdi了。。有点生疏哈） </p>
<p></p>
<p>&nbsp; &nbsp;<span style="color:#ff0000;">3） 通过句柄获取数据 &nbsp; 这里只是谈谈消息的使用 &nbsp; 同时有个新问题。怎么处理字符编码问题。。</span> 代码如下( &nbsp;部分 )</p>
<p></p>
</p>
<pre><code class="language-cpp">// 模式一 : 通过直接发送WM_GETTEXT
            TCHAR lpRes[20000] = L"";

            int len = ::SendMessage(m_DesHwnd,  WM_GETTEXT  , (WPARAM)10000, (LPARAM)lpRes);

            char str[40240] = "";

            int iLength = &lt;span style="color:#ff0000;"&gt;WideCharToMultiByte&lt;/span&gt;(CP_ACP, 0, lpRes, -1, NULL, 0, NULL, NULL);
            &lt;span style="color:#ff0000;"&gt;WideCharToMultiByte&lt;/span&gt;(CP_ACP, 0, lpRes, -1,str , iLength, NULL, NULL);

            ui-&gt;textEdit_Handle-&gt;setText(QString::fromAscii(str));</code></pre>
<p> 利用<br />
  <span style="color:#ff0000;">WideCharToMultiByte</span>函数再结合<br />
  <span style="color:#ff0000;">QString::fromAscii</span>我们可以很轻松的转换编码。。。 那么问题来了？ QString又该怎么便捷的转换为TCHAR呢？？&nbsp; </p>
<p></p>
</p>
<pre><code class="language-cpp">// 此函数实现通过句柄获取富文本数据
QString MainWindow::getDataFromHwnd(HWND hWnd)
{
    // 先获取总行数  然后读取数据
    int lineCount= ::SendMessage(hWnd, EM_GETLINECOUNT, 0, 0);

    if (lineCount &gt;0) {

        TCHAR strRes[102400] = L""; // 使用宽字符

        int  count = 0; // 用来记录总共获取了多少字符

        for (int i = 0; i&lt; lineCount;++i) {

            TCHAR szBuffer[200] = L"";
            ((WORD*) szBuffer)[0] = 200;

            int len = ::SendMessage(hWnd,  EM_GETLINE  ,(WPARAM)i, (LPARAM)szBuffer);

            ((WORD*) szBuffer)[len] = '\0';

            for  (int j= 0; j&lt; len;++j)
                strRes[count++] = szBuffer[j];
            strRes[count++] = '\n';
        }

        // 将宽字符转换为ASCII码字符
        char str[30240] = "";
        int iLength = WideCharToMultiByte(CP_ACP, 0, strRes, -1, NULL, 0, NULL, NULL);
        WideCharToMultiByte(CP_ACP, 0, strRes, -1,str , iLength, NULL, NULL);
        return QString::fromAscii(str);
    }
    return QString("");
}</code></pre>
<p> 这个主要是针对文本框的处理！思路很简单： 先获取文本框中的行数，然后循环获取每一行数据。。不过此代码中没有采用动态开辟数组。。这个如有需要，自行修改。 </p>
<p></p>
<p>&nbsp; <span style="color:#ff0000;">4）到此基本的就实现了。我们讲讲题外话。。怎么实现开机启动的功能。 &nbsp;&nbsp;</span>代码如下</p>
</p>
<pre><code class="language-cpp"> //设置为开机启动
    static void AutoRunWithSystem(bool IsAutoRun) {
        QSettings *reg = new QSettings(
                    "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run",
                    QSettings::NativeFormat);
        QString AppPath = QApplication::applicationFilePath();
        QString AppName = QApplication::applicationName();
        if (IsAutoRun) {
            reg-&gt;setValue(AppName, AppPath.replace("/","\\"));
        } else {
            reg-&gt;setValue(AppName, "");
        }
    }</code></pre>
</p>
<p></p>
<p>此代码并非原创。参考与游龙大神的代码。有修改。源代码测试有问题。问题出在windows系统注册表的‘\’符号问题。。必须先修改相应的符号。。</p>
<p></p>
<p>好了。最后附上已打包的软件和源码。。。仅供学习与交流。，不用于商业用途。 有不足之处，欢迎指出。谢谢。</p>
<p></p>
<p><span style="color:#ff6666;">可执行文件下载地址:&nbsp;http://download.csdn.net/detail/wu5151/8939661</span></p>
<p><span style="color:#ff6666;"><br /></span></p>
<p><span style="color:#ff6666;">源码文件下载地址: &nbsp;&nbsp;http://download.csdn.net/detail/wu5151/8939673</span></p>
<p><span style="color:#ff6666;"><br /></span></p>
<p><span style="color:#ff6666;">本博客地址:&nbsp;http://blog.csdn.net/wu5151</span></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p><span style="color:#ff0000;"><br /></span></p>
<p><span></span></p>
<p></p>
<p><span style="color:#ff6666;"><br /></span></p>
<p> 
 </div>
</div>
]]></content:encoded>
										</item>
	</channel>
</rss>
